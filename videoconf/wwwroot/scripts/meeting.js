(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController
// We don't actually ever use the API being polyfilled, we always use the polyfill because
// it's a very new API right now.
// Not exported from index.
/** @private */
var AbortController = /** @class */ (function () {
    function AbortController() {
        this.isAborted = false;
        this.onabort = null;
    }
    AbortController.prototype.abort = function () {
        if (!this.isAborted) {
            this.isAborted = true;
            if (this.onabort) {
                this.onabort();
            }
        }
    };
    Object.defineProperty(AbortController.prototype, "signal", {
        get: function () {
            return this;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AbortController.prototype, "aborted", {
        get: function () {
            return this.isAborted;
        },
        enumerable: true,
        configurable: true
    });
    return AbortController;
}());
exports.AbortController = AbortController;
//# sourceMappingURL=AbortController.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\AbortController.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],2:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Errors_1 = require("./Errors");
var FetchHttpClient_1 = require("./FetchHttpClient");
var HttpClient_1 = require("./HttpClient");
var Utils_1 = require("./Utils");
var XhrHttpClient_1 = require("./XhrHttpClient");
/** Default implementation of {@link @microsoft/signalr.HttpClient}. */
var DefaultHttpClient = /** @class */ (function (_super) {
    __extends(DefaultHttpClient, _super);
    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */
    function DefaultHttpClient(logger) {
        var _this = _super.call(this) || this;
        if (typeof fetch !== "undefined" || Utils_1.Platform.isNode) {
            _this.httpClient = new FetchHttpClient_1.FetchHttpClient(logger);
        }
        else if (typeof XMLHttpRequest !== "undefined") {
            _this.httpClient = new XhrHttpClient_1.XhrHttpClient(logger);
        }
        else {
            throw new Error("No usable HttpClient found.");
        }
        return _this;
    }
    /** @inheritDoc */
    DefaultHttpClient.prototype.send = function (request) {
        // Check that abort was not signaled before calling send
        if (request.abortSignal && request.abortSignal.aborted) {
            return Promise.reject(new Errors_1.AbortError());
        }
        if (!request.method) {
            return Promise.reject(new Error("No method defined."));
        }
        if (!request.url) {
            return Promise.reject(new Error("No url defined."));
        }
        return this.httpClient.send(request);
    };
    DefaultHttpClient.prototype.getCookieString = function (url) {
        return this.httpClient.getCookieString(url);
    };
    return DefaultHttpClient;
}(HttpClient_1.HttpClient));
exports.DefaultHttpClient = DefaultHttpClient;
//# sourceMappingURL=DefaultHttpClient.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\DefaultHttpClient.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./Errors":4,"./FetchHttpClient":5,"./HttpClient":7,"./Utils":20,"./XhrHttpClient":22,"buffer":25,"e/U+97":27}],3:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
// 0, 2, 10, 30 second delays before reconnect attempts.
var DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];
/** @private */
var DefaultReconnectPolicy = /** @class */ (function () {
    function DefaultReconnectPolicy(retryDelays) {
        this.retryDelays = retryDelays !== undefined ? retryDelays.concat([null]) : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;
    }
    DefaultReconnectPolicy.prototype.nextRetryDelayInMilliseconds = function (retryContext) {
        return this.retryDelays[retryContext.previousRetryCount];
    };
    return DefaultReconnectPolicy;
}());
exports.DefaultReconnectPolicy = DefaultReconnectPolicy;
//# sourceMappingURL=DefaultReconnectPolicy.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\DefaultReconnectPolicy.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],4:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
/** Error thrown when an HTTP request fails. */
var HttpError = /** @class */ (function (_super) {
    __extends(HttpError, _super);
    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.
     *
     * @param {string} errorMessage A descriptive error message.
     * @param {number} statusCode The HTTP status code represented by this error.
     */
    function HttpError(errorMessage, statusCode) {
        var _newTarget = this.constructor;
        var _this = this;
        var trueProto = _newTarget.prototype;
        _this = _super.call(this, errorMessage) || this;
        _this.statusCode = statusCode;
        // Workaround issue in Typescript compiler
        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200
        _this.__proto__ = trueProto;
        return _this;
    }
    return HttpError;
}(Error));
exports.HttpError = HttpError;
/** Error thrown when a timeout elapses. */
var TimeoutError = /** @class */ (function (_super) {
    __extends(TimeoutError, _super);
    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.
     *
     * @param {string} errorMessage A descriptive error message.
     */
    function TimeoutError(errorMessage) {
        var _newTarget = this.constructor;
        if (errorMessage === void 0) { errorMessage = "A timeout occurred."; }
        var _this = this;
        var trueProto = _newTarget.prototype;
        _this = _super.call(this, errorMessage) || this;
        // Workaround issue in Typescript compiler
        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200
        _this.__proto__ = trueProto;
        return _this;
    }
    return TimeoutError;
}(Error));
exports.TimeoutError = TimeoutError;
/** Error thrown when an action is aborted. */
var AbortError = /** @class */ (function (_super) {
    __extends(AbortError, _super);
    /** Constructs a new instance of {@link AbortError}.
     *
     * @param {string} errorMessage A descriptive error message.
     */
    function AbortError(errorMessage) {
        var _newTarget = this.constructor;
        if (errorMessage === void 0) { errorMessage = "An abort occurred."; }
        var _this = this;
        var trueProto = _newTarget.prototype;
        _this = _super.call(this, errorMessage) || this;
        // Workaround issue in Typescript compiler
        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200
        _this.__proto__ = trueProto;
        return _this;
    }
    return AbortError;
}(Error));
exports.AbortError = AbortError;
//# sourceMappingURL=Errors.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\Errors.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],5:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var Errors_1 = require("./Errors");
var HttpClient_1 = require("./HttpClient");
var ILogger_1 = require("./ILogger");
var Utils_1 = require("./Utils");
var FetchHttpClient = /** @class */ (function (_super) {
    __extends(FetchHttpClient, _super);
    function FetchHttpClient(logger) {
        var _this = _super.call(this) || this;
        _this.logger = logger;
        if (typeof fetch === "undefined") {
            // In order to ignore the dynamic require in webpack builds we need to do this magic
            // @ts-ignore: TS doesn't know about these names
            var requireFunc = typeof __webpack_require__ === "function" ? __non_webpack_require__ : require;
            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests
            _this.jar = new (requireFunc("tough-cookie")).CookieJar();
            _this.fetchType = requireFunc("node-fetch");
            // node-fetch doesn't have a nice API for getting and setting cookies
            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one
            _this.fetchType = requireFunc("fetch-cookie")(_this.fetchType, _this.jar);
            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide
            _this.abortControllerType = requireFunc("abort-controller");
        }
        else {
            _this.fetchType = fetch.bind(self);
            _this.abortControllerType = AbortController;
        }
        return _this;
    }
    /** @inheritDoc */
    FetchHttpClient.prototype.send = function (request) {
        return __awaiter(this, void 0, void 0, function () {
            var abortController, error, timeoutId, msTimeout, response, e_1, content, payload;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // Check that abort was not signaled before calling send
                        if (request.abortSignal && request.abortSignal.aborted) {
                            throw new Errors_1.AbortError();
                        }
                        if (!request.method) {
                            throw new Error("No method defined.");
                        }
                        if (!request.url) {
                            throw new Error("No url defined.");
                        }
                        abortController = new this.abortControllerType();
                        // Hook our abortSignal into the abort controller
                        if (request.abortSignal) {
                            request.abortSignal.onabort = function () {
                                abortController.abort();
                                error = new Errors_1.AbortError();
                            };
                        }
                        timeoutId = null;
                        if (request.timeout) {
                            msTimeout = request.timeout;
                            timeoutId = setTimeout(function () {
                                abortController.abort();
                                _this.logger.log(ILogger_1.LogLevel.Warning, "Timeout from HTTP request.");
                                error = new Errors_1.TimeoutError();
                            }, msTimeout);
                        }
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, 4, 5]);
                        return [4 /*yield*/, this.fetchType(request.url, {
                                body: request.content,
                                cache: "no-cache",
                                credentials: request.withCredentials === true ? "include" : "same-origin",
                                headers: __assign({ "Content-Type": "text/plain;charset=UTF-8", "X-Requested-With": "XMLHttpRequest" }, request.headers),
                                method: request.method,
                                mode: "cors",
                                redirect: "manual",
                                signal: abortController.signal,
                            })];
                    case 2:
                        response = _a.sent();
                        return [3 /*break*/, 5];
                    case 3:
                        e_1 = _a.sent();
                        if (error) {
                            throw error;
                        }
                        this.logger.log(ILogger_1.LogLevel.Warning, "Error from HTTP request. " + e_1 + ".");
                        throw e_1;
                    case 4:
                        if (timeoutId) {
                            clearTimeout(timeoutId);
                        }
                        if (request.abortSignal) {
                            request.abortSignal.onabort = null;
                        }
                        return [7 /*endfinally*/];
                    case 5:
                        if (!response.ok) {
                            throw new Errors_1.HttpError(response.statusText, response.status);
                        }
                        content = deserializeContent(response, request.responseType);
                        return [4 /*yield*/, content];
                    case 6:
                        payload = _a.sent();
                        return [2 /*return*/, new HttpClient_1.HttpResponse(response.status, response.statusText, payload)];
                }
            });
        });
    };
    FetchHttpClient.prototype.getCookieString = function (url) {
        var cookies = "";
        if (Utils_1.Platform.isNode && this.jar) {
            // @ts-ignore: unused variable
            this.jar.getCookies(url, function (e, c) { return cookies = c.join("; "); });
        }
        return cookies;
    };
    return FetchHttpClient;
}(HttpClient_1.HttpClient));
exports.FetchHttpClient = FetchHttpClient;
function deserializeContent(response, responseType) {
    var content;
    switch (responseType) {
        case "arraybuffer":
            content = response.arrayBuffer();
            break;
        case "text":
            content = response.text();
            break;
        case "blob":
        case "document":
        case "json":
            throw new Error(responseType + " is not supported.");
        default:
            content = response.text();
            break;
    }
    return content;
}
//# sourceMappingURL=FetchHttpClient.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\FetchHttpClient.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./Errors":4,"./HttpClient":7,"./ILogger":12,"./Utils":20,"buffer":25,"e/U+97":27}],6:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
var TextMessageFormat_1 = require("./TextMessageFormat");
var Utils_1 = require("./Utils");
/** @private */
var HandshakeProtocol = /** @class */ (function () {
    function HandshakeProtocol() {
    }
    // Handshake request is always JSON
    HandshakeProtocol.prototype.writeHandshakeRequest = function (handshakeRequest) {
        return TextMessageFormat_1.TextMessageFormat.write(JSON.stringify(handshakeRequest));
    };
    HandshakeProtocol.prototype.parseHandshakeResponse = function (data) {
        var responseMessage;
        var messageData;
        var remainingData;
        if (Utils_1.isArrayBuffer(data) || (typeof Buffer !== "undefined" && data instanceof Buffer)) {
            // Format is binary but still need to read JSON text from handshake response
            var binaryData = new Uint8Array(data);
            var separatorIndex = binaryData.indexOf(TextMessageFormat_1.TextMessageFormat.RecordSeparatorCode);
            if (separatorIndex === -1) {
                throw new Error("Message is incomplete.");
            }
            // content before separator is handshake response
            // optional content after is additional messages
            var responseLength = separatorIndex + 1;
            messageData = String.fromCharCode.apply(null, binaryData.slice(0, responseLength));
            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;
        }
        else {
            var textData = data;
            var separatorIndex = textData.indexOf(TextMessageFormat_1.TextMessageFormat.RecordSeparator);
            if (separatorIndex === -1) {
                throw new Error("Message is incomplete.");
            }
            // content before separator is handshake response
            // optional content after is additional messages
            var responseLength = separatorIndex + 1;
            messageData = textData.substring(0, responseLength);
            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;
        }
        // At this point we should have just the single handshake message
        var messages = TextMessageFormat_1.TextMessageFormat.parse(messageData);
        var response = JSON.parse(messages[0]);
        if (response.type) {
            throw new Error("Expected a handshake response from the server.");
        }
        responseMessage = response;
        // multiple messages could have arrived with handshake
        // return additional data to be parsed as usual, or null if all parsed
        return [remainingData, responseMessage];
    };
    return HandshakeProtocol;
}());
exports.HandshakeProtocol = HandshakeProtocol;
//# sourceMappingURL=HandshakeProtocol.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\HandshakeProtocol.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./TextMessageFormat":19,"./Utils":20,"buffer":25,"e/U+97":27}],7:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
/** Represents an HTTP response. */
var HttpResponse = /** @class */ (function () {
    function HttpResponse(statusCode, statusText, content) {
        this.statusCode = statusCode;
        this.statusText = statusText;
        this.content = content;
    }
    return HttpResponse;
}());
exports.HttpResponse = HttpResponse;
/** Abstraction over an HTTP client.
 *
 * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.
 */
var HttpClient = /** @class */ (function () {
    function HttpClient() {
    }
    HttpClient.prototype.get = function (url, options) {
        return this.send(__assign({}, options, { method: "GET", url: url }));
    };
    HttpClient.prototype.post = function (url, options) {
        return this.send(__assign({}, options, { method: "POST", url: url }));
    };
    HttpClient.prototype.delete = function (url, options) {
        return this.send(__assign({}, options, { method: "DELETE", url: url }));
    };
    /** Gets all cookies that apply to the specified URL.
     *
     * @param url The URL that the cookies are valid for.
     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.
     */
    // @ts-ignore
    HttpClient.prototype.getCookieString = function (url) {
        return "";
    };
    return HttpClient;
}());
exports.HttpClient = HttpClient;
//# sourceMappingURL=HttpClient.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\HttpClient.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],8:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var DefaultHttpClient_1 = require("./DefaultHttpClient");
var ILogger_1 = require("./ILogger");
var ITransport_1 = require("./ITransport");
var LongPollingTransport_1 = require("./LongPollingTransport");
var ServerSentEventsTransport_1 = require("./ServerSentEventsTransport");
var Utils_1 = require("./Utils");
var WebSocketTransport_1 = require("./WebSocketTransport");
var MAX_REDIRECTS = 100;
/** @private */
var HttpConnection = /** @class */ (function () {
    function HttpConnection(url, options) {
        if (options === void 0) { options = {}; }
        this.features = {};
        this.negotiateVersion = 1;
        Utils_1.Arg.isRequired(url, "url");
        this.logger = Utils_1.createLogger(options.logger);
        this.baseUrl = this.resolveUrl(url);
        options = options || {};
        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;
        if (typeof options.withCredentials === "boolean" || options.withCredentials === undefined) {
            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;
        }
        else {
            throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");
        }
        var webSocketModule = null;
        var eventSourceModule = null;
        if (Utils_1.Platform.isNode && typeof require !== "undefined") {
            // In order to ignore the dynamic require in webpack builds we need to do this magic
            // @ts-ignore: TS doesn't know about these names
            var requireFunc = typeof __webpack_require__ === "function" ? __non_webpack_require__ : require;
            webSocketModule = requireFunc("ws");
            eventSourceModule = requireFunc("eventsource");
        }
        if (!Utils_1.Platform.isNode && typeof WebSocket !== "undefined" && !options.WebSocket) {
            options.WebSocket = WebSocket;
        }
        else if (Utils_1.Platform.isNode && !options.WebSocket) {
            if (webSocketModule) {
                options.WebSocket = webSocketModule;
            }
        }
        if (!Utils_1.Platform.isNode && typeof EventSource !== "undefined" && !options.EventSource) {
            options.EventSource = EventSource;
        }
        else if (Utils_1.Platform.isNode && !options.EventSource) {
            if (typeof eventSourceModule !== "undefined") {
                options.EventSource = eventSourceModule;
            }
        }
        this.httpClient = options.httpClient || new DefaultHttpClient_1.DefaultHttpClient(this.logger);
        this.connectionState = "Disconnected" /* Disconnected */;
        this.connectionStarted = false;
        this.options = options;
        this.onreceive = null;
        this.onclose = null;
    }
    HttpConnection.prototype.start = function (transferFormat) {
        return __awaiter(this, void 0, void 0, function () {
            var message, message;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        transferFormat = transferFormat || ITransport_1.TransferFormat.Binary;
                        Utils_1.Arg.isIn(transferFormat, ITransport_1.TransferFormat, "transferFormat");
                        this.logger.log(ILogger_1.LogLevel.Debug, "Starting connection with transfer format '" + ITransport_1.TransferFormat[transferFormat] + "'.");
                        if (this.connectionState !== "Disconnected" /* Disconnected */) {
                            return [2 /*return*/, Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."))];
                        }
                        this.connectionState = "Connecting" /* Connecting */;
                        this.startInternalPromise = this.startInternal(transferFormat);
                        return [4 /*yield*/, this.startInternalPromise];
                    case 1:
                        _a.sent();
                        if (!(this.connectionState === "Disconnecting" /* Disconnecting */)) return [3 /*break*/, 3];
                        message = "Failed to start the HttpConnection before stop() was called.";
                        this.logger.log(ILogger_1.LogLevel.Error, message);
                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.
                        return [4 /*yield*/, this.stopPromise];
                    case 2:
                        // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.
                        _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(message))];
                    case 3:
                        if (this.connectionState !== "Connected" /* Connected */) {
                            message = "HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";
                            this.logger.log(ILogger_1.LogLevel.Error, message);
                            return [2 /*return*/, Promise.reject(new Error(message))];
                        }
                        _a.label = 4;
                    case 4:
                        this.connectionStarted = true;
                        return [2 /*return*/];
                }
            });
        });
    };
    HttpConnection.prototype.send = function (data) {
        if (this.connectionState !== "Connected" /* Connected */) {
            return Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State."));
        }
        if (!this.sendQueue) {
            this.sendQueue = new TransportSendQueue(this.transport);
        }
        // Transport will not be null if state is connected
        return this.sendQueue.send(data);
    };
    HttpConnection.prototype.stop = function (error) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (this.connectionState === "Disconnected" /* Disconnected */) {
                            this.logger.log(ILogger_1.LogLevel.Debug, "Call to HttpConnection.stop(" + error + ") ignored because the connection is already in the disconnected state.");
                            return [2 /*return*/, Promise.resolve()];
                        }
                        if (this.connectionState === "Disconnecting" /* Disconnecting */) {
                            this.logger.log(ILogger_1.LogLevel.Debug, "Call to HttpConnection.stop(" + error + ") ignored because the connection is already in the disconnecting state.");
                            return [2 /*return*/, this.stopPromise];
                        }
                        this.connectionState = "Disconnecting" /* Disconnecting */;
                        this.stopPromise = new Promise(function (resolve) {
                            // Don't complete stop() until stopConnection() completes.
                            _this.stopPromiseResolver = resolve;
                        });
                        // stopInternal should never throw so just observe it.
                        return [4 /*yield*/, this.stopInternal(error)];
                    case 1:
                        // stopInternal should never throw so just observe it.
                        _a.sent();
                        return [4 /*yield*/, this.stopPromise];
                    case 2:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    HttpConnection.prototype.stopInternal = function (error) {
        return __awaiter(this, void 0, void 0, function () {
            var e_1, e_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // Set error as soon as possible otherwise there is a race between
                        // the transport closing and providing an error and the error from a close message
                        // We would prefer the close message error.
                        this.stopError = error;
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.startInternalPromise];
                    case 2:
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        e_1 = _a.sent();
                        return [3 /*break*/, 4];
                    case 4:
                        if (!this.transport) return [3 /*break*/, 9];
                        _a.label = 5;
                    case 5:
                        _a.trys.push([5, 7, , 8]);
                        return [4 /*yield*/, this.transport.stop()];
                    case 6:
                        _a.sent();
                        return [3 /*break*/, 8];
                    case 7:
                        e_2 = _a.sent();
                        this.logger.log(ILogger_1.LogLevel.Error, "HttpConnection.transport.stop() threw error '" + e_2 + "'.");
                        this.stopConnection();
                        return [3 /*break*/, 8];
                    case 8:
                        this.transport = undefined;
                        return [3 /*break*/, 10];
                    case 9:
                        this.logger.log(ILogger_1.LogLevel.Debug, "HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.");
                        this.stopConnection();
                        _a.label = 10;
                    case 10: return [2 /*return*/];
                }
            });
        });
    };
    HttpConnection.prototype.startInternal = function (transferFormat) {
        return __awaiter(this, void 0, void 0, function () {
            var url, negotiateResponse, redirects, _loop_1, this_1, e_3;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        url = this.baseUrl;
                        this.accessTokenFactory = this.options.accessTokenFactory;
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 12, , 13]);
                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];
                        if (!(this.options.transport === ITransport_1.HttpTransportType.WebSockets)) return [3 /*break*/, 3];
                        // No need to add a connection ID in this case
                        this.transport = this.constructTransport(ITransport_1.HttpTransportType.WebSockets);
                        // We should just call connect directly in this case.
                        // No fallback or negotiate in this case.
                        return [4 /*yield*/, this.startTransport(url, transferFormat)];
                    case 2:
                        // We should just call connect directly in this case.
                        // No fallback or negotiate in this case.
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 3: throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");
                    case 4: return [3 /*break*/, 11];
                    case 5:
                        negotiateResponse = null;
                        redirects = 0;
                        _loop_1 = function () {
                            var accessToken_1;
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];
                                    case 1:
                                        negotiateResponse = _a.sent();
                                        // the user tries to stop the connection when it is being started
                                        if (this_1.connectionState === "Disconnecting" /* Disconnecting */ || this_1.connectionState === "Disconnected" /* Disconnected */) {
                                            throw new Error("The connection was stopped during negotiation.");
                                        }
                                        if (negotiateResponse.error) {
                                            throw new Error(negotiateResponse.error);
                                        }
                                        if (negotiateResponse.ProtocolVersion) {
                                            throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");
                                        }
                                        if (negotiateResponse.url) {
                                            url = negotiateResponse.url;
                                        }
                                        if (negotiateResponse.accessToken) {
                                            accessToken_1 = negotiateResponse.accessToken;
                                            this_1.accessTokenFactory = function () { return accessToken_1; };
                                        }
                                        redirects++;
                                        return [2 /*return*/];
                                }
                            });
                        };
                        this_1 = this;
                        _a.label = 6;
                    case 6: return [5 /*yield**/, _loop_1()];
                    case 7:
                        _a.sent();
                        _a.label = 8;
                    case 8:
                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];
                        _a.label = 9;
                    case 9:
                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {
                            throw new Error("Negotiate redirection limit exceeded.");
                        }
                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];
                    case 10:
                        _a.sent();
                        _a.label = 11;
                    case 11:
                        if (this.transport instanceof LongPollingTransport_1.LongPollingTransport) {
                            this.features.inherentKeepAlive = true;
                        }
                        if (this.connectionState === "Connecting" /* Connecting */) {
                            // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.
                            // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.
                            this.logger.log(ILogger_1.LogLevel.Debug, "The HttpConnection connected successfully.");
                            this.connectionState = "Connected" /* Connected */;
                        }
                        return [3 /*break*/, 13];
                    case 12:
                        e_3 = _a.sent();
                        this.logger.log(ILogger_1.LogLevel.Error, "Failed to start the connection: " + e_3);
                        this.connectionState = "Disconnected" /* Disconnected */;
                        this.transport = undefined;
                        return [2 /*return*/, Promise.reject(e_3)];
                    case 13: return [2 /*return*/];
                }
            });
        });
    };
    HttpConnection.prototype.getNegotiationResponse = function (url) {
        return __awaiter(this, void 0, void 0, function () {
            var headers, token, _a, name, value, negotiateUrl, response, negotiateResponse, e_4;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        headers = {};
                        if (!this.accessTokenFactory) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.accessTokenFactory()];
                    case 1:
                        token = _b.sent();
                        if (token) {
                            headers["Authorization"] = "Bearer " + token;
                        }
                        _b.label = 2;
                    case 2:
                        _a = Utils_1.getUserAgentHeader(), name = _a[0], value = _a[1];
                        headers[name] = value;
                        negotiateUrl = this.resolveNegotiateUrl(url);
                        this.logger.log(ILogger_1.LogLevel.Debug, "Sending negotiation request: " + negotiateUrl + ".");
                        _b.label = 3;
                    case 3:
                        _b.trys.push([3, 5, , 6]);
                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {
                                content: "",
                                headers: __assign({}, headers, this.options.headers),
                                withCredentials: this.options.withCredentials,
                            })];
                    case 4:
                        response = _b.sent();
                        if (response.statusCode !== 200) {
                            return [2 /*return*/, Promise.reject(new Error("Unexpected status code returned from negotiate '" + response.statusCode + "'"))];
                        }
                        negotiateResponse = JSON.parse(response.content);
                        if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {
                            // Negotiate version 0 doesn't use connectionToken
                            // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version
                            negotiateResponse.connectionToken = negotiateResponse.connectionId;
                        }
                        return [2 /*return*/, negotiateResponse];
                    case 5:
                        e_4 = _b.sent();
                        this.logger.log(ILogger_1.LogLevel.Error, "Failed to complete negotiation with the server: " + e_4);
                        return [2 /*return*/, Promise.reject(e_4)];
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    HttpConnection.prototype.createConnectUrl = function (url, connectionToken) {
        if (!connectionToken) {
            return url;
        }
        return url + (url.indexOf("?") === -1 ? "?" : "&") + ("id=" + connectionToken);
    };
    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {
        return __awaiter(this, void 0, void 0, function () {
            var connectUrl, transportExceptions, transports, negotiate, _i, transports_1, endpoint, transportOrError, ex_1, ex_2, message;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionToken);
                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];
                        this.logger.log(ILogger_1.LogLevel.Debug, "Connection was provided an instance of ITransport, using that directly.");
                        this.transport = requestedTransport;
                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];
                    case 1:
                        _a.sent();
                        this.connectionId = negotiateResponse.connectionId;
                        return [2 /*return*/];
                    case 2:
                        transportExceptions = [];
                        transports = negotiateResponse.availableTransports || [];
                        negotiate = negotiateResponse;
                        _i = 0, transports_1 = transports;
                        _a.label = 3;
                    case 3:
                        if (!(_i < transports_1.length)) return [3 /*break*/, 13];
                        endpoint = transports_1[_i];
                        transportOrError = this.resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat);
                        if (!(transportOrError instanceof Error)) return [3 /*break*/, 4];
                        // Store the error and continue, we don't want to cause a re-negotiate in these cases
                        transportExceptions.push(endpoint.transport + " failed: " + transportOrError);
                        return [3 /*break*/, 12];
                    case 4:
                        if (!this.isITransport(transportOrError)) return [3 /*break*/, 12];
                        this.transport = transportOrError;
                        if (!!negotiate) return [3 /*break*/, 9];
                        _a.label = 5;
                    case 5:
                        _a.trys.push([5, 7, , 8]);
                        return [4 /*yield*/, this.getNegotiationResponse(url)];
                    case 6:
                        negotiate = _a.sent();
                        return [3 /*break*/, 8];
                    case 7:
                        ex_1 = _a.sent();
                        return [2 /*return*/, Promise.reject(ex_1)];
                    case 8:
                        connectUrl = this.createConnectUrl(url, negotiate.connectionToken);
                        _a.label = 9;
                    case 9:
                        _a.trys.push([9, 11, , 12]);
                        return [4 /*yield*/, this.startTransport(connectUrl, requestedTransferFormat)];
                    case 10:
                        _a.sent();
                        this.connectionId = negotiate.connectionId;
                        return [2 /*return*/];
                    case 11:
                        ex_2 = _a.sent();
                        this.logger.log(ILogger_1.LogLevel.Error, "Failed to start the transport '" + endpoint.transport + "': " + ex_2);
                        negotiate = undefined;
                        transportExceptions.push(endpoint.transport + " failed: " + ex_2);
                        if (this.connectionState !== "Connecting" /* Connecting */) {
                            message = "Failed to select transport before stop() was called.";
                            this.logger.log(ILogger_1.LogLevel.Debug, message);
                            return [2 /*return*/, Promise.reject(new Error(message))];
                        }
                        return [3 /*break*/, 12];
                    case 12:
                        _i++;
                        return [3 /*break*/, 3];
                    case 13:
                        if (transportExceptions.length > 0) {
                            return [2 /*return*/, Promise.reject(new Error("Unable to connect to the server with any of the available transports. " + transportExceptions.join(" ")))];
                        }
                        return [2 /*return*/, Promise.reject(new Error("None of the transports supported by the client are supported by the server."))];
                }
            });
        });
    };
    HttpConnection.prototype.constructTransport = function (transport) {
        switch (transport) {
            case ITransport_1.HttpTransportType.WebSockets:
                if (!this.options.WebSocket) {
                    throw new Error("'WebSocket' is not supported in your environment.");
                }
                return new WebSocketTransport_1.WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket, this.options.headers || {});
            case ITransport_1.HttpTransportType.ServerSentEvents:
                if (!this.options.EventSource) {
                    throw new Error("'EventSource' is not supported in your environment.");
                }
                return new ServerSentEventsTransport_1.ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource, this.options.withCredentials, this.options.headers || {});
            case ITransport_1.HttpTransportType.LongPolling:
                return new LongPollingTransport_1.LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.withCredentials, this.options.headers || {});
            default:
                throw new Error("Unknown transport: " + transport + ".");
        }
    };
    HttpConnection.prototype.startTransport = function (url, transferFormat) {
        var _this = this;
        this.transport.onreceive = this.onreceive;
        this.transport.onclose = function (e) { return _this.stopConnection(e); };
        return this.transport.connect(url, transferFormat);
    };
    HttpConnection.prototype.resolveTransportOrError = function (endpoint, requestedTransport, requestedTransferFormat) {
        var transport = ITransport_1.HttpTransportType[endpoint.transport];
        if (transport === null || transport === undefined) {
            this.logger.log(ILogger_1.LogLevel.Debug, "Skipping transport '" + endpoint.transport + "' because it is not supported by this client.");
            return new Error("Skipping transport '" + endpoint.transport + "' because it is not supported by this client.");
        }
        else {
            if (transportMatches(requestedTransport, transport)) {
                var transferFormats = endpoint.transferFormats.map(function (s) { return ITransport_1.TransferFormat[s]; });
                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {
                    if ((transport === ITransport_1.HttpTransportType.WebSockets && !this.options.WebSocket) ||
                        (transport === ITransport_1.HttpTransportType.ServerSentEvents && !this.options.EventSource)) {
                        this.logger.log(ILogger_1.LogLevel.Debug, "Skipping transport '" + ITransport_1.HttpTransportType[transport] + "' because it is not supported in your environment.'");
                        return new Error("'" + ITransport_1.HttpTransportType[transport] + "' is not supported in your environment.");
                    }
                    else {
                        this.logger.log(ILogger_1.LogLevel.Debug, "Selecting transport '" + ITransport_1.HttpTransportType[transport] + "'.");
                        try {
                            return this.constructTransport(transport);
                        }
                        catch (ex) {
                            return ex;
                        }
                    }
                }
                else {
                    this.logger.log(ILogger_1.LogLevel.Debug, "Skipping transport '" + ITransport_1.HttpTransportType[transport] + "' because it does not support the requested transfer format '" + ITransport_1.TransferFormat[requestedTransferFormat] + "'.");
                    return new Error("'" + ITransport_1.HttpTransportType[transport] + "' does not support " + ITransport_1.TransferFormat[requestedTransferFormat] + ".");
                }
            }
            else {
                this.logger.log(ILogger_1.LogLevel.Debug, "Skipping transport '" + ITransport_1.HttpTransportType[transport] + "' because it was disabled by the client.");
                return new Error("'" + ITransport_1.HttpTransportType[transport] + "' is disabled by the client.");
            }
        }
    };
    HttpConnection.prototype.isITransport = function (transport) {
        return transport && typeof (transport) === "object" && "connect" in transport;
    };
    HttpConnection.prototype.stopConnection = function (error) {
        var _this = this;
        this.logger.log(ILogger_1.LogLevel.Debug, "HttpConnection.stopConnection(" + error + ") called while in state " + this.connectionState + ".");
        this.transport = undefined;
        // If we have a stopError, it takes precedence over the error from the transport
        error = this.stopError || error;
        this.stopError = undefined;
        if (this.connectionState === "Disconnected" /* Disconnected */) {
            this.logger.log(ILogger_1.LogLevel.Debug, "Call to HttpConnection.stopConnection(" + error + ") was ignored because the connection is already in the disconnected state.");
            return;
        }
        if (this.connectionState === "Connecting" /* Connecting */) {
            this.logger.log(ILogger_1.LogLevel.Warning, "Call to HttpConnection.stopConnection(" + error + ") was ignored because the connection is still in the connecting state.");
            throw new Error("HttpConnection.stopConnection(" + error + ") was called while the connection is still in the connecting state.");
        }
        if (this.connectionState === "Disconnecting" /* Disconnecting */) {
            // A call to stop() induced this call to stopConnection and needs to be completed.
            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.
            this.stopPromiseResolver();
        }
        if (error) {
            this.logger.log(ILogger_1.LogLevel.Error, "Connection disconnected with error '" + error + "'.");
        }
        else {
            this.logger.log(ILogger_1.LogLevel.Information, "Connection disconnected.");
        }
        if (this.sendQueue) {
            this.sendQueue.stop().catch(function (e) {
                _this.logger.log(ILogger_1.LogLevel.Error, "TransportSendQueue.stop() threw error '" + e + "'.");
            });
            this.sendQueue = undefined;
        }
        this.connectionId = undefined;
        this.connectionState = "Disconnected" /* Disconnected */;
        if (this.connectionStarted) {
            this.connectionStarted = false;
            try {
                if (this.onclose) {
                    this.onclose(error);
                }
            }
            catch (e) {
                this.logger.log(ILogger_1.LogLevel.Error, "HttpConnection.onclose(" + error + ") threw error '" + e + "'.");
            }
        }
    };
    HttpConnection.prototype.resolveUrl = function (url) {
        // startsWith is not supported in IE
        if (url.lastIndexOf("https://", 0) === 0 || url.lastIndexOf("http://", 0) === 0) {
            return url;
        }
        if (!Utils_1.Platform.isBrowser || !window.document) {
            throw new Error("Cannot resolve '" + url + "'.");
        }
        // Setting the url to the href propery of an anchor tag handles normalization
        // for us. There are 3 main cases.
        // 1. Relative path normalization e.g "b" -> "http://localhost:5000/a/b"
        // 2. Absolute path normalization e.g "/a/b" -> "http://localhost:5000/a/b"
        // 3. Networkpath reference normalization e.g "//localhost:5000/a/b" -> "http://localhost:5000/a/b"
        var aTag = window.document.createElement("a");
        aTag.href = url;
        this.logger.log(ILogger_1.LogLevel.Information, "Normalizing '" + url + "' to '" + aTag.href + "'.");
        return aTag.href;
    };
    HttpConnection.prototype.resolveNegotiateUrl = function (url) {
        var index = url.indexOf("?");
        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);
        if (negotiateUrl[negotiateUrl.length - 1] !== "/") {
            negotiateUrl += "/";
        }
        negotiateUrl += "negotiate";
        negotiateUrl += index === -1 ? "" : url.substring(index);
        if (negotiateUrl.indexOf("negotiateVersion") === -1) {
            negotiateUrl += index === -1 ? "?" : "&";
            negotiateUrl += "negotiateVersion=" + this.negotiateVersion;
        }
        return negotiateUrl;
    };
    return HttpConnection;
}());
exports.HttpConnection = HttpConnection;
function transportMatches(requestedTransport, actualTransport) {
    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);
}
/** @private */
var TransportSendQueue = /** @class */ (function () {
    function TransportSendQueue(transport) {
        this.transport = transport;
        this.buffer = [];
        this.executing = true;
        this.sendBufferedData = new PromiseSource();
        this.transportResult = new PromiseSource();
        this.sendLoopPromise = this.sendLoop();
    }
    TransportSendQueue.prototype.send = function (data) {
        this.bufferData(data);
        if (!this.transportResult) {
            this.transportResult = new PromiseSource();
        }
        return this.transportResult.promise;
    };
    TransportSendQueue.prototype.stop = function () {
        this.executing = false;
        this.sendBufferedData.resolve();
        return this.sendLoopPromise;
    };
    TransportSendQueue.prototype.bufferData = function (data) {
        if (this.buffer.length && typeof (this.buffer[0]) !== typeof (data)) {
            throw new Error("Expected data to be of type " + typeof (this.buffer) + " but was of type " + typeof (data));
        }
        this.buffer.push(data);
        this.sendBufferedData.resolve();
    };
    TransportSendQueue.prototype.sendLoop = function () {
        return __awaiter(this, void 0, void 0, function () {
            var transportResult, data, error_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!true) return [3 /*break*/, 6];
                        return [4 /*yield*/, this.sendBufferedData.promise];
                    case 1:
                        _a.sent();
                        if (!this.executing) {
                            if (this.transportResult) {
                                this.transportResult.reject("Connection stopped.");
                            }
                            return [3 /*break*/, 6];
                        }
                        this.sendBufferedData = new PromiseSource();
                        transportResult = this.transportResult;
                        this.transportResult = undefined;
                        data = typeof (this.buffer[0]) === "string" ?
                            this.buffer.join("") :
                            TransportSendQueue.concatBuffers(this.buffer);
                        this.buffer.length = 0;
                        _a.label = 2;
                    case 2:
                        _a.trys.push([2, 4, , 5]);
                        return [4 /*yield*/, this.transport.send(data)];
                    case 3:
                        _a.sent();
                        transportResult.resolve();
                        return [3 /*break*/, 5];
                    case 4:
                        error_1 = _a.sent();
                        transportResult.reject(error_1);
                        return [3 /*break*/, 5];
                    case 5: return [3 /*break*/, 0];
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    TransportSendQueue.concatBuffers = function (arrayBuffers) {
        var totalLength = arrayBuffers.map(function (b) { return b.byteLength; }).reduce(function (a, b) { return a + b; });
        var result = new Uint8Array(totalLength);
        var offset = 0;
        for (var _i = 0, arrayBuffers_1 = arrayBuffers; _i < arrayBuffers_1.length; _i++) {
            var item = arrayBuffers_1[_i];
            result.set(new Uint8Array(item), offset);
            offset += item.byteLength;
        }
        return result.buffer;
    };
    return TransportSendQueue;
}());
exports.TransportSendQueue = TransportSendQueue;
var PromiseSource = /** @class */ (function () {
    function PromiseSource() {
        var _this = this;
        this.promise = new Promise(function (resolve, reject) {
            var _a;
            return _a = [resolve, reject], _this.resolver = _a[0], _this.rejecter = _a[1], _a;
        });
    }
    PromiseSource.prototype.resolve = function () {
        this.resolver();
    };
    PromiseSource.prototype.reject = function (reason) {
        this.rejecter(reason);
    };
    return PromiseSource;
}());
//# sourceMappingURL=HttpConnection.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\HttpConnection.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./DefaultHttpClient":2,"./ILogger":12,"./ITransport":13,"./LongPollingTransport":16,"./ServerSentEventsTransport":17,"./Utils":20,"./WebSocketTransport":21,"buffer":25,"e/U+97":27}],9:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var HandshakeProtocol_1 = require("./HandshakeProtocol");
var IHubProtocol_1 = require("./IHubProtocol");
var ILogger_1 = require("./ILogger");
var Subject_1 = require("./Subject");
var Utils_1 = require("./Utils");
var DEFAULT_TIMEOUT_IN_MS = 30 * 1000;
var DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;
/** Describes the current state of the {@link HubConnection} to the server. */
var HubConnectionState;
(function (HubConnectionState) {
    /** The hub connection is disconnected. */
    HubConnectionState["Disconnected"] = "Disconnected";
    /** The hub connection is connecting. */
    HubConnectionState["Connecting"] = "Connecting";
    /** The hub connection is connected. */
    HubConnectionState["Connected"] = "Connected";
    /** The hub connection is disconnecting. */
    HubConnectionState["Disconnecting"] = "Disconnecting";
    /** The hub connection is reconnecting. */
    HubConnectionState["Reconnecting"] = "Reconnecting";
})(HubConnectionState = exports.HubConnectionState || (exports.HubConnectionState = {}));
/** Represents a connection to a SignalR Hub. */
var HubConnection = /** @class */ (function () {
    function HubConnection(connection, logger, protocol, reconnectPolicy) {
        var _this = this;
        Utils_1.Arg.isRequired(connection, "connection");
        Utils_1.Arg.isRequired(logger, "logger");
        Utils_1.Arg.isRequired(protocol, "protocol");
        this.serverTimeoutInMilliseconds = DEFAULT_TIMEOUT_IN_MS;
        this.keepAliveIntervalInMilliseconds = DEFAULT_PING_INTERVAL_IN_MS;
        this.logger = logger;
        this.protocol = protocol;
        this.connection = connection;
        this.reconnectPolicy = reconnectPolicy;
        this.handshakeProtocol = new HandshakeProtocol_1.HandshakeProtocol();
        this.connection.onreceive = function (data) { return _this.processIncomingData(data); };
        this.connection.onclose = function (error) { return _this.connectionClosed(error); };
        this.callbacks = {};
        this.methods = {};
        this.closedCallbacks = [];
        this.reconnectingCallbacks = [];
        this.reconnectedCallbacks = [];
        this.invocationId = 0;
        this.receivedHandshakeResponse = false;
        this.connectionState = HubConnectionState.Disconnected;
        this.connectionStarted = false;
        this.cachedPingMessage = this.protocol.writeMessage({ type: IHubProtocol_1.MessageType.Ping });
    }
    /** @internal */
    // Using a public static factory method means we can have a private constructor and an _internal_
    // create method that can be used by HubConnectionBuilder. An "internal" constructor would just
    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a
    // public parameter-less constructor.
    HubConnection.create = function (connection, logger, protocol, reconnectPolicy) {
        return new HubConnection(connection, logger, protocol, reconnectPolicy);
    };
    Object.defineProperty(HubConnection.prototype, "state", {
        /** Indicates the state of the {@link HubConnection} to the server. */
        get: function () {
            return this.connectionState;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HubConnection.prototype, "connectionId", {
        /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either
         *  in the disconnected state or if the negotiation step was skipped.
         */
        get: function () {
            return this.connection ? (this.connection.connectionId || null) : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HubConnection.prototype, "baseUrl", {
        /** Indicates the url of the {@link HubConnection} to the server. */
        get: function () {
            return this.connection.baseUrl || "";
        },
        /**
         * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or
         * Reconnecting states.
         * @param {string} url The url to connect to.
         */
        set: function (url) {
            if (this.connectionState !== HubConnectionState.Disconnected && this.connectionState !== HubConnectionState.Reconnecting) {
                throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");
            }
            if (!url) {
                throw new Error("The HubConnection url must be a valid url.");
            }
            this.connection.baseUrl = url;
        },
        enumerable: true,
        configurable: true
    });
    /** Starts the connection.
     *
     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.
     */
    HubConnection.prototype.start = function () {
        this.startPromise = this.startWithStateTransitions();
        return this.startPromise;
    };
    HubConnection.prototype.startWithStateTransitions = function () {
        return __awaiter(this, void 0, void 0, function () {
            var e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (this.connectionState !== HubConnectionState.Disconnected) {
                            return [2 /*return*/, Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."))];
                        }
                        this.connectionState = HubConnectionState.Connecting;
                        this.logger.log(ILogger_1.LogLevel.Debug, "Starting HubConnection.");
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.startInternal()];
                    case 2:
                        _a.sent();
                        this.connectionState = HubConnectionState.Connected;
                        this.connectionStarted = true;
                        this.logger.log(ILogger_1.LogLevel.Debug, "HubConnection connected successfully.");
                        return [3 /*break*/, 4];
                    case 3:
                        e_1 = _a.sent();
                        this.connectionState = HubConnectionState.Disconnected;
                        this.logger.log(ILogger_1.LogLevel.Debug, "HubConnection failed to start successfully because of error '" + e_1 + "'.");
                        return [2 /*return*/, Promise.reject(e_1)];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    HubConnection.prototype.startInternal = function () {
        return __awaiter(this, void 0, void 0, function () {
            var handshakePromise, handshakeRequest, e_2;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.stopDuringStartError = undefined;
                        this.receivedHandshakeResponse = false;
                        handshakePromise = new Promise(function (resolve, reject) {
                            _this.handshakeResolver = resolve;
                            _this.handshakeRejecter = reject;
                        });
                        return [4 /*yield*/, this.connection.start(this.protocol.transferFormat)];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        _a.trys.push([2, 5, , 7]);
                        handshakeRequest = {
                            protocol: this.protocol.name,
                            version: this.protocol.version,
                        };
                        this.logger.log(ILogger_1.LogLevel.Debug, "Sending handshake request.");
                        return [4 /*yield*/, this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(handshakeRequest))];
                    case 3:
                        _a.sent();
                        this.logger.log(ILogger_1.LogLevel.Information, "Using HubProtocol '" + this.protocol.name + "'.");
                        // defensively cleanup timeout in case we receive a message from the server before we finish start
                        this.cleanupTimeout();
                        this.resetTimeoutPeriod();
                        this.resetKeepAliveInterval();
                        return [4 /*yield*/, handshakePromise];
                    case 4:
                        _a.sent();
                        // It's important to check the stopDuringStartError instead of just relying on the handshakePromise
                        // being rejected on close, because this continuation can run after both the handshake completed successfully
                        // and the connection was closed.
                        if (this.stopDuringStartError) {
                            // It's important to throw instead of returning a rejected promise, because we don't want to allow any state
                            // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise
                            // will cause the calling continuation to get scheduled to run later.
                            throw this.stopDuringStartError;
                        }
                        return [3 /*break*/, 7];
                    case 5:
                        e_2 = _a.sent();
                        this.logger.log(ILogger_1.LogLevel.Debug, "Hub handshake failed with error '" + e_2 + "' during start(). Stopping HubConnection.");
                        this.cleanupTimeout();
                        this.cleanupPingTimer();
                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.
                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.
                        return [4 /*yield*/, this.connection.stop(e_2)];
                    case 6:
                        // HttpConnection.stop() should not complete until after the onclose callback is invoked.
                        // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.
                        _a.sent();
                        throw e_2;
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    /** Stops the connection.
     *
     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.
     */
    HubConnection.prototype.stop = function () {
        return __awaiter(this, void 0, void 0, function () {
            var startPromise, e_3;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        startPromise = this.startPromise;
                        this.stopPromise = this.stopInternal();
                        return [4 /*yield*/, this.stopPromise];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        _a.trys.push([2, 4, , 5]);
                        // Awaiting undefined continues immediately
                        return [4 /*yield*/, startPromise];
                    case 3:
                        // Awaiting undefined continues immediately
                        _a.sent();
                        return [3 /*break*/, 5];
                    case 4:
                        e_3 = _a.sent();
                        return [3 /*break*/, 5];
                    case 5: return [2 /*return*/];
                }
            });
        });
    };
    HubConnection.prototype.stopInternal = function (error) {
        if (this.connectionState === HubConnectionState.Disconnected) {
            this.logger.log(ILogger_1.LogLevel.Debug, "Call to HubConnection.stop(" + error + ") ignored because it is already in the disconnected state.");
            return Promise.resolve();
        }
        if (this.connectionState === HubConnectionState.Disconnecting) {
            this.logger.log(ILogger_1.LogLevel.Debug, "Call to HttpConnection.stop(" + error + ") ignored because the connection is already in the disconnecting state.");
            return this.stopPromise;
        }
        this.connectionState = HubConnectionState.Disconnecting;
        this.logger.log(ILogger_1.LogLevel.Debug, "Stopping HubConnection.");
        if (this.reconnectDelayHandle) {
            // We're in a reconnect delay which means the underlying connection is currently already stopped.
            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and
            // fire the onclose callbacks.
            this.logger.log(ILogger_1.LogLevel.Debug, "Connection stopped during reconnect delay. Done reconnecting.");
            clearTimeout(this.reconnectDelayHandle);
            this.reconnectDelayHandle = undefined;
            this.completeClose();
            return Promise.resolve();
        }
        this.cleanupTimeout();
        this.cleanupPingTimer();
        this.stopDuringStartError = error || new Error("The connection was stopped before the hub handshake could complete.");
        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails
        // or the onclose callback is invoked. The onclose callback will transition the HubConnection
        // to the disconnected state if need be before HttpConnection.stop() completes.
        return this.connection.stop(error);
    };
    /** Invokes a streaming hub method on the server using the specified name and arguments.
     *
     * @typeparam T The type of the items returned by the server.
     * @param {string} methodName The name of the server method to invoke.
     * @param {any[]} args The arguments used to invoke the server method.
     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.
     */
    HubConnection.prototype.stream = function (methodName) {
        var _this = this;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];
        var invocationDescriptor = this.createStreamInvocation(methodName, args, streamIds);
        var promiseQueue;
        var subject = new Subject_1.Subject();
        subject.cancelCallback = function () {
            var cancelInvocation = _this.createCancelInvocation(invocationDescriptor.invocationId);
            delete _this.callbacks[invocationDescriptor.invocationId];
            return promiseQueue.then(function () {
                return _this.sendWithProtocol(cancelInvocation);
            });
        };
        this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {
            if (error) {
                subject.error(error);
                return;
            }
            else if (invocationEvent) {
                // invocationEvent will not be null when an error is not passed to the callback
                if (invocationEvent.type === IHubProtocol_1.MessageType.Completion) {
                    if (invocationEvent.error) {
                        subject.error(new Error(invocationEvent.error));
                    }
                    else {
                        subject.complete();
                    }
                }
                else {
                    subject.next((invocationEvent.item));
                }
            }
        };
        promiseQueue = this.sendWithProtocol(invocationDescriptor)
            .catch(function (e) {
            subject.error(e);
            delete _this.callbacks[invocationDescriptor.invocationId];
        });
        this.launchStreams(streams, promiseQueue);
        return subject;
    };
    HubConnection.prototype.sendMessage = function (message) {
        this.resetKeepAliveInterval();
        return this.connection.send(message);
    };
    /**
     * Sends a js object to the server.
     * @param message The js object to serialize and send.
     */
    HubConnection.prototype.sendWithProtocol = function (message) {
        return this.sendMessage(this.protocol.writeMessage(message));
    };
    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.
     *
     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still
     * be processing the invocation.
     *
     * @param {string} methodName The name of the server method to invoke.
     * @param {any[]} args The arguments used to invoke the server method.
     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.
     */
    HubConnection.prototype.send = function (methodName) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];
        var sendPromise = this.sendWithProtocol(this.createInvocation(methodName, args, true, streamIds));
        this.launchStreams(streams, sendPromise);
        return sendPromise;
    };
    /** Invokes a hub method on the server using the specified name and arguments.
     *
     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise
     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of
     * resolving the Promise.
     *
     * @typeparam T The expected return type.
     * @param {string} methodName The name of the server method to invoke.
     * @param {any[]} args The arguments used to invoke the server method.
     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.
     */
    HubConnection.prototype.invoke = function (methodName) {
        var _this = this;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var _a = this.replaceStreamingParams(args), streams = _a[0], streamIds = _a[1];
        var invocationDescriptor = this.createInvocation(methodName, args, false, streamIds);
        var p = new Promise(function (resolve, reject) {
            // invocationId will always have a value for a non-blocking invocation
            _this.callbacks[invocationDescriptor.invocationId] = function (invocationEvent, error) {
                if (error) {
                    reject(error);
                    return;
                }
                else if (invocationEvent) {
                    // invocationEvent will not be null when an error is not passed to the callback
                    if (invocationEvent.type === IHubProtocol_1.MessageType.Completion) {
                        if (invocationEvent.error) {
                            reject(new Error(invocationEvent.error));
                        }
                        else {
                            resolve(invocationEvent.result);
                        }
                    }
                    else {
                        reject(new Error("Unexpected message type: " + invocationEvent.type));
                    }
                }
            };
            var promiseQueue = _this.sendWithProtocol(invocationDescriptor)
                .catch(function (e) {
                reject(e);
                // invocationId will always have a value for a non-blocking invocation
                delete _this.callbacks[invocationDescriptor.invocationId];
            });
            _this.launchStreams(streams, promiseQueue);
        });
        return p;
    };
    /** Registers a handler that will be invoked when the hub method with the specified method name is invoked.
     *
     * @param {string} methodName The name of the hub method to define.
     * @param {Function} newMethod The handler that will be raised when the hub method is invoked.
     */
    HubConnection.prototype.on = function (methodName, newMethod) {
        if (!methodName || !newMethod) {
            return;
        }
        methodName = methodName.toLowerCase();
        if (!this.methods[methodName]) {
            this.methods[methodName] = [];
        }
        // Preventing adding the same handler multiple times.
        if (this.methods[methodName].indexOf(newMethod) !== -1) {
            return;
        }
        this.methods[methodName].push(newMethod);
    };
    HubConnection.prototype.off = function (methodName, method) {
        if (!methodName) {
            return;
        }
        methodName = methodName.toLowerCase();
        var handlers = this.methods[methodName];
        if (!handlers) {
            return;
        }
        if (method) {
            var removeIdx = handlers.indexOf(method);
            if (removeIdx !== -1) {
                handlers.splice(removeIdx, 1);
                if (handlers.length === 0) {
                    delete this.methods[methodName];
                }
            }
        }
        else {
            delete this.methods[methodName];
        }
    };
    /** Registers a handler that will be invoked when the connection is closed.
     *
     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).
     */
    HubConnection.prototype.onclose = function (callback) {
        if (callback) {
            this.closedCallbacks.push(callback);
        }
    };
    /** Registers a handler that will be invoked when the connection starts reconnecting.
     *
     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).
     */
    HubConnection.prototype.onreconnecting = function (callback) {
        if (callback) {
            this.reconnectingCallbacks.push(callback);
        }
    };
    /** Registers a handler that will be invoked when the connection successfully reconnects.
     *
     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.
     */
    HubConnection.prototype.onreconnected = function (callback) {
        if (callback) {
            this.reconnectedCallbacks.push(callback);
        }
    };
    HubConnection.prototype.processIncomingData = function (data) {
        this.cleanupTimeout();
        if (!this.receivedHandshakeResponse) {
            data = this.processHandshakeResponse(data);
            this.receivedHandshakeResponse = true;
        }
        // Data may have all been read when processing handshake response
        if (data) {
            // Parse the messages
            var messages = this.protocol.parseMessages(data, this.logger);
            for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {
                var message = messages_1[_i];
                switch (message.type) {
                    case IHubProtocol_1.MessageType.Invocation:
                        this.invokeClientMethod(message);
                        break;
                    case IHubProtocol_1.MessageType.StreamItem:
                    case IHubProtocol_1.MessageType.Completion:
                        var callback = this.callbacks[message.invocationId];
                        if (callback) {
                            if (message.type === IHubProtocol_1.MessageType.Completion) {
                                delete this.callbacks[message.invocationId];
                            }
                            callback(message);
                        }
                        break;
                    case IHubProtocol_1.MessageType.Ping:
                        // Don't care about pings
                        break;
                    case IHubProtocol_1.MessageType.Close:
                        this.logger.log(ILogger_1.LogLevel.Information, "Close message received from server.");
                        var error = message.error ? new Error("Server returned an error on close: " + message.error) : undefined;
                        if (message.allowReconnect === true) {
                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,
                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.
                            // tslint:disable-next-line:no-floating-promises
                            this.connection.stop(error);
                        }
                        else {
                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.
                            this.stopPromise = this.stopInternal(error);
                        }
                        break;
                    default:
                        this.logger.log(ILogger_1.LogLevel.Warning, "Invalid message type: " + message.type + ".");
                        break;
                }
            }
        }
        this.resetTimeoutPeriod();
    };
    HubConnection.prototype.processHandshakeResponse = function (data) {
        var _a;
        var responseMessage;
        var remainingData;
        try {
            _a = this.handshakeProtocol.parseHandshakeResponse(data), remainingData = _a[0], responseMessage = _a[1];
        }
        catch (e) {
            var message = "Error parsing handshake response: " + e;
            this.logger.log(ILogger_1.LogLevel.Error, message);
            var error = new Error(message);
            this.handshakeRejecter(error);
            throw error;
        }
        if (responseMessage.error) {
            var message = "Server returned handshake error: " + responseMessage.error;
            this.logger.log(ILogger_1.LogLevel.Error, message);
            var error = new Error(message);
            this.handshakeRejecter(error);
            throw error;
        }
        else {
            this.logger.log(ILogger_1.LogLevel.Debug, "Server handshake complete.");
        }
        this.handshakeResolver();
        return remainingData;
    };
    HubConnection.prototype.resetKeepAliveInterval = function () {
        var _this = this;
        if (this.connection.features.inherentKeepAlive) {
            return;
        }
        this.cleanupPingTimer();
        this.pingServerHandle = setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {
            var _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        if (!(this.connectionState === HubConnectionState.Connected)) return [3 /*break*/, 4];
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.sendMessage(this.cachedPingMessage)];
                    case 2:
                        _b.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        _a = _b.sent();
                        // We don't care about the error. It should be seen elsewhere in the client.
                        // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering
                        this.cleanupPingTimer();
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        }); }, this.keepAliveIntervalInMilliseconds);
    };
    HubConnection.prototype.resetTimeoutPeriod = function () {
        var _this = this;
        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {
            // Set the timeout timer
            this.timeoutHandle = setTimeout(function () { return _this.serverTimeout(); }, this.serverTimeoutInMilliseconds);
        }
    };
    HubConnection.prototype.serverTimeout = function () {
        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(
        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.
        // tslint:disable-next-line:no-floating-promises
        this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."));
    };
    HubConnection.prototype.invokeClientMethod = function (invocationMessage) {
        var _this = this;
        var methods = this.methods[invocationMessage.target.toLowerCase()];
        if (methods) {
            try {
                methods.forEach(function (m) { return m.apply(_this, invocationMessage.arguments); });
            }
            catch (e) {
                this.logger.log(ILogger_1.LogLevel.Error, "A callback for the method " + invocationMessage.target.toLowerCase() + " threw error '" + e + "'.");
            }
            if (invocationMessage.invocationId) {
                // This is not supported in v1. So we return an error to avoid blocking the server waiting for the response.
                var message = "Server requested a response, which is not supported in this version of the client.";
                this.logger.log(ILogger_1.LogLevel.Error, message);
                // We don't want to wait on the stop itself.
                this.stopPromise = this.stopInternal(new Error(message));
            }
        }
        else {
            this.logger.log(ILogger_1.LogLevel.Warning, "No client method with the name '" + invocationMessage.target + "' found.");
        }
    };
    HubConnection.prototype.connectionClosed = function (error) {
        this.logger.log(ILogger_1.LogLevel.Debug, "HubConnection.connectionClosed(" + error + ") called while in state " + this.connectionState + ".");
        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.
        this.stopDuringStartError = this.stopDuringStartError || error || new Error("The underlying connection was closed before the hub handshake could complete.");
        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.
        // If it has already completed, this should just noop.
        if (this.handshakeResolver) {
            this.handshakeResolver();
        }
        this.cancelCallbacksWithError(error || new Error("Invocation canceled due to the underlying connection being closed."));
        this.cleanupTimeout();
        this.cleanupPingTimer();
        if (this.connectionState === HubConnectionState.Disconnecting) {
            this.completeClose(error);
        }
        else if (this.connectionState === HubConnectionState.Connected && this.reconnectPolicy) {
            // tslint:disable-next-line:no-floating-promises
            this.reconnect(error);
        }
        else if (this.connectionState === HubConnectionState.Connected) {
            this.completeClose(error);
        }
        // If none of the above if conditions were true were called the HubConnection must be in either:
        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.
        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt
        //    and potentially continue the reconnect() loop.
        // 3. The Disconnected state in which case we're already done.
    };
    HubConnection.prototype.completeClose = function (error) {
        var _this = this;
        if (this.connectionStarted) {
            this.connectionState = HubConnectionState.Disconnected;
            this.connectionStarted = false;
            try {
                this.closedCallbacks.forEach(function (c) { return c.apply(_this, [error]); });
            }
            catch (e) {
                this.logger.log(ILogger_1.LogLevel.Error, "An onclose callback called with error '" + error + "' threw error '" + e + "'.");
            }
        }
    };
    HubConnection.prototype.reconnect = function (error) {
        return __awaiter(this, void 0, void 0, function () {
            var reconnectStartTime, previousReconnectAttempts, retryError, nextRetryDelay, e_4;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        reconnectStartTime = Date.now();
                        previousReconnectAttempts = 0;
                        retryError = error !== undefined ? error : new Error("Attempting to reconnect due to a unknown error.");
                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, 0, retryError);
                        if (nextRetryDelay === null) {
                            this.logger.log(ILogger_1.LogLevel.Debug, "Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.");
                            this.completeClose(error);
                            return [2 /*return*/];
                        }
                        this.connectionState = HubConnectionState.Reconnecting;
                        if (error) {
                            this.logger.log(ILogger_1.LogLevel.Information, "Connection reconnecting because of error '" + error + "'.");
                        }
                        else {
                            this.logger.log(ILogger_1.LogLevel.Information, "Connection reconnecting.");
                        }
                        if (this.onreconnecting) {
                            try {
                                this.reconnectingCallbacks.forEach(function (c) { return c.apply(_this, [error]); });
                            }
                            catch (e) {
                                this.logger.log(ILogger_1.LogLevel.Error, "An onreconnecting callback called with error '" + error + "' threw error '" + e + "'.");
                            }
                            // Exit early if an onreconnecting callback called connection.stop().
                            if (this.connectionState !== HubConnectionState.Reconnecting) {
                                this.logger.log(ILogger_1.LogLevel.Debug, "Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");
                                return [2 /*return*/];
                            }
                        }
                        _a.label = 1;
                    case 1:
                        if (!(nextRetryDelay !== null)) return [3 /*break*/, 7];
                        this.logger.log(ILogger_1.LogLevel.Information, "Reconnect attempt number " + previousReconnectAttempts + " will start in " + nextRetryDelay + " ms.");
                        return [4 /*yield*/, new Promise(function (resolve) {
                                _this.reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);
                            })];
                    case 2:
                        _a.sent();
                        this.reconnectDelayHandle = undefined;
                        if (this.connectionState !== HubConnectionState.Reconnecting) {
                            this.logger.log(ILogger_1.LogLevel.Debug, "Connection left the reconnecting state during reconnect delay. Done reconnecting.");
                            return [2 /*return*/];
                        }
                        _a.label = 3;
                    case 3:
                        _a.trys.push([3, 5, , 6]);
                        return [4 /*yield*/, this.startInternal()];
                    case 4:
                        _a.sent();
                        this.connectionState = HubConnectionState.Connected;
                        this.logger.log(ILogger_1.LogLevel.Information, "HubConnection reconnected successfully.");
                        if (this.onreconnected) {
                            try {
                                this.reconnectedCallbacks.forEach(function (c) { return c.apply(_this, [_this.connection.connectionId]); });
                            }
                            catch (e) {
                                this.logger.log(ILogger_1.LogLevel.Error, "An onreconnected callback called with connectionId '" + this.connection.connectionId + "; threw error '" + e + "'.");
                            }
                        }
                        return [2 /*return*/];
                    case 5:
                        e_4 = _a.sent();
                        this.logger.log(ILogger_1.LogLevel.Information, "Reconnect attempt failed because of error '" + e_4 + "'.");
                        if (this.connectionState !== HubConnectionState.Reconnecting) {
                            this.logger.log(ILogger_1.LogLevel.Debug, "Connection left the reconnecting state during reconnect attempt. Done reconnecting.");
                            return [2 /*return*/];
                        }
                        retryError = e_4 instanceof Error ? e_4 : new Error(e_4.toString());
                        nextRetryDelay = this.getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);
                        return [3 /*break*/, 6];
                    case 6: return [3 /*break*/, 1];
                    case 7:
                        this.logger.log(ILogger_1.LogLevel.Information, "Reconnect retries have been exhausted after " + (Date.now() - reconnectStartTime) + " ms and " + previousReconnectAttempts + " failed attempts. Connection disconnecting.");
                        this.completeClose();
                        return [2 /*return*/];
                }
            });
        });
    };
    HubConnection.prototype.getNextRetryDelay = function (previousRetryCount, elapsedMilliseconds, retryReason) {
        try {
            return this.reconnectPolicy.nextRetryDelayInMilliseconds({
                elapsedMilliseconds: elapsedMilliseconds,
                previousRetryCount: previousRetryCount,
                retryReason: retryReason,
            });
        }
        catch (e) {
            this.logger.log(ILogger_1.LogLevel.Error, "IRetryPolicy.nextRetryDelayInMilliseconds(" + previousRetryCount + ", " + elapsedMilliseconds + ") threw error '" + e + "'.");
            return null;
        }
    };
    HubConnection.prototype.cancelCallbacksWithError = function (error) {
        var callbacks = this.callbacks;
        this.callbacks = {};
        Object.keys(callbacks)
            .forEach(function (key) {
            var callback = callbacks[key];
            callback(null, error);
        });
    };
    HubConnection.prototype.cleanupPingTimer = function () {
        if (this.pingServerHandle) {
            clearTimeout(this.pingServerHandle);
        }
    };
    HubConnection.prototype.cleanupTimeout = function () {
        if (this.timeoutHandle) {
            clearTimeout(this.timeoutHandle);
        }
    };
    HubConnection.prototype.createInvocation = function (methodName, args, nonblocking, streamIds) {
        if (nonblocking) {
            if (streamIds.length !== 0) {
                return {
                    arguments: args,
                    streamIds: streamIds,
                    target: methodName,
                    type: IHubProtocol_1.MessageType.Invocation,
                };
            }
            else {
                return {
                    arguments: args,
                    target: methodName,
                    type: IHubProtocol_1.MessageType.Invocation,
                };
            }
        }
        else {
            var invocationId = this.invocationId;
            this.invocationId++;
            if (streamIds.length !== 0) {
                return {
                    arguments: args,
                    invocationId: invocationId.toString(),
                    streamIds: streamIds,
                    target: methodName,
                    type: IHubProtocol_1.MessageType.Invocation,
                };
            }
            else {
                return {
                    arguments: args,
                    invocationId: invocationId.toString(),
                    target: methodName,
                    type: IHubProtocol_1.MessageType.Invocation,
                };
            }
        }
    };
    HubConnection.prototype.launchStreams = function (streams, promiseQueue) {
        var _this = this;
        if (streams.length === 0) {
            return;
        }
        // Synchronize stream data so they arrive in-order on the server
        if (!promiseQueue) {
            promiseQueue = Promise.resolve();
        }
        var _loop_1 = function (streamId) {
            streams[streamId].subscribe({
                complete: function () {
                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId)); });
                },
                error: function (err) {
                    var message;
                    if (err instanceof Error) {
                        message = err.message;
                    }
                    else if (err && err.toString) {
                        message = err.toString();
                    }
                    else {
                        message = "Unknown error";
                    }
                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createCompletionMessage(streamId, message)); });
                },
                next: function (item) {
                    promiseQueue = promiseQueue.then(function () { return _this.sendWithProtocol(_this.createStreamItemMessage(streamId, item)); });
                },
            });
        };
        // We want to iterate over the keys, since the keys are the stream ids
        // tslint:disable-next-line:forin
        for (var streamId in streams) {
            _loop_1(streamId);
        }
    };
    HubConnection.prototype.replaceStreamingParams = function (args) {
        var streams = [];
        var streamIds = [];
        for (var i = 0; i < args.length; i++) {
            var argument = args[i];
            if (this.isObservable(argument)) {
                var streamId = this.invocationId;
                this.invocationId++;
                // Store the stream for later use
                streams[streamId] = argument;
                streamIds.push(streamId.toString());
                // remove stream from args
                args.splice(i, 1);
            }
        }
        return [streams, streamIds];
    };
    HubConnection.prototype.isObservable = function (arg) {
        // This allows other stream implementations to just work (like rxjs)
        return arg && arg.subscribe && typeof arg.subscribe === "function";
    };
    HubConnection.prototype.createStreamInvocation = function (methodName, args, streamIds) {
        var invocationId = this.invocationId;
        this.invocationId++;
        if (streamIds.length !== 0) {
            return {
                arguments: args,
                invocationId: invocationId.toString(),
                streamIds: streamIds,
                target: methodName,
                type: IHubProtocol_1.MessageType.StreamInvocation,
            };
        }
        else {
            return {
                arguments: args,
                invocationId: invocationId.toString(),
                target: methodName,
                type: IHubProtocol_1.MessageType.StreamInvocation,
            };
        }
    };
    HubConnection.prototype.createCancelInvocation = function (id) {
        return {
            invocationId: id,
            type: IHubProtocol_1.MessageType.CancelInvocation,
        };
    };
    HubConnection.prototype.createStreamItemMessage = function (id, item) {
        return {
            invocationId: id,
            item: item,
            type: IHubProtocol_1.MessageType.StreamItem,
        };
    };
    HubConnection.prototype.createCompletionMessage = function (id, error, result) {
        if (error) {
            return {
                error: error,
                invocationId: id,
                type: IHubProtocol_1.MessageType.Completion,
            };
        }
        return {
            invocationId: id,
            result: result,
            type: IHubProtocol_1.MessageType.Completion,
        };
    };
    return HubConnection;
}());
exports.HubConnection = HubConnection;
//# sourceMappingURL=HubConnection.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\HubConnection.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./HandshakeProtocol":6,"./IHubProtocol":11,"./ILogger":12,"./Subject":18,"./Utils":20,"buffer":25,"e/U+97":27}],10:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var DefaultReconnectPolicy_1 = require("./DefaultReconnectPolicy");
var HttpConnection_1 = require("./HttpConnection");
var HubConnection_1 = require("./HubConnection");
var ILogger_1 = require("./ILogger");
var JsonHubProtocol_1 = require("./JsonHubProtocol");
var Loggers_1 = require("./Loggers");
var Utils_1 = require("./Utils");
// tslint:disable:object-literal-sort-keys
var LogLevelNameMapping = {
    trace: ILogger_1.LogLevel.Trace,
    debug: ILogger_1.LogLevel.Debug,
    info: ILogger_1.LogLevel.Information,
    information: ILogger_1.LogLevel.Information,
    warn: ILogger_1.LogLevel.Warning,
    warning: ILogger_1.LogLevel.Warning,
    error: ILogger_1.LogLevel.Error,
    critical: ILogger_1.LogLevel.Critical,
    none: ILogger_1.LogLevel.None,
};
function parseLogLevel(name) {
    // Case-insensitive matching via lower-casing
    // Yes, I know case-folding is a complicated problem in Unicode, but we only support
    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.
    var mapping = LogLevelNameMapping[name.toLowerCase()];
    if (typeof mapping !== "undefined") {
        return mapping;
    }
    else {
        throw new Error("Unknown log level: " + name);
    }
}
/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */
var HubConnectionBuilder = /** @class */ (function () {
    function HubConnectionBuilder() {
    }
    HubConnectionBuilder.prototype.configureLogging = function (logging) {
        Utils_1.Arg.isRequired(logging, "logging");
        if (isLogger(logging)) {
            this.logger = logging;
        }
        else if (typeof logging === "string") {
            var logLevel = parseLogLevel(logging);
            this.logger = new Utils_1.ConsoleLogger(logLevel);
        }
        else {
            this.logger = new Utils_1.ConsoleLogger(logging);
        }
        return this;
    };
    HubConnectionBuilder.prototype.withUrl = function (url, transportTypeOrOptions) {
        Utils_1.Arg.isRequired(url, "url");
        Utils_1.Arg.isNotEmpty(url, "url");
        this.url = url;
        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed
        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.
        if (typeof transportTypeOrOptions === "object") {
            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, transportTypeOrOptions);
        }
        else {
            this.httpConnectionOptions = __assign({}, this.httpConnectionOptions, { transport: transportTypeOrOptions });
        }
        return this;
    };
    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.
     *
     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.
     */
    HubConnectionBuilder.prototype.withHubProtocol = function (protocol) {
        Utils_1.Arg.isRequired(protocol, "protocol");
        this.protocol = protocol;
        return this;
    };
    HubConnectionBuilder.prototype.withAutomaticReconnect = function (retryDelaysOrReconnectPolicy) {
        if (this.reconnectPolicy) {
            throw new Error("A reconnectPolicy has already been set.");
        }
        if (!retryDelaysOrReconnectPolicy) {
            this.reconnectPolicy = new DefaultReconnectPolicy_1.DefaultReconnectPolicy();
        }
        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {
            this.reconnectPolicy = new DefaultReconnectPolicy_1.DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);
        }
        else {
            this.reconnectPolicy = retryDelaysOrReconnectPolicy;
        }
        return this;
    };
    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.
     *
     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.
     */
    HubConnectionBuilder.prototype.build = function () {
        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one
        // provided to configureLogger
        var httpConnectionOptions = this.httpConnectionOptions || {};
        // If it's 'null', the user **explicitly** asked for null, don't mess with it.
        if (httpConnectionOptions.logger === undefined) {
            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.
            httpConnectionOptions.logger = this.logger;
        }
        // Now create the connection
        if (!this.url) {
            throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");
        }
        var connection = new HttpConnection_1.HttpConnection(this.url, httpConnectionOptions);
        return HubConnection_1.HubConnection.create(connection, this.logger || Loggers_1.NullLogger.instance, this.protocol || new JsonHubProtocol_1.JsonHubProtocol(), this.reconnectPolicy);
    };
    return HubConnectionBuilder;
}());
exports.HubConnectionBuilder = HubConnectionBuilder;
function isLogger(logger) {
    return logger.log !== undefined;
}
//# sourceMappingURL=HubConnectionBuilder.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\HubConnectionBuilder.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./DefaultReconnectPolicy":3,"./HttpConnection":8,"./HubConnection":9,"./ILogger":12,"./JsonHubProtocol":14,"./Loggers":15,"./Utils":20,"buffer":25,"e/U+97":27}],11:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
/** Defines the type of a Hub Message. */
var MessageType;
(function (MessageType) {
    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */
    MessageType[MessageType["Invocation"] = 1] = "Invocation";
    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */
    MessageType[MessageType["StreamItem"] = 2] = "StreamItem";
    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */
    MessageType[MessageType["Completion"] = 3] = "Completion";
    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */
    MessageType[MessageType["StreamInvocation"] = 4] = "StreamInvocation";
    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */
    MessageType[MessageType["CancelInvocation"] = 5] = "CancelInvocation";
    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */
    MessageType[MessageType["Ping"] = 6] = "Ping";
    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */
    MessageType[MessageType["Close"] = 7] = "Close";
})(MessageType = exports.MessageType || (exports.MessageType = {}));
//# sourceMappingURL=IHubProtocol.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\IHubProtocol.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],12:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.
/** Indicates the severity of a log message.
 *
 * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.
 */
var LogLevel;
(function (LogLevel) {
    /** Log level for very low severity diagnostic messages. */
    LogLevel[LogLevel["Trace"] = 0] = "Trace";
    /** Log level for low severity diagnostic messages. */
    LogLevel[LogLevel["Debug"] = 1] = "Debug";
    /** Log level for informational diagnostic messages. */
    LogLevel[LogLevel["Information"] = 2] = "Information";
    /** Log level for diagnostic messages that indicate a non-fatal problem. */
    LogLevel[LogLevel["Warning"] = 3] = "Warning";
    /** Log level for diagnostic messages that indicate a failure in the current operation. */
    LogLevel[LogLevel["Error"] = 4] = "Error";
    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */
    LogLevel[LogLevel["Critical"] = 5] = "Critical";
    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */
    LogLevel[LogLevel["None"] = 6] = "None";
})(LogLevel = exports.LogLevel || (exports.LogLevel = {}));
//# sourceMappingURL=ILogger.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\ILogger.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],13:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
// This will be treated as a bit flag in the future, so we keep it using power-of-two values.
/** Specifies a specific HTTP transport type. */
var HttpTransportType;
(function (HttpTransportType) {
    /** Specifies no transport preference. */
    HttpTransportType[HttpTransportType["None"] = 0] = "None";
    /** Specifies the WebSockets transport. */
    HttpTransportType[HttpTransportType["WebSockets"] = 1] = "WebSockets";
    /** Specifies the Server-Sent Events transport. */
    HttpTransportType[HttpTransportType["ServerSentEvents"] = 2] = "ServerSentEvents";
    /** Specifies the Long Polling transport. */
    HttpTransportType[HttpTransportType["LongPolling"] = 4] = "LongPolling";
})(HttpTransportType = exports.HttpTransportType || (exports.HttpTransportType = {}));
/** Specifies the transfer format for a connection. */
var TransferFormat;
(function (TransferFormat) {
    /** Specifies that only text data will be transmitted over the connection. */
    TransferFormat[TransferFormat["Text"] = 1] = "Text";
    /** Specifies that binary data will be transmitted over the connection. */
    TransferFormat[TransferFormat["Binary"] = 2] = "Binary";
})(TransferFormat = exports.TransferFormat || (exports.TransferFormat = {}));
//# sourceMappingURL=ITransport.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\ITransport.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],14:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
var IHubProtocol_1 = require("./IHubProtocol");
var ILogger_1 = require("./ILogger");
var ITransport_1 = require("./ITransport");
var Loggers_1 = require("./Loggers");
var TextMessageFormat_1 = require("./TextMessageFormat");
var JSON_HUB_PROTOCOL_NAME = "json";
/** Implements the JSON Hub Protocol. */
var JsonHubProtocol = /** @class */ (function () {
    function JsonHubProtocol() {
        /** @inheritDoc */
        this.name = JSON_HUB_PROTOCOL_NAME;
        /** @inheritDoc */
        this.version = 1;
        /** @inheritDoc */
        this.transferFormat = ITransport_1.TransferFormat.Text;
    }
    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.
     *
     * @param {string} input A string containing the serialized representation.
     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.
     */
    JsonHubProtocol.prototype.parseMessages = function (input, logger) {
        // The interface does allow "ArrayBuffer" to be passed in, but this implementation does not. So let's throw a useful error.
        if (typeof input !== "string") {
            throw new Error("Invalid input for JSON hub protocol. Expected a string.");
        }
        if (!input) {
            return [];
        }
        if (logger === null) {
            logger = Loggers_1.NullLogger.instance;
        }
        // Parse the messages
        var messages = TextMessageFormat_1.TextMessageFormat.parse(input);
        var hubMessages = [];
        for (var _i = 0, messages_1 = messages; _i < messages_1.length; _i++) {
            var message = messages_1[_i];
            var parsedMessage = JSON.parse(message);
            if (typeof parsedMessage.type !== "number") {
                throw new Error("Invalid payload.");
            }
            switch (parsedMessage.type) {
                case IHubProtocol_1.MessageType.Invocation:
                    this.isInvocationMessage(parsedMessage);
                    break;
                case IHubProtocol_1.MessageType.StreamItem:
                    this.isStreamItemMessage(parsedMessage);
                    break;
                case IHubProtocol_1.MessageType.Completion:
                    this.isCompletionMessage(parsedMessage);
                    break;
                case IHubProtocol_1.MessageType.Ping:
                    // Single value, no need to validate
                    break;
                case IHubProtocol_1.MessageType.Close:
                    // All optional values, no need to validate
                    break;
                default:
                    // Future protocol changes can add message types, old clients can ignore them
                    logger.log(ILogger_1.LogLevel.Information, "Unknown message type '" + parsedMessage.type + "' ignored.");
                    continue;
            }
            hubMessages.push(parsedMessage);
        }
        return hubMessages;
    };
    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.
     *
     * @param {HubMessage} message The message to write.
     * @returns {string} A string containing the serialized representation of the message.
     */
    JsonHubProtocol.prototype.writeMessage = function (message) {
        return TextMessageFormat_1.TextMessageFormat.write(JSON.stringify(message));
    };
    JsonHubProtocol.prototype.isInvocationMessage = function (message) {
        this.assertNotEmptyString(message.target, "Invalid payload for Invocation message.");
        if (message.invocationId !== undefined) {
            this.assertNotEmptyString(message.invocationId, "Invalid payload for Invocation message.");
        }
    };
    JsonHubProtocol.prototype.isStreamItemMessage = function (message) {
        this.assertNotEmptyString(message.invocationId, "Invalid payload for StreamItem message.");
        if (message.item === undefined) {
            throw new Error("Invalid payload for StreamItem message.");
        }
    };
    JsonHubProtocol.prototype.isCompletionMessage = function (message) {
        if (message.result && message.error) {
            throw new Error("Invalid payload for Completion message.");
        }
        if (!message.result && message.error) {
            this.assertNotEmptyString(message.error, "Invalid payload for Completion message.");
        }
        this.assertNotEmptyString(message.invocationId, "Invalid payload for Completion message.");
    };
    JsonHubProtocol.prototype.assertNotEmptyString = function (value, errorMessage) {
        if (typeof value !== "string" || value === "") {
            throw new Error(errorMessage);
        }
    };
    return JsonHubProtocol;
}());
exports.JsonHubProtocol = JsonHubProtocol;
//# sourceMappingURL=JsonHubProtocol.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\JsonHubProtocol.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./IHubProtocol":11,"./ILogger":12,"./ITransport":13,"./Loggers":15,"./TextMessageFormat":19,"buffer":25,"e/U+97":27}],15:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
/** A logger that does nothing when log messages are sent to it. */
var NullLogger = /** @class */ (function () {
    function NullLogger() {
    }
    /** @inheritDoc */
    // tslint:disable-next-line
    NullLogger.prototype.log = function (_logLevel, _message) {
    };
    /** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */
    NullLogger.instance = new NullLogger();
    return NullLogger;
}());
exports.NullLogger = NullLogger;
//# sourceMappingURL=Loggers.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\Loggers.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],16:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var AbortController_1 = require("./AbortController");
var Errors_1 = require("./Errors");
var ILogger_1 = require("./ILogger");
var ITransport_1 = require("./ITransport");
var Utils_1 = require("./Utils");
// Not exported from 'index', this type is internal.
/** @private */
var LongPollingTransport = /** @class */ (function () {
    function LongPollingTransport(httpClient, accessTokenFactory, logger, logMessageContent, withCredentials, headers) {
        this.httpClient = httpClient;
        this.accessTokenFactory = accessTokenFactory;
        this.logger = logger;
        this.pollAbort = new AbortController_1.AbortController();
        this.logMessageContent = logMessageContent;
        this.withCredentials = withCredentials;
        this.headers = headers;
        this.running = false;
        this.onreceive = null;
        this.onclose = null;
    }
    Object.defineProperty(LongPollingTransport.prototype, "pollAborted", {
        // This is an internal type, not exported from 'index' so this is really just internal.
        get: function () {
            return this.pollAbort.aborted;
        },
        enumerable: true,
        configurable: true
    });
    LongPollingTransport.prototype.connect = function (url, transferFormat) {
        return __awaiter(this, void 0, void 0, function () {
            var _a, _b, name, value, headers, pollOptions, token, pollUrl, response;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        Utils_1.Arg.isRequired(url, "url");
                        Utils_1.Arg.isRequired(transferFormat, "transferFormat");
                        Utils_1.Arg.isIn(transferFormat, ITransport_1.TransferFormat, "transferFormat");
                        this.url = url;
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Connecting.");
                        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)
                        if (transferFormat === ITransport_1.TransferFormat.Binary &&
                            (typeof XMLHttpRequest !== "undefined" && typeof new XMLHttpRequest().responseType !== "string")) {
                            throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");
                        }
                        _b = Utils_1.getUserAgentHeader(), name = _b[0], value = _b[1];
                        headers = __assign((_a = {}, _a[name] = value, _a), this.headers);
                        pollOptions = {
                            abortSignal: this.pollAbort.signal,
                            headers: headers,
                            timeout: 100000,
                            withCredentials: this.withCredentials,
                        };
                        if (transferFormat === ITransport_1.TransferFormat.Binary) {
                            pollOptions.responseType = "arraybuffer";
                        }
                        return [4 /*yield*/, this.getAccessToken()];
                    case 1:
                        token = _c.sent();
                        this.updateHeaderToken(pollOptions, token);
                        pollUrl = url + "&_=" + Date.now();
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) polling: " + pollUrl + ".");
                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];
                    case 2:
                        response = _c.sent();
                        if (response.statusCode !== 200) {
                            this.logger.log(ILogger_1.LogLevel.Error, "(LongPolling transport) Unexpected response code: " + response.statusCode + ".");
                            // Mark running as false so that the poll immediately ends and runs the close logic
                            this.closeError = new Errors_1.HttpError(response.statusText || "", response.statusCode);
                            this.running = false;
                        }
                        else {
                            this.running = true;
                        }
                        this.receiving = this.poll(this.url, pollOptions);
                        return [2 /*return*/];
                }
            });
        });
    };
    LongPollingTransport.prototype.getAccessToken = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.accessTokenFactory) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.accessTokenFactory()];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2: return [2 /*return*/, null];
                }
            });
        });
    };
    LongPollingTransport.prototype.updateHeaderToken = function (request, token) {
        if (!request.headers) {
            request.headers = {};
        }
        if (token) {
            // tslint:disable-next-line:no-string-literal
            request.headers["Authorization"] = "Bearer " + token;
            return;
        }
        // tslint:disable-next-line:no-string-literal
        if (request.headers["Authorization"]) {
            // tslint:disable-next-line:no-string-literal
            delete request.headers["Authorization"];
        }
    };
    LongPollingTransport.prototype.poll = function (url, pollOptions) {
        return __awaiter(this, void 0, void 0, function () {
            var token, pollUrl, response, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, , 8, 9]);
                        _a.label = 1;
                    case 1:
                        if (!this.running) return [3 /*break*/, 7];
                        return [4 /*yield*/, this.getAccessToken()];
                    case 2:
                        token = _a.sent();
                        this.updateHeaderToken(pollOptions, token);
                        _a.label = 3;
                    case 3:
                        _a.trys.push([3, 5, , 6]);
                        pollUrl = url + "&_=" + Date.now();
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) polling: " + pollUrl + ".");
                        return [4 /*yield*/, this.httpClient.get(pollUrl, pollOptions)];
                    case 4:
                        response = _a.sent();
                        if (response.statusCode === 204) {
                            this.logger.log(ILogger_1.LogLevel.Information, "(LongPolling transport) Poll terminated by server.");
                            this.running = false;
                        }
                        else if (response.statusCode !== 200) {
                            this.logger.log(ILogger_1.LogLevel.Error, "(LongPolling transport) Unexpected response code: " + response.statusCode + ".");
                            // Unexpected status code
                            this.closeError = new Errors_1.HttpError(response.statusText || "", response.statusCode);
                            this.running = false;
                        }
                        else {
                            // Process the response
                            if (response.content) {
                                this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) data received. " + Utils_1.getDataDetail(response.content, this.logMessageContent) + ".");
                                if (this.onreceive) {
                                    this.onreceive(response.content);
                                }
                            }
                            else {
                                // This is another way timeout manifest.
                                this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Poll timed out, reissuing.");
                            }
                        }
                        return [3 /*break*/, 6];
                    case 5:
                        e_1 = _a.sent();
                        if (!this.running) {
                            // Log but disregard errors that occur after stopping
                            this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Poll errored after shutdown: " + e_1.message);
                        }
                        else {
                            if (e_1 instanceof Errors_1.TimeoutError) {
                                // Ignore timeouts and reissue the poll.
                                this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Poll timed out, reissuing.");
                            }
                            else {
                                // Close the connection with the error as the result.
                                this.closeError = e_1;
                                this.running = false;
                            }
                        }
                        return [3 /*break*/, 6];
                    case 6: return [3 /*break*/, 1];
                    case 7: return [3 /*break*/, 9];
                    case 8:
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Polling complete.");
                        // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.
                        // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.
                        if (!this.pollAborted) {
                            this.raiseOnClose();
                        }
                        return [7 /*endfinally*/];
                    case 9: return [2 /*return*/];
                }
            });
        });
    };
    LongPollingTransport.prototype.send = function (data) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!this.running) {
                    return [2 /*return*/, Promise.reject(new Error("Cannot send until the transport is connected"))];
                }
                return [2 /*return*/, Utils_1.sendMessage(this.logger, "LongPolling", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];
            });
        });
    };
    LongPollingTransport.prototype.stop = function () {
        return __awaiter(this, void 0, void 0, function () {
            var headers, _a, name_1, value, deleteOptions, token;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Stopping polling.");
                        // Tell receiving loop to stop, abort any current request, and then wait for it to finish
                        this.running = false;
                        this.pollAbort.abort();
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, , 5, 6]);
                        return [4 /*yield*/, this.receiving];
                    case 2:
                        _b.sent();
                        // Send DELETE to clean up long polling on the server
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) sending DELETE request to " + this.url + ".");
                        headers = {};
                        _a = Utils_1.getUserAgentHeader(), name_1 = _a[0], value = _a[1];
                        headers[name_1] = value;
                        deleteOptions = {
                            headers: __assign({}, headers, this.headers),
                            withCredentials: this.withCredentials,
                        };
                        return [4 /*yield*/, this.getAccessToken()];
                    case 3:
                        token = _b.sent();
                        this.updateHeaderToken(deleteOptions, token);
                        return [4 /*yield*/, this.httpClient.delete(this.url, deleteOptions)];
                    case 4:
                        _b.sent();
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) DELETE request sent.");
                        return [3 /*break*/, 6];
                    case 5:
                        this.logger.log(ILogger_1.LogLevel.Trace, "(LongPolling transport) Stop finished.");
                        // Raise close event here instead of in polling
                        // It needs to happen after the DELETE request is sent
                        this.raiseOnClose();
                        return [7 /*endfinally*/];
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    LongPollingTransport.prototype.raiseOnClose = function () {
        if (this.onclose) {
            var logMessage = "(LongPolling transport) Firing onclose event.";
            if (this.closeError) {
                logMessage += " Error: " + this.closeError;
            }
            this.logger.log(ILogger_1.LogLevel.Trace, logMessage);
            this.onclose(this.closeError);
        }
    };
    return LongPollingTransport;
}());
exports.LongPollingTransport = LongPollingTransport;
//# sourceMappingURL=LongPollingTransport.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\LongPollingTransport.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./AbortController":1,"./Errors":4,"./ILogger":12,"./ITransport":13,"./Utils":20,"buffer":25,"e/U+97":27}],17:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var ILogger_1 = require("./ILogger");
var ITransport_1 = require("./ITransport");
var Utils_1 = require("./Utils");
/** @private */
var ServerSentEventsTransport = /** @class */ (function () {
    function ServerSentEventsTransport(httpClient, accessTokenFactory, logger, logMessageContent, eventSourceConstructor, withCredentials, headers) {
        this.httpClient = httpClient;
        this.accessTokenFactory = accessTokenFactory;
        this.logger = logger;
        this.logMessageContent = logMessageContent;
        this.withCredentials = withCredentials;
        this.eventSourceConstructor = eventSourceConstructor;
        this.headers = headers;
        this.onreceive = null;
        this.onclose = null;
    }
    ServerSentEventsTransport.prototype.connect = function (url, transferFormat) {
        return __awaiter(this, void 0, void 0, function () {
            var token;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        Utils_1.Arg.isRequired(url, "url");
                        Utils_1.Arg.isRequired(transferFormat, "transferFormat");
                        Utils_1.Arg.isIn(transferFormat, ITransport_1.TransferFormat, "transferFormat");
                        this.logger.log(ILogger_1.LogLevel.Trace, "(SSE transport) Connecting.");
                        // set url before accessTokenFactory because this.url is only for send and we set the auth header instead of the query string for send
                        this.url = url;
                        if (!this.accessTokenFactory) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.accessTokenFactory()];
                    case 1:
                        token = _a.sent();
                        if (token) {
                            url += (url.indexOf("?") < 0 ? "?" : "&") + ("access_token=" + encodeURIComponent(token));
                        }
                        _a.label = 2;
                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {
                            var opened = false;
                            if (transferFormat !== ITransport_1.TransferFormat.Text) {
                                reject(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));
                                return;
                            }
                            var eventSource;
                            if (Utils_1.Platform.isBrowser || Utils_1.Platform.isWebWorker) {
                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials });
                            }
                            else {
                                // Non-browser passes cookies via the dictionary
                                var cookies = _this.httpClient.getCookieString(url);
                                var headers = {};
                                headers.Cookie = cookies;
                                var _a = Utils_1.getUserAgentHeader(), name_1 = _a[0], value = _a[1];
                                headers[name_1] = value;
                                eventSource = new _this.eventSourceConstructor(url, { withCredentials: _this.withCredentials, headers: __assign({}, headers, _this.headers) });
                            }
                            try {
                                eventSource.onmessage = function (e) {
                                    if (_this.onreceive) {
                                        try {
                                            _this.logger.log(ILogger_1.LogLevel.Trace, "(SSE transport) data received. " + Utils_1.getDataDetail(e.data, _this.logMessageContent) + ".");
                                            _this.onreceive(e.data);
                                        }
                                        catch (error) {
                                            _this.close(error);
                                            return;
                                        }
                                    }
                                };
                                eventSource.onerror = function (e) {
                                    var error = new Error(e.data || "Error occurred");
                                    if (opened) {
                                        _this.close(error);
                                    }
                                    else {
                                        reject(error);
                                    }
                                };
                                eventSource.onopen = function () {
                                    _this.logger.log(ILogger_1.LogLevel.Information, "SSE connected to " + _this.url);
                                    _this.eventSource = eventSource;
                                    opened = true;
                                    resolve();
                                };
                            }
                            catch (e) {
                                reject(e);
                                return;
                            }
                        })];
                }
            });
        });
    };
    ServerSentEventsTransport.prototype.send = function (data) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!this.eventSource) {
                    return [2 /*return*/, Promise.reject(new Error("Cannot send until the transport is connected"))];
                }
                return [2 /*return*/, Utils_1.sendMessage(this.logger, "SSE", this.httpClient, this.url, this.accessTokenFactory, data, this.logMessageContent, this.withCredentials, this.headers)];
            });
        });
    };
    ServerSentEventsTransport.prototype.stop = function () {
        this.close();
        return Promise.resolve();
    };
    ServerSentEventsTransport.prototype.close = function (e) {
        if (this.eventSource) {
            this.eventSource.close();
            this.eventSource = undefined;
            if (this.onclose) {
                this.onclose(e);
            }
        }
    };
    return ServerSentEventsTransport;
}());
exports.ServerSentEventsTransport = ServerSentEventsTransport;
//# sourceMappingURL=ServerSentEventsTransport.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\ServerSentEventsTransport.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./ILogger":12,"./ITransport":13,"./Utils":20,"buffer":25,"e/U+97":27}],18:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
var Utils_1 = require("./Utils");
/** Stream implementation to stream items to the server. */
var Subject = /** @class */ (function () {
    function Subject() {
        this.observers = [];
    }
    Subject.prototype.next = function (item) {
        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {
            var observer = _a[_i];
            observer.next(item);
        }
    };
    Subject.prototype.error = function (err) {
        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {
            var observer = _a[_i];
            if (observer.error) {
                observer.error(err);
            }
        }
    };
    Subject.prototype.complete = function () {
        for (var _i = 0, _a = this.observers; _i < _a.length; _i++) {
            var observer = _a[_i];
            if (observer.complete) {
                observer.complete();
            }
        }
    };
    Subject.prototype.subscribe = function (observer) {
        this.observers.push(observer);
        return new Utils_1.SubjectSubscription(this, observer);
    };
    return Subject;
}());
exports.Subject = Subject;
//# sourceMappingURL=Subject.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\Subject.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./Utils":20,"buffer":25,"e/U+97":27}],19:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
// Not exported from index
/** @private */
var TextMessageFormat = /** @class */ (function () {
    function TextMessageFormat() {
    }
    TextMessageFormat.write = function (output) {
        return "" + output + TextMessageFormat.RecordSeparator;
    };
    TextMessageFormat.parse = function (input) {
        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {
            throw new Error("Message is incomplete.");
        }
        var messages = input.split(TextMessageFormat.RecordSeparator);
        messages.pop();
        return messages;
    };
    TextMessageFormat.RecordSeparatorCode = 0x1e;
    TextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);
    return TextMessageFormat;
}());
exports.TextMessageFormat = TextMessageFormat;
//# sourceMappingURL=TextMessageFormat.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\TextMessageFormat.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"buffer":25,"e/U+97":27}],20:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var ILogger_1 = require("./ILogger");
var Loggers_1 = require("./Loggers");
// Version token that will be replaced by the prepack command
/** The version of the SignalR client. */
exports.VERSION = "5.0.5";
/** @private */
var Arg = /** @class */ (function () {
    function Arg() {
    }
    Arg.isRequired = function (val, name) {
        if (val === null || val === undefined) {
            throw new Error("The '" + name + "' argument is required.");
        }
    };
    Arg.isNotEmpty = function (val, name) {
        if (!val || val.match(/^\s*$/)) {
            throw new Error("The '" + name + "' argument should not be empty.");
        }
    };
    Arg.isIn = function (val, values, name) {
        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.
        if (!(val in values)) {
            throw new Error("Unknown " + name + " value: " + val + ".");
        }
    };
    return Arg;
}());
exports.Arg = Arg;
/** @private */
var Platform = /** @class */ (function () {
    function Platform() {
    }
    Object.defineProperty(Platform, "isBrowser", {
        get: function () {
            return typeof window === "object";
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Platform, "isWebWorker", {
        get: function () {
            return typeof self === "object" && "importScripts" in self;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Platform, "isNode", {
        get: function () {
            return !this.isBrowser && !this.isWebWorker;
        },
        enumerable: true,
        configurable: true
    });
    return Platform;
}());
exports.Platform = Platform;
/** @private */
function getDataDetail(data, includeContent) {
    var detail = "";
    if (isArrayBuffer(data)) {
        detail = "Binary data of length " + data.byteLength;
        if (includeContent) {
            detail += ". Content: '" + formatArrayBuffer(data) + "'";
        }
    }
    else if (typeof data === "string") {
        detail = "String data of length " + data.length;
        if (includeContent) {
            detail += ". Content: '" + data + "'";
        }
    }
    return detail;
}
exports.getDataDetail = getDataDetail;
/** @private */
function formatArrayBuffer(data) {
    var view = new Uint8Array(data);
    // Uint8Array.map only supports returning another Uint8Array?
    var str = "";
    view.forEach(function (num) {
        var pad = num < 16 ? "0" : "";
        str += "0x" + pad + num.toString(16) + " ";
    });
    // Trim of trailing space.
    return str.substr(0, str.length - 1);
}
exports.formatArrayBuffer = formatArrayBuffer;
// Also in signalr-protocol-msgpack/Utils.ts
/** @private */
function isArrayBuffer(val) {
    return val && typeof ArrayBuffer !== "undefined" &&
        (val instanceof ArrayBuffer ||
            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof
            (val.constructor && val.constructor.name === "ArrayBuffer"));
}
exports.isArrayBuffer = isArrayBuffer;
/** @private */
function sendMessage(logger, transportName, httpClient, url, accessTokenFactory, content, logMessageContent, withCredentials, defaultHeaders) {
    return __awaiter(this, void 0, void 0, function () {
        var _a, headers, token, _b, name, value, responseType, response;
        return __generator(this, function (_c) {
            switch (_c.label) {
                case 0:
                    headers = {};
                    if (!accessTokenFactory) return [3 /*break*/, 2];
                    return [4 /*yield*/, accessTokenFactory()];
                case 1:
                    token = _c.sent();
                    if (token) {
                        headers = (_a = {},
                            _a["Authorization"] = "Bearer " + token,
                            _a);
                    }
                    _c.label = 2;
                case 2:
                    _b = getUserAgentHeader(), name = _b[0], value = _b[1];
                    headers[name] = value;
                    logger.log(ILogger_1.LogLevel.Trace, "(" + transportName + " transport) sending data. " + getDataDetail(content, logMessageContent) + ".");
                    responseType = isArrayBuffer(content) ? "arraybuffer" : "text";
                    return [4 /*yield*/, httpClient.post(url, {
                            content: content,
                            headers: __assign({}, headers, defaultHeaders),
                            responseType: responseType,
                            withCredentials: withCredentials,
                        })];
                case 3:
                    response = _c.sent();
                    logger.log(ILogger_1.LogLevel.Trace, "(" + transportName + " transport) request complete. Response status: " + response.statusCode + ".");
                    return [2 /*return*/];
            }
        });
    });
}
exports.sendMessage = sendMessage;
/** @private */
function createLogger(logger) {
    if (logger === undefined) {
        return new ConsoleLogger(ILogger_1.LogLevel.Information);
    }
    if (logger === null) {
        return Loggers_1.NullLogger.instance;
    }
    if (logger.log) {
        return logger;
    }
    return new ConsoleLogger(logger);
}
exports.createLogger = createLogger;
/** @private */
var SubjectSubscription = /** @class */ (function () {
    function SubjectSubscription(subject, observer) {
        this.subject = subject;
        this.observer = observer;
    }
    SubjectSubscription.prototype.dispose = function () {
        var index = this.subject.observers.indexOf(this.observer);
        if (index > -1) {
            this.subject.observers.splice(index, 1);
        }
        if (this.subject.observers.length === 0 && this.subject.cancelCallback) {
            this.subject.cancelCallback().catch(function (_) { });
        }
    };
    return SubjectSubscription;
}());
exports.SubjectSubscription = SubjectSubscription;
/** @private */
var ConsoleLogger = /** @class */ (function () {
    function ConsoleLogger(minimumLogLevel) {
        this.minimumLogLevel = minimumLogLevel;
        this.outputConsole = console;
    }
    ConsoleLogger.prototype.log = function (logLevel, message) {
        if (logLevel >= this.minimumLogLevel) {
            switch (logLevel) {
                case ILogger_1.LogLevel.Critical:
                case ILogger_1.LogLevel.Error:
                    this.outputConsole.error("[" + new Date().toISOString() + "] " + ILogger_1.LogLevel[logLevel] + ": " + message);
                    break;
                case ILogger_1.LogLevel.Warning:
                    this.outputConsole.warn("[" + new Date().toISOString() + "] " + ILogger_1.LogLevel[logLevel] + ": " + message);
                    break;
                case ILogger_1.LogLevel.Information:
                    this.outputConsole.info("[" + new Date().toISOString() + "] " + ILogger_1.LogLevel[logLevel] + ": " + message);
                    break;
                default:
                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug
                    this.outputConsole.log("[" + new Date().toISOString() + "] " + ILogger_1.LogLevel[logLevel] + ": " + message);
                    break;
            }
        }
    };
    return ConsoleLogger;
}());
exports.ConsoleLogger = ConsoleLogger;
/** @private */
function getUserAgentHeader() {
    var userAgentHeaderName = "X-SignalR-User-Agent";
    if (Platform.isNode) {
        userAgentHeaderName = "User-Agent";
    }
    return [userAgentHeaderName, constructUserAgent(exports.VERSION, getOsName(), getRuntime(), getRuntimeVersion())];
}
exports.getUserAgentHeader = getUserAgentHeader;
/** @private */
function constructUserAgent(version, os, runtime, runtimeVersion) {
    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])
    var userAgent = "Microsoft SignalR/";
    var majorAndMinor = version.split(".");
    userAgent += majorAndMinor[0] + "." + majorAndMinor[1];
    userAgent += " (" + version + "; ";
    if (os && os !== "") {
        userAgent += os + "; ";
    }
    else {
        userAgent += "Unknown OS; ";
    }
    userAgent += "" + runtime;
    if (runtimeVersion) {
        userAgent += "; " + runtimeVersion;
    }
    else {
        userAgent += "; Unknown Runtime Version";
    }
    userAgent += ")";
    return userAgent;
}
exports.constructUserAgent = constructUserAgent;
function getOsName() {
    if (Platform.isNode) {
        switch (process.platform) {
            case "win32":
                return "Windows NT";
            case "darwin":
                return "macOS";
            case "linux":
                return "Linux";
            default:
                return process.platform;
        }
    }
    else {
        return "";
    }
}
function getRuntimeVersion() {
    if (Platform.isNode) {
        return process.versions.node;
    }
    return undefined;
}
function getRuntime() {
    if (Platform.isNode) {
        return "NodeJS";
    }
    else {
        return "Browser";
    }
}
//# sourceMappingURL=Utils.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\Utils.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./ILogger":12,"./Loggers":15,"buffer":25,"e/U+97":27}],21:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var ILogger_1 = require("./ILogger");
var ITransport_1 = require("./ITransport");
var Utils_1 = require("./Utils");
/** @private */
var WebSocketTransport = /** @class */ (function () {
    function WebSocketTransport(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {
        this.logger = logger;
        this.accessTokenFactory = accessTokenFactory;
        this.logMessageContent = logMessageContent;
        this.webSocketConstructor = webSocketConstructor;
        this.httpClient = httpClient;
        this.onreceive = null;
        this.onclose = null;
        this.headers = headers;
    }
    WebSocketTransport.prototype.connect = function (url, transferFormat) {
        return __awaiter(this, void 0, void 0, function () {
            var token;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        Utils_1.Arg.isRequired(url, "url");
                        Utils_1.Arg.isRequired(transferFormat, "transferFormat");
                        Utils_1.Arg.isIn(transferFormat, ITransport_1.TransferFormat, "transferFormat");
                        this.logger.log(ILogger_1.LogLevel.Trace, "(WebSockets transport) Connecting.");
                        if (!this.accessTokenFactory) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.accessTokenFactory()];
                    case 1:
                        token = _a.sent();
                        if (token) {
                            url += (url.indexOf("?") < 0 ? "?" : "&") + ("access_token=" + encodeURIComponent(token));
                        }
                        _a.label = 2;
                    case 2: return [2 /*return*/, new Promise(function (resolve, reject) {
                            url = url.replace(/^http/, "ws");
                            var webSocket;
                            var cookies = _this.httpClient.getCookieString(url);
                            var opened = false;
                            if (Utils_1.Platform.isNode) {
                                var headers = {};
                                var _a = Utils_1.getUserAgentHeader(), name_1 = _a[0], value = _a[1];
                                headers[name_1] = value;
                                if (cookies) {
                                    headers["Cookie"] = "" + cookies;
                                }
                                // Only pass headers when in non-browser environments
                                webSocket = new _this.webSocketConstructor(url, undefined, {
                                    headers: __assign({}, headers, _this.headers),
                                });
                            }
                            if (!webSocket) {
                                // Chrome is not happy with passing 'undefined' as protocol
                                webSocket = new _this.webSocketConstructor(url);
                            }
                            if (transferFormat === ITransport_1.TransferFormat.Binary) {
                                webSocket.binaryType = "arraybuffer";
                            }
                            // tslint:disable-next-line:variable-name
                            webSocket.onopen = function (_event) {
                                _this.logger.log(ILogger_1.LogLevel.Information, "WebSocket connected to " + url + ".");
                                _this.webSocket = webSocket;
                                opened = true;
                                resolve();
                            };
                            webSocket.onerror = function (event) {
                                var error = null;
                                // ErrorEvent is a browser only type we need to check if the type exists before using it
                                if (typeof ErrorEvent !== "undefined" && event instanceof ErrorEvent) {
                                    error = event.error;
                                }
                                else {
                                    error = new Error("There was an error with the transport.");
                                }
                                reject(error);
                            };
                            webSocket.onmessage = function (message) {
                                _this.logger.log(ILogger_1.LogLevel.Trace, "(WebSockets transport) data received. " + Utils_1.getDataDetail(message.data, _this.logMessageContent) + ".");
                                if (_this.onreceive) {
                                    try {
                                        _this.onreceive(message.data);
                                    }
                                    catch (error) {
                                        _this.close(error);
                                        return;
                                    }
                                }
                            };
                            webSocket.onclose = function (event) {
                                // Don't call close handler if connection was never established
                                // We'll reject the connect call instead
                                if (opened) {
                                    _this.close(event);
                                }
                                else {
                                    var error = null;
                                    // ErrorEvent is a browser only type we need to check if the type exists before using it
                                    if (typeof ErrorEvent !== "undefined" && event instanceof ErrorEvent) {
                                        error = event.error;
                                    }
                                    else {
                                        error = new Error("There was an error with the transport.");
                                    }
                                    reject(error);
                                }
                            };
                        })];
                }
            });
        });
    };
    WebSocketTransport.prototype.send = function (data) {
        if (this.webSocket && this.webSocket.readyState === this.webSocketConstructor.OPEN) {
            this.logger.log(ILogger_1.LogLevel.Trace, "(WebSockets transport) sending data. " + Utils_1.getDataDetail(data, this.logMessageContent) + ".");
            this.webSocket.send(data);
            return Promise.resolve();
        }
        return Promise.reject("WebSocket is not in the OPEN state");
    };
    WebSocketTransport.prototype.stop = function () {
        if (this.webSocket) {
            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning
            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects
            this.close(undefined);
        }
        return Promise.resolve();
    };
    WebSocketTransport.prototype.close = function (event) {
        // webSocket will be null if the transport did not start successfully
        if (this.webSocket) {
            // Clear websocket handlers because we are considering the socket closed now
            this.webSocket.onclose = function () { };
            this.webSocket.onmessage = function () { };
            this.webSocket.onerror = function () { };
            this.webSocket.close();
            this.webSocket = undefined;
        }
        this.logger.log(ILogger_1.LogLevel.Trace, "(WebSockets transport) socket closed.");
        if (this.onclose) {
            if (this.isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {
                this.onclose(new Error("WebSocket closed with status code: " + event.code + " (" + event.reason + ")."));
            }
            else if (event instanceof Error) {
                this.onclose(event);
            }
            else {
                this.onclose();
            }
        }
    };
    WebSocketTransport.prototype.isCloseEvent = function (event) {
        return event && typeof event.wasClean === "boolean" && typeof event.code === "number";
    };
    return WebSocketTransport;
}());
exports.WebSocketTransport = WebSocketTransport;
//# sourceMappingURL=WebSocketTransport.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\WebSocketTransport.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./ILogger":12,"./ITransport":13,"./Utils":20,"buffer":25,"e/U+97":27}],22:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Errors_1 = require("./Errors");
var HttpClient_1 = require("./HttpClient");
var ILogger_1 = require("./ILogger");
var XhrHttpClient = /** @class */ (function (_super) {
    __extends(XhrHttpClient, _super);
    function XhrHttpClient(logger) {
        var _this = _super.call(this) || this;
        _this.logger = logger;
        return _this;
    }
    /** @inheritDoc */
    XhrHttpClient.prototype.send = function (request) {
        var _this = this;
        // Check that abort was not signaled before calling send
        if (request.abortSignal && request.abortSignal.aborted) {
            return Promise.reject(new Errors_1.AbortError());
        }
        if (!request.method) {
            return Promise.reject(new Error("No method defined."));
        }
        if (!request.url) {
            return Promise.reject(new Error("No url defined."));
        }
        return new Promise(function (resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.open(request.method, request.url, true);
            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;
            xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
            // Explicitly setting the Content-Type header for React Native on Android platform.
            xhr.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
            var headers = request.headers;
            if (headers) {
                Object.keys(headers)
                    .forEach(function (header) {
                    xhr.setRequestHeader(header, headers[header]);
                });
            }
            if (request.responseType) {
                xhr.responseType = request.responseType;
            }
            if (request.abortSignal) {
                request.abortSignal.onabort = function () {
                    xhr.abort();
                    reject(new Errors_1.AbortError());
                };
            }
            if (request.timeout) {
                xhr.timeout = request.timeout;
            }
            xhr.onload = function () {
                if (request.abortSignal) {
                    request.abortSignal.onabort = null;
                }
                if (xhr.status >= 200 && xhr.status < 300) {
                    resolve(new HttpClient_1.HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));
                }
                else {
                    reject(new Errors_1.HttpError(xhr.statusText, xhr.status));
                }
            };
            xhr.onerror = function () {
                _this.logger.log(ILogger_1.LogLevel.Warning, "Error from HTTP request. " + xhr.status + ": " + xhr.statusText + ".");
                reject(new Errors_1.HttpError(xhr.statusText, xhr.status));
            };
            xhr.ontimeout = function () {
                _this.logger.log(ILogger_1.LogLevel.Warning, "Timeout from HTTP request.");
                reject(new Errors_1.TimeoutError());
            };
            xhr.send(request.content || "");
        });
    };
    return XhrHttpClient;
}(HttpClient_1.HttpClient));
exports.XhrHttpClient = XhrHttpClient;
//# sourceMappingURL=XhrHttpClient.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\XhrHttpClient.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./Errors":4,"./HttpClient":7,"./ILogger":12,"buffer":25,"e/U+97":27}],23:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
var Errors_1 = require("./Errors");
exports.AbortError = Errors_1.AbortError;
exports.HttpError = Errors_1.HttpError;
exports.TimeoutError = Errors_1.TimeoutError;
var HttpClient_1 = require("./HttpClient");
exports.HttpClient = HttpClient_1.HttpClient;
exports.HttpResponse = HttpClient_1.HttpResponse;
var DefaultHttpClient_1 = require("./DefaultHttpClient");
exports.DefaultHttpClient = DefaultHttpClient_1.DefaultHttpClient;
var HubConnection_1 = require("./HubConnection");
exports.HubConnection = HubConnection_1.HubConnection;
exports.HubConnectionState = HubConnection_1.HubConnectionState;
var HubConnectionBuilder_1 = require("./HubConnectionBuilder");
exports.HubConnectionBuilder = HubConnectionBuilder_1.HubConnectionBuilder;
var IHubProtocol_1 = require("./IHubProtocol");
exports.MessageType = IHubProtocol_1.MessageType;
var ILogger_1 = require("./ILogger");
exports.LogLevel = ILogger_1.LogLevel;
var ITransport_1 = require("./ITransport");
exports.HttpTransportType = ITransport_1.HttpTransportType;
exports.TransferFormat = ITransport_1.TransferFormat;
var Loggers_1 = require("./Loggers");
exports.NullLogger = Loggers_1.NullLogger;
var JsonHubProtocol_1 = require("./JsonHubProtocol");
exports.JsonHubProtocol = JsonHubProtocol_1.JsonHubProtocol;
var Subject_1 = require("./Subject");
exports.Subject = Subject_1.Subject;
var Utils_1 = require("./Utils");
exports.VERSION = Utils_1.VERSION;
//# sourceMappingURL=index.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs\\index.js","/..\\..\\node_modules\\@microsoft\\signalr\\dist\\cjs")
},{"./DefaultHttpClient":2,"./Errors":4,"./HttpClient":7,"./HubConnection":9,"./HubConnectionBuilder":10,"./IHubProtocol":11,"./ILogger":12,"./ITransport":13,"./JsonHubProtocol":14,"./Loggers":15,"./Subject":18,"./Utils":20,"buffer":25,"e/U+97":27}],24:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

;(function (exports) {
	'use strict';

  var Arr = (typeof Uint8Array !== 'undefined')
    ? Uint8Array
    : Array

	var PLUS   = '+'.charCodeAt(0)
	var SLASH  = '/'.charCodeAt(0)
	var NUMBER = '0'.charCodeAt(0)
	var LOWER  = 'a'.charCodeAt(0)
	var UPPER  = 'A'.charCodeAt(0)
	var PLUS_URL_SAFE = '-'.charCodeAt(0)
	var SLASH_URL_SAFE = '_'.charCodeAt(0)

	function decode (elt) {
		var code = elt.charCodeAt(0)
		if (code === PLUS ||
		    code === PLUS_URL_SAFE)
			return 62 // '+'
		if (code === SLASH ||
		    code === SLASH_URL_SAFE)
			return 63 // '/'
		if (code < NUMBER)
			return -1 //no match
		if (code < NUMBER + 10)
			return code - NUMBER + 26 + 26
		if (code < UPPER + 26)
			return code - UPPER
		if (code < LOWER + 26)
			return code - LOWER + 26
	}

	function b64ToByteArray (b64) {
		var i, j, l, tmp, placeHolders, arr

		if (b64.length % 4 > 0) {
			throw new Error('Invalid string. Length must be a multiple of 4')
		}

		// the number of equal signs (place holders)
		// if there are two placeholders, than the two characters before it
		// represent one byte
		// if there is only one, then the three characters before it represent 2 bytes
		// this is just a cheap hack to not do indexOf twice
		var len = b64.length
		placeHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0

		// base64 is 4/3 + up to two characters of the original data
		arr = new Arr(b64.length * 3 / 4 - placeHolders)

		// if there are placeholders, only get up to the last complete 4 chars
		l = placeHolders > 0 ? b64.length - 4 : b64.length

		var L = 0

		function push (v) {
			arr[L++] = v
		}

		for (i = 0, j = 0; i < l; i += 4, j += 3) {
			tmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))
			push((tmp & 0xFF0000) >> 16)
			push((tmp & 0xFF00) >> 8)
			push(tmp & 0xFF)
		}

		if (placeHolders === 2) {
			tmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)
			push(tmp & 0xFF)
		} else if (placeHolders === 1) {
			tmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)
			push((tmp >> 8) & 0xFF)
			push(tmp & 0xFF)
		}

		return arr
	}

	function uint8ToBase64 (uint8) {
		var i,
			extraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes
			output = "",
			temp, length

		function encode (num) {
			return lookup.charAt(num)
		}

		function tripletToBase64 (num) {
			return encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)
		}

		// go through the array every three bytes, we'll deal with trailing stuff later
		for (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {
			temp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])
			output += tripletToBase64(temp)
		}

		// pad the end with zeros, but make sure to not forget the extra bytes
		switch (extraBytes) {
			case 1:
				temp = uint8[uint8.length - 1]
				output += encode(temp >> 2)
				output += encode((temp << 4) & 0x3F)
				output += '=='
				break
			case 2:
				temp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])
				output += encode(temp >> 10)
				output += encode((temp >> 4) & 0x3F)
				output += encode((temp << 2) & 0x3F)
				output += '='
				break
		}

		return output
	}

	exports.toByteArray = b64ToByteArray
	exports.fromByteArray = uint8ToBase64
}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))

}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\base64-js\\lib\\b64.js","/..\\..\\node_modules\\base64-js\\lib")
},{"buffer":25,"e/U+97":27}],25:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */

var base64 = require('base64-js')
var ieee754 = require('ieee754')

exports.Buffer = Buffer
exports.SlowBuffer = Buffer
exports.INSPECT_MAX_BYTES = 50
Buffer.poolSize = 8192

/**
 * If `Buffer._useTypedArrays`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Use Object implementation (compatible down to IE6)
 */
Buffer._useTypedArrays = (function () {
  // Detect if browser supports Typed Arrays. Supported browsers are IE 10+, Firefox 4+,
  // Chrome 7+, Safari 5.1+, Opera 11.6+, iOS 4.2+. If the browser does not support adding
  // properties to `Uint8Array` instances, then that's the same as no `Uint8Array` support
  // because we need to be able to add all the node Buffer API methods. This is an issue
  // in Firefox 4-29. Now fixed: https://bugzilla.mozilla.org/show_bug.cgi?id=695438
  try {
    var buf = new ArrayBuffer(0)
    var arr = new Uint8Array(buf)
    arr.foo = function () { return 42 }
    return 42 === arr.foo() &&
        typeof arr.subarray === 'function' // Chrome 9-10 lack `subarray`
  } catch (e) {
    return false
  }
})()

/**
 * Class: Buffer
 * =============
 *
 * The Buffer constructor returns instances of `Uint8Array` that are augmented
 * with function properties for all the node `Buffer` API functions. We use
 * `Uint8Array` so that square bracket notation works as expected -- it returns
 * a single octet.
 *
 * By augmenting the instances, we can avoid modifying the `Uint8Array`
 * prototype.
 */
function Buffer (subject, encoding, noZero) {
  if (!(this instanceof Buffer))
    return new Buffer(subject, encoding, noZero)

  var type = typeof subject

  // Workaround: node's base64 implementation allows for non-padded strings
  // while base64-js does not.
  if (encoding === 'base64' && type === 'string') {
    subject = stringtrim(subject)
    while (subject.length % 4 !== 0) {
      subject = subject + '='
    }
  }

  // Find the length
  var length
  if (type === 'number')
    length = coerce(subject)
  else if (type === 'string')
    length = Buffer.byteLength(subject, encoding)
  else if (type === 'object')
    length = coerce(subject.length) // assume that object is array-like
  else
    throw new Error('First argument needs to be a number, array or string.')

  var buf
  if (Buffer._useTypedArrays) {
    // Preferred: Return an augmented `Uint8Array` instance for best performance
    buf = Buffer._augment(new Uint8Array(length))
  } else {
    // Fallback: Return THIS instance of Buffer (created by `new`)
    buf = this
    buf.length = length
    buf._isBuffer = true
  }

  var i
  if (Buffer._useTypedArrays && typeof subject.byteLength === 'number') {
    // Speed optimization -- use set if we're copying from a typed array
    buf._set(subject)
  } else if (isArrayish(subject)) {
    // Treat array-ish objects as a byte array
    for (i = 0; i < length; i++) {
      if (Buffer.isBuffer(subject))
        buf[i] = subject.readUInt8(i)
      else
        buf[i] = subject[i]
    }
  } else if (type === 'string') {
    buf.write(subject, 0, encoding)
  } else if (type === 'number' && !Buffer._useTypedArrays && !noZero) {
    for (i = 0; i < length; i++) {
      buf[i] = 0
    }
  }

  return buf
}

// STATIC METHODS
// ==============

Buffer.isEncoding = function (encoding) {
  switch (String(encoding).toLowerCase()) {
    case 'hex':
    case 'utf8':
    case 'utf-8':
    case 'ascii':
    case 'binary':
    case 'base64':
    case 'raw':
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      return true
    default:
      return false
  }
}

Buffer.isBuffer = function (b) {
  return !!(b !== null && b !== undefined && b._isBuffer)
}

Buffer.byteLength = function (str, encoding) {
  var ret
  str = str + ''
  switch (encoding || 'utf8') {
    case 'hex':
      ret = str.length / 2
      break
    case 'utf8':
    case 'utf-8':
      ret = utf8ToBytes(str).length
      break
    case 'ascii':
    case 'binary':
    case 'raw':
      ret = str.length
      break
    case 'base64':
      ret = base64ToBytes(str).length
      break
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      ret = str.length * 2
      break
    default:
      throw new Error('Unknown encoding')
  }
  return ret
}

Buffer.concat = function (list, totalLength) {
  assert(isArray(list), 'Usage: Buffer.concat(list, [totalLength])\n' +
      'list should be an Array.')

  if (list.length === 0) {
    return new Buffer(0)
  } else if (list.length === 1) {
    return list[0]
  }

  var i
  if (typeof totalLength !== 'number') {
    totalLength = 0
    for (i = 0; i < list.length; i++) {
      totalLength += list[i].length
    }
  }

  var buf = new Buffer(totalLength)
  var pos = 0
  for (i = 0; i < list.length; i++) {
    var item = list[i]
    item.copy(buf, pos)
    pos += item.length
  }
  return buf
}

// BUFFER INSTANCE METHODS
// =======================

function _hexWrite (buf, string, offset, length) {
  offset = Number(offset) || 0
  var remaining = buf.length - offset
  if (!length) {
    length = remaining
  } else {
    length = Number(length)
    if (length > remaining) {
      length = remaining
    }
  }

  // must be an even number of digits
  var strLen = string.length
  assert(strLen % 2 === 0, 'Invalid hex string')

  if (length > strLen / 2) {
    length = strLen / 2
  }
  for (var i = 0; i < length; i++) {
    var byte = parseInt(string.substr(i * 2, 2), 16)
    assert(!isNaN(byte), 'Invalid hex string')
    buf[offset + i] = byte
  }
  Buffer._charsWritten = i * 2
  return i
}

function _utf8Write (buf, string, offset, length) {
  var charsWritten = Buffer._charsWritten =
    blitBuffer(utf8ToBytes(string), buf, offset, length)
  return charsWritten
}

function _asciiWrite (buf, string, offset, length) {
  var charsWritten = Buffer._charsWritten =
    blitBuffer(asciiToBytes(string), buf, offset, length)
  return charsWritten
}

function _binaryWrite (buf, string, offset, length) {
  return _asciiWrite(buf, string, offset, length)
}

function _base64Write (buf, string, offset, length) {
  var charsWritten = Buffer._charsWritten =
    blitBuffer(base64ToBytes(string), buf, offset, length)
  return charsWritten
}

function _utf16leWrite (buf, string, offset, length) {
  var charsWritten = Buffer._charsWritten =
    blitBuffer(utf16leToBytes(string), buf, offset, length)
  return charsWritten
}

Buffer.prototype.write = function (string, offset, length, encoding) {
  // Support both (string, offset, length, encoding)
  // and the legacy (string, encoding, offset, length)
  if (isFinite(offset)) {
    if (!isFinite(length)) {
      encoding = length
      length = undefined
    }
  } else {  // legacy
    var swap = encoding
    encoding = offset
    offset = length
    length = swap
  }

  offset = Number(offset) || 0
  var remaining = this.length - offset
  if (!length) {
    length = remaining
  } else {
    length = Number(length)
    if (length > remaining) {
      length = remaining
    }
  }
  encoding = String(encoding || 'utf8').toLowerCase()

  var ret
  switch (encoding) {
    case 'hex':
      ret = _hexWrite(this, string, offset, length)
      break
    case 'utf8':
    case 'utf-8':
      ret = _utf8Write(this, string, offset, length)
      break
    case 'ascii':
      ret = _asciiWrite(this, string, offset, length)
      break
    case 'binary':
      ret = _binaryWrite(this, string, offset, length)
      break
    case 'base64':
      ret = _base64Write(this, string, offset, length)
      break
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      ret = _utf16leWrite(this, string, offset, length)
      break
    default:
      throw new Error('Unknown encoding')
  }
  return ret
}

Buffer.prototype.toString = function (encoding, start, end) {
  var self = this

  encoding = String(encoding || 'utf8').toLowerCase()
  start = Number(start) || 0
  end = (end !== undefined)
    ? Number(end)
    : end = self.length

  // Fastpath empty strings
  if (end === start)
    return ''

  var ret
  switch (encoding) {
    case 'hex':
      ret = _hexSlice(self, start, end)
      break
    case 'utf8':
    case 'utf-8':
      ret = _utf8Slice(self, start, end)
      break
    case 'ascii':
      ret = _asciiSlice(self, start, end)
      break
    case 'binary':
      ret = _binarySlice(self, start, end)
      break
    case 'base64':
      ret = _base64Slice(self, start, end)
      break
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      ret = _utf16leSlice(self, start, end)
      break
    default:
      throw new Error('Unknown encoding')
  }
  return ret
}

Buffer.prototype.toJSON = function () {
  return {
    type: 'Buffer',
    data: Array.prototype.slice.call(this._arr || this, 0)
  }
}

// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
Buffer.prototype.copy = function (target, target_start, start, end) {
  var source = this

  if (!start) start = 0
  if (!end && end !== 0) end = this.length
  if (!target_start) target_start = 0

  // Copy 0 bytes; we're done
  if (end === start) return
  if (target.length === 0 || source.length === 0) return

  // Fatal error conditions
  assert(end >= start, 'sourceEnd < sourceStart')
  assert(target_start >= 0 && target_start < target.length,
      'targetStart out of bounds')
  assert(start >= 0 && start < source.length, 'sourceStart out of bounds')
  assert(end >= 0 && end <= source.length, 'sourceEnd out of bounds')

  // Are we oob?
  if (end > this.length)
    end = this.length
  if (target.length - target_start < end - start)
    end = target.length - target_start + start

  var len = end - start

  if (len < 100 || !Buffer._useTypedArrays) {
    for (var i = 0; i < len; i++)
      target[i + target_start] = this[i + start]
  } else {
    target._set(this.subarray(start, start + len), target_start)
  }
}

function _base64Slice (buf, start, end) {
  if (start === 0 && end === buf.length) {
    return base64.fromByteArray(buf)
  } else {
    return base64.fromByteArray(buf.slice(start, end))
  }
}

function _utf8Slice (buf, start, end) {
  var res = ''
  var tmp = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; i++) {
    if (buf[i] <= 0x7F) {
      res += decodeUtf8Char(tmp) + String.fromCharCode(buf[i])
      tmp = ''
    } else {
      tmp += '%' + buf[i].toString(16)
    }
  }

  return res + decodeUtf8Char(tmp)
}

function _asciiSlice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; i++)
    ret += String.fromCharCode(buf[i])
  return ret
}

function _binarySlice (buf, start, end) {
  return _asciiSlice(buf, start, end)
}

function _hexSlice (buf, start, end) {
  var len = buf.length

  if (!start || start < 0) start = 0
  if (!end || end < 0 || end > len) end = len

  var out = ''
  for (var i = start; i < end; i++) {
    out += toHex(buf[i])
  }
  return out
}

function _utf16leSlice (buf, start, end) {
  var bytes = buf.slice(start, end)
  var res = ''
  for (var i = 0; i < bytes.length; i += 2) {
    res += String.fromCharCode(bytes[i] + bytes[i+1] * 256)
  }
  return res
}

Buffer.prototype.slice = function (start, end) {
  var len = this.length
  start = clamp(start, len, 0)
  end = clamp(end, len, len)

  if (Buffer._useTypedArrays) {
    return Buffer._augment(this.subarray(start, end))
  } else {
    var sliceLen = end - start
    var newBuf = new Buffer(sliceLen, undefined, true)
    for (var i = 0; i < sliceLen; i++) {
      newBuf[i] = this[i + start]
    }
    return newBuf
  }
}

// `get` will be removed in Node 0.13+
Buffer.prototype.get = function (offset) {
  console.log('.get() is deprecated. Access using array indexes instead.')
  return this.readUInt8(offset)
}

// `set` will be removed in Node 0.13+
Buffer.prototype.set = function (v, offset) {
  console.log('.set() is deprecated. Access using array indexes instead.')
  return this.writeUInt8(v, offset)
}

Buffer.prototype.readUInt8 = function (offset, noAssert) {
  if (!noAssert) {
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset < this.length, 'Trying to read beyond buffer length')
  }

  if (offset >= this.length)
    return

  return this[offset]
}

function _readUInt16 (buf, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 1 < buf.length, 'Trying to read beyond buffer length')
  }

  var len = buf.length
  if (offset >= len)
    return

  var val
  if (littleEndian) {
    val = buf[offset]
    if (offset + 1 < len)
      val |= buf[offset + 1] << 8
  } else {
    val = buf[offset] << 8
    if (offset + 1 < len)
      val |= buf[offset + 1]
  }
  return val
}

Buffer.prototype.readUInt16LE = function (offset, noAssert) {
  return _readUInt16(this, offset, true, noAssert)
}

Buffer.prototype.readUInt16BE = function (offset, noAssert) {
  return _readUInt16(this, offset, false, noAssert)
}

function _readUInt32 (buf, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 3 < buf.length, 'Trying to read beyond buffer length')
  }

  var len = buf.length
  if (offset >= len)
    return

  var val
  if (littleEndian) {
    if (offset + 2 < len)
      val = buf[offset + 2] << 16
    if (offset + 1 < len)
      val |= buf[offset + 1] << 8
    val |= buf[offset]
    if (offset + 3 < len)
      val = val + (buf[offset + 3] << 24 >>> 0)
  } else {
    if (offset + 1 < len)
      val = buf[offset + 1] << 16
    if (offset + 2 < len)
      val |= buf[offset + 2] << 8
    if (offset + 3 < len)
      val |= buf[offset + 3]
    val = val + (buf[offset] << 24 >>> 0)
  }
  return val
}

Buffer.prototype.readUInt32LE = function (offset, noAssert) {
  return _readUInt32(this, offset, true, noAssert)
}

Buffer.prototype.readUInt32BE = function (offset, noAssert) {
  return _readUInt32(this, offset, false, noAssert)
}

Buffer.prototype.readInt8 = function (offset, noAssert) {
  if (!noAssert) {
    assert(offset !== undefined && offset !== null,
        'missing offset')
    assert(offset < this.length, 'Trying to read beyond buffer length')
  }

  if (offset >= this.length)
    return

  var neg = this[offset] & 0x80
  if (neg)
    return (0xff - this[offset] + 1) * -1
  else
    return this[offset]
}

function _readInt16 (buf, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 1 < buf.length, 'Trying to read beyond buffer length')
  }

  var len = buf.length
  if (offset >= len)
    return

  var val = _readUInt16(buf, offset, littleEndian, true)
  var neg = val & 0x8000
  if (neg)
    return (0xffff - val + 1) * -1
  else
    return val
}

Buffer.prototype.readInt16LE = function (offset, noAssert) {
  return _readInt16(this, offset, true, noAssert)
}

Buffer.prototype.readInt16BE = function (offset, noAssert) {
  return _readInt16(this, offset, false, noAssert)
}

function _readInt32 (buf, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 3 < buf.length, 'Trying to read beyond buffer length')
  }

  var len = buf.length
  if (offset >= len)
    return

  var val = _readUInt32(buf, offset, littleEndian, true)
  var neg = val & 0x80000000
  if (neg)
    return (0xffffffff - val + 1) * -1
  else
    return val
}

Buffer.prototype.readInt32LE = function (offset, noAssert) {
  return _readInt32(this, offset, true, noAssert)
}

Buffer.prototype.readInt32BE = function (offset, noAssert) {
  return _readInt32(this, offset, false, noAssert)
}

function _readFloat (buf, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset + 3 < buf.length, 'Trying to read beyond buffer length')
  }

  return ieee754.read(buf, offset, littleEndian, 23, 4)
}

Buffer.prototype.readFloatLE = function (offset, noAssert) {
  return _readFloat(this, offset, true, noAssert)
}

Buffer.prototype.readFloatBE = function (offset, noAssert) {
  return _readFloat(this, offset, false, noAssert)
}

function _readDouble (buf, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset + 7 < buf.length, 'Trying to read beyond buffer length')
  }

  return ieee754.read(buf, offset, littleEndian, 52, 8)
}

Buffer.prototype.readDoubleLE = function (offset, noAssert) {
  return _readDouble(this, offset, true, noAssert)
}

Buffer.prototype.readDoubleBE = function (offset, noAssert) {
  return _readDouble(this, offset, false, noAssert)
}

Buffer.prototype.writeUInt8 = function (value, offset, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset < this.length, 'trying to write beyond buffer length')
    verifuint(value, 0xff)
  }

  if (offset >= this.length) return

  this[offset] = value
}

function _writeUInt16 (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 1 < buf.length, 'trying to write beyond buffer length')
    verifuint(value, 0xffff)
  }

  var len = buf.length
  if (offset >= len)
    return

  for (var i = 0, j = Math.min(len - offset, 2); i < j; i++) {
    buf[offset + i] =
        (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>
            (littleEndian ? i : 1 - i) * 8
  }
}

Buffer.prototype.writeUInt16LE = function (value, offset, noAssert) {
  _writeUInt16(this, value, offset, true, noAssert)
}

Buffer.prototype.writeUInt16BE = function (value, offset, noAssert) {
  _writeUInt16(this, value, offset, false, noAssert)
}

function _writeUInt32 (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 3 < buf.length, 'trying to write beyond buffer length')
    verifuint(value, 0xffffffff)
  }

  var len = buf.length
  if (offset >= len)
    return

  for (var i = 0, j = Math.min(len - offset, 4); i < j; i++) {
    buf[offset + i] =
        (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff
  }
}

Buffer.prototype.writeUInt32LE = function (value, offset, noAssert) {
  _writeUInt32(this, value, offset, true, noAssert)
}

Buffer.prototype.writeUInt32BE = function (value, offset, noAssert) {
  _writeUInt32(this, value, offset, false, noAssert)
}

Buffer.prototype.writeInt8 = function (value, offset, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset < this.length, 'Trying to write beyond buffer length')
    verifsint(value, 0x7f, -0x80)
  }

  if (offset >= this.length)
    return

  if (value >= 0)
    this.writeUInt8(value, offset, noAssert)
  else
    this.writeUInt8(0xff + value + 1, offset, noAssert)
}

function _writeInt16 (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 1 < buf.length, 'Trying to write beyond buffer length')
    verifsint(value, 0x7fff, -0x8000)
  }

  var len = buf.length
  if (offset >= len)
    return

  if (value >= 0)
    _writeUInt16(buf, value, offset, littleEndian, noAssert)
  else
    _writeUInt16(buf, 0xffff + value + 1, offset, littleEndian, noAssert)
}

Buffer.prototype.writeInt16LE = function (value, offset, noAssert) {
  _writeInt16(this, value, offset, true, noAssert)
}

Buffer.prototype.writeInt16BE = function (value, offset, noAssert) {
  _writeInt16(this, value, offset, false, noAssert)
}

function _writeInt32 (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 3 < buf.length, 'Trying to write beyond buffer length')
    verifsint(value, 0x7fffffff, -0x80000000)
  }

  var len = buf.length
  if (offset >= len)
    return

  if (value >= 0)
    _writeUInt32(buf, value, offset, littleEndian, noAssert)
  else
    _writeUInt32(buf, 0xffffffff + value + 1, offset, littleEndian, noAssert)
}

Buffer.prototype.writeInt32LE = function (value, offset, noAssert) {
  _writeInt32(this, value, offset, true, noAssert)
}

Buffer.prototype.writeInt32BE = function (value, offset, noAssert) {
  _writeInt32(this, value, offset, false, noAssert)
}

function _writeFloat (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 3 < buf.length, 'Trying to write beyond buffer length')
    verifIEEE754(value, 3.4028234663852886e+38, -3.4028234663852886e+38)
  }

  var len = buf.length
  if (offset >= len)
    return

  ieee754.write(buf, value, offset, littleEndian, 23, 4)
}

Buffer.prototype.writeFloatLE = function (value, offset, noAssert) {
  _writeFloat(this, value, offset, true, noAssert)
}

Buffer.prototype.writeFloatBE = function (value, offset, noAssert) {
  _writeFloat(this, value, offset, false, noAssert)
}

function _writeDouble (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    assert(value !== undefined && value !== null, 'missing value')
    assert(typeof littleEndian === 'boolean', 'missing or invalid endian')
    assert(offset !== undefined && offset !== null, 'missing offset')
    assert(offset + 7 < buf.length,
        'Trying to write beyond buffer length')
    verifIEEE754(value, 1.7976931348623157E+308, -1.7976931348623157E+308)
  }

  var len = buf.length
  if (offset >= len)
    return

  ieee754.write(buf, value, offset, littleEndian, 52, 8)
}

Buffer.prototype.writeDoubleLE = function (value, offset, noAssert) {
  _writeDouble(this, value, offset, true, noAssert)
}

Buffer.prototype.writeDoubleBE = function (value, offset, noAssert) {
  _writeDouble(this, value, offset, false, noAssert)
}

// fill(value, start=0, end=buffer.length)
Buffer.prototype.fill = function (value, start, end) {
  if (!value) value = 0
  if (!start) start = 0
  if (!end) end = this.length

  if (typeof value === 'string') {
    value = value.charCodeAt(0)
  }

  assert(typeof value === 'number' && !isNaN(value), 'value is not a number')
  assert(end >= start, 'end < start')

  // Fill 0 bytes; we're done
  if (end === start) return
  if (this.length === 0) return

  assert(start >= 0 && start < this.length, 'start out of bounds')
  assert(end >= 0 && end <= this.length, 'end out of bounds')

  for (var i = start; i < end; i++) {
    this[i] = value
  }
}

Buffer.prototype.inspect = function () {
  var out = []
  var len = this.length
  for (var i = 0; i < len; i++) {
    out[i] = toHex(this[i])
    if (i === exports.INSPECT_MAX_BYTES) {
      out[i + 1] = '...'
      break
    }
  }
  return '<Buffer ' + out.join(' ') + '>'
}

/**
 * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.
 * Added in Node 0.12. Only available in browsers that support ArrayBuffer.
 */
Buffer.prototype.toArrayBuffer = function () {
  if (typeof Uint8Array !== 'undefined') {
    if (Buffer._useTypedArrays) {
      return (new Buffer(this)).buffer
    } else {
      var buf = new Uint8Array(this.length)
      for (var i = 0, len = buf.length; i < len; i += 1)
        buf[i] = this[i]
      return buf.buffer
    }
  } else {
    throw new Error('Buffer.toArrayBuffer not supported in this browser')
  }
}

// HELPER FUNCTIONS
// ================

function stringtrim (str) {
  if (str.trim) return str.trim()
  return str.replace(/^\s+|\s+$/g, '')
}

var BP = Buffer.prototype

/**
 * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods
 */
Buffer._augment = function (arr) {
  arr._isBuffer = true

  // save reference to original Uint8Array get/set methods before overwriting
  arr._get = arr.get
  arr._set = arr.set

  // deprecated, will be removed in node 0.13+
  arr.get = BP.get
  arr.set = BP.set

  arr.write = BP.write
  arr.toString = BP.toString
  arr.toLocaleString = BP.toString
  arr.toJSON = BP.toJSON
  arr.copy = BP.copy
  arr.slice = BP.slice
  arr.readUInt8 = BP.readUInt8
  arr.readUInt16LE = BP.readUInt16LE
  arr.readUInt16BE = BP.readUInt16BE
  arr.readUInt32LE = BP.readUInt32LE
  arr.readUInt32BE = BP.readUInt32BE
  arr.readInt8 = BP.readInt8
  arr.readInt16LE = BP.readInt16LE
  arr.readInt16BE = BP.readInt16BE
  arr.readInt32LE = BP.readInt32LE
  arr.readInt32BE = BP.readInt32BE
  arr.readFloatLE = BP.readFloatLE
  arr.readFloatBE = BP.readFloatBE
  arr.readDoubleLE = BP.readDoubleLE
  arr.readDoubleBE = BP.readDoubleBE
  arr.writeUInt8 = BP.writeUInt8
  arr.writeUInt16LE = BP.writeUInt16LE
  arr.writeUInt16BE = BP.writeUInt16BE
  arr.writeUInt32LE = BP.writeUInt32LE
  arr.writeUInt32BE = BP.writeUInt32BE
  arr.writeInt8 = BP.writeInt8
  arr.writeInt16LE = BP.writeInt16LE
  arr.writeInt16BE = BP.writeInt16BE
  arr.writeInt32LE = BP.writeInt32LE
  arr.writeInt32BE = BP.writeInt32BE
  arr.writeFloatLE = BP.writeFloatLE
  arr.writeFloatBE = BP.writeFloatBE
  arr.writeDoubleLE = BP.writeDoubleLE
  arr.writeDoubleBE = BP.writeDoubleBE
  arr.fill = BP.fill
  arr.inspect = BP.inspect
  arr.toArrayBuffer = BP.toArrayBuffer

  return arr
}

// slice(start, end)
function clamp (index, len, defaultValue) {
  if (typeof index !== 'number') return defaultValue
  index = ~~index;  // Coerce to integer.
  if (index >= len) return len
  if (index >= 0) return index
  index += len
  if (index >= 0) return index
  return 0
}

function coerce (length) {
  // Coerce length to a number (possibly NaN), round up
  // in case it's fractional (e.g. 123.456) then do a
  // double negate to coerce a NaN to 0. Easy, right?
  length = ~~Math.ceil(+length)
  return length < 0 ? 0 : length
}

function isArray (subject) {
  return (Array.isArray || function (subject) {
    return Object.prototype.toString.call(subject) === '[object Array]'
  })(subject)
}

function isArrayish (subject) {
  return isArray(subject) || Buffer.isBuffer(subject) ||
      subject && typeof subject === 'object' &&
      typeof subject.length === 'number'
}

function toHex (n) {
  if (n < 16) return '0' + n.toString(16)
  return n.toString(16)
}

function utf8ToBytes (str) {
  var byteArray = []
  for (var i = 0; i < str.length; i++) {
    var b = str.charCodeAt(i)
    if (b <= 0x7F)
      byteArray.push(str.charCodeAt(i))
    else {
      var start = i
      if (b >= 0xD800 && b <= 0xDFFF) i++
      var h = encodeURIComponent(str.slice(start, i+1)).substr(1).split('%')
      for (var j = 0; j < h.length; j++)
        byteArray.push(parseInt(h[j], 16))
    }
  }
  return byteArray
}

function asciiToBytes (str) {
  var byteArray = []
  for (var i = 0; i < str.length; i++) {
    // Node's code seems to be doing this and not & 0x7F..
    byteArray.push(str.charCodeAt(i) & 0xFF)
  }
  return byteArray
}

function utf16leToBytes (str) {
  var c, hi, lo
  var byteArray = []
  for (var i = 0; i < str.length; i++) {
    c = str.charCodeAt(i)
    hi = c >> 8
    lo = c % 256
    byteArray.push(lo)
    byteArray.push(hi)
  }

  return byteArray
}

function base64ToBytes (str) {
  return base64.toByteArray(str)
}

function blitBuffer (src, dst, offset, length) {
  var pos
  for (var i = 0; i < length; i++) {
    if ((i + offset >= dst.length) || (i >= src.length))
      break
    dst[i + offset] = src[i]
  }
  return i
}

function decodeUtf8Char (str) {
  try {
    return decodeURIComponent(str)
  } catch (err) {
    return String.fromCharCode(0xFFFD) // UTF 8 invalid char
  }
}

/*
 * We have to make sure that the value is a valid integer. This means that it
 * is non-negative. It has no fractional component and that it does not
 * exceed the maximum allowed value.
 */
function verifuint (value, max) {
  assert(typeof value === 'number', 'cannot write a non-number as a number')
  assert(value >= 0, 'specified a negative value for writing an unsigned value')
  assert(value <= max, 'value is larger than maximum value for type')
  assert(Math.floor(value) === value, 'value has a fractional component')
}

function verifsint (value, max, min) {
  assert(typeof value === 'number', 'cannot write a non-number as a number')
  assert(value <= max, 'value larger than maximum allowed value')
  assert(value >= min, 'value smaller than minimum allowed value')
  assert(Math.floor(value) === value, 'value has a fractional component')
}

function verifIEEE754 (value, max, min) {
  assert(typeof value === 'number', 'cannot write a non-number as a number')
  assert(value <= max, 'value larger than maximum allowed value')
  assert(value >= min, 'value smaller than minimum allowed value')
}

function assert (test, message) {
  if (!test) throw new Error(message || 'Failed assertion')
}

}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\buffer\\index.js","/..\\..\\node_modules\\buffer")
},{"base64-js":24,"buffer":25,"e/U+97":27,"ieee754":26}],26:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
exports.read = function (buffer, offset, isLE, mLen, nBytes) {
  var e, m
  var eLen = (nBytes * 8) - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var nBits = -7
  var i = isLE ? (nBytes - 1) : 0
  var d = isLE ? -1 : 1
  var s = buffer[offset + i]

  i += d

  e = s & ((1 << (-nBits)) - 1)
  s >>= (-nBits)
  nBits += eLen
  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}

  m = e & ((1 << (-nBits)) - 1)
  e >>= (-nBits)
  nBits += mLen
  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}

  if (e === 0) {
    e = 1 - eBias
  } else if (e === eMax) {
    return m ? NaN : ((s ? -1 : 1) * Infinity)
  } else {
    m = m + Math.pow(2, mLen)
    e = e - eBias
  }
  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)
}

exports.write = function (buffer, value, offset, isLE, mLen, nBytes) {
  var e, m, c
  var eLen = (nBytes * 8) - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)
  var i = isLE ? 0 : (nBytes - 1)
  var d = isLE ? 1 : -1
  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0

  value = Math.abs(value)

  if (isNaN(value) || value === Infinity) {
    m = isNaN(value) ? 1 : 0
    e = eMax
  } else {
    e = Math.floor(Math.log(value) / Math.LN2)
    if (value * (c = Math.pow(2, -e)) < 1) {
      e--
      c *= 2
    }
    if (e + eBias >= 1) {
      value += rt / c
    } else {
      value += rt * Math.pow(2, 1 - eBias)
    }
    if (value * c >= 2) {
      e++
      c /= 2
    }

    if (e + eBias >= eMax) {
      m = 0
      e = eMax
    } else if (e + eBias >= 1) {
      m = ((value * c) - 1) * Math.pow(2, mLen)
      e = e + eBias
    } else {
      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)
      e = 0
    }
  }

  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}

  e = (e << mLen) | m
  eLen += mLen
  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}

  buffer[offset + i - d] |= s * 128
}

}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\ieee754\\index.js","/..\\..\\node_modules\\ieee754")
},{"buffer":25,"e/U+97":27}],27:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/..\\..\\node_modules\\process\\browser.js","/..\\..\\node_modules\\process")
},{"buffer":25,"e/U+97":27}],28:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AskDialog = exports.AskDialogProps = void 0;
var random_1 = require("../util/random");
var AskDialogProps = /** @class */ (function () {
    function AskDialogProps() {
    }
    return AskDialogProps;
}());
exports.AskDialogProps = AskDialogProps;
var AskDialog = /** @class */ (function () {
    function AskDialog(props) {
        this.props = props;
    }
    AskDialog.prototype.show = function () {
        var _this = this;
        var allowButtonId = "allow-" + random_1.randomSessonId();
        var denyButtonId = "deny-" + random_1.randomSessonId();
        var content = this.props.message + "\n            <p>\n                <a href=\"#\" id=\"" + allowButtonId + "\" class=\"btn btn-sm\">Accept</button>\n                <a href=\"#\" id=\"" + denyButtonId + "\" class=\"btn btn-sm\">Deny</button>\n            </p>";
        $.toast({
            heading: this.props.title,
            text: content,
            showHideTransition: 'slide',
            hideAfter: false,
            bgColor: this.props.isWarning ? "#800000" : "#164157",
            icon: this.props.icon,
            stack: 5,
            loader: false,
            afterShown: function () {
                _this.allowButtonElement = document.getElementById(allowButtonId);
                _this.denyButtonElement = document.getElementById(denyButtonId);
                _this.root = $(_this.allowButtonElement).closest(".jq-toast-single")[0];
                _this.attachHandlers();
            }
        });
    };
    AskDialog.prototype.attachHandlers = function () {
        var _this = this;
        this.allowButtonElement.addEventListener('click', function () {
            if (typeof _this.props.allowCallback === "function")
                _this.props.allowCallback(_this.props.param);
            (_this.root).remove();
        });
        this.denyButtonElement.addEventListener('click', function () {
            if (typeof _this.props.denyCallback === "function") {
                _this.props.denyCallback(_this.props.param);
            }
            $(_this.root).remove();
        });
    };
    return AskDialog;
}());
exports.AskDialog = AskDialog;
//# sourceMappingURL=AskDialog.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\AskDialog.js","/components")
},{"../util/random":54,"buffer":25,"e/U+97":27}],29:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
var __spreadArray = (this && this.__spreadArray) || function (to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ChattingWidget = exports.ChattingPanelProps = void 0;
var FileReceiver_1 = require("../file/FileReceiver");
var FileSender_1 = require("../file/FileSender");
var random_1 = require("../util/random");
var snippet_1 = require("../util/snippet");
var TimeUtil_1 = require("../util/TimeUtil");
var ChattingPanelProps = /** @class */ (function () {
    function ChattingPanelProps() {
    }
    return ChattingPanelProps;
}());
exports.ChattingPanelProps = ChattingPanelProps;
var ChattingWidget = /** @class */ (function () {
    function ChattingWidget() {
        this.unreadCount = 0;
        this.isPrivate = false;
        this.nameColors = [];
        this.remainColors = [];
        this.fileSendingPool = new Map();
        this.fileReceivingPool = new Map();
    }
    ChattingWidget.prototype.init = function (props) {
        this.props = props;
        this.root = document.getElementById("sideToolbarContainer");
        this.closeButton = document.querySelector(".chat-close-button");
        this.inputField = document.querySelector("#chat-input #usermsg");
        this.sendButton = document.querySelector(".send-button");
        this.filesendButton = document.querySelector(".file-share-button");
        this.fileElement = document.getElementById("file-selector");
        this.fileSendingPanel = document.getElementById("file-sending");
        this.privatePanel = document.querySelector("#chat-recipient");
        this.privateLabelElement = $(this.privatePanel).find(">span")[0];
        this.privateCloseElement = $(this.privatePanel).find(">div")[0];
        this.nameColors.push("#00bfff"); //deepskyblue
        this.nameColors.push("#9acd32"); //yellowgreen
        this.nameColors.push("#d2691e"); //chocolate
        this.nameColors.push("#ee82ee"); //violet
        this.nameColors.push("#6495ed"); //cornflowerblue
        this.nameColors.push("#ffd700"); //gold
        this.nameColors.push("#808000"); //olive
        this.nameColors.push("#cd853f"); //peru
        this.remainColors = __spreadArray([], this.nameColors);
        this.nameColorMap = new Map();
        this.attachEventHandlers();
        this.open(this.opened);
    };
    ChattingWidget.prototype.attachEventHandlers = function () {
        var _this_1 = this;
        $(this.closeButton).on('click', function () {
            _this_1.open(false);
        });
        $(this.inputField).keypress(function (e) {
            if ((e.keyCode || e.which) == 13) { //Enter keycode
                if (!e.shiftKey) {
                    e.preventDefault();
                    _this_1.onSend();
                }
            }
        });
        $(this.sendButton).on('click', function () {
            _this_1.onSend();
        });
        var _this = this;
        $(".smileyContainer").click(function () {
            var id = $(this).attr("id");
            var imoname = _this.idToEmoname(id);
            console.log(imoname);
            var sendel = $("#usermsg");
            var sms = sendel.val();
            sms += imoname;
            sendel.val(sms);
            //var el = $(".smileys-panel");
            //el.removeClass("show-smileys");
            //el.addClass("hide-smileys");
            sendel.focus();
        });
        $("#smileys").click(function () {
            var el = $(".smileys-panel");
            if (el.hasClass("hide-smileys")) {
                el.removeClass("hide-smileys");
                el.addClass("show-smileys");
            }
            else {
                el.removeClass("show-smileys");
                el.addClass("hide-smileys");
            }
        });
        $(this.privateCloseElement).click(function (_) {
            _this_1.clearPrivateState();
        });
        $(this.filesendButton).click(function (_) {
            $(_this_1.fileElement).click();
        });
        $(this.fileElement).on("change", function (_) {
            _this_1.sendFile();
        });
    };
    ChattingWidget.prototype.open = function (opened) {
        if (opened) {
            $("#video-panel").addClass("shift-right");
            $("#new-toolbox").addClass("shift-right");
            $(this.root).removeClass("invisible");
            $(this.inputField).focus();
            //$(".toolbox-icon", this.props.chatOpenButton).addClass("toggled");
        }
        else {
            $("#video-panel").removeClass("shift-right");
            $("#new-toolbox").removeClass("shift-right");
            $(this.root).addClass("invisible");
            //$(".toolbox-icon", this.props.chatOpenButton).removeClass("toggled");
        }
        this.unreadCount = 0;
        this.props.showUnreadBadge(false);
        this.opened = opened;
        this.props.openCallback();
    };
    ChattingWidget.prototype.clearInput = function () {
        $(this.inputField).val('');
    };
    ChattingWidget.prototype.toggleOpen = function () {
        this.opened = !this.opened;
        this.open(this.opened);
    };
    ChattingWidget.prototype.onSend = function () {
        var msg = $(this.inputField).val().toString().trim();
        this.clearInput();
        if (!msg)
            return;
        msg = this.emonameToEmoicon(msg);
        var time = TimeUtil_1.getCurTime();
        var privateClass = this.isPrivate ? "private" : "";
        var privateDetail = "";
        if (this.isPrivate) {
            privateDetail = "<div style=\"color:#778899\">private: " + this.privateSenderName + "</div>";
        }
        var el = $(".smileys-panel");
        el.removeClass("show-smileys");
        el.addClass("hide-smileys");
        var sel = $("#chatconversation div.chat-message-group:last-child");
        if (sel.hasClass("local")) {
            sel.find(".timestamp").remove();
            sel.append("<div class= \"chatmessage-wrapper\" >                            <div class=\"chatmessage " + privateClass + "\">                                <div class=\"replywrapper\">                                    <div class=\"messagecontent\">                                        <div class=\"usermessage\"> " + msg + " </div>                                        " + privateDetail + "\n                                    </div>                                </div>                            </div>                            <div class=\"timestamp\"> " + time + " </div>                        </div >");
        }
        else {
            $("#chatconversation").append("<div class=\"chat-message-group local\">                     <div class= \"chatmessage-wrapper\" >                        <div class=\"chatmessage " + privateClass + "\">                            <div class=\"replywrapper\">                                <div class=\"messagecontent\">                                    <div class=\"usermessage\"> " + msg + " </div>                                    " + privateDetail + "\n                                </div>                            </div>                        </div>                        <div class=\"timestamp\"> " + time + " </div>                    </div >                </div>");
        }
        this.scrollToBottom();
        if (this.isPrivate) {
            this.props.sendPrivateChat(this.privateSenderId, msg);
        }
        else {
            this.props.sendChat(msg);
        }
    };
    //chat
    ChattingWidget.prototype.receiveMessage = function (id, username, message, isPrivate) {
        if (isPrivate === void 0) { isPrivate = false; }
        //update unread count
        if (!this.opened) {
            this.unreadCount++;
            this.props.setUnreadCount(this.unreadCount);
            this.props.showUnreadBadge(true);
        }
        //update ui
        var emoMessage = this.emonameToEmoicon(message);
        var nameColor = this.getNameColor(username);
        var privateClass = isPrivate ? "private" : "";
        var replyElem = "";
        if (isPrivate) {
            replyElem = "\n                <span class=\"jitsi-icon\" jitsi-id=\"" + id + "\" jitsi-name=\"" + username + "\">\n                    <svg height=\"22\" width=\"22\" viewBox=\"0 0 36 36\">\n                        <path d=\"M30,29a1,1,0,0,1-.81-.41l-2.12-2.92A18.66,18.66,0,0,0,15,18.25V22a1,1,0,0,1-1.6.8l-12-9a1,1,0,0,1,0-1.6l12-9A1,1,0,0,1,15,4V8.24A19,19,0,0,1,31,27v1a1,1,0,0,1-.69.95A1.12,1.12,0,0,1,30,29ZM14,16.11h.1A20.68,20.68,0,0,1,28.69,24.5l.16.21a17,17,0,0,0-15-14.6,1,1,0,0,1-.89-1V6L3.67,13,13,20V17.11a1,1,0,0,1,.33-.74A1,1,0,0,1,14,16.11Z\"></path>\n                    </svg>\n                </span>";
        }
        var $chatitem = $("<div class=\"chat-message-group remote\">         <div class= \"chatmessage-wrapper\" >                <div class=\"chatmessage " + privateClass + "\">                    <div class=\"replywrapper\">                        <div class=\"messagecontent\">                            <div class=\"display-name\" style=\"color:" + nameColor + "\">" + username + replyElem + '</div>\
                            <div class="usermessage">' + emoMessage + '</div>\
                        </div>\
                    </div>\
                </div>\
                <div class="timestamp">' + TimeUtil_1.getCurTime() + '</div>\
            </div >\
        </div>');
        $("#chatconversation").append($chatitem);
        if (isPrivate) {
            var _this_2 = this;
            $chatitem.find(".jitsi-icon").click(function (e) {
                var id = $(this).attr("jitsi-id");
                var name = $(this).attr("jitsi-name");
                _this_2.setPrivateState(id, name);
            });
        }
        this.scrollToBottom();
        if (isPrivate)
            this.setPrivateState(id, username);
    };
    ChattingWidget.prototype.scrollToBottom = function () {
        var overheight = 0;
        $(".chat-message-group").each(function () {
            overheight += $(this).height();
        });
        var limit = $('#chatconversation').height();
        var pos = overheight - limit;
        $("#chatconversation").animate({ scrollTop: pos }, 200);
    };
    ChattingWidget.prototype.idToEmoname = function (id) {
        if (id == 'smiley1')
            return '';
        if (id == 'smiley2')
            return '';
        if (id == 'smiley3')
            return '';
        if (id == 'smiley4')
            return '';
        if (id == 'smiley5')
            return '';
        if (id == 'smiley6')
            return '';
        if (id == 'smiley7')
            return '';
        if (id == 'smiley8')
            return '';
        if (id == 'smiley9')
            return '';
        if (id == 'smiley10')
            return '';
        if (id == 'smiley11')
            return '';
        if (id == 'smiley12')
            return '';
        if (id == 'smiley13')
            return '';
        if (id == 'smiley14')
            return '';
        if (id == 'smiley15')
            return '';
        if (id == 'smiley16')
            return '';
        if (id == 'smiley17')
            return '';
        if (id == 'smiley18')
            return '';
        if (id == 'smiley19')
            return '';
        if (id == 'smiley20')
            return '';
    };
    ChattingWidget.prototype.emonameToEmoicon = function (sms) {
        var smsout = sms;
        smsout = smsout.replace(':)', '<span class="smiley" style="width: 20px; height:20px;"></span>');
        smsout = smsout.replace(':(', '<span class="smiley"></span>');
        smsout = smsout.replace(':D', '<span class="smiley"></span>');
        smsout = smsout.replace(':+1:', '<span class="smiley"></span>');
        smsout = smsout.replace(':P', '<span class="smiley"></span>');
        smsout = smsout.replace(':wave:', '<span class="smiley"></span>');
        smsout = smsout.replace(':blush:', '<span class="smiley"></span>');
        smsout = smsout.replace(':slightly_smiling_face:', '<span class="smiley"></span>');
        smsout = smsout.replace(':scream:', '<span class="smiley"></span>');
        smsout = smsout.replace(':*', '<span class="smiley"></span>');
        smsout = smsout.replace(':-1:', '<span class="smiley"></span>');
        smsout = smsout.replace(':mag:', '<span class="smiley"></span>');
        smsout = smsout.replace(':heart:', '<span class="smiley"></span>');
        smsout = smsout.replace(':innocent:', '<span class="smiley"></span>');
        smsout = smsout.replace(':angry:', '<span class="smiley"></span>');
        smsout = smsout.replace(':angel:', '<span class="smiley"></span>');
        smsout = smsout.replace(';(', '<span class="smiley"></span>');
        smsout = smsout.replace(':clap:', '<span class="smiley"></span>');
        smsout = smsout.replace(';)', '<span class="smiley"></span>');
        smsout = smsout.replace(':beer:', '<span class="smiley"></span>');
        return smsout;
    };
    ChattingWidget.prototype.getNameColor = function (name) {
        if (this.nameColorMap.has(name))
            return this.nameColorMap.get(name);
        if (this.remainColors.length <= 0)
            this.remainColors = __spreadArray([], this.nameColors);
        //[min, max)
        var randIndex = snippet_1.random(0, this.remainColors.length);
        var randomColor = this.remainColors[randIndex];
        this.remainColors.splice(randIndex, 1);
        this.nameColorMap.set(name, randomColor);
        return randomColor;
    };
    ChattingWidget.prototype.setPrivateState = function (jitsiId, name) {
        this.isPrivate = true;
        this.privateSenderId = jitsiId;
        this.privateSenderName = name;
        this.privatePanel.style.display = "flex";
        this.privateLabelElement.innerHTML = "Private message to " + name;
    };
    ChattingWidget.prototype.clearPrivateState = function () {
        this.isPrivate = false;
        this.privateSenderId = null;
        this.privatePanel.style.display = "none";
    };
    ChattingWidget.prototype.sendFile = function () {
        var props = new FileSender_1.FileSenderProps();
        props.fileElement = this.fileElement;
        props.fileSendingPanel = this.fileSendingPanel;
        props.sessionId = random_1.randomSessonId();
        props.onError = this.props.onFileSendErrror;
        props.onFinished = this.props.onFileSendFinished;
        props.sendFileData = this.props.sendFileData;
        props.sendFileMeta = this.props.sendFileMeta;
        //props.addChatItem = this.onSend.bind(this); //added matvey
        var fileSender = new FileSender_1.FileSender(props);
        fileSender.sendFile();
    };
    ChattingWidget.prototype.onFileMeta = function (sessionId, meta, senderId, senderName) {
        var props = new FileReceiver_1.FileReceiverProps();
        props.meta = meta;
        props.senderId = senderId;
        props.senderName = senderName;
        props.onFinished = this.onFileReceiveFinished.bind(this);
        props.onError = this.onFileReceiveError.bind(this);
        props.addChatItem = this.receiveMessage.bind(this);
        var receiver = new FileReceiver_1.FileReceiver(props);
        this.fileReceivingPool.set(sessionId, receiver);
        receiver.show();
    };
    ChattingWidget.prototype.onFileData = function (sessionId, data) {
        var receiver = this.fileReceivingPool.get(sessionId);
        if (receiver)
            receiver.readFileData(data);
    };
    ChattingWidget.prototype.onFileReceiveError = function (sessionId, filename, message) {
        this.fileReceivingPool.delete(sessionId);
        this.props.onFileReceiveError(filename, message);
    };
    ChattingWidget.prototype.onFileReceiveFinished = function (sessionId, filename, message) {
        this.fileReceivingPool.delete(sessionId);
        this.props.onFileReceiveFinished(filename, message);
    };
    ChattingWidget.prototype.openPrivateChat = function (jitsiId, name) {
        this.open(true);
        this.setPrivateState(jitsiId, name);
    };
    return ChattingWidget;
}());
exports.ChattingWidget = ChattingWidget;
//# sourceMappingURL=ChattingPanel.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\ChattingPanel.js","/components")
},{"../file/FileReceiver":42,"../file/FileSender":43,"../util/TimeUtil":53,"../util/random":54,"../util/snippet":55,"buffer":25,"e/U+97":27}],30:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingDescriptionWidget = void 0;
var MeetingDescriptionWidget = /** @class */ (function () {
    function MeetingDescriptionWidget() {
        //state
        this.firstUpdate = true;
        this.time = "";
        this.subject = "";
        this.root = document.querySelector(".subject");
        this.subjectElement = document.querySelector(".subject-text");
        this.timestampElement = document.querySelector(".subject-timer");
    }
    MeetingDescriptionWidget.prototype.updateTime = function (time) {
        this.time = time.trim();
        this.timestampElement.innerHTML = this.time;
        this.showOnInit();
    };
    MeetingDescriptionWidget.prototype.setSubject = function (subject, hostName) {
        this.subject = subject.trim();
        var subjectLabel = this.subject;
        if (hostName && hostName.trim().length > 0)
            subjectLabel += "(" + hostName.trim() + ")";
        this.subjectElement.innerHTML = subjectLabel;
        this.showOnInit();
    };
    MeetingDescriptionWidget.prototype.showOnInit = function () {
        if (this.firstUpdate && this.time.length > 0 && this.subject.length > 0) {
            this.firstUpdate = false;
            this.fadeIn();
        }
    };
    MeetingDescriptionWidget.prototype.fadeIn = function () {
        $(this.root).addClass("visible");
    };
    MeetingDescriptionWidget.prototype.fadeOut = function () {
        $(this.root).removeClass("visible");
    };
    return MeetingDescriptionWidget;
}());
exports.MeetingDescriptionWidget = MeetingDescriptionWidget;
//# sourceMappingURL=MeetingDescriptionWidget.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\MeetingDescriptionWidget.js","/components")
},{"buffer":25,"e/U+97":27}],31:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ParticipantListWidget = exports.ParticipantListPanelProps = void 0;
var snippet_1 = require("../util/snippet");
var vector_icon_1 = require("./vector_icon");
var ParticipantItemProps = /** @class */ (function () {
    function ParticipantItemProps() {
    }
    return ParticipantItemProps;
}());
var ParticipantItem = /** @class */ (function () {
    function ParticipantItem(props) {
        this.props = props;
        this.muteCamera = this.props.muteCamera;
        this.muteMic = this.props.muteMic;
        this.init();
    }
    ParticipantItem.prototype.init = function () {
        var _this = this;
        var body = '';
        if (!this.props.isMicDisable) {
            body = "\n                <div class=\"jitsi-participant\">\n                    <div class=\"participant-avatar\">\n                        <div class=\"avatar  userAvatar w-40px h-40px\" style=\"background-color: rgba(234, 255, 128, 0.4);\">\n                            <svg class=\"avatar-svg\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n                                <text dominant-baseline=\"central\" fill=\"rgba(255,255,255,.6)\" font-size=\"40pt\" text-anchor=\"middle\" x=\"50\" y=\"50\">?</text>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class=\"participant-content\">\n                        <span class=\"name\" class=\"fs-2 fw-bolder\">?</span>\n                        <span class=\"spacer\"></span>\n                        <div class=\"jitsi-icon camera-toggle-button\">\n                            <svg id=\"camera-disabled\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n                                <path d=\"\"></path>\n                            </svg>\n                        </div>\n                        <div class=\"jitsi-icon mic-toggle-button\">\n                            <svg id=\"mic-disabled\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n                                <path d=\"\"></path>\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n            ";
        }
        else {
            body = "\n                <div class=\"jitsi-participant\">\n                    <div class=\"participant-avatar\">\n                        <div class=\"avatar  userAvatar w-40px h-40px\" style=\"background-color: rgba(234, 255, 128, 0.4);\">\n                            <svg class=\"avatar-svg\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n                                <text dominant-baseline=\"central\" fill=\"rgba(255,255,255,.6)\" font-size=\"40pt\" text-anchor=\"middle\" x=\"50\" y=\"50\">?</text>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class=\"participant-content\">\n                        <span class=\"name\" class=\"fs-2 fw-bolder\">?</span>\n                        <span class=\"spacer\"></span>\n                        <div class=\"jitsi-icon camera-toggle-button\" style=\"pointer-events: none;\">\n                            <svg id=\"camera-disabled\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n                                <path d=\"\"></path>\n                            </svg>\n                        </div>\n                        <div class=\"jitsi-icon mic-toggle-button\" style=\"pointer-events: none;\">\n                            <svg id=\"mic-disabled\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n                                <path d=\"\"></path>\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n            ";
        }
        var $root = $(body);
        this.rootElement = $root[0];
        this.avatarElement = $root.find(".avatar")[0];
        this.avatarTextElement = $(this.avatarElement).find("text")[0];
        this.nameElement = $root.find(".name")[0];
        this.cameraButtonElement = $root.find(".camera-toggle-button")[0];
        this.micButtonElement = $root.find(".mic-toggle-button")[0];
        this.cameraIconElement = $(this.cameraButtonElement).find("path")[0];
        this.micIconElement = $(this.micButtonElement).find("path")[0];
        //avatar
        this.avatarTextElement.innerHTML = snippet_1.avatarName(this.props.name);
        var avatarColors = [
            "rgba(234, 255, 128, 0.4)",
            "rgba(114, 91, 60, 1.0)",
            "rgba(63, 65, 113, 1.0)",
            "rgba(56, 105, 91, 1.0)"
        ];
        $(this.avatarElement).css("background-color", avatarColors[snippet_1.random(0, avatarColors.length)]);
        //name
        if (this.props.me)
            $(this.nameElement).html(this.props.name + " (Me)");
        else
            $(this.nameElement).html(this.props.name);
        //icon
        this.updateCameraIcon();
        this.updateMicIcon();
        $(this.cameraButtonElement).on('click', function (_) {
            _this.onToggleCamera();
        });
        $(this.micButtonElement).on('click', function (_) {
            _this.onToggleMic();
        });
    };
    ParticipantItem.prototype.element = function () {
        return this.rootElement;
    };
    ParticipantItem.prototype.removeSelf = function () {
        $(this.rootElement).remove();
    };
    ParticipantItem.prototype.onToggleCamera = function () {
        if (!this.isHost)
            return;
        //this.muteCamera = !this.muteCamera;
        //this.updateCameraIcon();
        this.props.onMuteCamera(this.props.jitsiId, !this.muteCamera);
    };
    ParticipantItem.prototype.onToggleMic = function () {
        if (!this.isHost)
            return;
        //this.muteMic = !this.muteMic;
        //this.updateMicIcon();
        this.props.onMuteMic(this.props.jitsiId, !this.muteMic);
    };
    ParticipantItem.prototype.blockMic = function () {
        if (!this.muteMic)
            this.onToggleMic();
    };
    ParticipantItem.prototype.setMuteAudio = function (use) {
        this.muteMic = use;
        this.updateMicIcon();
    };
    ParticipantItem.prototype.setMuteCamera = function (use) {
        this.muteCamera = use;
        this.updateCameraIcon();
    };
    ParticipantItem.prototype.setRole = function (isHost) {
        this.isHost = isHost;
    };
    ParticipantItem.prototype.updateCameraIcon = function () {
        var icon = this.muteCamera ? vector_icon_1.VectorIcon.VIDEO_MUTE_ICON : vector_icon_1.VectorIcon.VIDEO_UNMUTE_ICON;
        $(this.cameraIconElement).attr("d", icon);
    };
    ParticipantItem.prototype.updateMicIcon = function () {
        var icon = this.muteMic ? vector_icon_1.VectorIcon.AUDIO_MUTE_ICON : vector_icon_1.VectorIcon.AUDIO_UNMUTE_ICON;
        $(this.micIconElement).attr("d", icon);
    };
    return ParticipantItem;
}());
var ParticipantListPanelProps = /** @class */ (function () {
    function ParticipantListPanelProps() {
    }
    return ParticipantListPanelProps;
}());
exports.ParticipantListPanelProps = ParticipantListPanelProps;
var ParticipantListWidget = /** @class */ (function () {
    function ParticipantListWidget() {
        //states
        this.participantItemMap = new Map();
        this.isHost = false;
        this.rootElement = document.getElementById("participants-list");
        var $root = $(this.rootElement);
        this.participantCountElement = $root.find("#participant-count")[0];
        this.participantListElement = $root.find("#participants-list-body")[0];
        this.muteAllButtonElement = $root.find("#participants-list-footer>.btn")[0];
        this.toggleCopyJoiningInfoElement = document.querySelector("#copy-joining-info");
        this.joiningInfoElement = document.querySelector("#joining-info");
    }
    ParticipantListWidget.prototype.init = function (props) {
        this.props = props;
        this.updateParticipantCount();
        this.attachHandlers();
    };
    ParticipantListWidget.prototype.attachHandlers = function () {
        var _this = this;
        $(this.muteAllButtonElement).on('click', function () {
            if (_this.isHost)
                _this.participantItemMap.forEach(function (participantItem, key) {
                    participantItem.blockMic();
                });
        });
        $(this.toggleCopyJoiningInfoElement).on('click', function (_) {
            _this.props.toggleCopyJoiningInfo();
        });
    };
    ParticipantListWidget.prototype.addParticipant = function (jitsiId, name, me, isMicDisable, isVideoDiable, muteCamera, muteMic) {
        if (this.participantItemMap.has(jitsiId)) {
            this.removeParticipant(jitsiId);
        }
        var props = new ParticipantItemProps();
        props.jitsiId = jitsiId;
        props.name = name;
        props.me = me;
        props.isMicDisable = isMicDisable;
        props.isVideoDisable = isVideoDiable;
        props.muteCamera = muteCamera;
        props.muteMic = muteMic;
        props.onMuteCamera = this.props.onMuteCamera;
        props.onMuteMic = this.props.onMuteMic;
        var item = new ParticipantItem(props);
        item.setRole(this.isHost);
        this.participantItemMap.set(jitsiId, item);
        this.updateParticipantCount();
        if (me && (isMicDisable || isVideoDiable)) {
            //if (me) {
            $(this.participantListElement).prepend(item.element());
        }
        else {
            $(this.participantListElement).append(item.element());
        }
    };
    ParticipantListWidget.prototype.removeParticipant = function (jitsiId) {
        if (!this.participantItemMap.has(jitsiId))
            return;
        this.participantItemMap.get(jitsiId).removeSelf();
        this.participantItemMap.delete(jitsiId);
        this.updateParticipantCount();
    };
    ParticipantListWidget.prototype.updateJoiningInfo = function (info) {
        this.joiningInfoElement.innerHTML = info;
    };
    ParticipantListWidget.prototype.updateParticipantCount = function () {
        this.participantCountElement.innerHTML = "" + this.participantItemMap.size;
    };
    ParticipantListWidget.prototype.setMuteCamera = function (jitsiId, muteCamera) {
        var item = this.participantItemMap.get(jitsiId);
        if (item)
            item.setMuteCamera(muteCamera);
    };
    ParticipantListWidget.prototype.setMuteMic = function (jitsiId, muteMic) {
        var item = this.participantItemMap.get(jitsiId);
        if (item)
            item.setMuteAudio(muteMic);
    };
    ParticipantListWidget.prototype.updateByRole = function (isHost) {
        this.isHost = isHost;
        if (isHost)
            $(this.rootElement).addClass("is-host");
        else
            $(this.rootElement).removeClass("is-host");
        this.muteAllButtonElement.style.visibility = isHost ? "visible" : "hidden";
        this.participantItemMap.forEach(function (participantItem, key) {
            participantItem.setRole(isHost);
        });
    };
    return ParticipantListWidget;
}());
exports.ParticipantListWidget = ParticipantListWidget;
//# sourceMappingURL=ParticipantListPanel.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\ParticipantListPanel.js","/components")
},{"../util/snippet":55,"./vector_icon":36,"buffer":25,"e/U+97":27}],32:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SettingDialog = exports.SettingDialogProps = void 0;
var MediaType_1 = require("../enum/MediaType");
var ActiveDevices_1 = require("../model/ActiveDevices");
var SettingDialogProps = /** @class */ (function () {
    function SettingDialogProps() {
    }
    return SettingDialogProps;
}());
exports.SettingDialogProps = SettingDialogProps;
var SettingDialog = /** @class */ (function () {
    function SettingDialog() {
        this.JitsiMeetJS = window.JitsiMeetJS;
        this.audioTrackError = null;
        this.videoTrackError = null;
        this.activeCameraDeviceId = null;
        this.activeMicDeviceId = null;
        this.activeSpeakerDeviceId = null;
        this.localTracks = [];
    }
    SettingDialog.prototype.init = function (props) {
        this.props = props;
        this.dialog = document.querySelector(".setting-dialog-wrapper");
        this.showButton = document.querySelector(".setting-dialog-wrapper>button");
        $(this.dialog).addClass("d-none");
        this.okButton = document.querySelector("#setting-dialog-ok-button");
        this.closeButton = document.querySelector("#setting-dialog-cancel-button");
        this.videoPreviewElem = document.getElementById("camera-preview");
        this.audioPreviewElem = document.getElementById("mic-preview");
        this.cameraListElem = document.getElementById("camera-list");
        this.micListElem = document.getElementById("mic-list");
        this.speakerListElem = document.getElementById("speaker-list");
        this.attachEventHandlers();
        this.refreshDeviceList();
    };
    SettingDialog.prototype.show = function () {
        $(this.dialog).removeClass("d-none");
        $(this.showButton).trigger("click");
    };
    SettingDialog.prototype.attachEventHandlers = function () {
        var _this_1 = this;
        var _this = this;
        $(this.cameraListElem).off('change').on('change', function () {
            _this.onCameraChanged($(this).val());
        });
        $(this.micListElem).off('change').on('change', function () {
            _this.onMicChanged($(this).val());
        });
        $(this.speakerListElem).off('change').on('change', function () {
            _this.onSpeakerChanged($(this).val());
        });
        $(this.okButton).off('click').on('click', function () {
            _this_1.onOK();
        });
    };
    SettingDialog.prototype.refreshDeviceList = function () {
        var _this_1 = this;
        this.JitsiMeetJS.mediaDevices.enumerateDevices(function (devices) {
            _this_1.cameraList = devices.filter(function (d) { return d.kind === 'videoinput'; });
            _this_1.micList = devices.filter(function (d) { return d.kind === 'audioinput'; });
            _this_1.speakerList = devices.filter(function (d) { return d.kind === 'audiooutput'; });
            _this_1.renderDevices();
        });
    };
    SettingDialog.prototype.renderDevices = function () {
        var _this_1 = this;
        this.activeCameraDeviceId = this.props.curDevices.cameraId;
        this.activeMicDeviceId = this.props.curDevices.micId;
        this.activeSpeakerDeviceId = this.props.curDevices.speakerId;
        this.clearDOMElement(this.cameraListElem);
        this.cameraList.forEach(function (camera) {
            var selected = (_this_1.activeCameraDeviceId && camera.deviceId === _this_1.activeCameraDeviceId)
                ? "selected" : "";
            $(_this_1.cameraListElem).append("<option value=\"" + camera.deviceId + "\" " + selected + ">" + camera.label + "</option>");
        });
        this.clearDOMElement(this.micListElem);
        this.micList.forEach(function (mic) {
            var selected = (_this_1.activeMicDeviceId && mic.deviceId === _this_1.activeMicDeviceId)
                ? "selected" : "";
            $(_this_1.micListElem).append("<option value=\"" + mic.deviceId + "\" " + selected + ">" + mic.label + "</option>");
        });
        this.clearDOMElement(this.speakerListElem);
        this.speakerList.forEach(function (speaker) {
            var selected = (_this_1.activeSpeakerDeviceId && speaker.deviceId === _this_1.activeSpeakerDeviceId)
                ? "selected" : "";
            $(_this_1.speakerListElem).append("<option value=\"" + speaker.deviceId + "\" " + selected + ">" + speaker.label + "</option>");
        });
        $(".form-select").select2();
        this.createLocalTracks(this.activeCameraDeviceId, this.activeMicDeviceId)
            .then(function (tracks) {
            tracks.forEach(function (t) {
                if (t.getType() === MediaType_1.MediaType.VIDEO) {
                    t.attach(_this_1.videoPreviewElem);
                }
                else if (t.getType() === MediaType_1.MediaType.AUDIO) {
                    t.attach(_this_1.audioPreviewElem);
                }
            });
            _this_1.localTracks = tracks;
        });
    };
    SettingDialog.prototype.initCurrentDevices = function () {
        var _this_1 = this;
        var _this = this;
        $("option", this.cameraListElem).each(function (_) {
            if ($(_this_1).val() === _this.props.curDevices.micId)
                $(_this_1).attr("selected", "selected");
        });
    };
    SettingDialog.prototype.clearDOMElement = function (elem) {
        while (elem.firstChild) {
            elem.removeChild(elem.firstChild);
        }
    };
    SettingDialog.prototype.createLocalTracks = function (cameraDeviceId, micDeviceId) {
        var _this_1 = this;
        this.videoTrackError = null;
        this.audioTrackError = null;
        if (cameraDeviceId != null && micDeviceId != null) {
            return this.JitsiMeetJS.createLocalTracks({
                devices: ['audio', 'video'],
                cameraDeviceId: cameraDeviceId,
                micDeviceId: micDeviceId
            }).catch(function () { return Promise.all([
                _this_1.createAudioTrack(micDeviceId).then(function (_a) {
                    var stream = _a[0];
                    return stream;
                }),
                _this_1.createVideoTrack(cameraDeviceId).then(function (_a) {
                    var stream = _a[0];
                    return stream;
                })
            ]); }).then(function (tracks) {
                if (_this_1.audioTrackError) {
                    //display error
                }
                if (_this_1.videoTrackError) {
                    //display error
                }
                return tracks.filter(function (t) { return typeof t !== 'undefined'; });
            });
        }
        else if (cameraDeviceId != null) {
            return this.createVideoTrack(cameraDeviceId);
        }
        else if (micDeviceId != null) {
            return this.createAudioTrack(micDeviceId);
        }
        return Promise.resolve([]);
    };
    SettingDialog.prototype.createVideoTrack = function (cameraDeviceId) {
        var _this_1 = this;
        return this.JitsiMeetJS.createLocalTracks({
            devices: ['video'],
            cameraDeviceId: cameraDeviceId,
            micDeviceId: null
        })
            .catch(function (error) {
            _this_1.videoTrackError = error;
            return Promise.resolve([]);
        });
    };
    SettingDialog.prototype.createAudioTrack = function (micDeviceId) {
        var _this_1 = this;
        return (this.JitsiMeetJS.createLocalTracks({
            devices: ['audio'],
            cameraDeviceId: null,
            micDeviceId: micDeviceId
        })
            .catch(function (error) {
            _this_1.audioTrackError = error;
            return Promise.resolve([]);
        }));
    };
    SettingDialog.prototype.onCameraChanged = function (cameraDeviceId) {
        var _this_1 = this;
        this.activeCameraDeviceId = cameraDeviceId;
        this.createLocalTracks(this.activeCameraDeviceId, null)
            .then(function (tracks) {
            var newTrack = tracks.find(function (t) { return t.getType() === MediaType_1.MediaType.VIDEO; });
            //remove existing track
            var oldTrack = _this_1.localTracks.find(function (t) { return t.getType() === MediaType_1.MediaType.VIDEO; });
            if (oldTrack) {
                oldTrack.dispose();
                _this_1.localTracks.splice(_this_1.localTracks.indexOf(oldTrack), 1);
            }
            if (newTrack) {
                _this_1.localTracks.push(newTrack);
                newTrack.attach(_this_1.videoPreviewElem);
            }
        });
    };
    SettingDialog.prototype.onMicChanged = function (micDeviceId) {
        var _this_1 = this;
        this.activeMicDeviceId = micDeviceId;
        this.createLocalTracks(null, this.activeMicDeviceId)
            .then(function (tracks) {
            var newTrack = tracks.find(function (t) { return t.getType() === MediaType_1.MediaType.AUDIO; });
            //remove existing track
            var oldTrack = _this_1.localTracks.find(function (t) { return t.getType() === MediaType_1.MediaType.AUDIO; });
            if (oldTrack) {
                oldTrack.dispose();
                _this_1.localTracks.splice(_this_1.localTracks.indexOf(oldTrack), 1);
            }
            if (newTrack) {
                _this_1.localTracks.push(newTrack);
                newTrack.attach(_this_1.audioPreviewElem);
            }
        });
    };
    SettingDialog.prototype.onSpeakerChanged = function (speakerDeviceId) {
        this.activeSpeakerDeviceId = speakerDeviceId;
        if (this.activeSpeakerDeviceId && this.JitsiMeetJS.mediaDevices.isDeviceChangeAvailable('output')) {
            this.JitsiMeetJS.mediaDevices.setAudioOutputDevice(this.activeSpeakerDeviceId);
        }
        ;
    };
    SettingDialog.prototype.onOK = function () {
        this.closeDialog();
        var newDevices = new ActiveDevices_1.ActiveDevices();
        newDevices.cameraId = this.activeCameraDeviceId;
        newDevices.micId = this.activeMicDeviceId;
        newDevices.speakerId = this.activeSpeakerDeviceId;
        this.props.onDeviceChange(newDevices);
    };
    SettingDialog.prototype.closeDialog = function () {
        $(this.closeButton).trigger("click");
        this.localTracks.forEach(function (track) {
            track.dispose();
        });
    };
    return SettingDialog;
}());
exports.SettingDialog = SettingDialog;
//# sourceMappingURL=SettingDialog.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\SettingDialog.js","/components")
},{"../enum/MediaType":38,"../model/ActiveDevices":47,"buffer":25,"e/U+97":27}],33:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ToolBar = exports.ToolBarProps = void 0;
var MediaType_1 = require("../enum/MediaType");
var vector_icon_1 = require("./vector_icon");
var ToolBarProps = /** @class */ (function () {
    function ToolBarProps() {
    }
    return ToolBarProps;
}());
exports.ToolBarProps = ToolBarProps;
var ToolBar = /** @class */ (function () {
    function ToolBar(props) {
        this.root = null;
        this.props = props;
        this.root = document.getElementById("new-toolbox");
        this.toolbarTileViewButtonElement = document.querySelector("#tileview");
        this.toolbarMuteAllButtonElement = document.querySelector("#muteall");
        this.toolbarMuteAllVideoButtonElement = document.querySelector("#muteallvideo");
        this.toolbarAudioButtonElement = document.querySelector("#mic-enable");
        this.toolbarVideoButtonElement = document.querySelector("#camera-enable");
        this.toolbarDesktopShareButtonElement = document.querySelector("#share");
        this.toolbarDesktopShareMenuButtonElement = document.querySelector("#sharescreen");
        this.toolbarRecordButtonElement = document.querySelector("#record");
        this.toolbarHandRaiseButtonElement = document.querySelector("#handraise");
        this.toolbarChatButtonElement = document.querySelector("#chat");
        this.toolbarLeaveButtonElement = document.querySelector("#leave");
        this.toolbarSettingButtonElement = document.querySelector("#setting");
        this.chattingUnreadBadge = document.querySelector(".chat-badge");
        this.attachHandlers();
    }
    ToolBar.prototype.attachHandlers = function () {
        var _this = this;
        $(this.toolbarTileViewButtonElement).on('click', function () {
            _this.props.toggleTileView();
        });
        $(this.toolbarMuteAllButtonElement).on('click', function () {
            _this.props.toggleMuteAll();
        });
        $(this.toolbarMuteAllVideoButtonElement).on('click', function () {
            _this.props.toggleMuteAllVideo();
        });
        $(this.toolbarVideoButtonElement).on('click', function () {
            _this.props.toggleVideoMute();
        });
        $(this.toolbarAudioButtonElement).on('click', function () {
            _this.props.toggleAudioMute();
        });
        $(this.toolbarChatButtonElement).on('click', function (_) {
            _this.props.openChatting(true);
        });
        $(this.toolbarDesktopShareButtonElement).on("click", function () {
            _this.props.toggleScreenShare();
        });
        $(this.toolbarDesktopShareMenuButtonElement).on("click", function () {
            _this.props.toggleScreenShare();
        });
        $(this.toolbarRecordButtonElement).on('click', function () {
            _this.props.toggleRecording();
        });
        $(this.toolbarHandRaiseButtonElement).on('click', function () {
            _this.props.toggleHandRaise();
        });
        $(this.toolbarSettingButtonElement).on('click', function () {
            _this.props.openSetting();
        });
        $(this.toolbarLeaveButtonElement).click(function () {
            _this.props.leaveMeeting();
        });
    };
    ToolBar.prototype.update = function (userInfo, localTracks) {
        var audioMuted = false, videoMuted = false;
        var hasAudioTrack = false, hasVideoTrack = false;
        localTracks.forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO) {
                hasVideoTrack = true;
                if (track.isMuted())
                    videoMuted = true;
            }
            else if (track.getType() === MediaType_1.MediaType.AUDIO) {
                hasAudioTrack = true;
                if (track.isMuted())
                    audioMuted = true;
            }
        });
        this.toolbarVideoButtonElement.style.display = hasVideoTrack ? "inline-block" : "";
        this.toolbarDesktopShareButtonElement.style.display = hasVideoTrack ? "inline-block" : "";
        this.toolbarAudioButtonElement.style.display = hasAudioTrack ? "inline-block" : "";
        if (audioMuted) {
            $(this.toolbarAudioButtonElement).find("path").attr("d", vector_icon_1.VectorIcon.AUDIO_MUTE_ICON);
            $(this.toolbarAudioButtonElement).addClass("muted");
        }
        else {
            $(this.toolbarAudioButtonElement).find("path").attr("d", vector_icon_1.VectorIcon.AUDIO_UNMUTE_ICON);
            $(this.toolbarAudioButtonElement).removeClass("muted");
        }
        if (videoMuted) {
            $(this.toolbarVideoButtonElement).find("path").attr("d", vector_icon_1.VectorIcon.VIDEO_MUTE_ICON);
            $(this.toolbarVideoButtonElement).addClass("muted");
        }
        else {
            $(this.toolbarVideoButtonElement).find("path").attr("d", vector_icon_1.VectorIcon.VIDEO_UNMUTE_ICON);
            $(this.toolbarVideoButtonElement).removeClass("muted");
        }
    };
    ToolBar.prototype.setScreenShare = function (on) {
        if (on) {
            $(".toolbox-icon", this.toolbarDesktopShareButtonElement).addClass("toggled");
        }
        else {
            $(".toolbox-icon", this.toolbarDesktopShareButtonElement).removeClass("toggled");
        }
    };
    ToolBar.prototype.setRecording = function (on) {
        if (on) {
            $(this.toolbarRecordButtonElement).addClass("live");
        }
        else {
            $(this.toolbarRecordButtonElement).removeClass("live");
        }
    };
    ToolBar.prototype.fadeIn = function () {
        $(this.root).addClass("visible");
    };
    ToolBar.prototype.fadeOut = function () {
        $(this.root).removeClass("visible");
    };
    ToolBar.prototype.showUnreadBadge = function (show) {
        this.chattingUnreadBadge.style.display = !!show ? "flex" : "none";
    };
    ToolBar.prototype.setUnreadCount = function (count) {
        this.chattingUnreadBadge.innerHTML = "" + count;
    };
    ToolBar.prototype.updateByRole = function (isHost) {
        this.toolbarHandRaiseButtonElement.style.display = isHost ? "none" : "inline-block";
        this.toolbarMuteAllButtonElement.style.display = !isHost ? "none" : "block";
        this.toolbarMuteAllVideoButtonElement.style.display = !isHost ? "none" : "block";
    };
    return ToolBar;
}());
exports.ToolBar = ToolBar;
//# sourceMappingURL=ToolBar.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\ToolBar.js","/components")
},{"../enum/MediaType":38,"./vector_icon":36,"buffer":25,"e/U+97":27}],34:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VideoPanel = exports.VideoPanelProps = void 0;
var MediaType_1 = require("../enum/MediaType");
var UserProperty_1 = require("../enum/UserProperty");
var snippet_1 = require("../util/snippet");
var vector_icon_1 = require("./vector_icon");
var VideoPanelProps = /** @class */ (function () {
    function VideoPanelProps() {
    }
    return VideoPanelProps;
}());
exports.VideoPanelProps = VideoPanelProps;
var DISCO_REMOTE_CONTROL_FEATURE = 'http://jitsi.org/meet/remotecontrol';
var VideoPanel = /** @class */ (function () {
    function VideoPanel(props) {
        this.videoElementClass = "video-element";
        this.moderatorClass = "moderator-icon";
        this.audioMuteClass = "audioMuted";
        this.videoMuteClass = "videoMuted";
        this.userNameClass = "displayname";
        this.shortNameClass = "avatar-container";
        this.activeSpeakerClass = "active-speaker";
        this.privateChatClass = "private-chat";
        this.popupMenuButtonClass = "remotevideomenu";
        this.props = props;
        this.panelClass = this.props.panelClass;
        this.fullscreenClass = this.props.fullscreenClass;
        this.popupMenuClass = this.props.popupMenuClass;
        this.Id = ++VideoPanel.nPanelInstanceId;
        this.root = this.create();
        this.videoElem = $("video", this.root)[0];
        this.audioElem = $("audio", this.root)[0];
        this.nameElem = $("." + this.userNameClass, this.root)[0];
        this.avatarNameElem = $("." + this.shortNameClass, this.root)[0];
        //white small icons at the bottom of panel
        this.audioMuteIconElem = $("." + this.audioMuteClass, this.root)[0];
        this.videoMuteIconElem = $("." + this.videoMuteClass, this.root)[0];
        this.moderatorIconElem = $("." + this.moderatorClass, this.root)[0];
        //menu items 
        this.grantModeratorMenuItem = $("li.grant-moderator", this.root)[0];
        this.audioMuteMenuItem = $("li.audio-mute", this.root)[0];
        this.videoMuteMenuItem = $("li.video-mute", this.root)[0];
        this.fullscreenMuteItem = $("li.fullscreen", this.root)[0];
        this.kickParticipantMenuItem = $("li.kick-participant", this.root)[0];
        this.remoteControlMenuItem = $("li.remote-control", this.root)[0];
        //this.attachHandlers();
    }
    VideoPanel.prototype.attachHandlers = function () {
        var _this = this;
        this.tileIcon = document.querySelector("#tileview");
        $(this.root)
            .on('click', "." + _this.popupMenuButtonClass, function (e) {
            $("." + _this.popupMenuClass).removeClass("visible");
            $(this).find("." + _this.popupMenuClass).addClass("visible").focus();
            e.stopPropagation();
        })
            .on('click', 'li.overflow-menu-item', function (e) {
            $(this).closest("." + _this.popupMenuClass).removeClass("visible");
            e.stopPropagation();
        })
            .on('click', '.fullscreen', function (e) {
            $(_this.root).toggleClass(_this.fullscreenClass);
            _this.props.refreshGrid();
            var label = $(this).find(".label");
            if ($(_this.root).hasClass(_this.fullscreenClass)) {
                label.html("Exit full screen");
            }
            else {
                label.html("View full screen");
            }
        })
            .on('mouseover', function () {
            $(this).removeClass("display-video");
            $(this).addClass("display-name-on-video");
        })
            .on('mouseout', function () {
            $(this).removeClass("display-name-on-video");
            $(this).addClass("display-video");
        })
            .on('dblclick', function (e) {
            $(this).find(".fullscreen").trigger("click");
        });
        $(this.tileIcon).on('click', function () {
            $(_this.root).toggleClass(_this.fullscreenClass);
            _this.props.refreshGrid();
        });
    };
    VideoPanel.prototype.setShotnameVisible = function (show) {
        this.avatarNameElem.style.display = show ? "block" : "none";
        this.videoElem.style.visibility = show ? "hidden" : "visible";
    };
    VideoPanel.prototype.setUserName = function (name) {
        this.nameElem.innerHTML = name;
        $("text", this.avatarNameElem).html(snippet_1.avatarName(name));
    };
    VideoPanel.prototype.showModeratorIcon = function (show) {
        this.moderatorIconElem.style.display = show ? "block" : "none";
    };
    VideoPanel.prototype.setHighlight = function (h) {
        if (h)
            $(this.root).addClass(this.activeSpeakerClass);
        else
            $(this.root).removeClass(this.activeSpeakerClass);
    };
    VideoPanel.prototype.updatePanelOnJitsiUser = function (myInfo, jitsiUser) {
        var _this_1 = this;
        //set name
        this.setUserName(jitsiUser.getDisplayName());
        //hide shotname if exist visible video track
        var isVisibleVideo = false;
        jitsiUser.getTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO && !track.isMuted()) {
                isVisibleVideo = true;
            }
        });
        this.setShotnameVisible(!isVisibleVideo);
        //bottom small icons
        this.videoMuteIconElem.style.display = jitsiUser.isVideoMuted() ? "block" : "none";
        this.audioMuteIconElem.style.display = jitsiUser.isAudioMuted() ? "block" : "none";
        this.moderatorIconElem.style.display = jitsiUser.getProperty(UserProperty_1.UserProperty.IsHost) ? "block" : "none";
        //popup menu
        if (myInfo.IsHost) {
            var userHaveCamera_1 = false, userHaveMicrophone_1 = false;
            jitsiUser.getTracks().forEach(function (track) {
                if (track.getType() === MediaType_1.MediaType.VIDEO)
                    userHaveCamera_1 = true;
                else if (track.getType() === MediaType_1.MediaType.AUDIO)
                    userHaveMicrophone_1 = true;
            });
            this.videoMuteMenuItem.style.display = userHaveCamera_1 ? "flex" : "none";
            this.audioMuteMenuItem.style.display = userHaveMicrophone_1 ? "flex" : "none";
            this.grantModeratorMenuItem.style.display = "flex";
            this.kickParticipantMenuItem.style.display = "flex";
            this.remoteControlMenuItem.style.display = "none";
            jitsiUser.getFeatures()
                .then(function (features) {
                /**/
                var b = features.has(DISCO_REMOTE_CONTROL_FEATURE);
                if (b)
                    _this_1.remoteControlMenuItem.style.display = "flex";
                console.log("-------------user:" + b);
                console.log(jitsiUser);
            });
        }
        else {
            this.videoMuteMenuItem.style.display = "none";
            this.audioMuteMenuItem.style.display = "none";
            this.grantModeratorMenuItem.style.display = "none";
            this.kickParticipantMenuItem.style.display = "none";
            this.remoteControlMenuItem.style.display = "none";
        }
        if (jitsiUser.getProperty(UserProperty_1.UserProperty.IsHost)) {
            this.grantModeratorMenuItem.style.display = "none";
            this.kickParticipantMenuItem.style.display = "none";
            this.remoteControlMenuItem.style.display = "none";
        }
        //popup menu audio icon/label change
        if (this.audioMuteMenuItem.style.display === 'flex') {
            if (jitsiUser.isAudioMuted()) {
                $(this.audioMuteMenuItem).find(".label").html("Unmute Audio");
                $(this.audioMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.AUDIO_MUTE_ICON);
            }
            else {
                $(this.audioMuteMenuItem).find(".label").html("Mute Audio");
                $(this.audioMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.AUDIO_UNMUTE_ICON);
            }
        }
        if (this.videoMuteMenuItem.style.display === 'flex') {
            if (jitsiUser.isVideoMuted()) {
                $(this.videoMuteMenuItem).find(".label").html("Unmute Video");
                $(this.videoMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.VIDEO_MUTE_ICON);
            }
            else {
                $(this.videoMuteMenuItem).find(".label").html("Mute Video");
                $(this.videoMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.VIDEO_UNMUTE_ICON);
            }
        }
        //popup menu handlers
        if (myInfo.IsHost) {
            $(this.grantModeratorMenuItem).unbind('click').on('click', function () {
                _this_1.props.grantModeratorRole(jitsiUser.getId());
            });
            $(this.audioMuteMenuItem).unbind('click').on('click', function () {
                _this_1.props.muteUserAudio(jitsiUser.getId(), !jitsiUser.isAudioMuted());
            });
            $(this.videoMuteMenuItem).unbind('click').on('click', function () {
                _this_1.props.muteUserVideo(jitsiUser.getId(), !jitsiUser.isVideoMuted());
            });
            $(this.kickParticipantMenuItem).unbind('click').on('click', function () {
                _this_1.props.kickParticipantOut(jitsiUser.getId());
            });
            $(this.remoteControlMenuItem).unbind('click').on('click', function () {
                _this_1.props.sendRemoteControlReply('permissions', {}, jitsiUser.getId());
            });
        }
        //private chat handler
        $(this.root).find("." + this.privateChatClass).unbind('click').on('click', function () {
            _this_1.props.openPrivateChat(jitsiUser.getId(), jitsiUser.getDisplayName());
        });
        //active speaker(blue border)
        $(this.root).removeClass(this.activeSpeakerClass);
        var _this = this;
        $(this.root).on('mousedown', function (e) {
            //e.preventDefault();
            e.stopPropagation();
            if (e.which === 3) {
                e.preventDefault();
            }
            var ae = {
                button: e.button + 1,
                x: e.offsetX,
                y: e.offsetY
            };
            _this.props.sendRemoteControlReply('mousedown', ae, jitsiUser.getId());
        });
        $(this.root).on('mouseup', function (e) {
            //e.preventDefault();
            e.stopPropagation();
            if (e.which === 3)
                e.preventDefault();
            var ae = {
                button: e.button + 1,
                x: e.offsetX,
                y: e.offsetY
            };
            _this.props.sendRemoteControlReply('mouseup', ae, jitsiUser.getId());
        });
        var enableHandler = true;
        $(this.root).on('mousemove', function (e) {
            if (enableHandler) {
                e.stopPropagation();
                var ae = {
                    button: e.button + 1,
                    x: e.offsetX / this.offsetWidth,
                    y: e.offsetY / this.offsetHeight
                };
                _this.props.sendRemoteControlReply('mousemove', ae, jitsiUser.getId());
                enableHandler = false;
            }
        });
        var timer = window.setInterval(function () {
            enableHandler = true;
        }, 200);
        $(window).unbind().on('keydown', function (e) {
            var modifiers = [];
            if (e.shiftKey) {
                modifiers.push('shift');
            }
            if (e.ctrlKey) {
                modifiers.push('control');
            }
            if (e.altKey) {
                modifiers.push('alt');
            }
            if (e.metaKey) {
                modifiers.push('command');
            }
            var ae = {
                modifiers: modifiers,
                key: e.keyCode,
            };
            _this.props.sendRemoteControlReply('keydown', ae, jitsiUser.getId());
        });
        $(window).on('keyup', function (e) {
            var modifiers = [];
            if (e.shiftKey) {
                modifiers.push('shift');
            }
            if (e.ctrlKey) {
                modifiers.push('control');
            }
            if (e.altKey) {
                modifiers.push('alt');
            }
            if (e.metaKey) {
                modifiers.push('command');
            }
            var ae = {
                modifiers: modifiers,
                key: e.keyCode,
            };
            _this.props.sendRemoteControlReply('keyup', ae, jitsiUser.getId());
        });
    };
    VideoPanel.prototype.updatePanelOnMyBGUser = function (myInfo, localTracks) {
        var _this_1 = this;
        var audioMuted = true, videoMuted = true;
        localTracks.forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO && !track.isMuted())
                videoMuted = false;
            else if (track.getType() === MediaType_1.MediaType.AUDIO && !track.isMuted())
                audioMuted = false;
        });
        //name
        this.setUserName(myInfo.Name);
        var isVisibleVideo = false;
        localTracks.forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO && !track.isMuted()) {
                isVisibleVideo = true;
            }
        });
        this.setShotnameVisible(!isVisibleVideo);
        //bottom small icons
        this.videoMuteIconElem.style.display = videoMuted ? "block" : "none";
        this.audioMuteIconElem.style.display = audioMuted ? "block" : "none";
        this.moderatorIconElem.style.display = myInfo.IsHost ? "block" : "none";
        //popup menu
        if (myInfo.IsHost) {
            this.videoMuteMenuItem.style.display = myInfo.mediaPolicy.useCamera ? "flex" : "none";
            this.audioMuteMenuItem.style.display = myInfo.mediaPolicy.useMic ? "flex" : "none";
        }
        else {
            this.videoMuteMenuItem.style.display = "none";
            this.audioMuteMenuItem.style.display = "none";
        }
        this.grantModeratorMenuItem.style.display = "none";
        this.kickParticipantMenuItem.style.display = "none";
        this.remoteControlMenuItem.style.display = "none";
        //popup menu audio icon/label change
        if (this.audioMuteMenuItem.style.display === 'flex') {
            if (audioMuted) {
                $(this.audioMuteMenuItem).find(".label").html("Unmute Audio");
                $(this.audioMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.AUDIO_MUTE_ICON);
            }
            else {
                $(this.audioMuteMenuItem).find(".label").html("Mute Audio");
                $(this.audioMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.AUDIO_UNMUTE_ICON);
            }
        }
        if (this.videoMuteMenuItem.style.display === 'flex') {
            if (videoMuted) {
                $(this.videoMuteMenuItem).find(".label").html("Unmute Video");
                $(this.videoMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.VIDEO_MUTE_ICON);
            }
            else {
                $(this.videoMuteMenuItem).find(".label").html("Mute Video");
                $(this.videoMuteMenuItem).find("path").attr("d", vector_icon_1.VectorIcon.VIDEO_UNMUTE_ICON);
            }
        }
        //popup menu handlers
        if (myInfo.IsHost) {
            $(this.audioMuteMenuItem).unbind('click').on('click', function () {
                _this_1.props.muteMyAudio(!audioMuted);
            });
            $(this.videoMuteMenuItem).unbind('click').on('click', function () {
                _this_1.props.muteMyVideo(!videoMuted);
            });
        }
        //hide private-chat item
        $(this.root).find("." + this.privateChatClass).hide();
        //active speaker(blue border)
        $(this.root).addClass(this.activeSpeakerClass);
    };
    VideoPanel.prototype.create = function () {
        var videoTag = "<video autoplay playsinline style='object-fit:cover; '  class='" + this.videoElementClass + "' id='remoteVideo_" + this.Id + "'></video>";
        var audioTag = "<audio autoplay=\"\" id=\"remoteAudio_" + this.Id + "\"></audio>";
        var avatarVisible = 'visible';
        var cameraStatus = '<div class="indicator-container videoMuted"> \
                        <div> \
                            <span class="indicator-icon-container  toolbar-icon" id=""> \
                                <div class="jitsi-icon "> \
                                    <svg height="13" id="camera-disabled" width="13" viewBox="0 0 32 32"> \
                                        <path d="M4.375 2.688L28 26.313l-1.688 1.688-4.25-4.25c-.188.125-.5.25-.75.25h-16c-.75 0-1.313-.563-1.313-1.313V9.313c0-.75.563-1.313 1.313-1.313h1L2.687 4.375zm23.625 6v14.25L13.062 8h8.25c.75 0 1.375.563 1.375 1.313v4.688z"></path> \
                                    </svg> \
                                </div> \
                            </span> \
                        </div> \
                    </div>';
        var micStatus = '<div class="indicator-container audioMuted"> \
                            <div> \
                                <span class="indicator-icon-container  toolbar-icon" id=""> \
                                    <div class="jitsi-icon "> \
                                        <svg height="13" id="mic-disabled" width="13" viewBox="0 0 32 32"> \
                                            <path d="M5.688 4l22.313 22.313-1.688 1.688-5.563-5.563c-1 .625-2.25 1-3.438 1.188v4.375h-2.625v-4.375c-4.375-.625-8-4.375-8-8.938h2.25c0 4 3.375 6.75 7.063 6.75 1.063 0 2.125-.25 3.063-.688l-2.188-2.188c-.25.063-.563.125-.875.125-2.188 0-4-1.813-4-4v-1l-8-8zM20 14.875l-8-7.938v-.25c0-2.188 1.813-4 4-4s4 1.813 4 4v8.188zm5.313-.187a8.824 8.824 0 01-1.188 4.375L22.5 17.375c.375-.813.563-1.688.563-2.688h2.25z"></path> \
                                        </svg> \
                                    </div> \
                                </span> \
                            </div> \
                        </div>';
        var moderatorStatus = '<div class="moderator-icon right"> \
                                <div class="indicator-container"> \
                                    <div> \
                                        <span class="indicator-icon-container focusindicator toolbar-icon" id=""> \
                                            <div class="jitsi-icon "> \
                                                <svg height="13" width="13" viewBox="0 0 32 32"> \
                                                    <path d="M16 20.563l5 3-1.313-5.688L24.125 14l-5.875-.5L16 8.125 13.75 13.5l-5.875.5 4.438 3.875L11 23.563zm13.313-8.25l-7.25 6.313 2.188 9.375-8.25-5-8.25 5 2.188-9.375-7.25-6.313 9.563-.813 3.75-8.813 3.75 8.813z"></path> \
                                                </svg> \
                                            </div> \
                                        </span> \
                                    </div> \
                                </div> \
                            </div>';
        var panelHtml = "\n        <span class=\"" + this.panelClass + " display-video\" onContextMenu = \"return false;\">\n\n            <label>Version 1.1</label>\n\n            " + videoTag + " \n            " + audioTag + "\n            <div class=\"videocontainer__toolbar\">\n                <div> " + cameraStatus + " " + micStatus + " " + moderatorStatus + "</div>\n            </div>\n            <div class=\"videocontainer__hoverOverlay\"></div>\n            <div class=\"displayNameContainer\"><span class=\"displayname\" id=\"localDisplayName\">Name</span>\n            \n            </div>\n            <div class=\"avatar-container " + avatarVisible + "\" style=\"height: 105.5px; width: 105.5px;\">\n                <div class=\"avatar  userAvatar\" style=\"background-color: rgba(234, 255, 128, 0.4); font-size: 180%; height: 100%; width: 100%;\">\n                    <svg class=\"avatar-svg\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n                        <text dominant-baseline=\"central\" fill=\"rgba(255,255,255,.6)\" font-size=\"40pt\" text-anchor=\"middle\" x=\"50\" y=\"50\">Name</text>\n                    </svg>\n                </div>\n            </div >\n            <span class=\"" + this.popupMenuButtonClass + "\">\n                <div class=\"\" id=\"\">\n                    <span class=\"popover-trigger remote-video-menu-trigger\">\n                        <div class=\"jitsi-icon\">\n                            <svg height=\"1em\" width=\"1em\" viewBox=\"0 0 24 24\">\n                                <path d=\"M12 15.984c1.078 0 2.016.938 2.016 2.016s-.938 2.016-2.016 2.016S9.984 19.078 9.984 18s.938-2.016 2.016-2.016zm0-6c1.078 0 2.016.938 2.016 2.016s-.938 2.016-2.016 2.016S9.984 13.078 9.984 12 10.922 9.984 12 9.984zm0-1.968c-1.078 0-2.016-.938-2.016-2.016S10.922 3.984 12 3.984s2.016.938 2.016 2.016S13.078 8.016 12 8.016z\"></path>                             </svg>\n                        </div>\n                    </span>\n                </div>\n                <div class=\"" + this.popupMenuClass + "\" tabIndex=-1 style=\"position: relative; right: 168px;  top: 25px; width: 175px;\">\n                    <ul aria-label=\"More actions menu\" class=\"overflow-menu\">\n                        <li aria-label=\"Grant Moderator\" class=\"overflow-menu-item grant-moderator\" tabindex=\"0\" role=\"button\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon \">\n                                    <svg height=\"22\" width=\"22\" viewBox=\"0 0 24 24\">\n                                        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M14 4a2 2 0 01-1.298 1.873l1.527 4.07.716 1.912c.062.074.126.074.165.035l1.444-1.444 2.032-2.032a2 2 0 111.248.579L19 19a2 2 0 01-2 2H7a2 2 0 01-2-2L4.166 8.993a2 2 0 111.248-.579l2.033 2.033L8.89 11.89c.087.042.145.016.165-.035l.716-1.912 1.527-4.07A2 2 0 1114 4zM6.84 17l-.393-4.725 1.029 1.03a2.1 2.1 0 003.451-.748L12 9.696l1.073 2.86a2.1 2.1 0 003.451.748l1.03-1.03L17.16 17H6.84z\"></path>                                     </svg>\n                                </div>\n                            </span>\n                            <span class=\"label\">Grant Moderator</span>\n                        </li>\n                        <li aria-label=\"Mute\" class=\"overflow-menu-item audio-mute\" tabindex=\"0\" role=\"button\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon \">\n                                    <svg fill=\"none\" height=\"22\" width=\"22\" viewBox=\"0 0 22 22\">\n                                        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.333 8.65V11a3.668 3.668 0 002.757 3.553.928.928 0 00-.007.114v1.757A5.501 5.501 0 015.5 11a.917.917 0 10-1.833 0c0 3.74 2.799 6.826 6.416 7.277v.973a.917.917 0 001.834 0v-.973a7.297 7.297 0 003.568-1.475l3.091 3.092a.932.932 0 101.318-1.318l-3.091-3.091.01-.013-1.311-1.311-.01.013-1.325-1.325.008-.014-1.395-1.395a1.24 1.24 0 01-.004.018l-3.61-3.609v-.023L7.334 5.993v.023l-3.909-3.91a.932.932 0 10-1.318 1.318L7.333 8.65zm1.834 1.834V11a1.833 1.833 0 002.291 1.776l-2.291-2.292zm3.682 3.683c-.29.17-.606.3-.94.386a.928.928 0 01.008.114v1.757a5.47 5.47 0 002.257-.932l-1.325-1.325zm1.818-3.476l-1.834-1.834V5.5a1.833 1.833 0 00-3.644-.287l-1.43-1.43A3.666 3.666 0 0114.667 5.5v5.19zm1.665 1.665l1.447 1.447c.357-.864.554-1.81.554-2.803a.917.917 0 10-1.833 0c0 .468-.058.922-.168 1.356z\"></path>                                     </svg>\n                                </div>\n                            </span>\n                            <span class=\"label\">Mute</span>\n                        </li>\n                        <li aria-label=\"Disable camera\" class=\"overflow-menu-item video-mute\" tabindex=\"0\" role=\"button\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon\">\n                                    <svg fill=\"none\" height=\"22\" width=\"22\" viewBox=\"0 0 22 22\">\n                                        <path clip-rule=\"evenodd\" d=\"M6.84 5.5h-.022L3.424 2.106a.932.932 0 10-1.318 1.318L4.182 5.5h-.515c-1.013 0-1.834.82-1.834 1.833v7.334c0 1.012.821 1.833 1.834 1.833H13.75c.404 0 .777-.13 1.08-.352l3.746 3.746a.932.932 0 101.318-1.318l-4.31-4.31v-.024L13.75 12.41v.023l-5.1-5.099h.024L6.841 5.5zm6.91 4.274V7.333h-2.44L9.475 5.5h4.274c1.012 0 1.833.82 1.833 1.833v.786l3.212-1.835a.917.917 0 011.372.796v7.84c0 .344-.19.644-.47.8l-3.736-3.735 2.372 1.356V8.659l-2.75 1.571v1.377L13.75 9.774zM3.667 7.334h2.349l7.333 7.333H3.667V7.333z\"></path>                                     </svg>\n                                </div>\n                            </span>\n                            <span class=\"label\">Disable camera</span>\n                        </li>\n                        <li aria-label=\"Toggle full screen\" class=\"overflow-menu-item fullscreen\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon \">\n                                    <svg fill=\"none\" height=\"22\" width=\"22\" viewBox=\"0 0 22 22\">\n                                        <path clip-rule=\"evenodd\" d=\"M8.25 2.75H3.667a.917.917 0 00-.917.917V8.25h1.833V4.583H8.25V2.75zm5.5 1.833V2.75h4.583c.507 0 .917.41.917.917V8.25h-1.833V4.583H13.75zm0 12.834h3.667V13.75h1.833v4.583c0 .507-.41.917-.917.917H13.75v-1.833zM4.583 13.75v3.667H8.25v1.833H3.667a.917.917 0 01-.917-.917V13.75h1.833z\"></path>                                     </svg>\n                                </div>\n                            </span>\n                            <span class=\"label overflow-menu-item-text\">View full screen</span>\n                        </li>\n                        <li aria-label=\"\" class=\"overflow-menu-item " + this.privateChatClass + "\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon \">\n                                    <svg fill=\"none\" height=\"22\" width=\"22\" viewBox=\"0 0 22 22\">\n                                        <path clip-rule=\"evenodd\" d=\"M19,8H18V5a3,3,0,0,0-3-3H5A3,3,0,0,0,2,5V17a1,1,0,0,0,.62.92A.84.84,0,0,0,3,18a1,1,0,0,0,.71-.29l2.81-2.82H8v1.44a3,3,0,0,0,3,3h6.92l2.37,2.38A1,1,0,0,0,21,22a.84.84,0,0,0,.38-.08A1,1,0,0,0,22,21V11A3,3,0,0,0,19,8ZM8,11v1.89H6.11a1,1,0,0,0-.71.29L4,14.59V5A1,1,0,0,1,5,4H15a1,1,0,0,1,1,1V8H11A3,3,0,0,0,8,11Zm12,7.59-1-1a1,1,0,0,0-.71-.3H11a1,1,0,0,1-1-1V11a1,1,0,0,1,1-1h8a1,1,0,0,1,1,1Z\"></path>                                     </svg>\n                                </div>\n                            </span>\n                            <span class=\"label overflow-menu-item-text\">Private chat</span>\n                        </li>\n                        <li aria-label=\"\" class=\"overflow-menu-item kick-participant\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon \">\n                                    <svg height=\"20\" width=\"20\" viewBox=\"0 0 20 20\">\n                                        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10 16.667a6.667 6.667 0 100-13.334 6.667 6.667 0 000 13.334zm0 1.666a8.333 8.333 0 110-16.666 8.333 8.333 0 010 16.666zm0-9.512l2.357-2.357a.833.833 0 111.179 1.179L11.179 10l2.357 2.357a.833.833 0 11-1.179 1.179L10 11.178l-2.357 2.357a.833.833 0 01-1.178-1.179L8.822 10 6.465 7.643a.833.833 0 111.178-1.179L10 8.821z\"></path>\n                                    </svg>\n                                </div>\n                            </span>\n                            <span class=\"label overflow-menu-item-text\">Kick out</span>\n                        </li>\n                        <li aria-label=\"\" class=\"overflow-menu-item remote-control\">\n                            <span class=\"overflow-menu-item-icon\">\n                                <div class=\"jitsi-icon \">\n                                    <svg height=\"22\" width=\"22\" viewBox=\"0 0 22 28\">\n                                        <path d=\"M21.625 14.484L.875 26.015c-.484.266-.875.031-.875-.516v-23c0-.547.391-.781.875-.516l20.75 11.531c.484.266.484.703 0 .969z\"></path>\n                                    </svg>\n                                </div>\n                            </span>\n                            <span class=\"label overflow-menu-item-text\">Remote Control</span>\n                        </li>\n                    </ul>\n                </div>\n            </span>\n        </span >";
        return $(panelHtml)[0];
    };
    VideoPanel.nPanelInstanceId = 0; //increased when add new, but not decreased when remove panel
    return VideoPanel;
}());
exports.VideoPanel = VideoPanel;
//# sourceMappingURL=VideoPanel.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\VideoPanel.js","/components")
},{"../enum/MediaType":38,"../enum/UserProperty":40,"../util/snippet":55,"./vector_icon":36,"buffer":25,"e/U+97":27}],35:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VideoPanelGrid = exports.VideoPanelGridProps = void 0;
var VideoPanel_1 = require("./VideoPanel");
var VideoPanelGridProps = /** @class */ (function () {
    function VideoPanelGridProps() {
    }
    return VideoPanelGridProps;
}());
exports.VideoPanelGridProps = VideoPanelGridProps;
var VideoPanelGrid = /** @class */ (function () {
    function VideoPanelGrid(props) {
        this.root = null;
        this.videoPanelMap = new Map();
        this.panelClass = "videocontainer";
        this.fullscreenClass = "video-fullscreen";
        this.popupMenuClass = "popup-menu";
        this.props = props;
        this.root = document.getElementById("video-grid");
        this.attachHandlers();
    }
    VideoPanelGrid.prototype.attachHandlers = function () {
        var _this = this;
        document.addEventListener('click', function (e) {
            var inside = $(e.target).closest("." + _this.popupMenuClass).length > 0;
            if (!inside) {
                $("." + _this.popupMenuClass).removeClass("visible");
            }
        });
        $(document).ready(function () {
            _this.redrawGrid();
        });
        $(window).resize(function () {
            _this.redrawGrid();
        });
    };
    VideoPanelGrid.prototype.getNewVideoPanel = function () {
        var props = new VideoPanel_1.VideoPanelProps();
        props.refreshGrid = this.redrawGrid.bind(this);
        props.grantModeratorRole = this.props.grantModeratorRole;
        props.kickParticipantOut = this.props.kickParticipantOut;
        props.sendRemoteControlReply = this.props.sendRemoteControlReply;
        props.muteUserVideo = this.props.muteUserVideo;
        props.muteUserAudio = this.props.muteUserAudio;
        props.muteMyVideo = this.props.muteMyVideo;
        props.muteMyAudio = this.props.muteMyAudio;
        props.openPrivateChat = this.props.openPrivateChat;
        props.panelClass = this.panelClass;
        props.fullscreenClass = this.fullscreenClass;
        props.popupMenuClass = this.popupMenuClass;
        var videoPanel = new VideoPanel_1.VideoPanel(props);
        $(this.root).append(videoPanel.root);
        videoPanel.attachHandlers();
        //add to map
        this.videoPanelMap.set(videoPanel.Id, videoPanel);
        //refresh layout
        this.redrawGrid();
        return videoPanel;
    };
    VideoPanelGrid.prototype.freeVideoPanel = function (Id) {
        var videoPanel = this.videoPanelMap.get(Id);
        if (videoPanel) {
            $(videoPanel.root).remove();
            this.videoPanelMap.delete(Id);
            this.redrawGrid();
        }
    };
    VideoPanelGrid.prototype.redrawGrid = function () {
        //margin
        var gutter = 40;
        var width = $("#content").width() - gutter;
        var height = $("#content").height() - gutter;
        //number of video panels
        var panelCount = $("." + this.panelClass).length;
        //chatting dialog
        var chattingWidth = 315;
        if ($(this.root).hasClass("shift-right")) {
            width -= chattingWidth;
        }
        //width, height of each video panel
        var w, h;
        //if fullscreen mode, hide other video panels
        if ($("." + this.panelClass).hasClass(this.fullscreenClass)) {
            $("." + this.panelClass).css("display", "none");
            $("." + this.fullscreenClass).css("display", "inline-block").css("height", height + gutter - 6).css("width", width + gutter);
            return;
        }
        //show all video panels
        $("." + this.panelClass).css("display", "inline-block");
        var columnCount = 1;
        var rowCount = 1;
        var SM = 576;
        var MD = 768;
        var LG = 992;
        var XL = 1200;
        var XXL = 1400;
        if (width < SM) {
            columnCount = 1;
        }
        else if (width < LG) {
            if (panelCount <= 1)
                columnCount = 1;
            else
                columnCount = 2;
        }
        else {
            if (panelCount == 1) {
                if (width < XXL)
                    columnCount = 1;
                else
                    columnCount = 2;
            }
            else if (panelCount <= 4)
                columnCount = 2;
            else if (panelCount <= 9)
                columnCount = 3;
            else if (panelCount <= 16)
                columnCount = 4;
            else if (panelCount <= 20)
                columnCount = 5;
            else
                columnCount = 6;
        }
        rowCount = Math.floor((panelCount - 1) / columnCount) + 1;
        if (width < 576) {
            w = width;
            h = w * 9 / 16;
        }
        else {
            // 
            if (width * rowCount * 9 > height * columnCount * 16) {
                h = height / rowCount;
                w = h * 16 / 9;
            }
            //
            else {
                w = width / columnCount;
                h = w * 9 / 16;
            }
        }
        $("." + this.panelClass)
            .css("width", w)
            .css("height", h)
            .find(".avatar-container")
            .css("width", h / 2)
            .css("height", h / 2);
    };
    VideoPanelGrid.prototype.hightlightPanel = function (targetId) {
        this.videoPanelMap.forEach(function (panel, Id) {
            panel.setHighlight(targetId === Id);
        });
    };
    return VideoPanelGrid;
}());
exports.VideoPanelGrid = VideoPanelGrid;
//# sourceMappingURL=VideoPanelGrid.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\VideoPanelGrid.js","/components")
},{"./VideoPanel":34,"buffer":25,"e/U+97":27}],36:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VectorIcon = void 0;
var VectorIcon = /** @class */ (function () {
    function VectorIcon() {
    }
    VectorIcon.AUDIO_MUTE_ICON = "M7.333 8.65V11a3.668 3.668 0 002.757 3.553.928.928 0 00-.007.114v1.757A5.501 5.501 0 015.5 11a.917.917 0 10-1.833 0c0 3.74 2.799 6.826 6.416 7.277v.973a.917.917 0 001.834 0v-.973a7.297 7.297 0 003.568-1.475l3.091 3.092a.932.932 0 101.318-1.318l-3.091-3.091.01-.013-1.311-1.311-.01.013-1.325-1.325.008-.014-1.395-1.395a1.24 1.24 0 01-.004.018l-3.61-3.609v-.023L7.334 5.993v.023l-3.909-3.91a.932.932 0 10-1.318 1.318L7.333 8.65zm1.834 1.834V11a1.833 1.833 0 002.291 1.776l-2.291-2.292zm3.682 3.683c-.29.17-.606.3-.94.386a.928.928 0 01.008.114v1.757a5.47 5.47 0 002.257-.932l-1.325-1.325zm1.818-3.476l-1.834-1.834V5.5a1.833 1.833 0 00-3.644-.287l-1.43-1.43A3.666 3.666 0 0114.667 5.5v5.19zm1.665 1.665l1.447 1.447c.357-.864.554-1.81.554-2.803a.917.917 0 10-1.833 0c0 .468-.058.922-.168 1.356z";
    VectorIcon.AUDIO_UNMUTE_ICON = "M16 6a4 4 0 00-8 0v6a4.002 4.002 0 003.008 3.876c-.005.04-.008.082-.008.124v1.917A6.002 6.002 0 016 12a1 1 0 10-2 0 8.001 8.001 0 007 7.938V21a1 1 0 102 0v-1.062A8.001 8.001 0 0020 12a1 1 0 10-2 0 6.002 6.002 0 01-5 5.917V16c0-.042-.003-.083-.008-.124A4.002 4.002 0 0016 12V6zm-4-2a2 2 0 00-2 2v6a2 2 0 104 0V6a2 2 0 00-2-2z";
    VectorIcon.VIDEO_MUTE_ICON = "M 6.84 5.5 h -0.022 L 3.424 2.106 a 0.932 0.932 0 1 0 -1.318 1.318 L 4.182 5.5 h -0.515 c -1.013 0 -1.834 0.82 -1.834 1.833 v 7.334 c 0 1.012 0.821 1.833 1.834 1.833 H 13.75 c 0.404 0 0.777 -0.13 1.08 -0.352 l 3.746 3.746 a 0.932 0.932 0 1 0 1.318 -1.318 l -4.31 -4.31 v -0.024 L 13.75 12.41 v 0.023 l -5.1 -5.099 h 0.024 L 6.841 5.5 Z m 6.91 4.274 V 7.333 h -2.44 L 9.475 5.5 h 4.274 c 1.012 0 1.833 0.82 1.833 1.833 v 0.786 l 3.212 -1.835 a 0.917 0.917 0 0 1 1.372 0.796 v 7.84 c 0 0.344 -0.19 0.644 -0.47 0.8 l -3.736 -3.735 l 2.372 1.356 V 8.659 l -2.75 1.571 v 1.377 L 13.75 9.774 Z M 3.667 7.334 h 2.349 l 7.333 7.333 H 3.667 V 7.333 Z";
    VectorIcon.VIDEO_UNMUTE_ICON = "M13.75 5.5H3.667c-1.013 0-1.834.82-1.834 1.833v7.334c0 1.012.821 1.833 1.834 1.833H13.75c1.012 0 1.833-.82 1.833-1.833v-.786l3.212 1.835a.916.916 0 001.372-.796V7.08a.917.917 0 00-1.372-.796l-3.212 1.835v-.786c0-1.012-.82-1.833-1.833-1.833zm0 3.667v5.5H3.667V7.333H13.75v1.834zm4.583 4.174l-2.75-1.572v-1.538l2.75-1.572v4.682z";
    VectorIcon.GRANT_MODERATOR_ICON = "M14 4a2 2 0 01-1.298 1.873l1.527 4.07.716 1.912c.062.074.126.074.165.035l1.444-1.444 2.032-2.032a2 2 0 111.248.579L19 19a2 2 0 01-2 2H7a2 2 0 01-2-2L4.166 8.993a2 2 0 111.248-.579l2.033 2.033L8.89 11.89c.087.042.145.016.165-.035l.716-1.912 1.527-4.07A2 2 0 1114 4zM6.84 17l-.393-4.725 1.029 1.03a2.1 2.1 0 003.451-.748L12 9.696l1.073 2.86a2.1 2.1 0 003.451.748l1.03-1.03L17.16 17H6.84z";
    VectorIcon.AUDIO_MUTE_SMALL_ICON = "M5.688 4l22.313 22.313-1.688 1.688-5.563-5.563c-1 .625-2.25 1-3.438 1.188v4.375h-2.625v-4.375c-4.375-.625-8-4.375-8-8.938h2.25c0 4 3.375 6.75 7.063 6.75 1.063 0 2.125-.25 3.063-.688l-2.188-2.188c-.25.063-.563.125-.875.125-2.188 0-4-1.813-4-4v-1l-8-8zM20 14.875l-8-7.938v-.25c0-2.188 1.813-4 4-4s4 1.813 4 4v8.188zm5.313-.187a8.824 8.824 0 01-1.188 4.375L22.5 17.375c.375-.813.563-1.688.563-2.688h2.25z";
    VectorIcon.VIDEO_MUTE_SMALL_ICON = "M4.375 2.688L28 26.313l-1.688 1.688-4.25-4.25c-.188.125-.5.25-.75.25h-16c-.75 0-1.313-.563-1.313-1.313V9.313c0-.75.563-1.313 1.313-1.313h1L2.687 4.375zm23.625 6v14.25L13.062 8h8.25c.75 0 1.375.563 1.375 1.313v4.688z";
    VectorIcon.MODERATOR_SMALL_ICON = "M16 20.563l5 3-1.313-5.688L24.125 14l-5.875-.5L16 8.125 13.75 13.5l-5.875.5 4.438 3.875L11 23.563zm13.313-8.25l-7.25 6.313 2.188 9.375-8.25-5-8.25 5 2.188-9.375-7.25-6.313 9.563-.813 3.75-8.813 3.75 8.813z";
    VectorIcon.SETTING_ICON = "M9.005 2.17l-.576 1.727-.634.262-1.628-.813a1.833 1.833 0 00-2.116.343l-.362.362a1.833 1.833 0 00-.343 2.116l.816 1.624-.265.638-1.727.576c-.748.25-1.253.95-1.253 1.739v.512c0 .79.505 1.49 1.253 1.74l1.727.575.262.634-.813 1.628a1.833 1.833 0 00.343 2.116l.362.362c.558.558 1.41.696 2.116.343l1.624-.816.638.265.576 1.727c.25.748.95 1.253 1.739 1.253h.512c.79 0 1.49-.505 1.74-1.253l.575-1.726.634-.263 1.628.813a1.833 1.833 0 002.116-.343l.362-.362c.558-.558.696-1.41.343-2.116l-.816-1.624.265-.638 1.727-.576a1.833 1.833 0 001.253-1.739v-.512c0-.79-.505-1.49-1.253-1.74l-1.726-.572-.264-.637.814-1.628a1.833 1.833 0 00-.343-2.116l-.362-.362a1.833 1.833 0 00-2.116-.343l-1.624.816-.638-.265-.576-1.727a1.833 1.833 0 00-1.74-1.253h-.511c-.79 0-1.49.505-1.74 1.253zM7.723 6.173l2.181-.903.84-2.52h.512l.84 2.52 2.185.908 2.372-1.193.362.362-1.188 2.376.903 2.185 2.52.836v.512l-2.52.84-.908 2.185 1.193 2.372-.362.362-2.376-1.188-2.181.903-.84 2.52h-.512l-.84-2.52-2.185-.908-2.372 1.193-.362-.362 1.188-2.376-.903-2.181-2.52-.84v-.512l2.52-.84.908-2.185-1.193-2.372.362-.362 2.376 1.188zM11 15.583a4.583 4.583 0 110-9.166 4.583 4.583 0 010 9.166zM13.75 11a2.75 2.75 0 11-5.5 0 2.75 2.75 0 015.5 0z";
    VectorIcon.USER_GROUP_ICON = "M5.33331 2C6.28101 2 7.09675 2.56499 7.46207 3.37651C7.00766 3.45023 6.58406 3.61583 6.21095 3.85361C6.04111 3.54356 5.71176 3.33333 5.33331 3.33333C4.78103 3.33333 4.33331 3.78105 4.33331 4.33333C4.33331 4.75895 4.59921 5.12246 4.97395 5.26682C4.77672 5.69245 4.66665 6.16671 4.66665 6.66667L4.66678 6.6967C3.12249 6.85332 2.66665 7.65415 2.66665 9.83333C2.66665 9.89666 2.66835 9.95222 2.67088 10H3.13441C2.977 10.3982 2.86114 10.8423 2.7841 11.3333H2.33331C1.66665 11.3333 1.33331 10.8333 1.33331 9.83333C1.33331 7.60559 1.88097 6.20498 3.39417 5.63152C3.14521 5.26038 2.99998 4.81382 2.99998 4.33333C2.99998 3.04467 4.04465 2 5.33331 2ZM9.78901 3.85361C9.4159 3.61583 8.9923 3.45023 8.53788 3.37651C8.90321 2.56499 9.71895 2 10.6666 2C11.9553 2 13 3.04467 13 4.33333C13 4.81382 12.8547 5.26038 12.6058 5.63152C14.119 6.20498 14.6666 7.60559 14.6666 9.83333C14.6666 10.8333 14.3333 11.3333 13.6666 11.3333H13.2159C13.1388 10.8423 13.023 10.3982 12.8656 10H13.3291C13.3316 9.95222 13.3333 9.89666 13.3333 9.83333C13.3333 7.65415 12.8775 6.85332 11.3332 6.6967L11.3333 6.66667C11.3333 6.1667 11.2232 5.69245 11.026 5.26682C11.4008 5.12246 11.6666 4.75895 11.6666 4.33333C11.6666 3.78105 11.2189 3.33333 10.6666 3.33333C10.2882 3.33333 9.95885 3.54356 9.78901 3.85361ZM4.49998 14.6667C3.7222 14.6667 3.33331 14.1111 3.33331 13C3.33331 10.4598 4.0062 8.8875 5.87888 8.28308C5.5366 7.83462 5.33331 7.27438 5.33331 6.66667C5.33331 5.19391 6.52722 4 7.99998 4C9.47274 4 10.6666 5.19391 10.6666 6.66667C10.6666 7.27438 10.4634 7.83462 10.1211 8.28308C11.9938 8.8875 12.6666 10.4598 12.6666 13C12.6666 14.1111 12.2778 14.6667 11.5 14.6667H4.49998ZM9.33331 6.66667C9.33331 7.40305 8.73636 8 7.99998 8C7.2636 8 6.66665 7.40305 6.66665 6.66667C6.66665 5.93029 7.2636 5.33333 7.99998 5.33333C8.73636 5.33333 9.33331 5.93029 9.33331 6.66667ZM11.3333 13C11.3333 13.1426 11.3252 13.2536 11.3152 13.3333H4.68477C4.67476 13.2536 4.66665 13.1426 4.66665 13C4.66665 10.1957 5.42021 9.33333 7.99998 9.33333C10.5797 9.33333 11.3333 10.1957 11.3333 13Z";
    VectorIcon.SEND_FILE = "M13.5,12.5a1,1,0,0,0-1-1h-5a1,1,0,0,0,0,2h5A1,1,0,0,0,13.5,12.5Zm5,5a2,2,0,0,0-1.18.39l-1.75-.8,1.91-.88a2,2,0,0,0,1,.29,2,2,0,1,0-2-2l-1.89.87A2,2,0,1,0,13.5,19a1.88,1.88,0,0,0,.92-.24l2.1,1a2,2,0,1,0,2-2.23Zm-8,2h-5a1,1,0,0,1-1-1V4.5a1,1,0,0,1,1-1h5v3a3,3,0,0,0,3,3h3a1,1,0,0,0,2,0v-1s0,0,0-.06a1.31,1.31,0,0,0-.06-.27l0-.09a1.07,1.07,0,0,0-.19-.28h0l-6-6h0a1.07,1.07,0,0,0-.28-.19.29.29,0,0,0-.1,0,1.1,1.1,0,0,0-.26-.06H5.5a3,3,0,0,0-3,3v14a3,3,0,0,0,3,3h5a1,1,0,0,0,0-2Zm2-14.59L15.09,7.5H13.5a1,1,0,0,1-1-1ZM7.5,15.5a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm0-6h1a1,1,0,0,0,0-2h-1a1,1,0,0,0,0,2Z";
    return VectorIcon;
}());
exports.VectorIcon = VectorIcon;
//# sourceMappingURL=vector_icon.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/components\\vector_icon.js","/components")
},{"buffer":25,"e/U+97":27}],37:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ChannelType = void 0;
var ChannelType;
(function (ChannelType) {
    ChannelType["Both"] = "Both";
    ChannelType["AudioOnly"] = "AudioOnly";
    ChannelType["VideoOnly"] = "VideoOnly";
})(ChannelType = exports.ChannelType || (exports.ChannelType = {}));
//# sourceMappingURL=ChannelType.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/enum\\ChannelType.js","/enum")
},{"buffer":25,"e/U+97":27}],38:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MediaType = void 0;
var MediaType;
(function (MediaType) {
    MediaType["VIDEO"] = "video";
    MediaType["AUDIO"] = "audio";
    MediaType["PRESENTER"] = "presenter";
})(MediaType = exports.MediaType || (exports.MediaType = {}));
//# sourceMappingURL=MediaType.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/enum\\MediaType.js","/enum")
},{"buffer":25,"e/U+97":27}],39:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationDuration = exports.NotificationType = void 0;
var NotificationType;
(function (NotificationType) {
    NotificationType["User"] = "user";
    NotificationType["GrantHost"] = "host";
    NotificationType["Video"] = "video";
    NotificationType["VideoMute"] = "video-mute";
    NotificationType["Audio"] = "audio";
    NotificationType["AudioMute"] = "audio-mute";
    NotificationType["Recording"] = "recording";
    NotificationType["Screensharing"] = "screensharing";
    NotificationType["HandRaise"] = "handraise";
    NotificationType["Chat"] = "chat";
    NotificationType["FileTransfer"] = "file-tranfer";
    NotificationType["FileReceive"] = "file-receive";
    NotificationType["Info"] = "info";
    NotificationType["Warning"] = "warning";
})(NotificationType = exports.NotificationType || (exports.NotificationType = {}));
;
var NotificationDuration;
(function (NotificationDuration) {
    NotificationDuration["Permanent"] = "permanent";
    NotificationDuration["HideAuto"] = "hide-auto";
})(NotificationDuration = exports.NotificationDuration || (exports.NotificationDuration = {}));
//# sourceMappingURL=NotificationType.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/enum\\NotificationType.js","/enum")
},{"buffer":25,"e/U+97":27}],40:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserProperty = void 0;
var UserProperty;
(function (UserProperty) {
    UserProperty["videoPanel"] = "videoPanel";
    UserProperty["IsHost"] = "IsHost";
    UserProperty["useCamera"] = "useCamera";
    UserProperty["useMic"] = "useMic";
})(UserProperty = exports.UserProperty || (exports.UserProperty = {}));
//# sourceMappingURL=UserProperty.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/enum\\UserProperty.js","/enum")
},{"buffer":25,"e/U+97":27}],41:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArray = (this && this.__spreadArray) || function (to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BizGazeMeeting = void 0;
var signalR = require("@microsoft/signalr");
var bg_1 = require("./protocol/bg");
var meeting_ui_1 = require("./meeting_ui");
var BGUser_1 = require("./model/BGUser");
var BGMeeting_1 = require("./model/BGMeeting");
var MediaType_1 = require("./enum/MediaType");
var JitsiCommandParam_1 = require("./jitsi/JitsiCommandParam");
var UserProperty_1 = require("./enum/UserProperty");
var TimeUtil_1 = require("./util/TimeUtil");
var ActiveDevices_1 = require("./model/ActiveDevices");
var InputDevicePolicy_1 = require("./model/InputDevicePolicy");
var ChannelType_1 = require("./enum/ChannelType");
var jitsi_1 = require("./protocol/jitsi");
var NotificationType_1 = require("./enum/NotificationType");
var JitsiCommandQueue_1 = require("./jitsi/JitsiCommandQueue");
var KEYS = {
    BACKSPACE: 'backspace',
    DELETE: 'delete',
    RETURN: 'enter',
    TAB: 'tab',
    ESCAPE: 'escape',
    UP: 'up',
    DOWN: 'down',
    RIGHT: 'right',
    LEFT: 'left',
    HOME: 'home',
    END: 'end',
    PAGEUP: 'pageup',
    PAGEDOWN: 'pagedown',
    F1: 'f1',
    F2: 'f2',
    F3: 'f3',
    F4: 'f4',
    F5: 'f5',
    F6: 'f6',
    F7: 'f7',
    F8: 'f8',
    F9: 'f9',
    F10: 'f10',
    F11: 'f11',
    F12: 'f12',
    META: 'command',
    CMD_L: 'command',
    CMD_R: 'command',
    ALT: 'alt',
    CONTROL: 'control',
    SHIFT: 'shift',
    CAPS_LOCK: 'caps_lock',
    SPACE: 'space',
    PRINTSCREEN: 'printscreen',
    INSERT: 'insert',
    NUMPAD_0: 'numpad_0',
    NUMPAD_1: 'numpad_1',
    NUMPAD_2: 'numpad_2',
    NUMPAD_3: 'numpad_3',
    NUMPAD_4: 'numpad_4',
    NUMPAD_5: 'numpad_5',
    NUMPAD_6: 'numpad_6',
    NUMPAD_7: 'numpad_7',
    NUMPAD_8: 'numpad_8',
    NUMPAD_9: 'numpad_9',
    COMMA: ',',
    PERIOD: '.',
    SEMICOLON: ';',
    QUOTE: '\'',
    BRACKET_LEFT: '[',
    BRACKET_RIGHT: ']',
    BACKQUOTE: '`',
    BACKSLASH: '\\',
    MINUS: '-',
    EQUAL: '=',
    SLASH: '/'
};
var keyCodeToKey = [];
keyCodeToKey[8] = KEYS.BACKSPACE;
keyCodeToKey[9] = KEYS.TAB;
keyCodeToKey[13] = KEYS.RETURN;
keyCodeToKey[16] = KEYS.SHIFT;
keyCodeToKey[17] = KEYS.CONTROL;
keyCodeToKey[18] = KEYS.ALT;
keyCodeToKey[20] = KEYS.CAPS_LOCK;
keyCodeToKey[27] = KEYS.ESCAPE;
keyCodeToKey[32] = KEYS.SPACE;
keyCodeToKey[33] = KEYS.PAGEUP;
keyCodeToKey[34] = KEYS.PAGEDOWN;
keyCodeToKey[35] = KEYS.END;
keyCodeToKey[36] = KEYS.HOME;
keyCodeToKey[37] = KEYS.LEFT;
keyCodeToKey[38] = KEYS.UP;
keyCodeToKey[39] = KEYS.RIGHT;
keyCodeToKey[40] = KEYS.DOWN;
keyCodeToKey[42] = KEYS.PRINTSCREEN;
keyCodeToKey[44] = KEYS.PRINTSCREEN;
keyCodeToKey[45] = KEYS.INSERT;
keyCodeToKey[46] = KEYS.DELETE;
keyCodeToKey[59] = KEYS.SEMICOLON;
keyCodeToKey[61] = KEYS.EQUAL;
keyCodeToKey[91] = KEYS.CMD_L;
keyCodeToKey[92] = KEYS.CMD_R;
keyCodeToKey[93] = KEYS.CMD_R;
keyCodeToKey[96] = KEYS.NUMPAD_0;
keyCodeToKey[97] = KEYS.NUMPAD_1;
keyCodeToKey[98] = KEYS.NUMPAD_2;
keyCodeToKey[99] = KEYS.NUMPAD_3;
keyCodeToKey[100] = KEYS.NUMPAD_4;
keyCodeToKey[101] = KEYS.NUMPAD_5;
keyCodeToKey[102] = KEYS.NUMPAD_6;
keyCodeToKey[103] = KEYS.NUMPAD_7;
keyCodeToKey[104] = KEYS.NUMPAD_8;
keyCodeToKey[105] = KEYS.NUMPAD_9;
keyCodeToKey[112] = KEYS.F1;
keyCodeToKey[113] = KEYS.F2;
keyCodeToKey[114] = KEYS.F3;
keyCodeToKey[115] = KEYS.F4;
keyCodeToKey[116] = KEYS.F5;
keyCodeToKey[117] = KEYS.F6;
keyCodeToKey[118] = KEYS.F7;
keyCodeToKey[119] = KEYS.F8;
keyCodeToKey[120] = KEYS.F9;
keyCodeToKey[121] = KEYS.F10;
keyCodeToKey[122] = KEYS.F11;
keyCodeToKey[123] = KEYS.F12;
keyCodeToKey[124] = KEYS.PRINTSCREEN;
keyCodeToKey[173] = KEYS.MINUS;
keyCodeToKey[186] = KEYS.SEMICOLON;
keyCodeToKey[187] = KEYS.EQUAL;
keyCodeToKey[188] = KEYS.COMMA;
keyCodeToKey[189] = KEYS.MINUS;
keyCodeToKey[190] = KEYS.PERIOD;
keyCodeToKey[191] = KEYS.SLASH;
keyCodeToKey[192] = KEYS.BACKQUOTE;
keyCodeToKey[219] = KEYS.BRACKET_LEFT;
keyCodeToKey[220] = KEYS.BACKSLASH;
keyCodeToKey[221] = KEYS.BRACKET_RIGHT;
keyCodeToKey[222] = KEYS.QUOTE;
keyCodeToKey[224] = KEYS.META;
keyCodeToKey[229] = KEYS.SEMICOLON;
for (var i = 0; i < 10; i++) {
    keyCodeToKey[i + 48] = "" + i;
}
for (var i = 0; i < 26; i++) {
    var keyCode = i + 65;
    keyCodeToKey[keyCode] = String.fromCharCode(keyCode).toLowerCase();
}
function keyboardEventToKey(akey) {
    return keyCodeToKey[akey];
}
/***********************************************************************************

                       Lifecycle of Bizgaze Meeting

    connectToBG -> joinBGConference -> connectToJitsi -> joinJitsiConference -> ...
    ... -> leaveFromJitsi -> leaveFromBG

************************************************************************************/
var MeetingConfig = /** @class */ (function () {
    function MeetingConfig() {
        this.resetMuteOnDeviceChange = true;
        this.hideToolbarOnMouseOut = true;
    }
    return MeetingConfig;
}());
var BizGazeMeeting = /** @class */ (function () {
    function BizGazeMeeting() {
        this.connection = new signalR.HubConnectionBuilder().withUrl("/BizGazeMeetingServer").build();
        this.joinedBGConference = false;
        this.isToggleMuteMyAudio = false; //isControlAllowed
        this.isToggleMuteMyVideo = false; //isControlAllowed
        this.isMultipleSharing = false;
        this.isAllowCtlMic = true; //is allowed control mic in participant's list
        this.isAllowCtlVideo = true; //is allowed control video in participant's list
        this.ui = new meeting_ui_1.MeetingUI(this);
        this.roomInfo = new BGMeeting_1.BGMeetingInfo();
        this.m_BGUserList = new Map();
        this.localVideoPanel = null;
        this.myInfo = new BGUser_1.UserInfo();
        this.JitsiMeetJS = window.JitsiMeetJS;
        //JitsiServerDomain = "idlests.com";
        //JitsiServerDomain = "unimail.in";
        this.JitsiServerDomain = "meetserver.com";
        this.localTracks = [];
        this.screenSharing = false;
        this.recording = false;
        this.downloadRecordFile = false;
        //default devices
        this.activeCameraId = window._camId;
        this.activeMicId = window._micId;
        this.activeSpeakerId = window._speakerId;
        this.config = new MeetingConfig();
        this.commandQueue = new JitsiCommandQueue_1.JitsiCommandQueue();
        this.privateCommandQueue = new JitsiCommandQueue_1.JitsiPrivateCommandQueue();
        this.recordingData = [];
    }
    /**
     * **************************************************************************
     *              START ~ END
     *
     * **************************************************************************
     */
    BizGazeMeeting.prototype.start = function () {
        var _this = this;
        if (!window._roomId) {
            this.leaveBGConference();
            return;
        }
        //jitsi init
        var initOptions = {
            disableAudioLevels: true
        };
        this.JitsiMeetJS.setLogLevel(this.JitsiMeetJS.logLevels.ERROR);
        this.JitsiMeetJS.init(initOptions);
        //device log
        this.JitsiMeetJS.mediaDevices.enumerateDevices(function (devices) {
            devices.forEach(function (d) {
                if (_this.activeCameraId.length > 0 && d.deviceId === _this.activeCameraId) {
                    _this.Log("Camera: " + d.label);
                }
                if (_this.activeMicId.length > 0 && d.deviceId === _this.activeMicId && d.kind === 'audioinput') {
                    _this.Log("Microphone: " + d.label);
                }
            });
        });
        //connect to bg server
        this.connectToBGServer(function () {
            _this.Log("Connected to BizGaze SignalR Server");
            _this.joinBGConference(); // => onBGConferenceJoined
        });
    };
    BizGazeMeeting.prototype.stop = function () {
        //todo 
        //if it was recording, save it before stop
        var _this = this;
        if (this.jitsiRoomJoined()) {
            this.stopAllMediaStreams();
            this.jitsiRoom.leave().then(function () {
                _this.leaveBGConference();
            }).catch(function (error) {
                _this.leaveBGConference();
            });
        }
        else {
            this.leaveBGConference();
        }
    };
    BizGazeMeeting.prototype.forceStop = function () {
        this.stop();
    };
    /**
     * **************************************************************************
     *              BizGaze SignalR Server interaction
     *
     *          Connect
     *          Join/Leave
     *          Control Message
     * **************************************************************************
     */
    BizGazeMeeting.prototype.connectToBGServer = function (callback) {
        var _this = this;
        // Connect to the signaling server
        this.connection.start().then(function () {
            _this.registerBGServerCallbacks();
            callback();
        }).catch(function (err) {
            return console.error(err.toString());
        });
    };
    BizGazeMeeting.prototype.joinBGConference = function () {
        this.connection.invoke("Join", "" + window._roomId, "" + window._userId, "" + window._anonymousUserName).catch(function (err) {
            return console.error("Join Meeting Failed.", err.toString());
        });
    };
    //this is the entry point where we can decide webinar/group chatting
    //                        where we can decide i am host or not
    BizGazeMeeting.prototype.onBGConferenceJoined = function (roomInfo, userInfo) {
        var _this = this;
        this.joinedBGConference = true;
        this.localStartTimestamp = Date.now();
        this.roomInfo = roomInfo;
        this.Log("Meeting Type: " + (roomInfo.IsWebinar ? "Webinar" : "Group Chatting"));
        this.myInfo.Id = userInfo.Id;
        this.myInfo.Name = userInfo.Name;
        this.myInfo.IsHost = userInfo.IsHost;
        var deviceUsePolicy = this.getInitMediaPolicy();
        this.myInfo.mediaPolicy.useCamera = deviceUsePolicy.useCamera;
        this.myInfo.mediaPolicy.useMic = deviceUsePolicy.useMic;
        this.ui.updateByRole(this.myInfo.IsHost);
        this.ui.toolbar.updateByRole(this.myInfo.IsHost);
        this.ui.updateJoiningInfo();
        this.initMediaDevices()
            .then(function (_) {
            //connect to jitsi server and enter room
            _this.connectToJitsiServer();
        });
    };
    BizGazeMeeting.prototype.leaveBGConference = function () {
        this.Log("leaving Meeting " + this.joinedBGConference);
        /*if (this.joinedBGConference) {
            this.connection.invoke("LeaveRoom").catch((err: any) => {
                return console.error("Leave Meeting Failed.", err.toString());
            });
        } else*/ {
            this.stopAllMediaStreams();
            $("form#return").submit();
        }
    };
    BizGazeMeeting.prototype.onBGConferenceLeft = function () {
        this.joinedBGConference = false;
        this.stopAllMediaStreams();
        this.m_BGUserList.clear();
        $("form#return").submit();
    };
    BizGazeMeeting.prototype.onBGUserJoined = function (userInfo) {
        this.m_BGUserList.set(userInfo.Id, userInfo);
    };
    BizGazeMeeting.prototype.onBGUserLeft = function (userId) {
        //self leave
        if (userId == this.myInfo.Id) {
            this.onBGConferenceLeft();
        }
        // participant left
        else {
            if (this.m_BGUserList.has(userId)) {
                var bizUser = this.m_BGUserList.get(userId);
                if (bizUser.Jitsi_Id && this.jitsiRoomJoined()) {
                    var jitsiUser = this.jitsiRoom.getParticipantById(bizUser.Jitsi_Id);
                    if (jitsiUser)
                        this.onJitsiUserLeft(bizUser.Jitsi_Id, jitsiUser);
                }
                this.Log(this.m_BGUserList.get(userId).Name + " has left");
                this.m_BGUserList.delete(userId);
            }
        }
    };
    BizGazeMeeting.prototype.registerBGServerCallbacks = function () {
        var _this = this;
        this.connection.on(bg_1.BGtoUser.ROOM_JOINED, function (strRoomInfo, strMyInfo) {
            var roomInfo = JSON.parse(strRoomInfo);
            var myInfo = JSON.parse(strMyInfo);
            _this.onBGConferenceJoined(roomInfo, myInfo);
        });
        this.connection.on(bg_1.BGtoUser.ROOM_USER_JOINED, function (strUserInfo) {
            var info = JSON.parse(strUserInfo);
            _this.onBGUserJoined(info);
        });
        this.connection.on(bg_1.BGtoUser.ERROR, function (message) {
            _this.forceStop();
        });
        this.connection.on(bg_1.BGtoUser.ROOM_LEFT, function (clientId) {
            _this.onBGUserLeft(clientId);
        });
        this.connection.on(bg_1.BGtoUser.SIGNALING, function (sourceId, strMsg) {
            /*console.log(' received signaling message:', strMsg);
            let msg = JSON.parse(strMsg);
            if (sourceId != this.myInfo.Id && this.connMap.has(sourceId)) {
                let peerConn: BizGazeConnection = this.connMap.get(sourceId);
                peerConn.onSignalingMessage(msg);
            }*/
        });
    };
    BizGazeMeeting.prototype.sendBGSignalingMessage = function (destId, msg) {
        this.connection.invoke(bg_1.BGtoUser.SIGNALING, this.myInfo.Id, destId, JSON.stringify(msg)).catch(function (err) {
            return console.error(err.toString());
        });
    };
    /**
     * **************************************************************************
     *              Local Camera/Microphone init
     *
     * **************************************************************************
     */
    BizGazeMeeting.prototype.initMediaDevices = function () {
        var _this = this;
        this.Log('Getting user media devices ...');
        //set speaker
        if (this.activeSpeakerId && this.JitsiMeetJS.mediaDevices.isDeviceChangeAvailable('output')) {
            this.JitsiMeetJS.mediaDevices.setAudioOutputDevice(this.activeSpeakerId);
        }
        ;
        //set input devices
        var cameraId = this.activeCameraId;
        var micId = this.activeMicId;
        return this.createLocalTracks(cameraId, micId)
            .then(function (tracks) {
            if (tracks.length <= 0) {
                throw new Error("no tracks");
            }
            tracks.forEach(function (track, index) {
                if (track.getType() === MediaType_1.MediaType.VIDEO) {
                    if (!_this.myInfo.mediaPolicy.useCamera)
                        track.mute();
                    else
                        track.unmute();
                }
                else if (track.getType() === MediaType_1.MediaType.AUDIO) {
                    if (!_this.myInfo.mediaPolicy.useMic)
                        track.mute();
                    else
                        track.unmute();
                }
            });
            _this.onLocalTrackAdded(tracks);
            return Promise.resolve();
        }).catch(function (error) {
            _this.ui.toolbar.update(_this.myInfo, _this.getLocalTracks());
            //if (!this.roomInfo.IsWebinar || this.myInfo.IsHost) //matvey
            if (!_this.roomInfo.IsControlAllowed || _this.myInfo.IsHost)
                _this._updateMyPanel();
            return Promise.resolve();
        });
    };
    BizGazeMeeting.prototype.createVideoTrack = function (cameraDeviceId) {
        var _this = this;
        return this.JitsiMeetJS.createLocalTracks({
            devices: ['video'],
            cameraDeviceId: cameraDeviceId,
            micDeviceId: null
        })
            .catch(function (error) {
            _this.Log(error);
            return Promise.resolve([]);
        });
    };
    BizGazeMeeting.prototype.createAudioTrack = function (micDeviceId) {
        var _this = this;
        return (this.JitsiMeetJS.createLocalTracks({
            devices: ['audio'],
            cameraDeviceId: null,
            micDeviceId: micDeviceId
        })
            .catch(function (error) {
            _this.Log(error);
            return Promise.resolve([]);
        }));
    };
    BizGazeMeeting.prototype.createLocalTracks = function (cameraDeviceId, micDeviceId) {
        var _this = this;
        if (cameraDeviceId != null && micDeviceId != null) {
            return this.JitsiMeetJS.createLocalTracks({
                devices: ['audio', 'video'],
                cameraDeviceId: cameraDeviceId,
                micDeviceId: micDeviceId
            }).catch(function () { return Promise.all([
                _this.createAudioTrack(micDeviceId).then(function (_a) {
                    var stream = _a[0];
                    return stream;
                }),
                _this.createVideoTrack(cameraDeviceId).then(function (_a) {
                    var stream = _a[0];
                    return stream;
                })
            ]); }).then(function (tracks) {
                return tracks.filter(function (t) { return typeof t !== 'undefined'; });
            });
        }
        else if (cameraDeviceId != null) {
            return this.createVideoTrack(cameraDeviceId);
        }
        else if (micDeviceId != null) {
            return this.createAudioTrack(micDeviceId);
        }
        return Promise.resolve([]);
    };
    BizGazeMeeting.prototype.onLocalTrackAdded = function (tracks) {
        return __awaiter(this, void 0, void 0, function () {
            var i, localVideoTrack;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (tracks.length <= 0)
                            return [2 /*return*/];
                        i = 0;
                        _a.label = 1;
                    case 1:
                        if (!(i < tracks.length)) return [3 /*break*/, 4];
                        tracks[i].addEventListener(this.JitsiMeetJS.events.track.TRACK_AUDIO_LEVEL_CHANGED, function (audioLevel) { return console.log("Audio Level local: " + audioLevel); });
                        tracks[i].addEventListener(this.JitsiMeetJS.events.track.TRACK_MUTE_CHANGED, function (track) { _this.updateUiOnLocalTrackChange(); });
                        tracks[i].addEventListener(this.JitsiMeetJS.events.track.LOCAL_TRACK_STOPPED, function (track) { _this.updateUiOnLocalTrackChange(); });
                        tracks[i].addEventListener(this.JitsiMeetJS.events.track.TRACK_AUDIO_OUTPUT_CHANGED, function (deviceId) {
                            return console.log("track audio output device was changed to " + deviceId);
                        });
                        if (this.jitsiRoomJoined())
                            this.Log("[ OUT ] my track - " + tracks[i].getType());
                        return [4 /*yield*/, this.replaceLocalTrack(tracks[i], tracks[i].getType())];
                    case 2:
                        _a.sent();
                        _a.label = 3;
                    case 3:
                        i++;
                        return [3 /*break*/, 1];
                    case 4:
                        //toolbar
                        this.ui.toolbar.update(this.myInfo, this.getLocalTracks());
                        //my video panel
                        this._updateMyPanel();
                        localVideoTrack = this.getLocalTrackByType(MediaType_1.MediaType.VIDEO);
                        if (localVideoTrack && this.localVideoPanel) {
                            localVideoTrack.attach(this.localVideoPanel.videoElem);
                            this.localVideoPanel.videoElem.play();
                            this.localVideoPanel.setShotnameVisible(false);
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.stopAllMediaStreams = function () {
        var _this = this;
        var localTracks = __spreadArray([], this.getLocalTracks());
        localTracks.forEach(function (track) {
            _this.removeLocalTrack(track).then(function (_) {
                track.dispose();
            });
        });
    };
    BizGazeMeeting.prototype.onDeviceChange = function (newDevices) {
        var _this = this;
        var videoDeviceChanged = this.activeCameraId !== newDevices.cameraId;
        var audioDeviceChanged = this.activeMicId !== newDevices.micId;
        //create new tracks with new devices
        this.createLocalTracks(videoDeviceChanged ? newDevices.cameraId : null, audioDeviceChanged ? newDevices.micId : null)
            .then(function (tracks) {
            _this.onLocalTrackAdded(tracks);
        });
        this.activeCameraId = newDevices.cameraId;
        this.activeMicId = newDevices.micId;
        this.activeSpeakerId = newDevices.speakerId;
    };
    BizGazeMeeting.prototype.getActiveDevices = function () {
        var activeDevices = new ActiveDevices_1.ActiveDevices();
        activeDevices.cameraId = this.activeCameraId;
        activeDevices.micId = this.activeMicId;
        activeDevices.speakerId = this.activeSpeakerId;
        return activeDevices;
    };
    BizGazeMeeting.prototype.getInitMediaPolicy = function () {
        var useCamera = true;
        var useMic = true;
        //if (this.roomInfo.IsWebinar) //matvey
        if (this.roomInfo.IsControlAllowed) {
            if (!this.myInfo.IsHost) {
                useCamera = false;
                useMic = false;
            }
        }
        if (this.roomInfo.channelType === ChannelType_1.ChannelType.AudioOnly)
            useCamera = false;
        if (this.roomInfo.channelType === ChannelType_1.ChannelType.VideoOnly)
            useMic = false;
        if (window._videoMute !== "true")
            useCamera = false;
        if (window._audioMute !== "true")
            useMic = false;
        var policy = new InputDevicePolicy_1.InputMediaPolicy();
        policy.useCamera = useCamera;
        policy.useMic = useMic;
        this.Log("useCamera " + useCamera);
        this.Log("useMic " + useMic);
        return policy;
    };
    /**
     * **************************************************************************
     *              Local Track Access
     *
     * **************************************************************************
     */
    BizGazeMeeting.prototype.jitsiRoomJoined = function () {
        return this.jitsiRoom && this.jitsiRoom.isJoined();
    };
    BizGazeMeeting.prototype.getLocalTracks = function () {
        if (this.jitsiRoomJoined())
            return this.jitsiRoom.getLocalTracks();
        else
            return this.localTracks;
    };
    BizGazeMeeting.prototype.getLocalTrackByType = function (type) {
        if (this.jitsiRoomJoined()) {
            var tracks = this.jitsiRoom.getLocalTracks(type);
            if (tracks.length > 0)
                return tracks[0];
            return null;
        }
        else {
            var track = this.localTracks.find(function (t) { return t.getType() === type; });
            return track;
        }
    };
    BizGazeMeeting.prototype.removeLocalTrack = function (track) {
        if (this.jitsiRoomJoined()) {
            return this.jitsiRoom.removeTrack(track);
        }
        else {
            var index = this.localTracks.indexOf(track);
            if (index >= 0)
                this.localTracks.splice(index, 1);
            return Promise.resolve();
        }
    };
    //type is neccessray when newTrack is null
    BizGazeMeeting.prototype.replaceLocalTrack = function (newTrack, type) {
        return __awaiter(this, void 0, void 0, function () {
            var oldTrack;
            var _this = this;
            return __generator(this, function (_a) {
                oldTrack = this.getLocalTrackByType(type);
                if (oldTrack === newTrack)
                    return [2 /*return*/, Promise.reject()];
                if (!oldTrack && !newTrack)
                    return [2 /*return*/, Promise.reject()];
                if (this.jitsiRoomJoined()) {
                    return [2 /*return*/, this.jitsiRoom.replaceTrack(oldTrack, newTrack).then(function (_) {
                            if (oldTrack)
                                oldTrack.dispose();
                            _this.updateUiOnLocalTrackChange();
                            return Promise.resolve();
                        })];
                }
                else {
                    return [2 /*return*/, this.removeLocalTrack(oldTrack).then(function (_) {
                            if (oldTrack)
                                oldTrack.dispose();
                            if (newTrack)
                                _this.localTracks.push(newTrack);
                            _this.updateUiOnLocalTrackChange();
                            return Promise.resolve();
                        })];
                }
                return [2 /*return*/];
            });
        });
    };
    BizGazeMeeting.prototype.updateUiOnLocalTrackChange = function () {
        if (this.localVideoPanel)
            this._updateMyPanel();
        this.ui.toolbar.update(this.myInfo, this.getLocalTracks());
    };
    /**
     * **************************************************************************
     *              Jitsi Server interaction
     *         Connect
     *         Enter/Leave Room
     *         Send/Receive Track
     *         UserInfo
     * **************************************************************************
     */
    BizGazeMeeting.prototype.connectToJitsiServer = function () {
        var _this = this;
        var serverdomain = this.JitsiServerDomain;
        var connConf = {
            hosts: {
                domain: serverdomain,
                muc: "conference." + serverdomain,
            },
            bosh: "//" + serverdomain + "/http-bind",
            // The name of client node advertised in XEP-0115 'c' stanza
            clientNode: "//" + serverdomain + "/jitsimeet"
        };
        this.jitsiConnection = new this.JitsiMeetJS.JitsiConnection(null, null, connConf);
        this.jitsiConnection.addEventListener(this.JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED, function () { _this.onJitsiConnectionSuccess(); });
        this.jitsiConnection.addEventListener(this.JitsiMeetJS.events.connection.CONNECTION_FAILED, function () { _this.onJitsiConnectionFailed(); });
        this.jitsiConnection.addEventListener(this.JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED, function () { _this.disconnectFromJitsiServer(); });
        this.jitsiConnection.connect();
    };
    BizGazeMeeting.prototype.onJitsiConnectionSuccess = function () {
        this.Log("Connected to Jitsi Server - " + this.JitsiServerDomain);
        this.joinJitsiConference();
    };
    BizGazeMeeting.prototype.onJitsiConnectionFailed = function () {
        this.Log("Failed to connect Jitsi Server - " + this.JitsiServerDomain);
        this.stop();
    };
    BizGazeMeeting.prototype.disconnectFromJitsiServer = function () {
        this.Log("Disconnected from Jitsi Server - " + this.JitsiServerDomain);
        this.stop();
    };
    BizGazeMeeting.prototype.joinJitsiConference = function () {
        var _this = this;
        var confOptions = {
            openBridgeChannel: true
        };
        this.jitsiRoom = this.jitsiConnection.initJitsiConference("" + this.roomInfo.Id, confOptions);
        //remote track
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.TRACK_ADDED, function (track) {
            _this.onRemoteTrackAdded(track);
        });
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.TRACK_REMOVED, function (track) {
            _this.onRemovedRemoteTrack(track);
        });
        //my join
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.CONFERENCE_JOINED, function () { _this.onJitsiConferenceJoined(); });
        //my left
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.CONFERENCE_LEFT, function () { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
            this.onJitsiConferenceLeft();
            return [2 /*return*/];
        }); }); });
        //remote join
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.USER_JOINED, function (id, user) {
            _this.onJitsiUserJoined(id, user);
            //remoteTracks[id] = [];
        });
        //remote left
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.USER_LEFT, function (id, user) {
            _this.onJitsiUserLeft(id, user);
        });
        //track mute
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.TRACK_MUTE_CHANGED, function (track) {
            if (track.isLocal()) {
                _this.onLocalTrackMuteChanged(track);
            }
            else {
                _this.onRemoteTrackMuteChanged(track);
            }
        });
        //audio level change
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.TRACK_AUDIO_LEVEL_CHANGED, function (userID, audioLevel) {
            _this.Log(userID + " - " + audioLevel);
        });
        //chat
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.MESSAGE_RECEIVED, function (id, message, timestamp) {
            _this.onReceiveChatMessage(id, message, timestamp);
        });
        //private message object
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.ENDPOINT_MESSAGE_RECEIVED, function (peer, message) {
            if (message && message.type === "biz_private") {
                _this.onPrivateCommand(message.senderId, message.subtype, message.message);
            }
        });
        //dominant speaker
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.DOMINANT_SPEAKER_CHANGED, function (id, previousSpeakers) {
            _this.onDominantSpeakerChanged(id);
        });
        //name change
        this.jitsiRoom.on(this.JitsiMeetJS.events.conference.DISPLAY_NAME_CHANGED, function (userID, displayName) {
            console.log(userID + " - " + displayName);
        });
        //command
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.KICK_OUT, function (param) {
            _this.onKickedOut(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.MUTE_All_AUDIO, function (param) {
            _this.onMuteAllAudio(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.MUTE_All_VIDEO, function (param) {
            _this.onMuteAllVideo(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.GRANT_HOST_ROLE, function (param) {
            _this.onChangedModerator(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.MUTE_AUDIO, function (param) {
            _this.onMutedAudio(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.ALLOW_MIC, function (param) {
            _this.onAllowMic(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.MUTE_VIDEO, function (param) {
            _this.onMutedVideo(param);
        });
        /*this.jitsiRoom.addCommandListener(JitsiCommand.ALLOW_CAMERA, (param: JitsiCommandParam) => {
            this.onAllowCameraCommand(param)
        });
        this.jitsiRoom.addCommandListener(JitsiCommand.ALLOW_MIC, (param: JitsiCommandParam) => {
            this.onAllowMicCommand(param)
        });*/
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.INIT_MEDIA_POLICY, function (param) {
            _this.onInitMediaPolicy(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.BIZ_ID, function (param) {
            _this.onBizId(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.ASK_RECORDING, function (param) {
            _this.onAskRecording(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.ASK_SCREENSHARE, function (param) {
            _this.onAskScreenShare(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.ASK_MULTISHARE, function (param) {
            _this.onAskMultiShare(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.ASK_HANDRAISE, function (param) {
            _this.onAskHandRaise(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.FILE_META, function (param) {
            _this.onFileMeta(param);
        });
        this.jitsiRoom.addCommandListener(jitsi_1.JitsiCommand.FILE_SLICE, function (param) {
            _this.onFileData(param);
        });
        //set name
        this.jitsiRoom.setDisplayName(this.myInfo.Name);
        for (var i = 0; i < this.localTracks.length; i++) {
            this.Log("[ OUT ] my track - " + this.localTracks[i].getType());
            this.jitsiRoom.addTrack(this.localTracks[i]).catch(function (error) {
                _this.Log(error);
            });
        }
        //joinJitsiConference
        this.jitsiRoom.join(); //callback -  onJitsiUserJoined
    };
    BizGazeMeeting.prototype.leaveJitsiConference = function () {
    };
    //my enter room
    BizGazeMeeting.prototype.onJitsiConferenceJoined = function () {
        var _this = this;
        this.myInfo.Jitsi_Id = this.jitsiRoom.myUserId();
        this.Log("Jitsi_Id : " + this.myInfo.Jitsi_Id);
        //set subject
        this.ui.meetingDescWidget.setSubject(this.roomInfo.conferenceName, this.roomInfo.hostName);
        var audioMute = true;
        var videoMute = true;
        this.getLocalTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO && !track.isMuted())
                videoMute = false;
            if (track.getType() === MediaType_1.MediaType.AUDIO && !track.isMuted())
                audioMute = false;
        });
        //add list
        //if (this.myInfo.IsHost) 
        {
            this.ui.addParticipant(this.jitsiRoom.myUserId(), this.myInfo.Name, true, false, false, videoMute, audioMute);
        }
        //set time
        setInterval(function () {
            var delta = Date.now() - _this.localStartTimestamp;
            var elapsed = _this.roomInfo.elapsed + delta;
            _this.ui.meetingDescWidget.updateTime(TimeUtil_1.TsToDateFormat(elapsed));
        }, 1000);
        //send media policy
        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.INIT_MEDIA_POLICY, this.myInfo.Jitsi_Id, this.myInfo.mediaPolicy);
        //send bizgaze id
        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.BIZ_ID, this.myInfo.Id);
    };
    //my leave room
    BizGazeMeeting.prototype.onJitsiConferenceLeft = function () {
        this.myInfo.Jitsi_Id = null;
        this.leaveBGConference();
    };
    //remote-user enter room
    BizGazeMeeting.prototype.onJitsiUserJoined = function (jitsiId, user) {
        var _this = this;
        this.Log("joined user: " + user.getDisplayName());
        this.ui.notification(user.getDisplayName(), "New Participant joined", NotificationType_1.NotificationType.User);
        //if track doesn't arrive for certain time
        //generate new panel for that user
        //if (!this.roomInfo.IsWebinar) { //matvey
        if (!this.roomInfo.IsControlAllowed) {
            setTimeout(function () {
                if (!user.getProperty(UserProperty_1.UserProperty.videoPanel)) {
                    var videoPanel = _this.ui.videoPanelGrid.getNewVideoPanel();
                    user.setProperty(UserProperty_1.UserProperty.videoPanel, videoPanel);
                    _this._updateUserPanel(user);
                }
            }, 1000);
        }
        var audioMute = true;
        var videoMute = true;
        user.getTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO && !track.isMuted())
                videoMute = false;
            if (track.getType() === MediaType_1.MediaType.AUDIO && !track.isMuted())
                videoMute = false;
        });
        //add list
        if (this.myInfo.IsHost) {
            this.ui.addParticipant(jitsiId, user.getDisplayName(), false, //me?
            false, false, videoMute, //use camera?
            audioMute //use mic?
            );
        }
        else {
            this.ui.addParticipant(jitsiId, user.getDisplayName(), false, //me?
            true, true, videoMute, //use camera?
            audioMute //use mic?
            );
        }
        //notify him that i am moderator
        if (this.myInfo.IsHost)
            this.grantModeratorRole(this.jitsiRoom.myUserId());
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.MEDIA_POLICY, this.myInfo.mediaPolicy);
        this.commandQueue.executeQueuedCommands(jitsiId);
        this.privateCommandQueue.executeQueuedCommands(jitsiId);
    };
    //remote leave room
    BizGazeMeeting.prototype.onJitsiUserLeft = function (jitsiId, user) {
        var _this = this;
        this.ui.notification_warning(user.getDisplayName(), "Participant left", NotificationType_1.NotificationType.User);
        this.Log("left user: " + user.getDisplayName());
        var videoPanel = user.getProperty(UserProperty_1.UserProperty.videoPanel);
        if (videoPanel) {
            this.ui.videoPanelGrid.freeVideoPanel(videoPanel.Id);
            user.setProperty(UserProperty_1.UserProperty.videoPanel, null);
        }
        //remove list
        this.ui.removeParticipant(jitsiId);
        //remove from list
        this.m_BGUserList.forEach(function (bzUser, bizId) {
            if (bzUser.Jitsi_Id == jitsiId) {
                _this.m_BGUserList.delete(bizId);
            }
        });
    };
    BizGazeMeeting.prototype.onBizId = function (param) {
        var senderJitsiId = param.attributes.senderId;
        if (senderJitsiId === this.myInfo.Jitsi_Id)
            return;
        var user = this.jitsiRoom.getParticipantById(senderJitsiId);
        if (user) {
            var bizId = param.value;
            var bizUser = this.m_BGUserList.get(bizId);
            if (bizUser)
                bizUser.Jitsi_Id = senderJitsiId;
        }
        else {
            this.commandQueue.queueCommand(senderJitsiId, jitsi_1.JitsiCommand.BIZ_ID, param, this.onBizId.bind(this));
        }
    };
    //[ IN ] remote track
    BizGazeMeeting.prototype.onRemoteTrackAdded = function (track) {
        if (track.isLocal()) {
            return;
        }
        this.Log("[ IN ] remote track - " + track.getType());
        //if (this.roomInfo.IsWebinar && track.isMuted()) //matvey
        if (this.roomInfo.IsControlAllowed && track.isMuted())
            return;
        //add to ui
        var id = track.getParticipantId();
        var user = this.jitsiRoom.getParticipantById(id);
        if (!user) {
            this.Log(user.getDisplayName() + " not yet added");
            return;
        }
        var videoPanel = user.getProperty(UserProperty_1.UserProperty.videoPanel);
        if (!videoPanel) {
            videoPanel = this.ui.videoPanelGrid.getNewVideoPanel();
            user.setProperty(UserProperty_1.UserProperty.videoPanel, videoPanel);
        }
        if (track.getType() === MediaType_1.MediaType.VIDEO) {
            var videoElem = videoPanel.videoElem;
            track.attach(videoElem);
            videoElem.play();
        }
        else if (track.getType() === MediaType_1.MediaType.AUDIO) {
            var audioElem = videoPanel.audioElem;
            track.attach(audioElem);
            audioElem.play();
        }
        this._updateUserPanel(user);
    };
    // [DEL] remote track
    BizGazeMeeting.prototype.onRemovedRemoteTrack = function (track) {
        if (track.isLocal()) {
            this.Log("[ DEL ] localtrack - " + track.getType());
            console.log("[ DEL ] localtrack - " + track.getType());
        }
        else {
            this.Log("[ DEL ] remotetrack - " + track.getType());
            console.log("[ DEL ] remotetrack --- " + track.getType());
        }
        track.removeAllListeners(this.JitsiMeetJS.events.track.TRACK_AUDIO_LEVEL_CHANGED);
        track.removeAllListeners(this.JitsiMeetJS.events.track.TRACK_MUTE_CHANGED);
        track.removeAllListeners(this.JitsiMeetJS.events.track.LOCAL_TRACK_STOPPED);
        track.removeAllListeners(this.JitsiMeetJS.events.track.TRACK_VIDEOTYPE_CHANGED);
        track.removeAllListeners(this.JitsiMeetJS.events.track.TRACK_AUDIO_OUTPUT_CHANGED);
        track.removeAllListeners(this.JitsiMeetJS.events.track.NO_DATA_FROM_SOURCE);
        if (!track.isLocal()) {
            var jitsiId = track.getParticipantId();
            var user = this.jitsiRoom.getParticipantById(jitsiId);
            //if (this.roomInfo.IsWebinar) { //matvey
            if (this.roomInfo.IsControlAllowed) {
                var IsHost = user.getProperty(UserProperty_1.UserProperty.IsHost);
                var userVideoPanel = user.getProperty(UserProperty_1.UserProperty.videoPanel);
                if (!IsHost && user.getTracks().length <= 0 && userVideoPanel) {
                    this.ui.videoPanelGrid.freeVideoPanel(userVideoPanel.Id);
                    user.setProperty(UserProperty_1.UserProperty.videoPanel, null);
                }
            }
            this._updateUserPanel(user);
        }
        else {
            this.updateUiOnLocalTrackChange();
        }
    };
    BizGazeMeeting.prototype._updateUserPanel = function (user) {
        if (user && user.getProperty(UserProperty_1.UserProperty.videoPanel)) {
            var videoPanel = user.getProperty(UserProperty_1.UserProperty.videoPanel);
            videoPanel.updatePanelOnJitsiUser(this.myInfo, user);
        }
    };
    BizGazeMeeting.prototype._updateMyPanel = function () {
        if (this.localVideoPanel == null) {
            //if (this.roomInfo.IsWebinar && !this.myInfo.IsHost) { //matvey
            if (this.roomInfo.IsControlAllowed && !this.myInfo.IsHost) {
                var isAllMuted_1 = true;
                this.getLocalTracks().forEach(function (track) {
                    if (!track.isMuted())
                        isAllMuted_1 = false;
                });
                if (!isAllMuted_1)
                    this.localVideoPanel = this.ui.videoPanelGrid.getNewVideoPanel();
            }
            else {
                this.localVideoPanel = this.ui.videoPanelGrid.getNewVideoPanel();
            }
        }
        if (this.localVideoPanel)
            this.localVideoPanel.updatePanelOnMyBGUser(this.myInfo, this.getLocalTracks());
    };
    /**
     * **************************************************************************
     *                Messaging between Jitsi participants
     *        Broadcast
     *        Private
     *
     * **************************************************************************
     */
    //ATTENTION! attributes = {key1: not object, key2: not object, ...}
    //send as primitive type like boolean, string, number...
    //and decode when use value1, vaule2
    BizGazeMeeting.prototype.sendJitsiBroadcastCommand = function (type, value, attributes) {
        if (attributes === void 0) { attributes = null; }
        var param = new JitsiCommandParam_1.JitsiCommandParam();
        param.value = value;
        if (!!attributes && typeof attributes === "object" && attributes.constructor.name === "Object")
            param.attributes = __assign({}, attributes);
        param.attributes.senderId = this.myInfo.Jitsi_Id;
        param.attributes.senderName = this.myInfo.Name;
        this.jitsiRoom.sendCommandOnce(type, param);
    };
    BizGazeMeeting.prototype.sendJitsiPrivateCommand = function (targetId, type, message) {
        var payload = {
            type: "biz_private",
            subtype: type,
            senderId: this.myInfo.Jitsi_Id,
            message: message
        };
        this.jitsiRoom.sendMessage(payload, targetId);
    };
    BizGazeMeeting.prototype.onPrivateCommand = function (senderId, type, message) {
        var user = this.jitsiRoom.getParticipantById(senderId);
        if (!user) {
            this.privateCommandQueue.queueCommand(senderId, type, message, this.onPrivateCommand.bind(this));
            return;
        }
        if (type === jitsi_1.JitsiPrivateCommand.MEDIA_POLICY) {
            var policy = message;
            this.onUserMediaPolicy(senderId, policy);
        }
        else if (type === jitsi_1.JitsiPrivateCommand.ALLOW_RECORDING) {
            var allow = message.allow;
            this.onAllowRecording(senderId, allow);
        }
        else if (type === jitsi_1.JitsiPrivateCommand.ALLOW_SCREENSHARE) {
            var allow = message.allow;
            this.onAllowScreenshare(senderId, allow);
        }
        else if (type === jitsi_1.JitsiPrivateCommand.ALLOW_HANDRAISE) {
            var allow = message.allow;
            this.onAllowHandRaise(senderId, allow);
        }
        else if (type === jitsi_1.JitsiPrivateCommand.PRIVATE_CAHT) {
            this.onReceivePrivateChatMessage(senderId, message);
        }
    };
    /**
     * **************************************************************************
     *                Meeting Logic
     *        Moderator
     *        Mute/Unmute Audio/Video
     *        ScreenShare
     *        Recording
     *        Chatting
     *        File Sharing
     *
     * **************************************************************************
     */
    BizGazeMeeting.prototype.sendRemoteControlReply = function (type, e, targetId) {
        //this.Log("Sending remoteControl");
        var param = {
            name: 'remote-control',
            type: '',
            action: '',
            button: 0,
            x: 0,
            y: 0,
            modifiers: {},
            key: ''
        };
        switch (type) {
            case 'permissions':
                param.type = 'permissions';
                param.action = 'request';
                break;
            case 'mousemove':
                param.type = 'mousemove';
                param.x = e.x;
                param.y = e.y;
                break;
            case 'mousedown':
                param.type = 'mousedown';
                param.button = e.button;
                break;
            case 'mouseup':
                param.type = 'mouseup';
                param.button = e.button;
                break;
            case 'keydown':
                param.type = 'keydown';
                param.modifiers = e.modifiers;
                param.key = keyboardEventToKey(e.key);
                console.info('--------------------param', param);
                break;
            case 'keyup':
                param.type = 'keyup';
                param.modifiers = e.modifiers;
                param.key = keyboardEventToKey(e.key);
                console.info('--------------------param', param);
                break;
        }
        /*let param = {
            name: 'remote-control',
            type: 'mousedown',
            button: 1
        };*/
        this.jitsiRoom.sendEndpointMessage(targetId, param);
    };
    BizGazeMeeting.prototype.kickParticipantOut = function (targetId) {
        this.Log("Sending kick out");
        console.log(targetId);
        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.KICK_OUT, targetId);
    };
    BizGazeMeeting.prototype.onKickedOut = function (param) {
        this.Log("received kick out");
        var targetId = param.value;
        if (targetId === this.myInfo.Jitsi_Id) {
            this.forceStop();
        }
    };
    //moderator
    BizGazeMeeting.prototype.grantModeratorRole = function (targetId) {
        this.Log("Sending grant host");
        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.GRANT_HOST_ROLE, targetId);
    };
    BizGazeMeeting.prototype.onChangedModerator = function (param) {
        var _this = this;
        this.Log("received grant host");
        var targetId = param.value;
        var senderName = param.attributes.senderName;
        var senderId = param.attributes.senderId;
        if (targetId === this.myInfo.Jitsi_Id) {
            if (senderId !== targetId) {
                this.ui.notification_warning(senderName, "You're granted co-host permission", NotificationType_1.NotificationType.GrantHost);
                this.myInfo.IsHost = true;
                this._updateMyPanel();
                this.jitsiRoom.getParticipants().forEach(function (user) {
                    _this._updateUserPanel(user);
                });
                this.ui.updateByRole(this.myInfo.IsHost);
            }
        }
        else {
            var user = this.jitsiRoom.getParticipantById(targetId);
            if (user) {
                user.setProperty(UserProperty_1.UserProperty.IsHost, true);
                this._updateUserPanel(user);
            }
            else {
                this.commandQueue.queueCommand(targetId, jitsi_1.JitsiCommand.GRANT_HOST_ROLE, param, this.onChangedModerator.bind(this));
            }
        }
    };
    BizGazeMeeting.prototype.onInitMediaPolicy = function (param) {
        var sourceId = param.value;
        if (sourceId === this.myInfo.Jitsi_Id)
            return;
        this.Log("received initMediaPolicy from " + sourceId);
        var user = this.jitsiRoom.getParticipantById(sourceId);
        if (user) {
            var useCamera = param.attributes.useCamera === "true";
            var useMic = param.attributes.useMic === "true";
            this.ui.participantsListWidget.setMuteCamera(sourceId, !useCamera);
            this.ui.participantsListWidget.setMuteMic(sourceId, !useMic);
        }
        else {
            this.Log("delaying initMediaPolicy callback");
            this.commandQueue.queueCommand(sourceId, jitsi_1.JitsiCommand.INIT_MEDIA_POLICY, param, this.onInitMediaPolicy.bind(this));
        }
    };
    BizGazeMeeting.prototype.onUserMediaPolicy = function (senderId, policy) {
        this.ui.participantsListWidget.setMuteCamera(senderId, !policy.useCamera);
        this.ui.participantsListWidget.setMuteMic(senderId, !policy.useMic);
    };
    //mute myself
    //called when user click toolbar buttons
    BizGazeMeeting.prototype.OnToggleMuteMyAudio = function () {
        if (this.roomInfo.IsControlAllowed && !this.myInfo.IsHost)
            return;
        //alert("IsHost" + this.roomInfo.IsControlAllowed + "-" + "IsControlAllowed" + this.roomInfo.IsControlAllowed);
        var audioMuted = false;
        this.getLocalTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.AUDIO && track.isMuted())
                audioMuted = true;
        });
        this.isToggleMuteMyAudio = true;
        this.muteMyAudio(!audioMuted);
    };
    BizGazeMeeting.prototype.OnToggleMuteMyVideo = function () {
        if (this.roomInfo.IsControlAllowed && !this.myInfo.IsHost)
            return;
        var videoMuted = false;
        this.getLocalTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO && track.isMuted())
                videoMuted = true;
        });
        this.isToggleMuteMyVideo = true;
        this.muteMyVideo(!videoMuted);
    };
    BizGazeMeeting.prototype.deniedunmuteMyAudio = function (targetId, mute) {
        if (targetId !== this.myInfo.Jitsi_Id) {
            this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ALLOW_MIC, targetId, { mute: mute });
        }
    };
    BizGazeMeeting.prototype.muteMyAudio = function (mute) {
        console.log("muteMyAudio");
        this.getLocalTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.AUDIO) {
                if (mute)
                    track.mute();
                else
                    track.unmute();
            }
        });
        if (this.roomInfo.IsControlAllowed && mute) {
            if (!this.myInfo.IsHost) {
                this.isAllowCtlMic = false;
            }
            this.ui.updateByRole(this.isAllowCtlMic);
            this.ui.notification_warning("", "Your Mic is Muted", NotificationType_1.NotificationType.AudioMute);
        }
        else if (this.roomInfo.IsControlAllowed && (!mute)) {
            this.isAllowCtlMic = true;
            this.ui.updateByRole(this.isAllowCtlMic);
            this.ui.notification_warning("", "Your Mic is Unmuted", NotificationType_1.NotificationType.Audio);
        }
        else if (!this.roomInfo.IsControlAllowed && (mute) && (!this.isToggleMuteMyAudio))
            this.ui.notification_warning("", "Host muted Your Mic", NotificationType_1.NotificationType.AudioMute);
        //else if (!this.roomInfo.IsControlAllowed && (!mute) && (! this.isToggleMuteMyAudio))
        //    this.ui.notification_warning("", "Host Unmuted your Mic", NotificationType.Audio);
    };
    BizGazeMeeting.prototype.muteMyVideo = function (mute) {
        this.getLocalTracks().forEach(function (track) {
            if (track.getType() === MediaType_1.MediaType.VIDEO) {
                if (mute)
                    track.mute();
                else
                    track.unmute();
            }
        });
        if (this.roomInfo.IsControlAllowed && mute) {
            if (!this.myInfo.IsHost) {
                this.isAllowCtlVideo = false;
            }
            this.ui.updateByRole(this.isAllowCtlVideo);
            this.ui.notification_warning("", "Your Carmera is Disabled", NotificationType_1.NotificationType.VideoMute);
        }
        else if (this.roomInfo.IsControlAllowed && (!mute)) {
            this.isAllowCtlMic = true;
            this.ui.updateByRole(this.isAllowCtlMic);
            this.ui.notification_warning("", "Your Camera is Enabled", NotificationType_1.NotificationType.Video);
        }
        else if (!this.roomInfo.IsControlAllowed && (mute) && (!this.isToggleMuteMyVideo))
            this.ui.notification_warning("", "Host disabled your Camera", NotificationType_1.NotificationType.VideoMute);
        else if (!this.roomInfo.IsControlAllowed && (!mute) && (!this.isToggleMuteMyVideo))
            this.ui.notification_warning("", "Host enabled your Camera", NotificationType_1.NotificationType.Video);
    };
    //mute others
    BizGazeMeeting.prototype.muteUserAudio = function (targetId, mute) {
        this.isToggleMuteMyAudio = false;
        if (targetId === this.myInfo.Jitsi_Id) {
            this.muteMyAudio(mute);
        }
        else
            this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.MUTE_AUDIO, targetId, { mute: mute });
    };
    BizGazeMeeting.prototype.muteUserVideo = function (targetId, mute) {
        this.isToggleMuteMyVideo = false;
        if (targetId === this.myInfo.Jitsi_Id)
            this.muteMyVideo(mute);
        else
            this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.MUTE_VIDEO, targetId, { mute: mute });
    };
    BizGazeMeeting.prototype.onAllowMic = function (param) {
        var senderName = param.attributes.senderName;
        if (this.myInfo.IsHost)
            this.ui.notification_warning("", "Your request is denied by " + senderName, NotificationType_1.NotificationType.AudioMute);
    };
    BizGazeMeeting.prototype.onMutedAudio = function (param) {
        this.isToggleMuteMyAudio = false;
        var targetId = param.value;
        var senderId = param.attributes.senderId;
        var senderName = param.attributes.senderName;
        var mute = param.attributes.mute === "true";
        if (targetId == this.myInfo.Jitsi_Id) {
            if (senderId !== targetId) {
                if (mute) {
                    /*
                    if (!this.roomInfo.IsControlAllowed) {
                        this.ui.askDialog(
                            senderName,
                            "Requested to mute your microphone",
                            NotificationType.AudioMute,
                            this.muteMyAudio.bind(this),
                            null,
                            mute);
                    }
                    else {*/
                    this.muteMyAudio(mute);
                    //}
                }
                else {
                    if (!this.roomInfo.IsControlAllowed) {
                        this.ui.askDialog(senderName, "Requested to unmute your microphone", NotificationType_1.NotificationType.Audio, this.muteMyAudio.bind(this), this.deniedunmuteMyAudio.bind(this), mute);
                    }
                    else {
                        this.muteMyAudio(mute);
                    }
                }
            }
            else {
                this.muteMyAudio(mute);
            }
        }
    };
    BizGazeMeeting.prototype.onMutedVideo = function (param) {
        this.isToggleMuteMyVideo = false;
        var targetId = param.value;
        var senderId = param.attributes.senderId;
        var senderName = param.attributes.senderName;
        var mute = param.attributes.mute === "true";
        if (targetId == this.myInfo.Jitsi_Id) {
            if (senderId !== targetId) {
                if (mute) {
                    if (!this.roomInfo.IsControlAllowed) {
                        this.ui.askDialog(senderName, "Requested to mute your camera", NotificationType_1.NotificationType.VideoMute, this.muteMyVideo.bind(this), null, mute);
                    }
                    else {
                        this.muteMyVideo(mute);
                    }
                }
                else {
                    if (!this.roomInfo.IsControlAllowed) {
                        this.ui.askDialog(senderName, "Requested to unmute your camera", NotificationType_1.NotificationType.Video, this.muteMyVideo.bind(this), null, mute);
                    }
                    else {
                        this.muteMyVideo(mute);
                    }
                }
            }
            else {
                this.muteMyVideo(mute);
            }
        }
    };
    BizGazeMeeting.prototype.onLocalTrackMuteChanged = function (track) {
        var id = track.getParticipantId();
        //if (this.roomInfo.IsWebinar && !this.myInfo.IsHost) { //matvey
        if (this.roomInfo.IsControlAllowed && !this.myInfo.IsHost) {
            var isAllMuted_2 = true;
            this.getLocalTracks().forEach(function (t) {
                if (!t.isMuted())
                    isAllMuted_2 = false;
            });
            if (isAllMuted_2) {
                if (this.localVideoPanel) { //remote it
                    this.ui.videoPanelGrid.freeVideoPanel(this.localVideoPanel.Id);
                    this.localVideoPanel = null;
                }
            }
            else {
                if (!this.localVideoPanel) {
                    this.localVideoPanel = this.ui.videoPanelGrid.getNewVideoPanel();
                }
                //if (!this.roomInfo.IsControlAllowed) {
                if (track.getType() === MediaType_1.MediaType.VIDEO) {
                    var videoElem = this.localVideoPanel.videoElem;
                    track.attach(videoElem);
                    videoElem.play();
                }
                else if (track.getType() === MediaType_1.MediaType.AUDIO) {
                    var audioElem = this.localVideoPanel.audioElem;
                    track.attach(audioElem);
                    audioElem.play();
                }
                //}
            }
        }
        this.updateUiOnLocalTrackChange();
        //update list
        if (track.getType() === MediaType_1.MediaType.VIDEO)
            this.ui.participantsListWidget.setMuteCamera(id, track.isMuted());
        else if (track.getType() === MediaType_1.MediaType.AUDIO)
            this.ui.participantsListWidget.setMuteMic(id, track.isMuted());
    };
    BizGazeMeeting.prototype.onRemoteTrackMuteChanged = function (track) {
        var id = track.getParticipantId();
        var user = this.jitsiRoom.getParticipantById(id);
        if (!user)
            return;
        //if (this.roomInfo.IsWebinar) { //matvey
        if (this.roomInfo.IsControlAllowed) {
            var isAllMuted_3 = true;
            user.getTracks().forEach(function (t) {
                if (!t.isMuted())
                    isAllMuted_3 = false;
            });
            var videoPanel = user.getProperty(UserProperty_1.UserProperty.videoPanel);
            if (isAllMuted_3) {
                if (videoPanel) { //remote it
                    this.ui.videoPanelGrid.freeVideoPanel(videoPanel.Id);
                    user.setProperty(UserProperty_1.UserProperty.videoPanel, null);
                }
            }
            else {
                if (!videoPanel) {
                    videoPanel = this.ui.videoPanelGrid.getNewVideoPanel();
                    user.setProperty(UserProperty_1.UserProperty.videoPanel, videoPanel);
                }
                if (track.getType() === MediaType_1.MediaType.VIDEO) {
                    var videoElem = videoPanel.videoElem;
                    track.attach(videoElem);
                    videoElem.play();
                }
                else if (track.getType() === MediaType_1.MediaType.AUDIO) {
                    var audioElem = videoPanel.audioElem;
                    track.attach(audioElem);
                    audioElem.play();
                }
            }
        }
        //update panel
        this._updateUserPanel(user);
        //update list
        if (track.getType() === MediaType_1.MediaType.VIDEO)
            this.ui.participantsListWidget.setMuteCamera(id, track.isMuted());
        else if (track.getType() === MediaType_1.MediaType.AUDIO)
            this.ui.participantsListWidget.setMuteMic(id, track.isMuted());
    };
    //allow of camera, mic 
    /*public allowCamera(jitsiId: string, allow: boolean) {
        if (!this.myInfo.IsHost)
            return;

        this.sendJitsiBroadcastCommand(JitsiCommand.ALLOW_CAMERA, jitsiId, { allow: allow });
    }

    public allowMic(jitsiId: string, allow: boolean) {
        if (!this.myInfo.IsHost)
            return;

        this.sendJitsiBroadcastCommand(JitsiCommand.ALLOW_MIC, jitsiId, { allow: allow });
    }

    private onAllowCameraCommand(param: JitsiCommandParam) {
        const targetId = param.value;
        const allow = param.attributes.allow === "true";

        this.ui.participantsListWidget.setMuteCamera(targetId, allow);

        if (targetId === this.jitsiRoom.myUserId()) {
            if (param.attributes.senderId !== targetId) {
                if (allow) {
                    this.ui.notification(
                        param.attributes.senderName,
                        "Your camera was allowed",
                        NotificationType.Video
                    );
                }
                else {
                    this.ui.notification_warning(
                        param.attributes.senderName,
                        "Your camera was blocked",
                        NotificationType.VideoMute
                    );
                }
            }

            this.onAllowCamera(allow);
        }
    }

    private onAllowCamera(allow: boolean) {
        this.myInfo.mediaPolicy.useCamera = allow;
        if (allow) {
            this.createVideoTrack(this.activeCameraId)
                .then((tracks: JitsiTrack[]) => {
                    this.onLocalTrackAdded(tracks);
                })
        } else {
            //remove track
            const localVideoTrack = this.getLocalTrackByType(MediaType.VIDEO);
            if (localVideoTrack) {
                this.removeLocalTrack(localVideoTrack).then((_: any) => {
                    localVideoTrack.dispose();
                    this.updateUiOnLocalTrackChange();
                });
            }
        }
    }

    private onAllowMicCommand(param: JitsiCommandParam) {
        const targetId = param.value;
        const allow = param.attributes.allow === "true";

        this.ui.participantsListWidget.setMuteMic(targetId, allow);

        if (targetId === this.jitsiRoom.myUserId()) {
            if (param.attributes.senderId !== targetId) {
                if (allow) {
                    this.ui.notification(
                        param.attributes.senderName,
                        "Your microphone was allowed",
                        NotificationType.Audio
                    );
                }
                else {
                    this.ui.notification_warning(
                        param.attributes.senderName,
                        "Your microphone was blocked",
                        NotificationType.AudioMute
                    );
                }
            }

            this.onAllowMic(allow);
        }
    }

    private onAllowMic(allow: boolean) {
        this.myInfo.mediaPolicy.useMic = allow;

        if (allow) {
            this.createAudioTrack(this.activeMicId)
                .then((tracks: JitsiTrack[]) => {
                    this.onLocalTrackAdded(tracks);
                })
        } else {
            //remove track
            const localAudioTrack = this.getLocalTrackByType(MediaType.AUDIO);
            if (localAudioTrack) {
                this.removeLocalTrack(localAudioTrack).then((_: any) => {
                    localAudioTrack.dispose();
                    this.updateUiOnLocalTrackChange();
                });
            }
        }
    }*/
    //screenshare
    BizGazeMeeting.prototype.toggleScreenShare = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.screenSharing) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.turnOnCamera()];
                    case 1:
                        _a.sent();
                        return [3 /*break*/, 11];
                    case 2:
                        if (!this.myInfo.IsHost) return [3 /*break*/, 6];
                        if (!(!this.roomInfo.IsMultipleSharingAllowed && this.isMultipleSharing)) return [3 /*break*/, 3];
                        this.ui.notification_warning("", this.sharingUserName + " is Already Sharing Screen", NotificationType_1.NotificationType.Screensharing);
                        return [3 /*break*/, 5];
                    case 3: return [4 /*yield*/, this.turnOnScreenShare()];
                    case 4:
                        _a.sent();
                        _a.label = 5;
                    case 5: return [3 /*break*/, 11];
                    case 6:
                        if (!this.roomInfo.IsMultipleSharingAllowed) return [3 /*break*/, 10];
                        if (!this.roomInfo.IsScreenShareRequired) return [3 /*break*/, 7];
                        //ask permission to host
                        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ASK_SCREENSHARE, this.myInfo.Jitsi_Id, null);
                        this.ui.notification_warning("Wait a second", "Sent your screen sharing request", NotificationType_1.NotificationType.Screensharing);
                        return [3 /*break*/, 9];
                    case 7: return [4 /*yield*/, this.turnOnScreenShare()];
                    case 8:
                        _a.sent();
                        _a.label = 9;
                    case 9: return [3 /*break*/, 11];
                    case 10:
                        if (this.isMultipleSharing) //true
                         {
                            this.ui.notification_warning("", this.sharingUserName + " is Already Sharing Screen", NotificationType_1.NotificationType.Screensharing);
                        }
                        else {
                            //await this.turnOnScreenShare();
                            this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ASK_SCREENSHARE, this.myInfo.Jitsi_Id, null);
                            this.ui.notification_warning("Wait a second", "Sent your screen sharing request", NotificationType_1.NotificationType.Screensharing);
                        }
                        _a.label = 11;
                    case 11:
                        this.ui.toolbar.setScreenShare(this.screenSharing);
                        return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.onAskMultiShare = function (param) {
        if (param.attributes.sharing == "true") { //true: turn on sharing
            this.isMultipleSharing = true;
            this.sharingUserName = param.attributes.senderName;
        }
        else if (param.attributes.sharing == "false") {
            this.isMultipleSharing = false;
        }
    };
    BizGazeMeeting.prototype.onAskScreenShare = function (param) {
        if (!this.myInfo.IsHost)
            return;
        var senderName = param.attributes.senderName;
        var senderId = param.attributes.senderId;
        this.ui.askDialog(senderName, "Requested screen sharing", NotificationType_1.NotificationType.Screensharing, this.allowScreenshare.bind(this), this.denyScreenshare.bind(this), senderId);
    };
    BizGazeMeeting.prototype.allowScreenshare = function (jitsiId) {
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.ALLOW_SCREENSHARE, { allow: true });
    };
    BizGazeMeeting.prototype.denyScreenshare = function (jitsiId) {
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.ALLOW_SCREENSHARE, { allow: false });
    };
    BizGazeMeeting.prototype.onAllowScreenshare = function (senderId, allow) {
        return __awaiter(this, void 0, void 0, function () {
            var user, userName;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        user = this.jitsiRoom.getParticipantById(senderId);
                        if (!user) return [3 /*break*/, 3];
                        userName = user.getDisplayName();
                        if (!allow) return [3 /*break*/, 2];
                        this.ui.notification(userName, "Accepted your Request", NotificationType_1.NotificationType.Screensharing);
                        return [4 /*yield*/, this.turnOnScreenShare()];
                    case 1:
                        _a.sent();
                        this.ui.toolbar.setScreenShare(this.screenSharing);
                        return [3 /*break*/, 3];
                    case 2:
                        this.ui.notification_warning(userName, "Denied your Request", NotificationType_1.NotificationType.Screensharing);
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    //turn on screen share
    BizGazeMeeting.prototype.turnOnScreenShare = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.JitsiMeetJS.createLocalTracks({
                            devices: ['desktop']
                        })
                            .then(function (tracks) { return __awaiter(_this, void 0, void 0, function () {
                            var screenTrack;
                            var _this = this;
                            return __generator(this, function (_a) {
                                if (tracks.length <= 0) {
                                    throw new Error("No Screen Selected");
                                }
                                screenTrack = tracks[0];
                                this.onLocalTrackAdded([screenTrack]);
                                screenTrack.addEventListener(this.JitsiMeetJS.events.track.LOCAL_TRACK_STOPPED, function () {
                                    _this.Log('screen - stopped');
                                    _this.toggleScreenShare();
                                    _this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ASK_MULTISHARE, _this.myInfo.Jitsi_Id, { sharing: false });
                                });
                                this.screenSharing = true;
                                if (!this.roomInfo.IsMultipleSharingAllowed)
                                    this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ASK_MULTISHARE, this.myInfo.Jitsi_Id, { sharing: true });
                                return [2 /*return*/];
                            });
                        }); })
                            .catch(function (error) {
                            _this.screenSharing = false;
                        })];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.turnOnCamera = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.JitsiMeetJS.createLocalTracks({
                            devices: [MediaType_1.MediaType.VIDEO]
                        })
                            .then(function (tracks) { return __awaiter(_this, void 0, void 0, function () {
                            var cameraTrack;
                            return __generator(this, function (_a) {
                                if (tracks.length <= 0) {
                                    return [2 /*return*/];
                                }
                                cameraTrack = tracks[0];
                                this.onLocalTrackAdded([cameraTrack]);
                                this.screenSharing = false;
                                return [2 /*return*/];
                            });
                        }); })
                            .catch(function (error) {
                            _this.screenSharing = false;
                            console.log(error);
                        })];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    /*chat*/
    BizGazeMeeting.prototype.sendChatMessage = function (msg) {
        this.jitsiRoom.sendTextMessage(msg);
    };
    BizGazeMeeting.prototype.sendPrivateChatMessage = function (targetId, msg) {
        this.sendJitsiPrivateCommand(targetId, jitsi_1.JitsiPrivateCommand.PRIVATE_CAHT, msg);
    };
    BizGazeMeeting.prototype.onReceiveChatMessage = function (id, msg, timestamp) {
        if (this.myInfo.Jitsi_Id === id)
            return;
        var user = this.jitsiRoom.getParticipantById(id);
        if (user) {
            this.ui.chattingWidget.receiveMessage(id, user.getDisplayName(), msg);
        }
    };
    BizGazeMeeting.prototype.onReceivePrivateChatMessage = function (senderId, msg) {
        if (this.myInfo.Jitsi_Id === senderId)
            return;
        var user = this.jitsiRoom.getParticipantById(senderId);
        if (user) {
            this.ui.chattingWidget.receiveMessage(senderId, user.getDisplayName(), msg, true);
        }
    };
    BizGazeMeeting.prototype.onAllowControl = function (senderId, allow) {
        return __awaiter(this, void 0, void 0, function () {
            var user, userName;
            return __generator(this, function (_a) {
                user = this.jitsiRoom.getParticipantById(senderId);
                if (user) {
                    userName = user.getDisplayName();
                    if (allow) {
                    }
                    else {
                        this.ui.notification_warning(userName, "Recording was denied", NotificationType_1.NotificationType.AudioMute);
                    }
                }
                return [2 /*return*/];
            });
        });
    };
    /*file sharing*/
    BizGazeMeeting.prototype.sendFileMeta = function (meta) {
        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.FILE_META, meta.sessionId, { meta: JSON.stringify(meta) });
    };
    BizGazeMeeting.prototype.sendFileData = function (sessionId, data) {
        var binary = '';
        var bytes = new Uint8Array(data);
        var len = bytes.byteLength;
        for (var i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        var enc = window.btoa(binary);
        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.FILE_SLICE, sessionId, { data: enc });
    };
    BizGazeMeeting.prototype.onFileMeta = function (param) {
        var sessionId = param.value;
        var senderId = param.attributes.senderId;
        var senderName = param.attributes.senderName;
        var meta = JSON.parse(param.attributes.meta);
        if (senderId === this.myInfo.Jitsi_Id)
            return;
        this.ui.chattingWidget.onFileMeta(sessionId, meta, senderId, senderName);
    };
    BizGazeMeeting.prototype.onFileData = function (param) {
        var sessionId = param.value;
        var enc = param.attributes.data;
        var senderId = param.attributes.senderId;
        var senderName = param.attributes.senderName;
        if (senderId === this.myInfo.Jitsi_Id)
            return;
        var binary = window.atob(enc);
        var array = new Uint8Array(binary.length);
        for (var i = 0; i < binary.length; ++i) {
            array[i] = binary.charCodeAt(i);
        }
        this.ui.chattingWidget.onFileData(sessionId, array.buffer);
    };
    BizGazeMeeting.prototype.toggleRecording = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.recording) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.stopRecording()];
                    case 1:
                        _a.sent();
                        this.ui.toolbar.setRecording(this.recording);
                        return [3 /*break*/, 7];
                    case 2:
                        if (!this.myInfo.IsHost) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.startRecording()];
                    case 3:
                        _a.sent();
                        this.ui.toolbar.setRecording(this.recording);
                        return [3 /*break*/, 7];
                    case 4:
                        if (!this.roomInfo.IsRecordingRequired) return [3 /*break*/, 5];
                        //ask permission to host
                        this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ASK_RECORDING, this.myInfo.Jitsi_Id, null);
                        this.ui.notification_warning("Wait a second", "Sent your recording request", NotificationType_1.NotificationType.Recording);
                        return [3 /*break*/, 7];
                    case 5: return [4 /*yield*/, this.startRecording()];
                    case 6:
                        _a.sent();
                        this.ui.toolbar.setRecording(this.recording);
                        _a.label = 7;
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.onAskRecording = function (param) {
        if (!this.myInfo.IsHost)
            return;
        var senderName = param.attributes.senderName;
        var senderId = param.attributes.senderId;
        this.ui.askDialog(senderName, "Requested a recording", NotificationType_1.NotificationType.Recording, this.allowRecording.bind(this), this.denyRecording.bind(this), senderId);
    };
    BizGazeMeeting.prototype.allowRecording = function (jitsiId) {
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.ALLOW_RECORDING, { allow: true });
    };
    BizGazeMeeting.prototype.denyRecording = function (jitsiId) {
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.ALLOW_RECORDING, { allow: false });
    };
    BizGazeMeeting.prototype.onAllowRecording = function (senderId, allow) {
        return __awaiter(this, void 0, void 0, function () {
            var user, userName;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        user = this.jitsiRoom.getParticipantById(senderId);
                        if (!user) return [3 /*break*/, 3];
                        userName = user.getDisplayName();
                        if (!allow) return [3 /*break*/, 2];
                        this.ui.notification(userName, "Recording was accepted", NotificationType_1.NotificationType.Recording);
                        return [4 /*yield*/, this.startRecording()];
                    case 1:
                        _a.sent();
                        this.ui.toolbar.setRecording(this.recording);
                        return [3 /*break*/, 3];
                    case 2:
                        this.ui.notification_warning(userName, "Recording was denied", NotificationType_1.NotificationType.Recording);
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.startRecording = function () {
        return __awaiter(this, void 0, void 0, function () {
            var gumStream, gdmStream, e_1, e_2;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        gumStream = null;
                        gdmStream = null;
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 4, , 9]);
                        return [4 /*yield*/, navigator.mediaDevices.getUserMedia({ video: false, audio: true })];
                    case 2:
                        gumStream = _a.sent();
                        return [4 /*yield*/, navigator.mediaDevices.getDisplayMedia({
                                video: { displaySurface: "browser" },
                                audio: { channelCount: 2 },
                            })];
                    case 3:
                        gdmStream = _a.sent();
                        gdmStream.addEventListener('inactive', function (event) {
                            if (_this.recording)
                                _this.toggleRecording();
                        });
                        return [3 /*break*/, 9];
                    case 4:
                        e_1 = _a.sent();
                        //seems to has no audio device
                        debugger;
                        _a.label = 5;
                    case 5:
                        _a.trys.push([5, 7, , 8]);
                        gumStream = null;
                        return [4 /*yield*/, navigator.mediaDevices.getDisplayMedia({
                                video: { displaySurface: "browser" },
                                audio: { channelCount: 2 }
                            })];
                    case 6:
                        gdmStream = _a.sent();
                        gdmStream.addEventListener('inactive', function (event) {
                            if (_this.recording)
                                _this.toggleRecording();
                        });
                        return [3 /*break*/, 8];
                    case 7:
                        e_2 = _a.sent();
                        console.error("capture for recording failure");
                        return [2 /*return*/];
                    case 8: return [3 /*break*/, 9];
                    case 9:
                        this.recorderStream = gumStream ? this.mixer(gumStream, gdmStream) : gdmStream;
                        this.mediaRecorder = new MediaRecorder(this.recorderStream, { mimeType: 'video/webm' });
                        this.mediaRecorder.ondataavailable = function (e) {
                            if (e.data && e.data.size > 0) {
                                _this.recordingData.push(e.data);
                                if (!_this.recording && !_this.downloadRecordFile) {
                                    _this.downloadRecordingFile();
                                }
                            }
                        };
                        this.mediaRecorder.onstop = function () {
                            _this.recorderStream.getTracks().forEach(function (track) { return track.stop(); });
                            gumStream.getTracks().forEach(function (track) { return track.stop(); });
                            gdmStream.getTracks().forEach(function (track) { return track.stop(); });
                        };
                        this.recorderStream.addEventListener('inactive', function () {
                            console.log('Capture stream inactive');
                            _this.stopRecording();
                        });
                        this.recordingData = [];
                        this.mediaRecorder.start();
                        this.recording = true;
                        this.downloadRecordFile = false;
                        return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.stopRecording = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.recording)
                            return [2 /*return*/];
                        return [4 /*yield*/, this.mediaRecorder.stop()];
                    case 1:
                        _a.sent();
                        this.downloadRecordingFile();
                        this.recording = false;
                        return [2 /*return*/];
                }
            });
        });
    };
    BizGazeMeeting.prototype.downloadRecordingFile = function () {
        if (this.downloadRecordFile || this.recordingData.length <= 0)
            return;
        var blob = new Blob(this.recordingData, { type: 'video/webm' });
        var url = window.URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = this.getRecordingFilename() + ".webm";
        document.body.appendChild(a);
        a.click();
        setTimeout(function () {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 5000);
        this.downloadRecordFile = true;
    };
    BizGazeMeeting.prototype.getRecordingFilename = function () {
        var now = new Date();
        var timestamp = now.toISOString();
        return this.roomInfo.conferenceName + "_recording_" + timestamp;
    };
    BizGazeMeeting.prototype.mixer = function (stream1, stream2) {
        var ctx = new AudioContext();
        var dest = ctx.createMediaStreamDestination();
        if (stream1.getAudioTracks().length > 0)
            ctx.createMediaStreamSource(stream1).connect(dest);
        if (stream2.getAudioTracks().length > 0)
            ctx.createMediaStreamSource(stream2).connect(dest);
        var tracks = dest.stream.getTracks();
        tracks = tracks.concat(stream1.getVideoTracks()).concat(stream2.getVideoTracks());
        return new MediaStream(tracks);
    };
    BizGazeMeeting.prototype.toggleMuteAllVideo = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!this.myInfo.IsHost)
                    return [2 /*return*/];
                this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.MUTE_All_VIDEO, this.myInfo.Jitsi_Id, { mute: true });
                this.ui.notification_warning("Wait a second", "Sent your all video disable request", NotificationType_1.NotificationType.VideoMute);
                return [2 /*return*/];
            });
        });
    };
    BizGazeMeeting.prototype.onMuteAllVideo = function (param) {
        var senderId = param.value;
        var senderName = param.attributes.senderName;
        var mute = param.attributes.mute === "true";
        if (senderId !== this.myInfo.Jitsi_Id) {
            this.ui.askDialog(senderName, "Requested to mute your camera", NotificationType_1.NotificationType.VideoMute, this.muteMyVideo.bind(this), null, mute);
        }
    };
    BizGazeMeeting.prototype.toggleMuteAll = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!this.myInfo.IsHost)
                    return [2 /*return*/];
                this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.MUTE_All_AUDIO, this.myInfo.Jitsi_Id, { mute: true });
                this.ui.notification_warning("Wait a second", "Sent your mute all request", NotificationType_1.NotificationType.AudioMute);
                return [2 /*return*/];
            });
        });
    };
    BizGazeMeeting.prototype.onMuteAllAudio = function (param) {
        var senderId = param.value;
        var senderName = param.attributes.senderName;
        var mute = param.attributes.mute;
        if (senderId !== this.myInfo.Jitsi_Id) {
            this.ui.askDialog(senderName, "Requested to mute your microphone", NotificationType_1.NotificationType.AudioMute, this.muteMyAudio.bind(this), null, mute);
        }
    };
    // handraise
    BizGazeMeeting.prototype.toggleHandRaise = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!this.myInfo.IsHost) {
                    //ask handraise to host
                    this.sendJitsiBroadcastCommand(jitsi_1.JitsiCommand.ASK_HANDRAISE, this.myInfo.Jitsi_Id, null);
                    this.ui.notification_warning("Wait a second", "Sent your hand-raise request", NotificationType_1.NotificationType.HandRaise);
                }
                return [2 /*return*/];
            });
        });
    };
    BizGazeMeeting.prototype.onAskHandRaise = function (param) {
        if (!this.myInfo.IsHost)
            return;
        var senderName = param.attributes.senderName;
        var senderId = param.attributes.senderId;
        this.ui.askDialog(senderName, "Requested Hand-Raise", NotificationType_1.NotificationType.HandRaise, this.allowHandRaise.bind(this), this.denyHandRaise.bind(this), senderId);
    };
    BizGazeMeeting.prototype.allowHandRaise = function (jitsiId) {
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.ALLOW_HANDRAISE, { allow: true });
    };
    BizGazeMeeting.prototype.denyHandRaise = function (jitsiId) {
        this.sendJitsiPrivateCommand(jitsiId, jitsi_1.JitsiPrivateCommand.ALLOW_HANDRAISE, { allow: false });
    };
    BizGazeMeeting.prototype.onAllowHandRaise = function (senderId, allow) {
        return __awaiter(this, void 0, void 0, function () {
            var user, userName;
            return __generator(this, function (_a) {
                user = this.jitsiRoom.getParticipantById(senderId);
                if (user) {
                    userName = user.getDisplayName();
                    if (allow) {
                        this.ui.notification(userName, "Hand-raise was accepted", NotificationType_1.NotificationType.HandRaise);
                        this.muteMyVideo(false);
                        this.muteMyAudio(false);
                    }
                    else {
                        this.ui.notification_warning(userName, "Hand-raise was denied", NotificationType_1.NotificationType.HandRaise);
                    }
                }
                return [2 /*return*/];
            });
        });
    };
    BizGazeMeeting.prototype.toggleCopyJoiningInfo = function () {
        var TempText = document.createElement("input");
        TempText.value = "https://" + window.location.host + "/lobby/" + this.roomInfo.Id; // enter your meeting url here
        document.body.appendChild(TempText);
        TempText.select();
        document.execCommand("copy");
        document.body.removeChild(TempText);
    };
    //highlight speaker
    BizGazeMeeting.prototype.onDominantSpeakerChanged = function (id) {
        if (id === this.myInfo.Jitsi_Id) {
            this.ui.videoPanelGrid.hightlightPanel(this.localVideoPanel.Id);
        }
        else {
            var user = this.jitsiRoom.getParticipantById(id);
            if (user) {
                var videoPanel = user.getProperty(UserProperty_1.UserProperty.videoPanel);
                if (videoPanel)
                    this.ui.videoPanelGrid.hightlightPanel(videoPanel.Id);
            }
        }
    };
    /**
     * **************************************************************************
     *              Log
     * **************************************************************************
     */
    BizGazeMeeting.prototype.Log = function (message) {
        console.log(message);
        if (this.ui != null)
            this.ui.Log(message);
    };
    return BizGazeMeeting;
}());
exports.BizGazeMeeting = BizGazeMeeting;
var meeting = new BizGazeMeeting();
meeting.start();
//# sourceMappingURL=meeting.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_84cb55ca.js","/")
},{"./enum/ChannelType":37,"./enum/MediaType":38,"./enum/NotificationType":39,"./enum/UserProperty":40,"./jitsi/JitsiCommandParam":44,"./jitsi/JitsiCommandQueue":45,"./meeting_ui":46,"./model/ActiveDevices":47,"./model/BGMeeting":48,"./model/BGUser":49,"./model/InputDevicePolicy":50,"./protocol/bg":51,"./protocol/jitsi":52,"./util/TimeUtil":53,"@microsoft/signalr":23,"buffer":25,"e/U+97":27}],42:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileReceiver = exports.FileReceiverProps = void 0;
var snippet_1 = require("../util/snippet");
var FileReceiverProps = /** @class */ (function () {
    function FileReceiverProps() {
    }
    return FileReceiverProps;
}());
exports.FileReceiverProps = FileReceiverProps;
var FileReceiver = /** @class */ (function () {
    function FileReceiver(props) {
        this.receiveBuffer = [];
        this.size = 0;
        this.props = props;
    }
    FileReceiver.prototype.show = function () {
        var receivingId = "receiving-" + this.props.meta.sessionId;
        var html = "\n            <div class=\"file-progress\" id=\"" + receivingId + "\">\n                <div class=\"fileinfo\">\n                    <a class=\"download\" href=\"#\">" + this.props.meta.name + "(" + snippet_1.getCapacityLabel(this.props.meta.size) + ")</a>\n                </div>\n                <div class=\"progress\">\n                    <div class=\"progress-bar\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                </div>\n            </div>";
        this.props.addChatItem(this.props.senderId, this.props.senderName, html, false);
        this.receivingElement = $("#" + receivingId);
        this.progressElement = this.receivingElement.find(".progress-bar");
        this.downloadElement = this.receivingElement.find(".download");
        this.receivingElement.closest(".usermessage").css("white-space", "nowrap");
    };
    FileReceiver.prototype.readFileData = function (data) {
        debugger;
        this.receiveBuffer.push(data);
        this.size += data.byteLength;
        var percent = Math.floor(this.size / this.props.meta.size * 100);
        this.progressElement.attr("aria-valuenow", percent);
        this.progressElement.css("width", percent + "%");
        if (this.size >= this.props.meta.size) {
            var received = new Blob(this.receiveBuffer);
            this.downloadElement.attr('href', URL.createObjectURL(received));
            this.downloadElement.attr('download', this.props.meta.name);
            this.props.onFinished(this.props.meta.sessionId, this.props.meta.name, "Receive finished");
        }
    };
    return FileReceiver;
}());
exports.FileReceiver = FileReceiver;
//# sourceMappingURL=FileReceiver.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/file\\FileReceiver.js","/file")
},{"../util/snippet":55,"buffer":25,"e/U+97":27}],43:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileSender = exports.FileSenderProps = void 0;
var snippet_1 = require("../util/snippet");
var TimeUtil_1 = require("../util/TimeUtil");
var FileSenderProps = /** @class */ (function () {
    function FileSenderProps() {
    }
    return FileSenderProps;
}());
exports.FileSenderProps = FileSenderProps;
var FileSender = /** @class */ (function () {
    function FileSender(props) {
        this.sendBuf = [];
        this.props = props;
    }
    FileSender.prototype.sendFile = function () {
        return __awaiter(this, void 0, void 0, function () {
            var file, sendingId, html, $progressElem, chunkSize, fileReader, offset, readSlice;
            var _this = this;
            return __generator(this, function (_a) {
                if (this.props.fileElement.files.length <= 0) {
                    //this.props.onError("No file", "Please select a file to share");
                    return [2 /*return*/];
                }
                file = this.props.fileElement.files[0];
                if (file.size <= 0) {
                    this.props.onError(file.name, "You choosed empty file");
                    return [2 /*return*/];
                }
                this.file = file;
                sendingId = "sending-" + this.props.sessionId;
                html = "\n            <div class=\"file-progress\" id=\"" + sendingId + "\">\n                <div class=\"fileinfo\">\n                    " + file.name + "(" + snippet_1.getCapacityLabel(file.size) + ")\n                </div>\n                <div class=\"progress\">\n                    <div class=\"progress-bar\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n                </div>\n            </div>";
                $(this.props.fileSendingPanel).append(html);
                this.sendingElement = $("#" + sendingId);
                $progressElem = this.sendingElement.find(".progress-bar");
                this.props.sendFileMeta({
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    sessionId: this.props.sessionId
                });
                chunkSize = 16384;
                fileReader = new FileReader();
                offset = 0;
                fileReader.addEventListener('error', function (error) {
                    _this.removeSelf();
                    _this.props.onError(file.name, "Error happened while reading ");
                });
                fileReader.addEventListener('abort', function (event) {
                    _this.removeSelf();
                    _this.props.onError(file.name, "Reading was aborted");
                });
                readSlice = function (o) {
                    var slice = file.slice(offset, o + chunkSize);
                    fileReader.readAsArrayBuffer(slice);
                };
                fileReader.addEventListener('load', function (e) {
                    var blob = e.target.result;
                    _this.props.sendFileData(_this.props.sessionId, blob);
                    offset += blob.byteLength;
                    //update progress
                    var percent = Math.floor((offset * 100) / file.size);
                    $progressElem.attr("aria-valuenow", percent);
                    $progressElem.css("width", percent + "%");
                    if (offset < file.size) {
                        setTimeout(function (_) {
                            readSlice(offset);
                        }, 100);
                        //readSlice(offset);
                    }
                    else {
                        _this.removeSelf();
                        //this.props.onFinished(file.name, `Sending finished`);
                        var time = TimeUtil_1.getCurTime();
                        var binary = '';
                        var bytes = new Uint8Array(blob);
                        var len = bytes.byteLength;
                        for (var i = 0; i < len; i++) {
                            binary += String.fromCharCode(bytes[i]);
                        }
                        var sender = new Blob(Array.from(binary));
                        var html_1 = "\n                    <div class=\"chat-message-group local\">\n                        <div class=\"chatmessage-wrapper\">\n                            <div class=\"chatmessage\" >\n                                <div class=\"replywrapper\">\n                                    <div class=\"messagecontent\">\n                                        <div class=\"fileinfo\">\n                                            <a href = \"" + URL.createObjectURL(sender) + "\" download = \"" + _this.file.name + "\" > " + _this.file.name + " (" + snippet_1.getCapacityLabel(_this.file.size) + ") </a>\n                                        </div>\n                                    </div>\n                                </div>\n                             </div >\n                             <div class=\"timestamp\" >" + time + "</div>\n                        </div>\n                    </div>\n                ";
                        $("#chatconversation").append(html_1);
                    }
                });
                readSlice(0);
                return [2 /*return*/];
            });
        });
    };
    FileSender.prototype.removeSelf = function () {
        this.sendingElement.remove();
    };
    return FileSender;
}());
exports.FileSender = FileSender;
//# sourceMappingURL=FileSender.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/file\\FileSender.js","/file")
},{"../util/TimeUtil":53,"../util/snippet":55,"buffer":25,"e/U+97":27}],44:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.JitsiCommandParam = void 0;
var JitsiCommandParam = /** @class */ (function () {
    function JitsiCommandParam() {
        this.attributes = {};
        this.children = [];
    }
    return JitsiCommandParam;
}());
exports.JitsiCommandParam = JitsiCommandParam;
//# sourceMappingURL=JitsiCommandParam.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/jitsi\\JitsiCommandParam.js","/jitsi")
},{"buffer":25,"e/U+97":27}],45:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.JitsiPrivateCommandQueue = exports.JitsiCommandQueue = void 0;
var JitsiCommandCallback = /** @class */ (function () {
    function JitsiCommandCallback() {
    }
    return JitsiCommandCallback;
}());
var JitsiCommandQueue = /** @class */ (function () {
    function JitsiCommandQueue() {
        this.callbacks = new Map();
    }
    JitsiCommandQueue.prototype.reset = function () {
        this.callbacks.clear();
    };
    JitsiCommandQueue.prototype.queueCommand = function (jitsiId, command, param, callback) {
        if (!this.callbacks.has(jitsiId)) {
            this.callbacks.set(jitsiId, []);
        }
        var cb = new JitsiCommandCallback();
        cb.command = command;
        cb.param = param;
        cb.callback = callback;
        this.callbacks.get(jitsiId).push(cb);
    };
    JitsiCommandQueue.prototype.executeQueuedCommands = function (jitsiId) {
        if (!this.callbacks.has(jitsiId))
            return;
        var cbs = this.callbacks.get(jitsiId);
        cbs.forEach(function (cb, index) {
            debugger;
            cb.callback(cb.param);
        });
        this.callbacks.delete(jitsiId);
    };
    return JitsiCommandQueue;
}());
exports.JitsiCommandQueue = JitsiCommandQueue;
var JitsiPrivateCommandCallback = /** @class */ (function () {
    function JitsiPrivateCommandCallback() {
    }
    return JitsiPrivateCommandCallback;
}());
var JitsiPrivateCommandQueue = /** @class */ (function () {
    function JitsiPrivateCommandQueue() {
        this.callbacks = new Map();
    }
    JitsiPrivateCommandQueue.prototype.reset = function () {
        this.callbacks.clear();
    };
    JitsiPrivateCommandQueue.prototype.queueCommand = function (jitsiId, command, message, callback) {
        if (!this.callbacks.has(jitsiId)) {
            this.callbacks.set(jitsiId, []);
        }
        var cb = new JitsiPrivateCommandCallback();
        cb.command = command;
        cb.message = message;
        cb.callback = callback;
        this.callbacks.get(jitsiId).push(cb);
    };
    JitsiPrivateCommandQueue.prototype.executeQueuedCommands = function (jitsiId) {
        if (!this.callbacks.has(jitsiId))
            return;
        var cbs = this.callbacks.get(jitsiId);
        cbs.forEach(function (cb, index) {
            cb.callback(jitsiId, cb.command, cb.message);
        });
        this.callbacks.delete(jitsiId);
    };
    return JitsiPrivateCommandQueue;
}());
exports.JitsiPrivateCommandQueue = JitsiPrivateCommandQueue;
//# sourceMappingURL=JitsiCommandQueue.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/jitsi\\JitsiCommandQueue.js","/jitsi")
},{"buffer":25,"e/U+97":27}],46:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
/****************************************************************
  
          nPanelCount = 4

----------panelContainer--------------

    ---panel---       ---panel---
    |    1     |      |    2    |
    |__________|      |_________|

    ---panel---       ---panel---
    |    3     |      |    4    |
    |__________|      |_________|

-------------------------------------

         Buttons -  audio/videoMute, screenShare, Record, Chat
*****************************************************************/
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingUI = void 0;
var SettingDialog_1 = require("./components/SettingDialog");
var ChattingPanel_1 = require("./components/ChattingPanel");
var ParticipantListPanel_1 = require("./components/ParticipantListPanel");
var NotificationType_1 = require("./enum/NotificationType");
var AskDialog_1 = require("./components/AskDialog");
var ToolBar_1 = require("./components/ToolBar");
var MeetingDescriptionWidget_1 = require("./components/MeetingDescriptionWidget");
var VideoPanelGrid_1 = require("./components/VideoPanelGrid");
var PanelVideoState;
(function (PanelVideoState) {
    PanelVideoState["NoCamera"] = "no-camera";
    PanelVideoState["ScreenShare"] = "screen";
    PanelVideoState["Camera"] = "camera";
    PanelVideoState["VideoStreaming"] = "stream";
})(PanelVideoState || (PanelVideoState = {}));
var MeetingUI = /** @class */ (function () {
    function MeetingUI(meeting) {
        this.meeting = null;
        this.options = {
            hideToolbarOnMouseOut: false,
        };
        this.meeting = meeting;
        //toolbar
        var tProps = new ToolBar_1.ToolBarProps();
        tProps.toggleTileView = this.redrawGrid.bind(this);
        tProps.toggleVideoMute = this.meeting.OnToggleMuteMyVideo.bind(this.meeting);
        tProps.toggleAudioMute = this.meeting.OnToggleMuteMyAudio.bind(this.meeting);
        tProps.openChatting = this.openChatting.bind(this);
        tProps.toggleScreenShare = this.meeting.toggleScreenShare.bind(this.meeting);
        tProps.toggleRecording = this.meeting.toggleRecording.bind(this.meeting);
        tProps.toggleHandRaise = this.meeting.toggleHandRaise.bind(this.meeting);
        tProps.toggleMuteAll = this.meeting.toggleMuteAll.bind(this.meeting);
        tProps.toggleMuteAllVideo = this.meeting.toggleMuteAllVideo.bind(this.meeting);
        tProps.openSetting = this.showSettingDialog.bind(this);
        tProps.leaveMeeting = this.meeting.stop.bind(this.meeting);
        this.toolbar = new ToolBar_1.ToolBar(tProps);
        //chatting
        this.chattingWidget = new ChattingPanel_1.ChattingWidget();
        var props = new ChattingPanel_1.ChattingPanelProps();
        props.openCallback = this.redrawGrid.bind(this);
        props.sendChat = this.meeting.sendChatMessage.bind(this.meeting);
        props.sendPrivateChat = this.meeting.sendPrivateChatMessage.bind(this.meeting);
        props.sendFileMeta = this.meeting.sendFileMeta.bind(this.meeting);
        props.sendFileData = this.meeting.sendFileData.bind(this.meeting);
        props.onFileSendErrror = this.onFileSendError.bind(this);
        props.onFileSendFinished = this.onFileSendFinished.bind(this);
        props.onFileReceiveError = this.onFileReceiveError.bind(this);
        props.onFileReceiveFinished = this.onFileReceiveFinished.bind(this);
        props.showUnreadBadge = this.toolbar.showUnreadBadge.bind(this.toolbar);
        props.setUnreadCount = this.toolbar.setUnreadCount.bind(this.toolbar);
        this.chattingWidget.init(props);
        //list
        this.participantsListWidget = new ParticipantListPanel_1.ParticipantListWidget();
        var lProps = new ParticipantListPanel_1.ParticipantListPanelProps();
        lProps.onMuteCamera = this.meeting.muteUserVideo.bind(this.meeting);
        lProps.onMuteMic = this.meeting.muteUserAudio.bind(this.meeting);
        lProps.toggleCopyJoiningInfo = this.meeting.toggleCopyJoiningInfo.bind(this.meeting);
        this.participantsListWidget.init(lProps);
        //meeting description
        this.meetingDescWidget = new MeetingDescriptionWidget_1.MeetingDescriptionWidget();
        //video grid
        var vProps = new VideoPanelGrid_1.VideoPanelGridProps();
        vProps.grantModeratorRole = this.meeting.grantModeratorRole.bind(this.meeting);
        vProps.kickParticipantOut = this.meeting.kickParticipantOut.bind(this.meeting);
        vProps.sendRemoteControlReply = this.meeting.sendRemoteControlReply.bind(this.meeting);
        vProps.muteMyAudio = this.meeting.muteMyAudio.bind(this.meeting);
        vProps.muteMyVideo = this.meeting.muteMyVideo.bind(this.meeting);
        vProps.muteUserAudio = this.meeting.muteUserAudio.bind(this.meeting);
        vProps.muteUserVideo = this.meeting.muteUserVideo.bind(this.meeting);
        vProps.openPrivateChat = this.chattingWidget.openPrivateChat.bind(this.chattingWidget);
        this.videoPanelGrid = new VideoPanelGrid_1.VideoPanelGrid(vProps);
        this.attachHandlers();
    }
    MeetingUI.prototype.attachHandlers = function () {
        var _this = this;
        $(document).ready(function () {
            //hover effect
            if (_this.options.hideToolbarOnMouseOut) {
                $("#content").hover(function (_) {
                    _this.toolbar.fadeIn();
                    _this.meetingDescWidget.fadeIn();
                }, function (_) {
                    _this.toolbar.fadeOut();
                    _this.meetingDescWidget.fadeOut();
                });
            }
        });
        window.addEventListener('unload', function () {
            _this.meeting.forceStop();
        });
    };
    MeetingUI.prototype.updateByRole = function (isHost) {
        var isWebinar = this.meeting.roomInfo.IsWebinar;
        /*if (isWebinar && !isHost)
            this.showParticipantListButton(false);
        else
            this.showParticipantListButton(true);*/
        //this.participantsListWidget.updateByRole(isHost && this.meeting.roomInfo.IsControlAllowed); //commented by matvey
        this.participantsListWidget.updateByRole(isHost);
    };
    MeetingUI.prototype.updateJoiningInfo = function () {
        this.participantsListWidget.updateJoiningInfo("https://" + window.location.host + "/lobby/" + this.meeting.roomInfo.Id);
    };
    //chattting
    MeetingUI.prototype.openChatting = function (o) {
        if (this.chattingWidget)
            this.chattingWidget.open(o);
    };
    MeetingUI.prototype.redrawGrid = function () {
        if (this.videoPanelGrid)
            this.videoPanelGrid.redrawGrid();
    };
    MeetingUI.prototype.showSettingDialog = function () {
        var settingDialog = new SettingDialog_1.SettingDialog();
        var props = new SettingDialog_1.SettingDialogProps();
        props.curDevices = this.meeting.getActiveDevices();
        props.onDeviceChange = this.meeting.onDeviceChange.bind(this.meeting);
        settingDialog.init(props);
        settingDialog.show();
    };
    //add, remove participant to and from list
    MeetingUI.prototype.addParticipant = function (jitsiId, name, me, isMicDisable, isVideoDisable, muteCamera, muteMic) {
        this.participantsListWidget.addParticipant(jitsiId, name, me, isMicDisable, isVideoDisable, muteCamera, muteMic);
    };
    MeetingUI.prototype.removeParticipant = function (jitsiId) {
        this.participantsListWidget.removeParticipant(jitsiId);
    };
    MeetingUI.prototype.showParticipantListButton = function (show) {
        $("#open-participants-toggle").css("visibility", show ? "visible" : "hidden");
    };
    //file send
    MeetingUI.prototype.onFileSendError = function (filename, message) {
        this.notification_warning(filename, message, NotificationType_1.NotificationType.FileTransfer);
    };
    MeetingUI.prototype.onFileSendFinished = function (filename, message) {
        this.notification(filename, message, NotificationType_1.NotificationType.FileTransfer);
    };
    //file receive
    MeetingUI.prototype.onFileReceiveError = function (filename, message) {
        this.notification_warning(filename, message, NotificationType_1.NotificationType.FileReceive);
    };
    MeetingUI.prototype.onFileReceiveFinished = function (filename, message) {
        this.notification(filename, message, NotificationType_1.NotificationType.FileReceive);
    };
    MeetingUI.prototype.Log = function (message) {
        return;
        if ($("#logPanel").length <= 0) {
            var logPanel = "<div id=\"logPanel\" style=\"position: fixed;width: 300px;height: 100px;background: black;top:0px;left: 0px;\n                                z-index: 100000;border-right: 1px dashed rebeccapurple;border-bottom: 1px dashed rebeccapurple;overflow-y:auto;\"></div>";
            $("body").append(logPanel);
        }
        var colors = ['blanchedalmond', 'hotpink', 'chartreuse', 'coral', 'gold', 'greenyellow', 'violet', 'wheat'];
        var color = colors[Math.floor(Math.random() * 100) % colors.length];
        var messageItm = "<div style=\"color:" + color + ";\"><span>" + message + "</span></div>";
        $("#logPanel").append(messageItm);
        $('#logPanel').scroll();
        $("#logPanel").animate({
            scrollTop: 20000
        }, 200);
    };
    MeetingUI.prototype.askDialog = function (title, message, icon, allowCallback, denyCallback, param) {
        var props = new AskDialog_1.AskDialogProps();
        props.title = title;
        props.message = message;
        props.icon = icon;
        props.isWarning = true;
        props.allowCallback = allowCallback;
        props.denyCallback = denyCallback;
        props.param = param;
        var dlg = new AskDialog_1.AskDialog(props);
        dlg.show();
    };
    MeetingUI.prototype.notification = function (title, message, icon) {
        if (!icon)
            icon = NotificationType_1.NotificationType.Info;
        $.toast({
            heading: title,
            text: message,
            showHideTransition: 'slide',
            hideAfter: 7000,
            bgColor: "#164157",
            icon: icon,
            stack: 5,
            loader: false,
        });
    };
    MeetingUI.prototype.notification_warning = function (title, message, icon) {
        if (!icon)
            icon = NotificationType_1.NotificationType.Warning;
        $.toast({
            heading: title,
            text: message,
            showHideTransition: 'slide',
            hideAfter: 7000,
            bgColor: "#800000",
            icon: icon,
            stack: 5,
            loader: false
        });
    };
    return MeetingUI;
}());
exports.MeetingUI = MeetingUI;
//# sourceMappingURL=meeting_ui.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/meeting_ui.js","/")
},{"./components/AskDialog":28,"./components/ChattingPanel":29,"./components/MeetingDescriptionWidget":30,"./components/ParticipantListPanel":31,"./components/SettingDialog":32,"./components/ToolBar":33,"./components/VideoPanelGrid":35,"./enum/NotificationType":39,"buffer":25,"e/U+97":27}],47:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ActiveDevices = void 0;
var ActiveDevices = /** @class */ (function () {
    function ActiveDevices() {
    }
    return ActiveDevices;
}());
exports.ActiveDevices = ActiveDevices;
//# sourceMappingURL=ActiveDevices.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/model\\ActiveDevices.js","/model")
},{"buffer":25,"e/U+97":27}],48:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BGMeetingInfo = exports.BGMeeting = exports.BGMeetingParticipant = void 0;
/*
callbackUrl: "http://"
conferenceId: 1234
conferenceName: "Building A Bitcoin Crypto application "
isControlAllowed: true | false              // Host can control Audio and Video of Participants
isRecordingRequired: true | false           // Approval required for recording the meeting
isMultipleSharingAllowed: true | false      // Allow multiple participants to screen share
isScreenShareRequired: true | false         // Approval required to present/share the screen
isOpened: true | false                      // Allow external users to join meeting using link
channelType : : "Both |  AudioOnly | VideoOnly"
description: "c# application that works on dotnet framework, and bouncy castle crypto libraries"
duration: "2021-05-18T09:19:57.654Z"
endDateTime: "2021-05-18T09:19:57.654Z"
participants: (2) [{}, {}]
refGuid: "30251003"
startDateTime: "2021-05-18T09:19:57.654Z"
*/
//src/DbModels/Participants.cs
var BGMeetingParticipant = /** @class */ (function () {
    function BGMeetingParticipant() {
    }
    return BGMeetingParticipant;
}());
exports.BGMeetingParticipant = BGMeetingParticipant;
//src/DbModels/Meeting.cs
//comes from api
var BGMeeting = /** @class */ (function () {
    function BGMeeting() {
    }
    return BGMeeting;
}());
exports.BGMeeting = BGMeeting;
//src/Model/LiveMeeting.cs/MeetingInfo
//comes from BGMeeting SignalR Server
var BGMeetingInfo = /** @class */ (function () {
    function BGMeetingInfo() {
    }
    return BGMeetingInfo;
}());
exports.BGMeetingInfo = BGMeetingInfo;
//# sourceMappingURL=BGMeeting.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/model\\BGMeeting.js","/model")
},{"buffer":25,"e/U+97":27}],49:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserInfo = void 0;
var UserInfo = /** @class */ (function () {
    function UserInfo() {
        this.Id = ""; //connectionId
        //BG_Id: string;
        this.Jitsi_Id = "";
        this.Name = "";
        this.IsHost = false;
        this.IsAnonymous = false;
        this.mediaPolicy = { useCamera: false, useMic: false };
    }
    return UserInfo;
}());
exports.UserInfo = UserInfo;
//# sourceMappingURL=BGUser.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/model\\BGUser.js","/model")
},{"buffer":25,"e/U+97":27}],50:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputMediaPolicy = void 0;
var InputMediaPolicy = /** @class */ (function () {
    function InputMediaPolicy() {
    }
    return InputMediaPolicy;
}());
exports.InputMediaPolicy = InputMediaPolicy;
//# sourceMappingURL=InputDevicePolicy.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/model\\InputDevicePolicy.js","/model")
},{"buffer":25,"e/U+97":27}],51:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserToUserViaBG = exports.UserToBG = exports.BGtoUser = void 0;
/**
 * **************************************************************************
 *
 *              should match with /src/Server/Protocol/BGtoUser
 *
 * **************************************************************************
 */
var BGtoUser;
(function (BGtoUser) {
    BGtoUser["ROOM_CREATED"] = "created";
    BGtoUser["ROOM_INFO"] = "room_info";
    BGtoUser["ROOM_JOINED"] = "joined";
    BGtoUser["ROOM_USER_JOINED"] = "user_joined";
    BGtoUser["ROOM_LEFT"] = "left";
    BGtoUser["ERROR"] = "error";
    BGtoUser["SIGNALING"] = "SignalingMessage";
})(BGtoUser = exports.BGtoUser || (exports.BGtoUser = {}));
;
/**
 * **************************************************************************
 *
 *              should match with /src/Server/Protocol/UserToBG
 *
 * **************************************************************************
 */
var UserToBG;
(function (UserToBG) {
})(UserToBG = exports.UserToBG || (exports.UserToBG = {}));
var UserToUserViaBG;
(function (UserToUserViaBG) {
})(UserToUserViaBG = exports.UserToUserViaBG || (exports.UserToUserViaBG = {}));
//# sourceMappingURL=bg.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/protocol\\bg.js","/protocol")
},{"buffer":25,"e/U+97":27}],52:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
/* SHOULD not exist same value in two enums
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.JitsiPrivateCommand = exports.JitsiCommand = void 0;
var JitsiCommand;
(function (JitsiCommand) {
    JitsiCommand["GRANT_HOST_ROLE"] = "grant-host";
    JitsiCommand["MUTE_AUDIO"] = "mute_audio";
    JitsiCommand["MUTE_VIDEO"] = "mute_video";
    JitsiCommand["ALLOW_CAMERA"] = "allow_video";
    JitsiCommand["ALLOW_MIC"] = "allow_audio";
    JitsiCommand["INIT_MEDIA_POLICY"] = "init_media_policy";
    JitsiCommand["ASK_RECORDING"] = "ask-recording";
    JitsiCommand["ASK_SCREENSHARE"] = "ask-screenshare";
    JitsiCommand["ASK_MULTISHARE"] = "ask-multishare";
    JitsiCommand["ASK_HANDRAISE"] = "ask-handraise";
    JitsiCommand["FILE_META"] = "file_meta";
    JitsiCommand["FILE_SLICE"] = "file_slice";
    JitsiCommand["BIZ_ID"] = "biz_id";
    JitsiCommand["KICK_OUT"] = "kick_out";
    JitsiCommand["MUTE_All_AUDIO"] = "mute_all_audio";
    JitsiCommand["MUTE_All_VIDEO"] = "mute_all_video";
})(JitsiCommand = exports.JitsiCommand || (exports.JitsiCommand = {}));
;
var JitsiPrivateCommand;
(function (JitsiPrivateCommand) {
    JitsiPrivateCommand["MEDIA_POLICY"] = "media_policy";
    JitsiPrivateCommand["ALLOW_RECORDING"] = "allow_recording";
    JitsiPrivateCommand["ALLOW_SCREENSHARE"] = "allow_screenshare";
    JitsiPrivateCommand["ALLOW_HANDRAISE"] = "allow_handraise";
    JitsiPrivateCommand["PRIVATE_CAHT"] = "private_chat";
})(JitsiPrivateCommand = exports.JitsiPrivateCommand || (exports.JitsiPrivateCommand = {}));
//# sourceMappingURL=jitsi.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/protocol\\jitsi.js","/protocol")
},{"buffer":25,"e/U+97":27}],53:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCurrentTimestamp = exports.getCurTime = exports.TsToDateFormat = void 0;
function TsToDateFormat(tsInMillisecond) {
    var sec = Math.floor(tsInMillisecond / 1000);
    // Hours part from the timestamp
    var hours = Math.floor(sec / 3600);
    // Minutes part from the timestamp
    var minutes = "0" + (Math.floor(sec / 60) - (hours * 60));
    // Seconds part from the timestamp
    var seconds = "0" + (sec % 60);
    // Will display time in 10:30:23 format
    var formattedTime = ("0" + hours).substr(-2) + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
    return formattedTime;
}
exports.TsToDateFormat = TsToDateFormat;
function getCurTime() {
    var date = new Date();
    var h = date.getHours();
    var m = date.getMinutes();
    var m_2 = ("0" + m).slice(-2);
    var h_2 = ("0" + h).slice(-2);
    var time = h_2 + ":" + m_2;
    return time;
}
exports.getCurTime = getCurTime;
function getCurrentTimestamp() {
    var currentDate = new Date();
    var timestamp = currentDate.getTime();
    return timestamp;
}
exports.getCurrentTimestamp = getCurrentTimestamp;
//# sourceMappingURL=TimeUtil.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/util\\TimeUtil.js","/util")
},{"buffer":25,"e/U+97":27}],54:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.randomSessonId = exports.randomNumber = void 0;
var TimeUtil_1 = require("./TimeUtil");
function randomNumber() {
    return randomFromInterval(1, 100000000);
}
exports.randomNumber = randomNumber;
function randomSessonId() {
    return TimeUtil_1.getCurrentTimestamp() + "-" + randomNumber();
}
exports.randomSessonId = randomSessonId;
function randomFromInterval(from, to) {
    return Math.floor(Math.random() * (to - from + 1) + from);
}
/*interface ProvideFeedbackFormProps {
    feedbackNature: FormikDropdownProps
    waybillNumber: FormikDropdownProps
    provideFeedback: FormikDropdownProps
    editorState?: string
    attachments?: string[]
}


interface FormikDropdownProps {
    id: number
    value: string
}

const values: ProvideFeedbackFormProps = {};
const customFields: string[] = [];

for (const property in values) {
    const customField = values[property as keyof ProvideFeedbackFormProps]
    customFields.push(customField)
}*/ 
//# sourceMappingURL=random.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/util\\random.js","/util")
},{"./TimeUtil":53,"buffer":25,"e/U+97":27}],55:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCapacityLabel = exports.random = exports.avatarName = exports.stripHTMLTags = void 0;
function stripHTMLTags(text) {
    return text.replace(/(<([^>]+)>)/gi, "");
}
exports.stripHTMLTags = stripHTMLTags;
/*
 ajax example
 $.ajax({
        url: "http://localhost/myproject/ajax_url",
        type: "POST",
        data: $("#my-form").serialize(),
        dataType: 'json', // lowercase is always preferered though jQuery does it, too.
        success: function(){}
});
 
 
 */
function avatarName(name) {
    var unknown = "?";
    if (!name || name.length <= 0)
        return unknown;
    var nameParts = name.split(" ");
    var res = "";
    nameParts.forEach(function (p) {
        if (p.length > 0)
            res += p[0];
    });
    if (res.length <= 0)
        unknown;
    return res.toUpperCase().substr(0, 2);
}
exports.avatarName = avatarName;
var random = function (min, max) { return Math.floor(Math.random() * (max - min)) + min; };
exports.random = random;
function getCapacityLabel(bytes) {
    if (bytes < 1024)
        return bytes + " bytes";
    else if (bytes < 1024 * 1024) {
        var kb = bytes / 1024;
        return kb.toFixed(2) + " KB";
    }
    else {
        var mb = bytes / (1024 * 1024);
        return mb.toFixed(2) + " MB";
    }
}
exports.getCapacityLabel = getCapacityLabel;
//# sourceMappingURL=snippet.js.map
}).call(this,require("e/U+97"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/util\\snippet.js","/util")
},{"buffer":25,"e/U+97":27}]},{},[41])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkU6XFxqaXRzaVxcd29yayhyYXpvcilcXGJpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pXFxiaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbFxcdmlkZW9jb25mXFxub2RlX21vZHVsZXNcXGJyb3dzZXItcGFja1xcX3ByZWx1ZGUuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9BYm9ydENvbnRyb2xsZXIuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9EZWZhdWx0SHR0cENsaWVudC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL0RlZmF1bHRSZWNvbm5lY3RQb2xpY3kuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9FcnJvcnMuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9GZXRjaEh0dHBDbGllbnQuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9IYW5kc2hha2VQcm90b2NvbC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL0h0dHBDbGllbnQuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9IdHRwQ29ubmVjdGlvbi5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL0h1YkNvbm5lY3Rpb24uanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9IdWJDb25uZWN0aW9uQnVpbGRlci5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL0lIdWJQcm90b2NvbC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL0lMb2dnZXIuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9JVHJhbnNwb3J0LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L3NpZ25hbHIvZGlzdC9janMvSnNvbkh1YlByb3RvY29sLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L3NpZ25hbHIvZGlzdC9janMvTG9nZ2Vycy5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL0xvbmdQb2xsaW5nVHJhbnNwb3J0LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L3NpZ25hbHIvZGlzdC9janMvU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL1N1YmplY3QuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvbm9kZV9tb2R1bGVzL0BtaWNyb3NvZnQvc2lnbmFsci9kaXN0L2Nqcy9UZXh0TWVzc2FnZUZvcm1hdC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL1V0aWxzLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L3NpZ25hbHIvZGlzdC9janMvV2ViU29ja2V0VHJhbnNwb3J0LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9AbWljcm9zb2Z0L3NpZ25hbHIvZGlzdC9janMvWGhySHR0cENsaWVudC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvQG1pY3Jvc29mdC9zaWduYWxyL2Rpc3QvY2pzL2luZGV4LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9iYXNlNjQtanMvbGliL2I2NC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9ub2RlX21vZHVsZXMvYnVmZmVyL2luZGV4LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9pZWVlNzU0L2luZGV4LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9jb21wb25lbnRzL0Fza0RpYWxvZy5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2NvbXBvbmVudHMvQ2hhdHRpbmdQYW5lbC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2NvbXBvbmVudHMvTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0LmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvY29tcG9uZW50cy9QYXJ0aWNpcGFudExpc3RQYW5lbC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2NvbXBvbmVudHMvU2V0dGluZ0RpYWxvZy5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2NvbXBvbmVudHMvVG9vbEJhci5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2NvbXBvbmVudHMvVmlkZW9QYW5lbC5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2NvbXBvbmVudHMvVmlkZW9QYW5lbEdyaWQuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9jb21wb25lbnRzL3ZlY3Rvcl9pY29uLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvZW51bS9DaGFubmVsVHlwZS5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2VudW0vTWVkaWFUeXBlLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvZW51bS9Ob3RpZmljYXRpb25UeXBlLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvZW51bS9Vc2VyUHJvcGVydHkuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9mYWtlXzg0Y2I1NWNhLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvZmlsZS9GaWxlUmVjZWl2ZXIuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9maWxlL0ZpbGVTZW5kZXIuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9qaXRzaS9KaXRzaUNvbW1hbmRQYXJhbS5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL2ppdHNpL0ppdHNpQ29tbWFuZFF1ZXVlLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvbWVldGluZ191aS5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL21vZGVsL0FjdGl2ZURldmljZXMuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9tb2RlbC9CR01lZXRpbmcuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9tb2RlbC9CR1VzZXIuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC9tb2RlbC9JbnB1dERldmljZVBvbGljeS5qcyIsIkU6L2ppdHNpL3dvcmsocmF6b3IpL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pL2JpemdhemVfbWVldGluZy1tYXN0ZXIobGF0ZXN0LWZyb20tZ3lvbmdib20pX2luX3RyaWFsL3ZpZGVvY29uZi9zY3JpcHRzL2J1aWxkL3Byb3RvY29sL2JnLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvcHJvdG9jb2wvaml0c2kuanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC91dGlsL1RpbWVVdGlsLmpzIiwiRTovaml0c2kvd29yayhyYXpvcikvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSkvYml6Z2F6ZV9tZWV0aW5nLW1hc3RlcihsYXRlc3QtZnJvbS1neW9uZ2JvbSlfaW5fdHJpYWwvdmlkZW9jb25mL3NjcmlwdHMvYnVpbGQvdXRpbC9yYW5kb20uanMiLCJFOi9qaXRzaS93b3JrKHJhem9yKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKS9iaXpnYXplX21lZXRpbmctbWFzdGVyKGxhdGVzdC1mcm9tLWd5b25nYm9tKV9pbl90cmlhbC92aWRlb2NvbmYvc2NyaXB0cy9idWlsZC91dGlsL3NuaXBwZXQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6N0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDektBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdmxDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDelZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqb0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLy8gUm91Z2ggcG9seWZpbGwgb2YgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0Fib3J0Q29udHJvbGxlclxuLy8gV2UgZG9uJ3QgYWN0dWFsbHkgZXZlciB1c2UgdGhlIEFQSSBiZWluZyBwb2x5ZmlsbGVkLCB3ZSBhbHdheXMgdXNlIHRoZSBwb2x5ZmlsbCBiZWNhdXNlXG4vLyBpdCdzIGEgdmVyeSBuZXcgQVBJIHJpZ2h0IG5vdy5cbi8vIE5vdCBleHBvcnRlZCBmcm9tIGluZGV4LlxuLyoqIEBwcml2YXRlICovXG52YXIgQWJvcnRDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFib3J0Q29udHJvbGxlcigpIHtcbiAgICAgICAgdGhpcy5pc0Fib3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbmFib3J0ID0gbnVsbDtcbiAgICB9XG4gICAgQWJvcnRDb250cm9sbGVyLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQWJvcnRlZCkge1xuICAgICAgICAgICAgdGhpcy5pc0Fib3J0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHRoaXMub25hYm9ydCkge1xuICAgICAgICAgICAgICAgIHRoaXMub25hYm9ydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWJvcnRDb250cm9sbGVyLnByb3RvdHlwZSwgXCJzaWduYWxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWJvcnRDb250cm9sbGVyLnByb3RvdHlwZSwgXCJhYm9ydGVkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Fib3J0ZWQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBBYm9ydENvbnRyb2xsZXI7XG59KCkpO1xuZXhwb3J0cy5BYm9ydENvbnRyb2xsZXIgPSBBYm9ydENvbnRyb2xsZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1BYm9ydENvbnRyb2xsZXIuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcQWJvcnRDb250cm9sbGVyLmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEVycm9yc18xID0gcmVxdWlyZShcIi4vRXJyb3JzXCIpO1xudmFyIEZldGNoSHR0cENsaWVudF8xID0gcmVxdWlyZShcIi4vRmV0Y2hIdHRwQ2xpZW50XCIpO1xudmFyIEh0dHBDbGllbnRfMSA9IHJlcXVpcmUoXCIuL0h0dHBDbGllbnRcIik7XG52YXIgVXRpbHNfMSA9IHJlcXVpcmUoXCIuL1V0aWxzXCIpO1xudmFyIFhockh0dHBDbGllbnRfMSA9IHJlcXVpcmUoXCIuL1hockh0dHBDbGllbnRcIik7XG4vKiogRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLkh0dHBDbGllbnR9LiAqL1xudmFyIERlZmF1bHRIdHRwQ2xpZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhEZWZhdWx0SHR0cENsaWVudCwgX3N1cGVyKTtcbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5EZWZhdWx0SHR0cENsaWVudH0sIHVzaW5nIHRoZSBwcm92aWRlZCB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLklMb2dnZXJ9IHRvIGxvZyBtZXNzYWdlcy4gKi9cbiAgICBmdW5jdGlvbiBEZWZhdWx0SHR0cENsaWVudChsb2dnZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgaWYgKHR5cGVvZiBmZXRjaCAhPT0gXCJ1bmRlZmluZWRcIiB8fCBVdGlsc18xLlBsYXRmb3JtLmlzTm9kZSkge1xuICAgICAgICAgICAgX3RoaXMuaHR0cENsaWVudCA9IG5ldyBGZXRjaEh0dHBDbGllbnRfMS5GZXRjaEh0dHBDbGllbnQobG9nZ2VyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgWE1MSHR0cFJlcXVlc3QgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIF90aGlzLmh0dHBDbGllbnQgPSBuZXcgWGhySHR0cENsaWVudF8xLlhockh0dHBDbGllbnQobG9nZ2VyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHVzYWJsZSBIdHRwQ2xpZW50IGZvdW5kLlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIERlZmF1bHRIdHRwQ2xpZW50LnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgLy8gQ2hlY2sgdGhhdCBhYm9ydCB3YXMgbm90IHNpZ25hbGVkIGJlZm9yZSBjYWxsaW5nIHNlbmRcbiAgICAgICAgaWYgKHJlcXVlc3QuYWJvcnRTaWduYWwgJiYgcmVxdWVzdC5hYm9ydFNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yc18xLkFib3J0RXJyb3IoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXF1ZXN0Lm1ldGhvZCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIk5vIG1ldGhvZCBkZWZpbmVkLlwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXF1ZXN0LnVybCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIk5vIHVybCBkZWZpbmVkLlwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5zZW5kKHJlcXVlc3QpO1xuICAgIH07XG4gICAgRGVmYXVsdEh0dHBDbGllbnQucHJvdG90eXBlLmdldENvb2tpZVN0cmluZyA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXRDb29raWVTdHJpbmcodXJsKTtcbiAgICB9O1xuICAgIHJldHVybiBEZWZhdWx0SHR0cENsaWVudDtcbn0oSHR0cENsaWVudF8xLkh0dHBDbGllbnQpKTtcbmV4cG9ydHMuRGVmYXVsdEh0dHBDbGllbnQgPSBEZWZhdWx0SHR0cENsaWVudDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPURlZmF1bHRIdHRwQ2xpZW50LmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXERlZmF1bHRIdHRwQ2xpZW50LmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8vIDAsIDIsIDEwLCAzMCBzZWNvbmQgZGVsYXlzIGJlZm9yZSByZWNvbm5lY3QgYXR0ZW1wdHMuXG52YXIgREVGQVVMVF9SRVRSWV9ERUxBWVNfSU5fTUlMTElTRUNPTkRTID0gWzAsIDIwMDAsIDEwMDAwLCAzMDAwMCwgbnVsbF07XG4vKiogQHByaXZhdGUgKi9cbnZhciBEZWZhdWx0UmVjb25uZWN0UG9saWN5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERlZmF1bHRSZWNvbm5lY3RQb2xpY3kocmV0cnlEZWxheXMpIHtcbiAgICAgICAgdGhpcy5yZXRyeURlbGF5cyA9IHJldHJ5RGVsYXlzICE9PSB1bmRlZmluZWQgPyByZXRyeURlbGF5cy5jb25jYXQoW251bGxdKSA6IERFRkFVTFRfUkVUUllfREVMQVlTX0lOX01JTExJU0VDT05EUztcbiAgICB9XG4gICAgRGVmYXVsdFJlY29ubmVjdFBvbGljeS5wcm90b3R5cGUubmV4dFJldHJ5RGVsYXlJbk1pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uIChyZXRyeUNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmV0cnlEZWxheXNbcmV0cnlDb250ZXh0LnByZXZpb3VzUmV0cnlDb3VudF07XG4gICAgfTtcbiAgICByZXR1cm4gRGVmYXVsdFJlY29ubmVjdFBvbGljeTtcbn0oKSk7XG5leHBvcnRzLkRlZmF1bHRSZWNvbm5lY3RQb2xpY3kgPSBEZWZhdWx0UmVjb25uZWN0UG9saWN5O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGVmYXVsdFJlY29ubmVjdFBvbGljeS5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxEZWZhdWx0UmVjb25uZWN0UG9saWN5LmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLyoqIEVycm9yIHRocm93biB3aGVuIGFuIEhUVFAgcmVxdWVzdCBmYWlscy4gKi9cbnZhciBIdHRwRXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEh0dHBFcnJvciwgX3N1cGVyKTtcbiAgICAvKiogQ29uc3RydWN0cyBhIG5ldyBpbnN0YW5jZSBvZiB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLkh0dHBFcnJvcn0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXJyb3JNZXNzYWdlIEEgZGVzY3JpcHRpdmUgZXJyb3IgbWVzc2FnZS5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gc3RhdHVzQ29kZSBUaGUgSFRUUCBzdGF0dXMgY29kZSByZXByZXNlbnRlZCBieSB0aGlzIGVycm9yLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEh0dHBFcnJvcihlcnJvck1lc3NhZ2UsIHN0YXR1c0NvZGUpIHtcbiAgICAgICAgdmFyIF9uZXdUYXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgdHJ1ZVByb3RvID0gX25ld1RhcmdldC5wcm90b3R5cGU7XG4gICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZXJyb3JNZXNzYWdlKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZTtcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBpc3N1ZSBpbiBUeXBlc2NyaXB0IGNvbXBpbGVyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5NjUjaXNzdWVjb21tZW50LTI3ODU3MDIwMFxuICAgICAgICBfdGhpcy5fX3Byb3RvX18gPSB0cnVlUHJvdG87XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEh0dHBFcnJvcjtcbn0oRXJyb3IpKTtcbmV4cG9ydHMuSHR0cEVycm9yID0gSHR0cEVycm9yO1xuLyoqIEVycm9yIHRocm93biB3aGVuIGEgdGltZW91dCBlbGFwc2VzLiAqL1xudmFyIFRpbWVvdXRFcnJvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGltZW91dEVycm9yLCBfc3VwZXIpO1xuICAgIC8qKiBDb25zdHJ1Y3RzIGEgbmV3IGluc3RhbmNlIG9mIHtAbGluayBAbWljcm9zb2Z0L3NpZ25hbHIuVGltZW91dEVycm9yfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlcnJvck1lc3NhZ2UgQSBkZXNjcmlwdGl2ZSBlcnJvciBtZXNzYWdlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFRpbWVvdXRFcnJvcihlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIF9uZXdUYXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgICAgICBpZiAoZXJyb3JNZXNzYWdlID09PSB2b2lkIDApIHsgZXJyb3JNZXNzYWdlID0gXCJBIHRpbWVvdXQgb2NjdXJyZWQuXCI7IH1cbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHRydWVQcm90byA9IF9uZXdUYXJnZXQucHJvdG90eXBlO1xuICAgICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGVycm9yTWVzc2FnZSkgfHwgdGhpcztcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBpc3N1ZSBpbiBUeXBlc2NyaXB0IGNvbXBpbGVyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTM5NjUjaXNzdWVjb21tZW50LTI3ODU3MDIwMFxuICAgICAgICBfdGhpcy5fX3Byb3RvX18gPSB0cnVlUHJvdG87XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFRpbWVvdXRFcnJvcjtcbn0oRXJyb3IpKTtcbmV4cG9ydHMuVGltZW91dEVycm9yID0gVGltZW91dEVycm9yO1xuLyoqIEVycm9yIHRocm93biB3aGVuIGFuIGFjdGlvbiBpcyBhYm9ydGVkLiAqL1xudmFyIEFib3J0RXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFib3J0RXJyb3IsIF9zdXBlcik7XG4gICAgLyoqIENvbnN0cnVjdHMgYSBuZXcgaW5zdGFuY2Ugb2Yge0BsaW5rIEFib3J0RXJyb3J9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVycm9yTWVzc2FnZSBBIGRlc2NyaXB0aXZlIGVycm9yIG1lc3NhZ2UuXG4gICAgICovXG4gICAgZnVuY3Rpb24gQWJvcnRFcnJvcihlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIF9uZXdUYXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgICAgICBpZiAoZXJyb3JNZXNzYWdlID09PSB2b2lkIDApIHsgZXJyb3JNZXNzYWdlID0gXCJBbiBhYm9ydCBvY2N1cnJlZC5cIjsgfVxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgdHJ1ZVByb3RvID0gX25ld1RhcmdldC5wcm90b3R5cGU7XG4gICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZXJyb3JNZXNzYWdlKSB8fCB0aGlzO1xuICAgICAgICAvLyBXb3JrYXJvdW5kIGlzc3VlIGluIFR5cGVzY3JpcHQgY29tcGlsZXJcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy8xMzk2NSNpc3N1ZWNvbW1lbnQtMjc4NTcwMjAwXG4gICAgICAgIF90aGlzLl9fcHJvdG9fXyA9IHRydWVQcm90bztcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQWJvcnRFcnJvcjtcbn0oRXJyb3IpKTtcbmV4cG9ydHMuQWJvcnRFcnJvciA9IEFib3J0RXJyb3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1FcnJvcnMuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcRXJyb3JzLmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XG4gICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIHMgPSBhcmd1bWVudHNbaV07XG4gICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcbiAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xuICAgIH1cbiAgICByZXR1cm4gdDtcbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7XG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcbiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgXCJ0aHJvd1wiOiB2ZXJiKDEpLCBcInJldHVyblwiOiB2ZXJiKDIpIH0sIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZztcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcbiAgICB9XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEVycm9yc18xID0gcmVxdWlyZShcIi4vRXJyb3JzXCIpO1xudmFyIEh0dHBDbGllbnRfMSA9IHJlcXVpcmUoXCIuL0h0dHBDbGllbnRcIik7XG52YXIgSUxvZ2dlcl8xID0gcmVxdWlyZShcIi4vSUxvZ2dlclwiKTtcbnZhciBVdGlsc18xID0gcmVxdWlyZShcIi4vVXRpbHNcIik7XG52YXIgRmV0Y2hIdHRwQ2xpZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhGZXRjaEh0dHBDbGllbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRmV0Y2hIdHRwQ2xpZW50KGxvZ2dlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgICAgIGlmICh0eXBlb2YgZmV0Y2ggPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIC8vIEluIG9yZGVyIHRvIGlnbm9yZSB0aGUgZHluYW1pYyByZXF1aXJlIGluIHdlYnBhY2sgYnVpbGRzIHdlIG5lZWQgdG8gZG8gdGhpcyBtYWdpY1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZTogVFMgZG9lc24ndCBrbm93IGFib3V0IHRoZXNlIG5hbWVzXG4gICAgICAgICAgICB2YXIgcmVxdWlyZUZ1bmMgPSB0eXBlb2YgX193ZWJwYWNrX3JlcXVpcmVfXyA9PT0gXCJmdW5jdGlvblwiID8gX19ub25fd2VicGFja19yZXF1aXJlX18gOiByZXF1aXJlO1xuICAgICAgICAgICAgLy8gQ29va2llcyBhcmVuJ3QgYXV0b21hdGljYWxseSBoYW5kbGVkIGluIE5vZGUgc28gd2UgbmVlZCB0byBhZGQgYSBDb29raWVKYXIgdG8gcHJlc2VydmUgY29va2llcyBhY3Jvc3MgcmVxdWVzdHNcbiAgICAgICAgICAgIF90aGlzLmphciA9IG5ldyAocmVxdWlyZUZ1bmMoXCJ0b3VnaC1jb29raWVcIikpLkNvb2tpZUphcigpO1xuICAgICAgICAgICAgX3RoaXMuZmV0Y2hUeXBlID0gcmVxdWlyZUZ1bmMoXCJub2RlLWZldGNoXCIpO1xuICAgICAgICAgICAgLy8gbm9kZS1mZXRjaCBkb2Vzbid0IGhhdmUgYSBuaWNlIEFQSSBmb3IgZ2V0dGluZyBhbmQgc2V0dGluZyBjb29raWVzXG4gICAgICAgICAgICAvLyBmZXRjaC1jb29raWUgd2lsbCB3cmFwIGEgZmV0Y2ggaW1wbGVtZW50YXRpb24gd2l0aCBhIGRlZmF1bHQgQ29va2llSmFyIG9yIGEgcHJvdmlkZWQgb25lXG4gICAgICAgICAgICBfdGhpcy5mZXRjaFR5cGUgPSByZXF1aXJlRnVuYyhcImZldGNoLWNvb2tpZVwiKShfdGhpcy5mZXRjaFR5cGUsIF90aGlzLmphcik7XG4gICAgICAgICAgICAvLyBOb2RlIG5lZWRzIEV2ZW50TGlzdGVuZXIgbWV0aG9kcyBvbiBBYm9ydENvbnRyb2xsZXIgd2hpY2ggb3VyIGN1c3RvbSBwb2x5ZmlsbCBkb2Vzbid0IHByb3ZpZGVcbiAgICAgICAgICAgIF90aGlzLmFib3J0Q29udHJvbGxlclR5cGUgPSByZXF1aXJlRnVuYyhcImFib3J0LWNvbnRyb2xsZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBfdGhpcy5mZXRjaFR5cGUgPSBmZXRjaC5iaW5kKHNlbGYpO1xuICAgICAgICAgICAgX3RoaXMuYWJvcnRDb250cm9sbGVyVHlwZSA9IEFib3J0Q29udHJvbGxlcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIEZldGNoSHR0cENsaWVudC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhYm9ydENvbnRyb2xsZXIsIGVycm9yLCB0aW1lb3V0SWQsIG1zVGltZW91dCwgcmVzcG9uc2UsIGVfMSwgY29udGVudCwgcGF5bG9hZDtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayB0aGF0IGFib3J0IHdhcyBub3Qgc2lnbmFsZWQgYmVmb3JlIGNhbGxpbmcgc2VuZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QuYWJvcnRTaWduYWwgJiYgcmVxdWVzdC5hYm9ydFNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yc18xLkFib3J0RXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVxdWVzdC5tZXRob2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBtZXRob2QgZGVmaW5lZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcXVlc3QudXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdXJsIGRlZmluZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IHRoaXMuYWJvcnRDb250cm9sbGVyVHlwZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG9vayBvdXIgYWJvcnRTaWduYWwgaW50byB0aGUgYWJvcnQgY29udHJvbGxlclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3QuYWJvcnRTaWduYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmFib3J0U2lnbmFsLm9uYWJvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlci5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG5ldyBFcnJvcnNfMS5BYm9ydEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRJZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC50aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNUaW1lb3V0ID0gcmVxdWVzdC50aW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydENvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuV2FybmluZywgXCJUaW1lb3V0IGZyb20gSFRUUCByZXF1ZXN0LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBuZXcgRXJyb3JzXzEuVGltZW91dEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgbXNUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCA0LCA1XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmZldGNoVHlwZShyZXF1ZXN0LnVybCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiByZXF1ZXN0LmNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBcIm5vLWNhY2hlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzOiByZXF1ZXN0LndpdGhDcmVkZW50aWFscyA9PT0gdHJ1ZSA/IFwiaW5jbHVkZVwiIDogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBfX2Fzc2lnbih7IFwiQ29udGVudC1UeXBlXCI6IFwidGV4dC9wbGFpbjtjaGFyc2V0PVVURi04XCIsIFwiWC1SZXF1ZXN0ZWQtV2l0aFwiOiBcIlhNTEh0dHBSZXF1ZXN0XCIgfSwgcmVxdWVzdC5oZWFkZXJzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogXCJjb3JzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiBcIm1hbnVhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWw6IGFib3J0Q29udHJvbGxlci5zaWduYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBlXzEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuV2FybmluZywgXCJFcnJvciBmcm9tIEhUVFAgcmVxdWVzdC4gXCIgKyBlXzEgKyBcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlXzE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lb3V0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0LmFib3J0U2lnbmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5hYm9ydFNpZ25hbC5vbmFib3J0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNyAvKmVuZGZpbmFsbHkqL107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3JzXzEuSHR0cEVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQsIHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gZGVzZXJpYWxpemVDb250ZW50KHJlc3BvbnNlLCByZXF1ZXN0LnJlc3BvbnNlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjb250ZW50XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBuZXcgSHR0cENsaWVudF8xLkh0dHBSZXNwb25zZShyZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLnN0YXR1c1RleHQsIHBheWxvYWQpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBGZXRjaEh0dHBDbGllbnQucHJvdG90eXBlLmdldENvb2tpZVN0cmluZyA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgdmFyIGNvb2tpZXMgPSBcIlwiO1xuICAgICAgICBpZiAoVXRpbHNfMS5QbGF0Zm9ybS5pc05vZGUgJiYgdGhpcy5qYXIpIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmU6IHVudXNlZCB2YXJpYWJsZVxuICAgICAgICAgICAgdGhpcy5qYXIuZ2V0Q29va2llcyh1cmwsIGZ1bmN0aW9uIChlLCBjKSB7IHJldHVybiBjb29raWVzID0gYy5qb2luKFwiOyBcIik7IH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb29raWVzO1xuICAgIH07XG4gICAgcmV0dXJuIEZldGNoSHR0cENsaWVudDtcbn0oSHR0cENsaWVudF8xLkh0dHBDbGllbnQpKTtcbmV4cG9ydHMuRmV0Y2hIdHRwQ2xpZW50ID0gRmV0Y2hIdHRwQ2xpZW50O1xuZnVuY3Rpb24gZGVzZXJpYWxpemVDb250ZW50KHJlc3BvbnNlLCByZXNwb25zZVR5cGUpIHtcbiAgICB2YXIgY29udGVudDtcbiAgICBzd2l0Y2ggKHJlc3BvbnNlVHlwZSkge1xuICAgICAgICBjYXNlIFwiYXJyYXlidWZmZXJcIjpcbiAgICAgICAgICAgIGNvbnRlbnQgPSByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICBjb250ZW50ID0gcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJibG9iXCI6XG4gICAgICAgIGNhc2UgXCJkb2N1bWVudFwiOlxuICAgICAgICBjYXNlIFwianNvblwiOlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlVHlwZSArIFwiIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29udGVudCA9IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gY29udGVudDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUZldGNoSHR0cENsaWVudC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxGZXRjaEh0dHBDbGllbnQuanNcIixcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFRleHRNZXNzYWdlRm9ybWF0XzEgPSByZXF1aXJlKFwiLi9UZXh0TWVzc2FnZUZvcm1hdFwiKTtcbnZhciBVdGlsc18xID0gcmVxdWlyZShcIi4vVXRpbHNcIik7XG4vKiogQHByaXZhdGUgKi9cbnZhciBIYW5kc2hha2VQcm90b2NvbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBIYW5kc2hha2VQcm90b2NvbCgpIHtcbiAgICB9XG4gICAgLy8gSGFuZHNoYWtlIHJlcXVlc3QgaXMgYWx3YXlzIEpTT05cbiAgICBIYW5kc2hha2VQcm90b2NvbC5wcm90b3R5cGUud3JpdGVIYW5kc2hha2VSZXF1ZXN0ID0gZnVuY3Rpb24gKGhhbmRzaGFrZVJlcXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIFRleHRNZXNzYWdlRm9ybWF0XzEuVGV4dE1lc3NhZ2VGb3JtYXQud3JpdGUoSlNPTi5zdHJpbmdpZnkoaGFuZHNoYWtlUmVxdWVzdCkpO1xuICAgIH07XG4gICAgSGFuZHNoYWtlUHJvdG9jb2wucHJvdG90eXBlLnBhcnNlSGFuZHNoYWtlUmVzcG9uc2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgcmVzcG9uc2VNZXNzYWdlO1xuICAgICAgICB2YXIgbWVzc2FnZURhdGE7XG4gICAgICAgIHZhciByZW1haW5pbmdEYXRhO1xuICAgICAgICBpZiAoVXRpbHNfMS5pc0FycmF5QnVmZmVyKGRhdGEpIHx8ICh0eXBlb2YgQnVmZmVyICE9PSBcInVuZGVmaW5lZFwiICYmIGRhdGEgaW5zdGFuY2VvZiBCdWZmZXIpKSB7XG4gICAgICAgICAgICAvLyBGb3JtYXQgaXMgYmluYXJ5IGJ1dCBzdGlsbCBuZWVkIHRvIHJlYWQgSlNPTiB0ZXh0IGZyb20gaGFuZHNoYWtlIHJlc3BvbnNlXG4gICAgICAgICAgICB2YXIgYmluYXJ5RGF0YSA9IG5ldyBVaW50OEFycmF5KGRhdGEpO1xuICAgICAgICAgICAgdmFyIHNlcGFyYXRvckluZGV4ID0gYmluYXJ5RGF0YS5pbmRleE9mKFRleHRNZXNzYWdlRm9ybWF0XzEuVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yQ29kZSk7XG4gICAgICAgICAgICBpZiAoc2VwYXJhdG9ySW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWVzc2FnZSBpcyBpbmNvbXBsZXRlLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNvbnRlbnQgYmVmb3JlIHNlcGFyYXRvciBpcyBoYW5kc2hha2UgcmVzcG9uc2VcbiAgICAgICAgICAgIC8vIG9wdGlvbmFsIGNvbnRlbnQgYWZ0ZXIgaXMgYWRkaXRpb25hbCBtZXNzYWdlc1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlTGVuZ3RoID0gc2VwYXJhdG9ySW5kZXggKyAxO1xuICAgICAgICAgICAgbWVzc2FnZURhdGEgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJpbmFyeURhdGEuc2xpY2UoMCwgcmVzcG9uc2VMZW5ndGgpKTtcbiAgICAgICAgICAgIHJlbWFpbmluZ0RhdGEgPSAoYmluYXJ5RGF0YS5ieXRlTGVuZ3RoID4gcmVzcG9uc2VMZW5ndGgpID8gYmluYXJ5RGF0YS5zbGljZShyZXNwb25zZUxlbmd0aCkuYnVmZmVyIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciB0ZXh0RGF0YSA9IGRhdGE7XG4gICAgICAgICAgICB2YXIgc2VwYXJhdG9ySW5kZXggPSB0ZXh0RGF0YS5pbmRleE9mKFRleHRNZXNzYWdlRm9ybWF0XzEuVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yKTtcbiAgICAgICAgICAgIGlmIChzZXBhcmF0b3JJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXNzYWdlIGlzIGluY29tcGxldGUuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY29udGVudCBiZWZvcmUgc2VwYXJhdG9yIGlzIGhhbmRzaGFrZSByZXNwb25zZVxuICAgICAgICAgICAgLy8gb3B0aW9uYWwgY29udGVudCBhZnRlciBpcyBhZGRpdGlvbmFsIG1lc3NhZ2VzXG4gICAgICAgICAgICB2YXIgcmVzcG9uc2VMZW5ndGggPSBzZXBhcmF0b3JJbmRleCArIDE7XG4gICAgICAgICAgICBtZXNzYWdlRGF0YSA9IHRleHREYXRhLnN1YnN0cmluZygwLCByZXNwb25zZUxlbmd0aCk7XG4gICAgICAgICAgICByZW1haW5pbmdEYXRhID0gKHRleHREYXRhLmxlbmd0aCA+IHJlc3BvbnNlTGVuZ3RoKSA/IHRleHREYXRhLnN1YnN0cmluZyhyZXNwb25zZUxlbmd0aCkgOiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIEF0IHRoaXMgcG9pbnQgd2Ugc2hvdWxkIGhhdmUganVzdCB0aGUgc2luZ2xlIGhhbmRzaGFrZSBtZXNzYWdlXG4gICAgICAgIHZhciBtZXNzYWdlcyA9IFRleHRNZXNzYWdlRm9ybWF0XzEuVGV4dE1lc3NhZ2VGb3JtYXQucGFyc2UobWVzc2FnZURhdGEpO1xuICAgICAgICB2YXIgcmVzcG9uc2UgPSBKU09OLnBhcnNlKG1lc3NhZ2VzWzBdKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnR5cGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIGEgaGFuZHNoYWtlIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlci5cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmVzcG9uc2VNZXNzYWdlID0gcmVzcG9uc2U7XG4gICAgICAgIC8vIG11bHRpcGxlIG1lc3NhZ2VzIGNvdWxkIGhhdmUgYXJyaXZlZCB3aXRoIGhhbmRzaGFrZVxuICAgICAgICAvLyByZXR1cm4gYWRkaXRpb25hbCBkYXRhIHRvIGJlIHBhcnNlZCBhcyB1c3VhbCwgb3IgbnVsbCBpZiBhbGwgcGFyc2VkXG4gICAgICAgIHJldHVybiBbcmVtYWluaW5nRGF0YSwgcmVzcG9uc2VNZXNzYWdlXTtcbiAgICB9O1xuICAgIHJldHVybiBIYW5kc2hha2VQcm90b2NvbDtcbn0oKSk7XG5leHBvcnRzLkhhbmRzaGFrZVByb3RvY29sID0gSGFuZHNoYWtlUHJvdG9jb2w7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1IYW5kc2hha2VQcm90b2NvbC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxIYW5kc2hha2VQcm90b2NvbC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcbiAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgfVxuICAgIHJldHVybiB0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8qKiBSZXByZXNlbnRzIGFuIEhUVFAgcmVzcG9uc2UuICovXG52YXIgSHR0cFJlc3BvbnNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEh0dHBSZXNwb25zZShzdGF0dXNDb2RlLCBzdGF0dXNUZXh0LCBjb250ZW50KSB7XG4gICAgICAgIHRoaXMuc3RhdHVzQ29kZSA9IHN0YXR1c0NvZGU7XG4gICAgICAgIHRoaXMuc3RhdHVzVGV4dCA9IHN0YXR1c1RleHQ7XG4gICAgICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgfVxuICAgIHJldHVybiBIdHRwUmVzcG9uc2U7XG59KCkpO1xuZXhwb3J0cy5IdHRwUmVzcG9uc2UgPSBIdHRwUmVzcG9uc2U7XG4vKiogQWJzdHJhY3Rpb24gb3ZlciBhbiBIVFRQIGNsaWVudC5cbiAqXG4gKiBUaGlzIGNsYXNzIHByb3ZpZGVzIGFuIGFic3RyYWN0aW9uIG92ZXIgYW4gSFRUUCBjbGllbnQgc28gdGhhdCBhIGRpZmZlcmVudCBpbXBsZW1lbnRhdGlvbiBjYW4gYmUgcHJvdmlkZWQgb24gZGlmZmVyZW50IHBsYXRmb3Jtcy5cbiAqL1xudmFyIEh0dHBDbGllbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSHR0cENsaWVudCgpIHtcbiAgICB9XG4gICAgSHR0cENsaWVudC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5zZW5kKF9fYXNzaWduKHt9LCBvcHRpb25zLCB7IG1ldGhvZDogXCJHRVRcIiwgdXJsOiB1cmwgfSkpO1xuICAgIH07XG4gICAgSHR0cENsaWVudC5wcm90b3R5cGUucG9zdCA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VuZChfX2Fzc2lnbih7fSwgb3B0aW9ucywgeyBtZXRob2Q6IFwiUE9TVFwiLCB1cmw6IHVybCB9KSk7XG4gICAgfTtcbiAgICBIdHRwQ2xpZW50LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAodXJsLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbmQoX19hc3NpZ24oe30sIG9wdGlvbnMsIHsgbWV0aG9kOiBcIkRFTEVURVwiLCB1cmw6IHVybCB9KSk7XG4gICAgfTtcbiAgICAvKiogR2V0cyBhbGwgY29va2llcyB0aGF0IGFwcGx5IHRvIHRoZSBzcGVjaWZpZWQgVVJMLlxuICAgICAqXG4gICAgICogQHBhcmFtIHVybCBUaGUgVVJMIHRoYXQgdGhlIGNvb2tpZXMgYXJlIHZhbGlkIGZvci5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBBIHN0cmluZyBjb250YWluaW5nIGFsbCB0aGUga2V5LXZhbHVlIGNvb2tpZSBwYWlycyBmb3IgdGhlIHNwZWNpZmllZCBVUkwuXG4gICAgICovXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIEh0dHBDbGllbnQucHJvdG90eXBlLmdldENvb2tpZVN0cmluZyA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfTtcbiAgICByZXR1cm4gSHR0cENsaWVudDtcbn0oKSk7XG5leHBvcnRzLkh0dHBDbGllbnQgPSBIdHRwQ2xpZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SHR0cENsaWVudC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxIdHRwQ2xpZW50LmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xuICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBEZWZhdWx0SHR0cENsaWVudF8xID0gcmVxdWlyZShcIi4vRGVmYXVsdEh0dHBDbGllbnRcIik7XG52YXIgSUxvZ2dlcl8xID0gcmVxdWlyZShcIi4vSUxvZ2dlclwiKTtcbnZhciBJVHJhbnNwb3J0XzEgPSByZXF1aXJlKFwiLi9JVHJhbnNwb3J0XCIpO1xudmFyIExvbmdQb2xsaW5nVHJhbnNwb3J0XzEgPSByZXF1aXJlKFwiLi9Mb25nUG9sbGluZ1RyYW5zcG9ydFwiKTtcbnZhciBTZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0XzEgPSByZXF1aXJlKFwiLi9TZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0XCIpO1xudmFyIFV0aWxzXzEgPSByZXF1aXJlKFwiLi9VdGlsc1wiKTtcbnZhciBXZWJTb2NrZXRUcmFuc3BvcnRfMSA9IHJlcXVpcmUoXCIuL1dlYlNvY2tldFRyYW5zcG9ydFwiKTtcbnZhciBNQVhfUkVESVJFQ1RTID0gMTAwO1xuLyoqIEBwcml2YXRlICovXG52YXIgSHR0cENvbm5lY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSHR0cENvbm5lY3Rpb24odXJsLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgICAgIHRoaXMuZmVhdHVyZXMgPSB7fTtcbiAgICAgICAgdGhpcy5uZWdvdGlhdGVWZXJzaW9uID0gMTtcbiAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZCh1cmwsIFwidXJsXCIpO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IFV0aWxzXzEuY3JlYXRlTG9nZ2VyKG9wdGlvbnMubG9nZ2VyKTtcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gdGhpcy5yZXNvbHZlVXJsKHVybCk7XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICBvcHRpb25zLmxvZ01lc3NhZ2VDb250ZW50ID0gb3B0aW9ucy5sb2dNZXNzYWdlQ29udGVudCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRpb25zLmxvZ01lc3NhZ2VDb250ZW50O1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMud2l0aENyZWRlbnRpYWxzID09PSBcImJvb2xlYW5cIiB8fCBvcHRpb25zLndpdGhDcmVkZW50aWFscyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBvcHRpb25zLndpdGhDcmVkZW50aWFscyA9IG9wdGlvbnMud2l0aENyZWRlbnRpYWxzID09PSB1bmRlZmluZWQgPyB0cnVlIDogb3B0aW9ucy53aXRoQ3JlZGVudGlhbHM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ3aXRoQ3JlZGVudGlhbHMgb3B0aW9uIHdhcyBub3QgYSAnYm9vbGVhbicgb3IgJ3VuZGVmaW5lZCcgdmFsdWVcIik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHdlYlNvY2tldE1vZHVsZSA9IG51bGw7XG4gICAgICAgIHZhciBldmVudFNvdXJjZU1vZHVsZSA9IG51bGw7XG4gICAgICAgIGlmIChVdGlsc18xLlBsYXRmb3JtLmlzTm9kZSAmJiB0eXBlb2YgcmVxdWlyZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgLy8gSW4gb3JkZXIgdG8gaWdub3JlIHRoZSBkeW5hbWljIHJlcXVpcmUgaW4gd2VicGFjayBidWlsZHMgd2UgbmVlZCB0byBkbyB0aGlzIG1hZ2ljXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlOiBUUyBkb2Vzbid0IGtub3cgYWJvdXQgdGhlc2UgbmFtZXNcbiAgICAgICAgICAgIHZhciByZXF1aXJlRnVuYyA9IHR5cGVvZiBfX3dlYnBhY2tfcmVxdWlyZV9fID09PSBcImZ1bmN0aW9uXCIgPyBfX25vbl93ZWJwYWNrX3JlcXVpcmVfXyA6IHJlcXVpcmU7XG4gICAgICAgICAgICB3ZWJTb2NrZXRNb2R1bGUgPSByZXF1aXJlRnVuYyhcIndzXCIpO1xuICAgICAgICAgICAgZXZlbnRTb3VyY2VNb2R1bGUgPSByZXF1aXJlRnVuYyhcImV2ZW50c291cmNlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghVXRpbHNfMS5QbGF0Zm9ybS5pc05vZGUgJiYgdHlwZW9mIFdlYlNvY2tldCAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhb3B0aW9ucy5XZWJTb2NrZXQpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuV2ViU29ja2V0ID0gV2ViU29ja2V0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKFV0aWxzXzEuUGxhdGZvcm0uaXNOb2RlICYmICFvcHRpb25zLldlYlNvY2tldCkge1xuICAgICAgICAgICAgaWYgKHdlYlNvY2tldE1vZHVsZSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuV2ViU29ja2V0ID0gd2ViU29ja2V0TW9kdWxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghVXRpbHNfMS5QbGF0Zm9ybS5pc05vZGUgJiYgdHlwZW9mIEV2ZW50U291cmNlICE9PSBcInVuZGVmaW5lZFwiICYmICFvcHRpb25zLkV2ZW50U291cmNlKSB7XG4gICAgICAgICAgICBvcHRpb25zLkV2ZW50U291cmNlID0gRXZlbnRTb3VyY2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoVXRpbHNfMS5QbGF0Zm9ybS5pc05vZGUgJiYgIW9wdGlvbnMuRXZlbnRTb3VyY2UpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnRTb3VyY2VNb2R1bGUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLkV2ZW50U291cmNlID0gZXZlbnRTb3VyY2VNb2R1bGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5odHRwQ2xpZW50ID0gb3B0aW9ucy5odHRwQ2xpZW50IHx8IG5ldyBEZWZhdWx0SHR0cENsaWVudF8xLkRlZmF1bHRIdHRwQ2xpZW50KHRoaXMubG9nZ2VyKTtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBcIkRpc2Nvbm5lY3RlZFwiIC8qIERpc2Nvbm5lY3RlZCAqLztcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLm9ucmVjZWl2ZSA9IG51bGw7XG4gICAgICAgIHRoaXMub25jbG9zZSA9IG51bGw7XG4gICAgfVxuICAgIEh0dHBDb25uZWN0aW9uLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICh0cmFuc2ZlckZvcm1hdCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSwgbWVzc2FnZTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZmVyRm9ybWF0ID0gdHJhbnNmZXJGb3JtYXQgfHwgSVRyYW5zcG9ydF8xLlRyYW5zZmVyRm9ybWF0LkJpbmFyeTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzXzEuQXJnLmlzSW4odHJhbnNmZXJGb3JtYXQsIElUcmFuc3BvcnRfMS5UcmFuc2ZlckZvcm1hdCwgXCJ0cmFuc2ZlckZvcm1hdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiU3RhcnRpbmcgY29ubmVjdGlvbiB3aXRoIHRyYW5zZmVyIGZvcm1hdCAnXCIgKyBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXRbdHJhbnNmZXJGb3JtYXRdICsgXCInLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gXCJEaXNjb25uZWN0ZWRcIiAvKiBEaXNjb25uZWN0ZWQgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGFuIEh0dHBDb25uZWN0aW9uIHRoYXQgaXMgbm90IGluIHRoZSAnRGlzY29ubmVjdGVkJyBzdGF0ZS5cIikpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gXCJDb25uZWN0aW5nXCIgLyogQ29ubmVjdGluZyAqLztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRJbnRlcm5hbFByb21pc2UgPSB0aGlzLnN0YXJ0SW50ZXJuYWwodHJhbnNmZXJGb3JtYXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdGFydEludGVybmFsUHJvbWlzZV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHRoaXMuY29ubmVjdGlvblN0YXRlID09PSBcIkRpc2Nvbm5lY3RpbmdcIiAvKiBEaXNjb25uZWN0aW5nICovKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJGYWlsZWQgdG8gc3RhcnQgdGhlIEh0dHBDb25uZWN0aW9uIGJlZm9yZSBzdG9wKCkgd2FzIGNhbGxlZC5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgY2Fubm90IGF3YWl0IHN0b3BQcm9taXNlIGluc2lkZSBzdGFydEludGVybmFsIHNpbmNlIHN0b3BJbnRlcm5hbCBhd2FpdHMgdGhlIHN0YXJ0SW50ZXJuYWxQcm9taXNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdG9wUHJvbWlzZV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGNhbm5vdCBhd2FpdCBzdG9wUHJvbWlzZSBpbnNpZGUgc3RhcnRJbnRlcm5hbCBzaW5jZSBzdG9wSW50ZXJuYWwgYXdhaXRzIHRoZSBzdGFydEludGVybmFsUHJvbWlzZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IobWVzc2FnZSkpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXRlICE9PSBcIkNvbm5lY3RlZFwiIC8qIENvbm5lY3RlZCAqLykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBcIkh0dHBDb25uZWN0aW9uLnN0YXJ0SW50ZXJuYWwgY29tcGxldGVkIGdyYWNlZnVsbHkgYnV0IGRpZG4ndCBlbnRlciB0aGUgY29ubmVjdGlvbiBpbnRvIHRoZSBjb25uZWN0ZWQgc3RhdGUhXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5FcnJvciwgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihtZXNzYWdlKSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA0O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBIdHRwQ29ubmVjdGlvbi5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gXCJDb25uZWN0ZWRcIiAvKiBDb25uZWN0ZWQgKi8pIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJDYW5ub3Qgc2VuZCBkYXRhIGlmIHRoZSBjb25uZWN0aW9uIGlzIG5vdCBpbiB0aGUgJ0Nvbm5lY3RlZCcgU3RhdGUuXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuc2VuZFF1ZXVlKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRRdWV1ZSA9IG5ldyBUcmFuc3BvcnRTZW5kUXVldWUodGhpcy50cmFuc3BvcnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRyYW5zcG9ydCB3aWxsIG5vdCBiZSBudWxsIGlmIHN0YXRlIGlzIGNvbm5lY3RlZFxuICAgICAgICByZXR1cm4gdGhpcy5zZW5kUXVldWUuc2VuZChkYXRhKTtcbiAgICB9O1xuICAgIEh0dHBDb25uZWN0aW9uLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhdGUgPT09IFwiRGlzY29ubmVjdGVkXCIgLyogRGlzY29ubmVjdGVkICovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJDYWxsIHRvIEh0dHBDb25uZWN0aW9uLnN0b3AoXCIgKyBlcnJvciArIFwiKSBpZ25vcmVkIGJlY2F1c2UgdGhlIGNvbm5lY3Rpb24gaXMgYWxyZWFkeSBpbiB0aGUgZGlzY29ubmVjdGVkIHN0YXRlLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgUHJvbWlzZS5yZXNvbHZlKCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXRlID09PSBcIkRpc2Nvbm5lY3RpbmdcIiAvKiBEaXNjb25uZWN0aW5nICovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJDYWxsIHRvIEh0dHBDb25uZWN0aW9uLnN0b3AoXCIgKyBlcnJvciArIFwiKSBpZ25vcmVkIGJlY2F1c2UgdGhlIGNvbm5lY3Rpb24gaXMgYWxyZWFkeSBpbiB0aGUgZGlzY29ubmVjdGluZyBzdGF0ZS5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuc3RvcFByb21pc2VdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBcIkRpc2Nvbm5lY3RpbmdcIiAvKiBEaXNjb25uZWN0aW5nICovO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wUHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgY29tcGxldGUgc3RvcCgpIHVudGlsIHN0b3BDb25uZWN0aW9uKCkgY29tcGxldGVzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnN0b3BQcm9taXNlUmVzb2x2ZXIgPSByZXNvbHZlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9wSW50ZXJuYWwgc2hvdWxkIG5ldmVyIHRocm93IHNvIGp1c3Qgb2JzZXJ2ZSBpdC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc3RvcEludGVybmFsKGVycm9yKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3BJbnRlcm5hbCBzaG91bGQgbmV2ZXIgdGhyb3cgc28ganVzdCBvYnNlcnZlIGl0LlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdG9wUHJvbWlzZV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBIdHRwQ29ubmVjdGlvbi5wcm90b3R5cGUuc3RvcEludGVybmFsID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBlXzEsIGVfMjtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBlcnJvciBhcyBzb29uIGFzIHBvc3NpYmxlIG90aGVyd2lzZSB0aGVyZSBpcyBhIHJhY2UgYmV0d2VlblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHRyYW5zcG9ydCBjbG9zaW5nIGFuZCBwcm92aWRpbmcgYW4gZXJyb3IgYW5kIHRoZSBlcnJvciBmcm9tIGEgY2xvc2UgbWVzc2FnZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugd291bGQgcHJlZmVyIHRoZSBjbG9zZSBtZXNzYWdlIGVycm9yLlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wRXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc3RhcnRJbnRlcm5hbFByb21pc2VdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgZV8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy50cmFuc3BvcnQpIHJldHVybiBbMyAvKmJyZWFrKi8sIDldO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA1O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzUsIDcsICwgOF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy50cmFuc3BvcnQuc3RvcCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgOF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfMiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiSHR0cENvbm5lY3Rpb24udHJhbnNwb3J0LnN0b3AoKSB0aHJldyBlcnJvciAnXCIgKyBlXzIgKyBcIicuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wQ29ubmVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgOF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgMTBdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIkh0dHBDb25uZWN0aW9uLnRyYW5zcG9ydCBpcyB1bmRlZmluZWQgaW4gSHR0cENvbm5lY3Rpb24uc3RvcCgpIGJlY2F1c2Ugc3RhcnQoKSBmYWlsZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wQ29ubmVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEh0dHBDb25uZWN0aW9uLnByb3RvdHlwZS5zdGFydEludGVybmFsID0gZnVuY3Rpb24gKHRyYW5zZmVyRm9ybWF0KSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1cmwsIG5lZ290aWF0ZVJlc3BvbnNlLCByZWRpcmVjdHMsIF9sb29wXzEsIHRoaXNfMSwgZV8zO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdGhpcy5iYXNlVXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkgPSB0aGlzLm9wdGlvbnMuYWNjZXNzVG9rZW5GYWN0b3J5O1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzEsIDEyLCAsIDEzXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5za2lwTmVnb3RpYXRpb24pIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy5vcHRpb25zLnRyYW5zcG9ydCA9PT0gSVRyYW5zcG9ydF8xLkh0dHBUcmFuc3BvcnRUeXBlLldlYlNvY2tldHMpKSByZXR1cm4gWzMgLypicmVhayovLCAzXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIG5lZWQgdG8gYWRkIGEgY29ubmVjdGlvbiBJRCBpbiB0aGlzIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdGhpcy5jb25zdHJ1Y3RUcmFuc3BvcnQoSVRyYW5zcG9ydF8xLkh0dHBUcmFuc3BvcnRUeXBlLldlYlNvY2tldHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIGp1c3QgY2FsbCBjb25uZWN0IGRpcmVjdGx5IGluIHRoaXMgY2FzZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIGZhbGxiYWNrIG9yIG5lZ290aWF0ZSBpbiB0aGlzIGNhc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnN0YXJ0VHJhbnNwb3J0KHVybCwgdHJhbnNmZXJGb3JtYXQpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIGp1c3QgY2FsbCBjb25uZWN0IGRpcmVjdGx5IGluIHRoaXMgY2FzZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIGZhbGxiYWNrIG9yIG5lZ290aWF0ZSBpbiB0aGlzIGNhc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiB0aHJvdyBuZXcgRXJyb3IoXCJOZWdvdGlhdGlvbiBjYW4gb25seSBiZSBza2lwcGVkIHdoZW4gdXNpbmcgdGhlIFdlYlNvY2tldCB0cmFuc3BvcnQgZGlyZWN0bHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6IHJldHVybiBbMyAvKmJyZWFrKi8sIDExXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgbmVnb3RpYXRlUmVzcG9uc2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RzID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9sb29wXzEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjY2Vzc1Rva2VuXzE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXNfMS5nZXROZWdvdGlhdGlvblJlc3BvbnNlKHVybCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0ZVJlc3BvbnNlID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSB1c2VyIHRyaWVzIHRvIHN0b3AgdGhlIGNvbm5lY3Rpb24gd2hlbiBpdCBpcyBiZWluZyBzdGFydGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNfMS5jb25uZWN0aW9uU3RhdGUgPT09IFwiRGlzY29ubmVjdGluZ1wiIC8qIERpc2Nvbm5lY3RpbmcgKi8gfHwgdGhpc18xLmNvbm5lY3Rpb25TdGF0ZSA9PT0gXCJEaXNjb25uZWN0ZWRcIiAvKiBEaXNjb25uZWN0ZWQgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGNvbm5lY3Rpb24gd2FzIHN0b3BwZWQgZHVyaW5nIG5lZ290aWF0aW9uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5lZ290aWF0ZVJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuZWdvdGlhdGVSZXNwb25zZS5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWdvdGlhdGVSZXNwb25zZS5Qcm90b2NvbFZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGV0ZWN0ZWQgYSBjb25uZWN0aW9uIGF0dGVtcHQgdG8gYW4gQVNQLk5FVCBTaWduYWxSIFNlcnZlci4gVGhpcyBjbGllbnQgb25seSBzdXBwb3J0cyBjb25uZWN0aW5nIHRvIGFuIEFTUC5ORVQgQ29yZSBTaWduYWxSIFNlcnZlci4gU2VlIGh0dHBzOi8vYWthLm1zL3NpZ25hbHItY29yZS1kaWZmZXJlbmNlcyBmb3IgZGV0YWlscy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWdvdGlhdGVSZXNwb25zZS51cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gbmVnb3RpYXRlUmVzcG9uc2UudXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVnb3RpYXRlUmVzcG9uc2UuYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW5fMSA9IG5lZ290aWF0ZVJlc3BvbnNlLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzXzEuYWNjZXNzVG9rZW5GYWN0b3J5ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gYWNjZXNzVG9rZW5fMTsgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RzKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc18xID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gNjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzUgLyp5aWVsZCoqLywgX2xvb3BfMSgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA4O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmVnb3RpYXRlUmVzcG9uc2UudXJsICYmIHJlZGlyZWN0cyA8IE1BWF9SRURJUkVDVFMpIHJldHVybiBbMyAvKmJyZWFrKi8sIDZdO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA5O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVkaXJlY3RzID09PSBNQVhfUkVESVJFQ1RTICYmIG5lZ290aWF0ZVJlc3BvbnNlLnVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5lZ290aWF0ZSByZWRpcmVjdGlvbiBsaW1pdCBleGNlZWRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmNyZWF0ZVRyYW5zcG9ydCh1cmwsIHRoaXMub3B0aW9ucy50cmFuc3BvcnQsIG5lZ290aWF0ZVJlc3BvbnNlLCB0cmFuc2ZlckZvcm1hdCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydCBpbnN0YW5jZW9mIExvbmdQb2xsaW5nVHJhbnNwb3J0XzEuTG9uZ1BvbGxpbmdUcmFuc3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZlYXR1cmVzLmluaGVyZW50S2VlcEFsaXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9PT0gXCJDb25uZWN0aW5nXCIgLyogQ29ubmVjdGluZyAqLykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUgY29ubmVjdGlvbiB0cmFuc2l0aW9ucyB0byB0aGUgY29ubmVjdGVkIHN0YXRlIHByaW9yIHRvIGNvbXBsZXRpbmcgdGhpcy5zdGFydEludGVybmFsUHJvbWlzZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydCgpIHdpbGwgaGFuZGxlIHRoZSBjYXNlIHdoZW4gc3RvcCB3YXMgY2FsbGVkIGFuZCBzdGFydEludGVybmFsIGV4aXRzIHN0aWxsIGluIHRoZSBkaXNjb25uZWN0aW5nIHN0YXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiVGhlIEh0dHBDb25uZWN0aW9uIGNvbm5lY3RlZCBzdWNjZXNzZnVsbHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gXCJDb25uZWN0ZWRcIiAvKiBDb25uZWN0ZWQgKi87XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAxM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6XG4gICAgICAgICAgICAgICAgICAgICAgICBlXzMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLCBcIkZhaWxlZCB0byBzdGFydCB0aGUgY29ubmVjdGlvbjogXCIgKyBlXzMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBcIkRpc2Nvbm5lY3RlZFwiIC8qIERpc2Nvbm5lY3RlZCAqLztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFByb21pc2UucmVqZWN0KGVfMyldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgSHR0cENvbm5lY3Rpb24ucHJvdG90eXBlLmdldE5lZ290aWF0aW9uUmVzcG9uc2UgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXJzLCB0b2tlbiwgX2EsIG5hbWUsIHZhbHVlLCBuZWdvdGlhdGVVcmwsIHJlc3BvbnNlLCBuZWdvdGlhdGVSZXNwb25zZSwgZV80O1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2IubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IFwiQmVhcmVyIFwiICsgdG9rZW47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5sYWJlbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hID0gVXRpbHNfMS5nZXRVc2VyQWdlbnRIZWFkZXIoKSwgbmFtZSA9IF9hWzBdLCB2YWx1ZSA9IF9hWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmVnb3RpYXRlVXJsID0gdGhpcy5yZXNvbHZlTmVnb3RpYXRlVXJsKHVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIlNlbmRpbmcgbmVnb3RpYXRpb24gcmVxdWVzdDogXCIgKyBuZWdvdGlhdGVVcmwgKyBcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5sYWJlbCA9IDM7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iLnRyeXMucHVzaChbMywgNSwgLCA2XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmh0dHBDbGllbnQucG9zdChuZWdvdGlhdGVVcmwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogX19hc3NpZ24oe30sIGhlYWRlcnMsIHRoaXMub3B0aW9ucy5oZWFkZXJzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLm9wdGlvbnMud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgc3RhdHVzIGNvZGUgcmV0dXJuZWQgZnJvbSBuZWdvdGlhdGUgJ1wiICsgcmVzcG9uc2Uuc3RhdHVzQ29kZSArIFwiJ1wiKSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbmVnb3RpYXRlUmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuZWdvdGlhdGVSZXNwb25zZS5uZWdvdGlhdGVWZXJzaW9uIHx8IG5lZ290aWF0ZVJlc3BvbnNlLm5lZ290aWF0ZVZlcnNpb24gPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmVnb3RpYXRlIHZlcnNpb24gMCBkb2Vzbid0IHVzZSBjb25uZWN0aW9uVG9rZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTbyB3ZSBzZXQgaXQgZXF1YWwgdG8gY29ubmVjdGlvbklkIHNvIGFsbCBvdXIgbG9naWMgY2FuIHVzZSBjb25uZWN0aW9uVG9rZW4gd2l0aG91dCBiZWluZyBhd2FyZSBvZiB0aGUgbmVnb3RpYXRlIHZlcnNpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWdvdGlhdGVSZXNwb25zZS5jb25uZWN0aW9uVG9rZW4gPSBuZWdvdGlhdGVSZXNwb25zZS5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbmVnb3RpYXRlUmVzcG9uc2VdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBlXzQgPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLCBcIkZhaWxlZCB0byBjb21wbGV0ZSBuZWdvdGlhdGlvbiB3aXRoIHRoZSBzZXJ2ZXI6IFwiICsgZV80KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdChlXzQpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgSHR0cENvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZUNvbm5lY3RVcmwgPSBmdW5jdGlvbiAodXJsLCBjb25uZWN0aW9uVG9rZW4pIHtcbiAgICAgICAgaWYgKCFjb25uZWN0aW9uVG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVybCArICh1cmwuaW5kZXhPZihcIj9cIikgPT09IC0xID8gXCI/XCIgOiBcIiZcIikgKyAoXCJpZD1cIiArIGNvbm5lY3Rpb25Ub2tlbik7XG4gICAgfTtcbiAgICBIdHRwQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlVHJhbnNwb3J0ID0gZnVuY3Rpb24gKHVybCwgcmVxdWVzdGVkVHJhbnNwb3J0LCBuZWdvdGlhdGVSZXNwb25zZSwgcmVxdWVzdGVkVHJhbnNmZXJGb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbm5lY3RVcmwsIHRyYW5zcG9ydEV4Y2VwdGlvbnMsIHRyYW5zcG9ydHMsIG5lZ290aWF0ZSwgX2ksIHRyYW5zcG9ydHNfMSwgZW5kcG9pbnQsIHRyYW5zcG9ydE9yRXJyb3IsIGV4XzEsIGV4XzIsIG1lc3NhZ2U7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0VXJsID0gdGhpcy5jcmVhdGVDb25uZWN0VXJsKHVybCwgbmVnb3RpYXRlUmVzcG9uc2UuY29ubmVjdGlvblRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0lUcmFuc3BvcnQocmVxdWVzdGVkVHJhbnNwb3J0KSkgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIkNvbm5lY3Rpb24gd2FzIHByb3ZpZGVkIGFuIGluc3RhbmNlIG9mIElUcmFuc3BvcnQsIHVzaW5nIHRoYXQgZGlyZWN0bHkuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSByZXF1ZXN0ZWRUcmFuc3BvcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnN0YXJ0VHJhbnNwb3J0KGNvbm5lY3RVcmwsIHJlcXVlc3RlZFRyYW5zZmVyRm9ybWF0KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gbmVnb3RpYXRlUmVzcG9uc2UuY29ubmVjdGlvbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnRFeGNlcHRpb25zID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnRzID0gbmVnb3RpYXRlUmVzcG9uc2UuYXZhaWxhYmxlVHJhbnNwb3J0cyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0ZSA9IG5lZ290aWF0ZVJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2kgPSAwLCB0cmFuc3BvcnRzXzEgPSB0cmFuc3BvcnRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAzO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShfaSA8IHRyYW5zcG9ydHNfMS5sZW5ndGgpKSByZXR1cm4gWzMgLypicmVhayovLCAxM107XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludCA9IHRyYW5zcG9ydHNfMVtfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnRPckVycm9yID0gdGhpcy5yZXNvbHZlVHJhbnNwb3J0T3JFcnJvcihlbmRwb2ludCwgcmVxdWVzdGVkVHJhbnNwb3J0LCByZXF1ZXN0ZWRUcmFuc2ZlckZvcm1hdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh0cmFuc3BvcnRPckVycm9yIGluc3RhbmNlb2YgRXJyb3IpKSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBlcnJvciBhbmQgY29udGludWUsIHdlIGRvbid0IHdhbnQgdG8gY2F1c2UgYSByZS1uZWdvdGlhdGUgaW4gdGhlc2UgY2FzZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydEV4Y2VwdGlvbnMucHVzaChlbmRwb2ludC50cmFuc3BvcnQgKyBcIiBmYWlsZWQ6IFwiICsgdHJhbnNwb3J0T3JFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAxMl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0lUcmFuc3BvcnQodHJhbnNwb3J0T3JFcnJvcikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDEyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdHJhbnNwb3J0T3JFcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIW5lZ290aWF0ZSkgcmV0dXJuIFszIC8qYnJlYWsqLywgOV07XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDU7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbNSwgNywgLCA4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmdldE5lZ290aWF0aW9uUmVzcG9uc2UodXJsKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0ZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDhdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICAgICAgICBleF8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFByb21pc2UucmVqZWN0KGV4XzEpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdFVybCA9IHRoaXMuY3JlYXRlQ29ubmVjdFVybCh1cmwsIG5lZ290aWF0ZS5jb25uZWN0aW9uVG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA5O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzksIDExLCAsIDEyXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnN0YXJ0VHJhbnNwb3J0KGNvbm5lY3RVcmwsIHJlcXVlc3RlZFRyYW5zZmVyRm9ybWF0KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25JZCA9IG5lZ290aWF0ZS5jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgICAgICAgICAgICBleF8yID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5FcnJvciwgXCJGYWlsZWQgdG8gc3RhcnQgdGhlIHRyYW5zcG9ydCAnXCIgKyBlbmRwb2ludC50cmFuc3BvcnQgKyBcIic6IFwiICsgZXhfMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZWdvdGlhdGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnRFeGNlcHRpb25zLnB1c2goZW5kcG9pbnQudHJhbnNwb3J0ICsgXCIgZmFpbGVkOiBcIiArIGV4XzIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXRlICE9PSBcIkNvbm5lY3RpbmdcIiAvKiBDb25uZWN0aW5nICovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiRmFpbGVkIHRvIHNlbGVjdCB0cmFuc3BvcnQgYmVmb3JlIHN0b3AoKSB3YXMgY2FsbGVkLlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IobWVzc2FnZSkpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDEyXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pKys7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAzXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc3BvcnRFeGNlcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIHNlcnZlciB3aXRoIGFueSBvZiB0aGUgYXZhaWxhYmxlIHRyYW5zcG9ydHMuIFwiICsgdHJhbnNwb3J0RXhjZXB0aW9ucy5qb2luKFwiIFwiKSkpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJOb25lIG9mIHRoZSB0cmFuc3BvcnRzIHN1cHBvcnRlZCBieSB0aGUgY2xpZW50IGFyZSBzdXBwb3J0ZWQgYnkgdGhlIHNlcnZlci5cIikpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBIdHRwQ29ubmVjdGlvbi5wcm90b3R5cGUuY29uc3RydWN0VHJhbnNwb3J0ID0gZnVuY3Rpb24gKHRyYW5zcG9ydCkge1xuICAgICAgICBzd2l0Y2ggKHRyYW5zcG9ydCkge1xuICAgICAgICAgICAgY2FzZSBJVHJhbnNwb3J0XzEuSHR0cFRyYW5zcG9ydFR5cGUuV2ViU29ja2V0czpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5XZWJTb2NrZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ1dlYlNvY2tldCcgaXMgbm90IHN1cHBvcnRlZCBpbiB5b3VyIGVudmlyb25tZW50LlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBXZWJTb2NrZXRUcmFuc3BvcnRfMS5XZWJTb2NrZXRUcmFuc3BvcnQodGhpcy5odHRwQ2xpZW50LCB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSwgdGhpcy5sb2dnZXIsIHRoaXMub3B0aW9ucy5sb2dNZXNzYWdlQ29udGVudCB8fCBmYWxzZSwgdGhpcy5vcHRpb25zLldlYlNvY2tldCwgdGhpcy5vcHRpb25zLmhlYWRlcnMgfHwge30pO1xuICAgICAgICAgICAgY2FzZSBJVHJhbnNwb3J0XzEuSHR0cFRyYW5zcG9ydFR5cGUuU2VydmVyU2VudEV2ZW50czpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5FdmVudFNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCInRXZlbnRTb3VyY2UnIGlzIG5vdCBzdXBwb3J0ZWQgaW4geW91ciBlbnZpcm9ubWVudC5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydF8xLlNlcnZlclNlbnRFdmVudHNUcmFuc3BvcnQodGhpcy5odHRwQ2xpZW50LCB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSwgdGhpcy5sb2dnZXIsIHRoaXMub3B0aW9ucy5sb2dNZXNzYWdlQ29udGVudCB8fCBmYWxzZSwgdGhpcy5vcHRpb25zLkV2ZW50U291cmNlLCB0aGlzLm9wdGlvbnMud2l0aENyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMuaGVhZGVycyB8fCB7fSk7XG4gICAgICAgICAgICBjYXNlIElUcmFuc3BvcnRfMS5IdHRwVHJhbnNwb3J0VHlwZS5Mb25nUG9sbGluZzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvbmdQb2xsaW5nVHJhbnNwb3J0XzEuTG9uZ1BvbGxpbmdUcmFuc3BvcnQodGhpcy5odHRwQ2xpZW50LCB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSwgdGhpcy5sb2dnZXIsIHRoaXMub3B0aW9ucy5sb2dNZXNzYWdlQ29udGVudCB8fCBmYWxzZSwgdGhpcy5vcHRpb25zLndpdGhDcmVkZW50aWFscywgdGhpcy5vcHRpb25zLmhlYWRlcnMgfHwge30pO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIHRyYW5zcG9ydDogXCIgKyB0cmFuc3BvcnQgKyBcIi5cIik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEh0dHBDb25uZWN0aW9uLnByb3RvdHlwZS5zdGFydFRyYW5zcG9ydCA9IGZ1bmN0aW9uICh1cmwsIHRyYW5zZmVyRm9ybWF0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0Lm9ucmVjZWl2ZSA9IHRoaXMub25yZWNlaXZlO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydC5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLnN0b3BDb25uZWN0aW9uKGUpOyB9O1xuICAgICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuY29ubmVjdCh1cmwsIHRyYW5zZmVyRm9ybWF0KTtcbiAgICB9O1xuICAgIEh0dHBDb25uZWN0aW9uLnByb3RvdHlwZS5yZXNvbHZlVHJhbnNwb3J0T3JFcnJvciA9IGZ1bmN0aW9uIChlbmRwb2ludCwgcmVxdWVzdGVkVHJhbnNwb3J0LCByZXF1ZXN0ZWRUcmFuc2ZlckZvcm1hdCkge1xuICAgICAgICB2YXIgdHJhbnNwb3J0ID0gSVRyYW5zcG9ydF8xLkh0dHBUcmFuc3BvcnRUeXBlW2VuZHBvaW50LnRyYW5zcG9ydF07XG4gICAgICAgIGlmICh0cmFuc3BvcnQgPT09IG51bGwgfHwgdHJhbnNwb3J0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiU2tpcHBpbmcgdHJhbnNwb3J0ICdcIiArIGVuZHBvaW50LnRyYW5zcG9ydCArIFwiJyBiZWNhdXNlIGl0IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBjbGllbnQuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBFcnJvcihcIlNraXBwaW5nIHRyYW5zcG9ydCAnXCIgKyBlbmRwb2ludC50cmFuc3BvcnQgKyBcIicgYmVjYXVzZSBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgY2xpZW50LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0cmFuc3BvcnRNYXRjaGVzKHJlcXVlc3RlZFRyYW5zcG9ydCwgdHJhbnNwb3J0KSkge1xuICAgICAgICAgICAgICAgIHZhciB0cmFuc2ZlckZvcm1hdHMgPSBlbmRwb2ludC50cmFuc2ZlckZvcm1hdHMubWFwKGZ1bmN0aW9uIChzKSB7IHJldHVybiBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXRbc107IH0pO1xuICAgICAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdHMuaW5kZXhPZihyZXF1ZXN0ZWRUcmFuc2ZlckZvcm1hdCkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKHRyYW5zcG9ydCA9PT0gSVRyYW5zcG9ydF8xLkh0dHBUcmFuc3BvcnRUeXBlLldlYlNvY2tldHMgJiYgIXRoaXMub3B0aW9ucy5XZWJTb2NrZXQpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAodHJhbnNwb3J0ID09PSBJVHJhbnNwb3J0XzEuSHR0cFRyYW5zcG9ydFR5cGUuU2VydmVyU2VudEV2ZW50cyAmJiAhdGhpcy5vcHRpb25zLkV2ZW50U291cmNlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJTa2lwcGluZyB0cmFuc3BvcnQgJ1wiICsgSVRyYW5zcG9ydF8xLkh0dHBUcmFuc3BvcnRUeXBlW3RyYW5zcG9ydF0gKyBcIicgYmVjYXVzZSBpdCBpcyBub3Qgc3VwcG9ydGVkIGluIHlvdXIgZW52aXJvbm1lbnQuJ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXJyb3IoXCInXCIgKyBJVHJhbnNwb3J0XzEuSHR0cFRyYW5zcG9ydFR5cGVbdHJhbnNwb3J0XSArIFwiJyBpcyBub3Qgc3VwcG9ydGVkIGluIHlvdXIgZW52aXJvbm1lbnQuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJTZWxlY3RpbmcgdHJhbnNwb3J0ICdcIiArIElUcmFuc3BvcnRfMS5IdHRwVHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdICsgXCInLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0VHJhbnNwb3J0KHRyYW5zcG9ydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiU2tpcHBpbmcgdHJhbnNwb3J0ICdcIiArIElUcmFuc3BvcnRfMS5IdHRwVHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdICsgXCInIGJlY2F1c2UgaXQgZG9lcyBub3Qgc3VwcG9ydCB0aGUgcmVxdWVzdGVkIHRyYW5zZmVyIGZvcm1hdCAnXCIgKyBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXRbcmVxdWVzdGVkVHJhbnNmZXJGb3JtYXRdICsgXCInLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFcnJvcihcIidcIiArIElUcmFuc3BvcnRfMS5IdHRwVHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdICsgXCInIGRvZXMgbm90IHN1cHBvcnQgXCIgKyBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXRbcmVxdWVzdGVkVHJhbnNmZXJGb3JtYXRdICsgXCIuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiU2tpcHBpbmcgdHJhbnNwb3J0ICdcIiArIElUcmFuc3BvcnRfMS5IdHRwVHJhbnNwb3J0VHlwZVt0cmFuc3BvcnRdICsgXCInIGJlY2F1c2UgaXQgd2FzIGRpc2FibGVkIGJ5IHRoZSBjbGllbnQuXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXJyb3IoXCInXCIgKyBJVHJhbnNwb3J0XzEuSHR0cFRyYW5zcG9ydFR5cGVbdHJhbnNwb3J0XSArIFwiJyBpcyBkaXNhYmxlZCBieSB0aGUgY2xpZW50LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSHR0cENvbm5lY3Rpb24ucHJvdG90eXBlLmlzSVRyYW5zcG9ydCA9IGZ1bmN0aW9uICh0cmFuc3BvcnQpIHtcbiAgICAgICAgcmV0dXJuIHRyYW5zcG9ydCAmJiB0eXBlb2YgKHRyYW5zcG9ydCkgPT09IFwib2JqZWN0XCIgJiYgXCJjb25uZWN0XCIgaW4gdHJhbnNwb3J0O1xuICAgIH07XG4gICAgSHR0cENvbm5lY3Rpb24ucHJvdG90eXBlLnN0b3BDb25uZWN0aW9uID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiSHR0cENvbm5lY3Rpb24uc3RvcENvbm5lY3Rpb24oXCIgKyBlcnJvciArIFwiKSBjYWxsZWQgd2hpbGUgaW4gc3RhdGUgXCIgKyB0aGlzLmNvbm5lY3Rpb25TdGF0ZSArIFwiLlwiKTtcbiAgICAgICAgdGhpcy50cmFuc3BvcnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIElmIHdlIGhhdmUgYSBzdG9wRXJyb3IsIGl0IHRha2VzIHByZWNlZGVuY2Ugb3ZlciB0aGUgZXJyb3IgZnJvbSB0aGUgdHJhbnNwb3J0XG4gICAgICAgIGVycm9yID0gdGhpcy5zdG9wRXJyb3IgfHwgZXJyb3I7XG4gICAgICAgIHRoaXMuc3RvcEVycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhdGUgPT09IFwiRGlzY29ubmVjdGVkXCIgLyogRGlzY29ubmVjdGVkICovKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIkNhbGwgdG8gSHR0cENvbm5lY3Rpb24uc3RvcENvbm5lY3Rpb24oXCIgKyBlcnJvciArIFwiKSB3YXMgaWdub3JlZCBiZWNhdXNlIHRoZSBjb25uZWN0aW9uIGlzIGFscmVhZHkgaW4gdGhlIGRpc2Nvbm5lY3RlZCBzdGF0ZS5cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXRlID09PSBcIkNvbm5lY3RpbmdcIiAvKiBDb25uZWN0aW5nICovKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLldhcm5pbmcsIFwiQ2FsbCB0byBIdHRwQ29ubmVjdGlvbi5zdG9wQ29ubmVjdGlvbihcIiArIGVycm9yICsgXCIpIHdhcyBpZ25vcmVkIGJlY2F1c2UgdGhlIGNvbm5lY3Rpb24gaXMgc3RpbGwgaW4gdGhlIGNvbm5lY3Rpbmcgc3RhdGUuXCIpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSHR0cENvbm5lY3Rpb24uc3RvcENvbm5lY3Rpb24oXCIgKyBlcnJvciArIFwiKSB3YXMgY2FsbGVkIHdoaWxlIHRoZSBjb25uZWN0aW9uIGlzIHN0aWxsIGluIHRoZSBjb25uZWN0aW5nIHN0YXRlLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhdGUgPT09IFwiRGlzY29ubmVjdGluZ1wiIC8qIERpc2Nvbm5lY3RpbmcgKi8pIHtcbiAgICAgICAgICAgIC8vIEEgY2FsbCB0byBzdG9wKCkgaW5kdWNlZCB0aGlzIGNhbGwgdG8gc3RvcENvbm5lY3Rpb24gYW5kIG5lZWRzIHRvIGJlIGNvbXBsZXRlZC5cbiAgICAgICAgICAgIC8vIEFueSBzdG9wKCkgYXdhaXRlcnMgd2lsbCBiZSBzY2hlZHVsZWQgdG8gY29udGludWUgYWZ0ZXIgdGhlIG9uY2xvc2UgY2FsbGJhY2sgZmlyZXMuXG4gICAgICAgICAgICB0aGlzLnN0b3BQcm9taXNlUmVzb2x2ZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiQ29ubmVjdGlvbiBkaXNjb25uZWN0ZWQgd2l0aCBlcnJvciAnXCIgKyBlcnJvciArIFwiJy5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uLCBcIkNvbm5lY3Rpb24gZGlzY29ubmVjdGVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZW5kUXVldWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZFF1ZXVlLnN0b3AoKS5jYXRjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLCBcIlRyYW5zcG9ydFNlbmRRdWV1ZS5zdG9wKCkgdGhyZXcgZXJyb3IgJ1wiICsgZSArIFwiJy5cIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuc2VuZFF1ZXVlID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbklkID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IFwiRGlzY29ubmVjdGVkXCIgLyogRGlzY29ubmVjdGVkICovO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhcnRlZCkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vbmNsb3NlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25jbG9zZShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLCBcIkh0dHBDb25uZWN0aW9uLm9uY2xvc2UoXCIgKyBlcnJvciArIFwiKSB0aHJldyBlcnJvciAnXCIgKyBlICsgXCInLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSHR0cENvbm5lY3Rpb24ucHJvdG90eXBlLnJlc29sdmVVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIC8vIHN0YXJ0c1dpdGggaXMgbm90IHN1cHBvcnRlZCBpbiBJRVxuICAgICAgICBpZiAodXJsLmxhc3RJbmRleE9mKFwiaHR0cHM6Ly9cIiwgMCkgPT09IDAgfHwgdXJsLmxhc3RJbmRleE9mKFwiaHR0cDovL1wiLCAwKSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIVV0aWxzXzEuUGxhdGZvcm0uaXNCcm93c2VyIHx8ICF3aW5kb3cuZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCByZXNvbHZlICdcIiArIHVybCArIFwiJy5cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2V0dGluZyB0aGUgdXJsIHRvIHRoZSBocmVmIHByb3Blcnkgb2YgYW4gYW5jaG9yIHRhZyBoYW5kbGVzIG5vcm1hbGl6YXRpb25cbiAgICAgICAgLy8gZm9yIHVzLiBUaGVyZSBhcmUgMyBtYWluIGNhc2VzLlxuICAgICAgICAvLyAxLiBSZWxhdGl2ZSBwYXRoIG5vcm1hbGl6YXRpb24gZS5nIFwiYlwiIC0+IFwiaHR0cDovL2xvY2FsaG9zdDo1MDAwL2EvYlwiXG4gICAgICAgIC8vIDIuIEFic29sdXRlIHBhdGggbm9ybWFsaXphdGlvbiBlLmcgXCIvYS9iXCIgLT4gXCJodHRwOi8vbG9jYWxob3N0OjUwMDAvYS9iXCJcbiAgICAgICAgLy8gMy4gTmV0d29ya3BhdGggcmVmZXJlbmNlIG5vcm1hbGl6YXRpb24gZS5nIFwiLy9sb2NhbGhvc3Q6NTAwMC9hL2JcIiAtPiBcImh0dHA6Ly9sb2NhbGhvc3Q6NTAwMC9hL2JcIlxuICAgICAgICB2YXIgYVRhZyA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICAgICAgYVRhZy5ocmVmID0gdXJsO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uLCBcIk5vcm1hbGl6aW5nICdcIiArIHVybCArIFwiJyB0byAnXCIgKyBhVGFnLmhyZWYgKyBcIicuXCIpO1xuICAgICAgICByZXR1cm4gYVRhZy5ocmVmO1xuICAgIH07XG4gICAgSHR0cENvbm5lY3Rpb24ucHJvdG90eXBlLnJlc29sdmVOZWdvdGlhdGVVcmwgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIHZhciBpbmRleCA9IHVybC5pbmRleE9mKFwiP1wiKTtcbiAgICAgICAgdmFyIG5lZ290aWF0ZVVybCA9IHVybC5zdWJzdHJpbmcoMCwgaW5kZXggPT09IC0xID8gdXJsLmxlbmd0aCA6IGluZGV4KTtcbiAgICAgICAgaWYgKG5lZ290aWF0ZVVybFtuZWdvdGlhdGVVcmwubGVuZ3RoIC0gMV0gIT09IFwiL1wiKSB7XG4gICAgICAgICAgICBuZWdvdGlhdGVVcmwgKz0gXCIvXCI7XG4gICAgICAgIH1cbiAgICAgICAgbmVnb3RpYXRlVXJsICs9IFwibmVnb3RpYXRlXCI7XG4gICAgICAgIG5lZ290aWF0ZVVybCArPSBpbmRleCA9PT0gLTEgPyBcIlwiIDogdXJsLnN1YnN0cmluZyhpbmRleCk7XG4gICAgICAgIGlmIChuZWdvdGlhdGVVcmwuaW5kZXhPZihcIm5lZ290aWF0ZVZlcnNpb25cIikgPT09IC0xKSB7XG4gICAgICAgICAgICBuZWdvdGlhdGVVcmwgKz0gaW5kZXggPT09IC0xID8gXCI/XCIgOiBcIiZcIjtcbiAgICAgICAgICAgIG5lZ290aWF0ZVVybCArPSBcIm5lZ290aWF0ZVZlcnNpb249XCIgKyB0aGlzLm5lZ290aWF0ZVZlcnNpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5lZ290aWF0ZVVybDtcbiAgICB9O1xuICAgIHJldHVybiBIdHRwQ29ubmVjdGlvbjtcbn0oKSk7XG5leHBvcnRzLkh0dHBDb25uZWN0aW9uID0gSHR0cENvbm5lY3Rpb247XG5mdW5jdGlvbiB0cmFuc3BvcnRNYXRjaGVzKHJlcXVlc3RlZFRyYW5zcG9ydCwgYWN0dWFsVHJhbnNwb3J0KSB7XG4gICAgcmV0dXJuICFyZXF1ZXN0ZWRUcmFuc3BvcnQgfHwgKChhY3R1YWxUcmFuc3BvcnQgJiByZXF1ZXN0ZWRUcmFuc3BvcnQpICE9PSAwKTtcbn1cbi8qKiBAcHJpdmF0ZSAqL1xudmFyIFRyYW5zcG9ydFNlbmRRdWV1ZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUcmFuc3BvcnRTZW5kUXVldWUodHJhbnNwb3J0KSB7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0ID0gdHJhbnNwb3J0O1xuICAgICAgICB0aGlzLmJ1ZmZlciA9IFtdO1xuICAgICAgICB0aGlzLmV4ZWN1dGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VuZEJ1ZmZlcmVkRGF0YSA9IG5ldyBQcm9taXNlU291cmNlKCk7XG4gICAgICAgIHRoaXMudHJhbnNwb3J0UmVzdWx0ID0gbmV3IFByb21pc2VTb3VyY2UoKTtcbiAgICAgICAgdGhpcy5zZW5kTG9vcFByb21pc2UgPSB0aGlzLnNlbmRMb29wKCk7XG4gICAgfVxuICAgIFRyYW5zcG9ydFNlbmRRdWV1ZS5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyRGF0YShkYXRhKTtcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydFJlc3VsdCkge1xuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRSZXN1bHQgPSBuZXcgUHJvbWlzZVNvdXJjZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydFJlc3VsdC5wcm9taXNlO1xuICAgIH07XG4gICAgVHJhbnNwb3J0U2VuZFF1ZXVlLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmV4ZWN1dGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbmRCdWZmZXJlZERhdGEucmVzb2x2ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5zZW5kTG9vcFByb21pc2U7XG4gICAgfTtcbiAgICBUcmFuc3BvcnRTZW5kUXVldWUucHJvdG90eXBlLmJ1ZmZlckRhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBpZiAodGhpcy5idWZmZXIubGVuZ3RoICYmIHR5cGVvZiAodGhpcy5idWZmZXJbMF0pICE9PSB0eXBlb2YgKGRhdGEpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFeHBlY3RlZCBkYXRhIHRvIGJlIG9mIHR5cGUgXCIgKyB0eXBlb2YgKHRoaXMuYnVmZmVyKSArIFwiIGJ1dCB3YXMgb2YgdHlwZSBcIiArIHR5cGVvZiAoZGF0YSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYnVmZmVyLnB1c2goZGF0YSk7XG4gICAgICAgIHRoaXMuc2VuZEJ1ZmZlcmVkRGF0YS5yZXNvbHZlKCk7XG4gICAgfTtcbiAgICBUcmFuc3BvcnRTZW5kUXVldWUucHJvdG90eXBlLnNlbmRMb29wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdHJhbnNwb3J0UmVzdWx0LCBkYXRhLCBlcnJvcl8xO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cnVlKSByZXR1cm4gWzMgLypicmVhayovLCA2XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc2VuZEJ1ZmZlcmVkRGF0YS5wcm9taXNlXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmV4ZWN1dGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydFJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydFJlc3VsdC5yZWplY3QoXCJDb25uZWN0aW9uIHN0b3BwZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA2XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZEJ1ZmZlcmVkRGF0YSA9IG5ldyBQcm9taXNlU291cmNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnRSZXN1bHQgPSB0aGlzLnRyYW5zcG9ydFJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0UmVzdWx0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHR5cGVvZiAodGhpcy5idWZmZXJbMF0pID09PSBcInN0cmluZ1wiID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5qb2luKFwiXCIpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc3BvcnRTZW5kUXVldWUuY29uY2F0QnVmZmVycyh0aGlzLmJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAyO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzIsIDQsICwgNV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy50cmFuc3BvcnQuc2VuZChkYXRhKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydFJlc3VsdC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA1XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfMSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydFJlc3VsdC5yZWplY3QoZXJyb3JfMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA1XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OiByZXR1cm4gWzMgLypicmVhayovLCAwXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgVHJhbnNwb3J0U2VuZFF1ZXVlLmNvbmNhdEJ1ZmZlcnMgPSBmdW5jdGlvbiAoYXJyYXlCdWZmZXJzKSB7XG4gICAgICAgIHZhciB0b3RhbExlbmd0aCA9IGFycmF5QnVmZmVycy5tYXAoZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGIuYnl0ZUxlbmd0aDsgfSkucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhICsgYjsgfSk7XG4gICAgICAgIHZhciByZXN1bHQgPSBuZXcgVWludDhBcnJheSh0b3RhbExlbmd0aCk7XG4gICAgICAgIHZhciBvZmZzZXQgPSAwO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGFycmF5QnVmZmVyc18xID0gYXJyYXlCdWZmZXJzOyBfaSA8IGFycmF5QnVmZmVyc18xLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBhcnJheUJ1ZmZlcnNfMVtfaV07XG4gICAgICAgICAgICByZXN1bHQuc2V0KG5ldyBVaW50OEFycmF5KGl0ZW0pLCBvZmZzZXQpO1xuICAgICAgICAgICAgb2Zmc2V0ICs9IGl0ZW0uYnl0ZUxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0LmJ1ZmZlcjtcbiAgICB9O1xuICAgIHJldHVybiBUcmFuc3BvcnRTZW5kUXVldWU7XG59KCkpO1xuZXhwb3J0cy5UcmFuc3BvcnRTZW5kUXVldWUgPSBUcmFuc3BvcnRTZW5kUXVldWU7XG52YXIgUHJvbWlzZVNvdXJjZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQcm9taXNlU291cmNlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gX2EgPSBbcmVzb2x2ZSwgcmVqZWN0XSwgX3RoaXMucmVzb2x2ZXIgPSBfYVswXSwgX3RoaXMucmVqZWN0ZXIgPSBfYVsxXSwgX2E7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBQcm9taXNlU291cmNlLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlc29sdmVyKCk7XG4gICAgfTtcbiAgICBQcm9taXNlU291cmNlLnByb3RvdHlwZS5yZWplY3QgPSBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgIHRoaXMucmVqZWN0ZXIocmVhc29uKTtcbiAgICB9O1xuICAgIHJldHVybiBQcm9taXNlU291cmNlO1xufSgpKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUh0dHBDb25uZWN0aW9uLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXEh0dHBDb25uZWN0aW9uLmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgSGFuZHNoYWtlUHJvdG9jb2xfMSA9IHJlcXVpcmUoXCIuL0hhbmRzaGFrZVByb3RvY29sXCIpO1xudmFyIElIdWJQcm90b2NvbF8xID0gcmVxdWlyZShcIi4vSUh1YlByb3RvY29sXCIpO1xudmFyIElMb2dnZXJfMSA9IHJlcXVpcmUoXCIuL0lMb2dnZXJcIik7XG52YXIgU3ViamVjdF8xID0gcmVxdWlyZShcIi4vU3ViamVjdFwiKTtcbnZhciBVdGlsc18xID0gcmVxdWlyZShcIi4vVXRpbHNcIik7XG52YXIgREVGQVVMVF9USU1FT1VUX0lOX01TID0gMzAgKiAxMDAwO1xudmFyIERFRkFVTFRfUElOR19JTlRFUlZBTF9JTl9NUyA9IDE1ICogMTAwMDtcbi8qKiBEZXNjcmliZXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIHtAbGluayBIdWJDb25uZWN0aW9ufSB0byB0aGUgc2VydmVyLiAqL1xudmFyIEh1YkNvbm5lY3Rpb25TdGF0ZTtcbihmdW5jdGlvbiAoSHViQ29ubmVjdGlvblN0YXRlKSB7XG4gICAgLyoqIFRoZSBodWIgY29ubmVjdGlvbiBpcyBkaXNjb25uZWN0ZWQuICovXG4gICAgSHViQ29ubmVjdGlvblN0YXRlW1wiRGlzY29ubmVjdGVkXCJdID0gXCJEaXNjb25uZWN0ZWRcIjtcbiAgICAvKiogVGhlIGh1YiBjb25uZWN0aW9uIGlzIGNvbm5lY3RpbmcuICovXG4gICAgSHViQ29ubmVjdGlvblN0YXRlW1wiQ29ubmVjdGluZ1wiXSA9IFwiQ29ubmVjdGluZ1wiO1xuICAgIC8qKiBUaGUgaHViIGNvbm5lY3Rpb24gaXMgY29ubmVjdGVkLiAqL1xuICAgIEh1YkNvbm5lY3Rpb25TdGF0ZVtcIkNvbm5lY3RlZFwiXSA9IFwiQ29ubmVjdGVkXCI7XG4gICAgLyoqIFRoZSBodWIgY29ubmVjdGlvbiBpcyBkaXNjb25uZWN0aW5nLiAqL1xuICAgIEh1YkNvbm5lY3Rpb25TdGF0ZVtcIkRpc2Nvbm5lY3RpbmdcIl0gPSBcIkRpc2Nvbm5lY3RpbmdcIjtcbiAgICAvKiogVGhlIGh1YiBjb25uZWN0aW9uIGlzIHJlY29ubmVjdGluZy4gKi9cbiAgICBIdWJDb25uZWN0aW9uU3RhdGVbXCJSZWNvbm5lY3RpbmdcIl0gPSBcIlJlY29ubmVjdGluZ1wiO1xufSkoSHViQ29ubmVjdGlvblN0YXRlID0gZXhwb3J0cy5IdWJDb25uZWN0aW9uU3RhdGUgfHwgKGV4cG9ydHMuSHViQ29ubmVjdGlvblN0YXRlID0ge30pKTtcbi8qKiBSZXByZXNlbnRzIGEgY29ubmVjdGlvbiB0byBhIFNpZ25hbFIgSHViLiAqL1xudmFyIEh1YkNvbm5lY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSHViQ29ubmVjdGlvbihjb25uZWN0aW9uLCBsb2dnZXIsIHByb3RvY29sLCByZWNvbm5lY3RQb2xpY3kpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZChjb25uZWN0aW9uLCBcImNvbm5lY3Rpb25cIik7XG4gICAgICAgIFV0aWxzXzEuQXJnLmlzUmVxdWlyZWQobG9nZ2VyLCBcImxvZ2dlclwiKTtcbiAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZChwcm90b2NvbCwgXCJwcm90b2NvbFwiKTtcbiAgICAgICAgdGhpcy5zZXJ2ZXJUaW1lb3V0SW5NaWxsaXNlY29uZHMgPSBERUZBVUxUX1RJTUVPVVRfSU5fTVM7XG4gICAgICAgIHRoaXMua2VlcEFsaXZlSW50ZXJ2YWxJbk1pbGxpc2Vjb25kcyA9IERFRkFVTFRfUElOR19JTlRFUlZBTF9JTl9NUztcbiAgICAgICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgICAgIHRoaXMucHJvdG9jb2wgPSBwcm90b2NvbDtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICAgICAgdGhpcy5yZWNvbm5lY3RQb2xpY3kgPSByZWNvbm5lY3RQb2xpY3k7XG4gICAgICAgIHRoaXMuaGFuZHNoYWtlUHJvdG9jb2wgPSBuZXcgSGFuZHNoYWtlUHJvdG9jb2xfMS5IYW5kc2hha2VQcm90b2NvbCgpO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24ub25yZWNlaXZlID0gZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF90aGlzLnByb2Nlc3NJbmNvbWluZ0RhdGEoZGF0YSk7IH07XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbmNsb3NlID0gZnVuY3Rpb24gKGVycm9yKSB7IHJldHVybiBfdGhpcy5jb25uZWN0aW9uQ2xvc2VkKGVycm9yKTsgfTtcbiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSB7fTtcbiAgICAgICAgdGhpcy5tZXRob2RzID0ge307XG4gICAgICAgIHRoaXMuY2xvc2VkQ2FsbGJhY2tzID0gW107XG4gICAgICAgIHRoaXMucmVjb25uZWN0aW5nQ2FsbGJhY2tzID0gW107XG4gICAgICAgIHRoaXMucmVjb25uZWN0ZWRDYWxsYmFja3MgPSBbXTtcbiAgICAgICAgdGhpcy5pbnZvY2F0aW9uSWQgPSAwO1xuICAgICAgICB0aGlzLnJlY2VpdmVkSGFuZHNoYWtlUmVzcG9uc2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBIdWJDb25uZWN0aW9uU3RhdGUuRGlzY29ubmVjdGVkO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGFydGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2FjaGVkUGluZ01lc3NhZ2UgPSB0aGlzLnByb3RvY29sLndyaXRlTWVzc2FnZSh7IHR5cGU6IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLlBpbmcgfSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAvLyBVc2luZyBhIHB1YmxpYyBzdGF0aWMgZmFjdG9yeSBtZXRob2QgbWVhbnMgd2UgY2FuIGhhdmUgYSBwcml2YXRlIGNvbnN0cnVjdG9yIGFuZCBhbiBfaW50ZXJuYWxfXG4gICAgLy8gY3JlYXRlIG1ldGhvZCB0aGF0IGNhbiBiZSB1c2VkIGJ5IEh1YkNvbm5lY3Rpb25CdWlsZGVyLiBBbiBcImludGVybmFsXCIgY29uc3RydWN0b3Igd291bGQganVzdFxuICAgIC8vIGJlIHN0cmlwcGVkIGF3YXkgYW5kIHRoZSAnLmQudHMnIGZpbGUgd291bGQgaGF2ZSBubyBjb25zdHJ1Y3Rvciwgd2hpY2ggaXMgaW50ZXJwcmV0ZWQgYXMgYVxuICAgIC8vIHB1YmxpYyBwYXJhbWV0ZXItbGVzcyBjb25zdHJ1Y3Rvci5cbiAgICBIdWJDb25uZWN0aW9uLmNyZWF0ZSA9IGZ1bmN0aW9uIChjb25uZWN0aW9uLCBsb2dnZXIsIHByb3RvY29sLCByZWNvbm5lY3RQb2xpY3kpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBIdWJDb25uZWN0aW9uKGNvbm5lY3Rpb24sIGxvZ2dlciwgcHJvdG9jb2wsIHJlY29ubmVjdFBvbGljeSk7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSHViQ29ubmVjdGlvbi5wcm90b3R5cGUsIFwic3RhdGVcIiwge1xuICAgICAgICAvKiogSW5kaWNhdGVzIHRoZSBzdGF0ZSBvZiB0aGUge0BsaW5rIEh1YkNvbm5lY3Rpb259IHRvIHRoZSBzZXJ2ZXIuICovXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvblN0YXRlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSHViQ29ubmVjdGlvbi5wcm90b3R5cGUsIFwiY29ubmVjdGlvbklkXCIsIHtcbiAgICAgICAgLyoqIFJlcHJlc2VudHMgdGhlIGNvbm5lY3Rpb24gaWQgb2YgdGhlIHtAbGluayBIdWJDb25uZWN0aW9ufSBvbiB0aGUgc2VydmVyLiBUaGUgY29ubmVjdGlvbiBpZCB3aWxsIGJlIG51bGwgd2hlbiB0aGUgY29ubmVjdGlvbiBpcyBlaXRoZXJcbiAgICAgICAgICogIGluIHRoZSBkaXNjb25uZWN0ZWQgc3RhdGUgb3IgaWYgdGhlIG5lZ290aWF0aW9uIHN0ZXAgd2FzIHNraXBwZWQuXG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24gPyAodGhpcy5jb25uZWN0aW9uLmNvbm5lY3Rpb25JZCB8fCBudWxsKSA6IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShIdWJDb25uZWN0aW9uLnByb3RvdHlwZSwgXCJiYXNlVXJsXCIsIHtcbiAgICAgICAgLyoqIEluZGljYXRlcyB0aGUgdXJsIG9mIHRoZSB7QGxpbmsgSHViQ29ubmVjdGlvbn0gdG8gdGhlIHNlcnZlci4gKi9cbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uLmJhc2VVcmwgfHwgXCJcIjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgYSBuZXcgdXJsIGZvciB0aGUgSHViQ29ubmVjdGlvbi4gTm90ZSB0aGF0IHRoZSB1cmwgY2FuIG9ubHkgYmUgY2hhbmdlZCB3aGVuIHRoZSBjb25uZWN0aW9uIGlzIGluIGVpdGhlciB0aGUgRGlzY29ubmVjdGVkIG9yXG4gICAgICAgICAqIFJlY29ubmVjdGluZyBzdGF0ZXMuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgVGhlIHVybCB0byBjb25uZWN0IHRvLlxuICAgICAgICAgKi9cbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhdGUgIT09IEh1YkNvbm5lY3Rpb25TdGF0ZS5EaXNjb25uZWN0ZWQgJiYgdGhpcy5jb25uZWN0aW9uU3RhdGUgIT09IEh1YkNvbm5lY3Rpb25TdGF0ZS5SZWNvbm5lY3RpbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgSHViQ29ubmVjdGlvbiBtdXN0IGJlIGluIHRoZSBEaXNjb25uZWN0ZWQgb3IgUmVjb25uZWN0aW5nIHN0YXRlIHRvIGNoYW5nZSB0aGUgdXJsLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdXJsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIEh1YkNvbm5lY3Rpb24gdXJsIG11c3QgYmUgYSB2YWxpZCB1cmwuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLmJhc2VVcmwgPSB1cmw7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIC8qKiBTdGFydHMgdGhlIGNvbm5lY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn0gQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgY29ubmVjdGlvbiBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgZXN0YWJsaXNoZWQsIG9yIHJlamVjdHMgd2l0aCBhbiBlcnJvci5cbiAgICAgKi9cbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdGFydFByb21pc2UgPSB0aGlzLnN0YXJ0V2l0aFN0YXRlVHJhbnNpdGlvbnMoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9taXNlO1xuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuc3RhcnRXaXRoU3RhdGVUcmFuc2l0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGVfMTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gSHViQ29ubmVjdGlvblN0YXRlLkRpc2Nvbm5lY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJDYW5ub3Qgc3RhcnQgYSBIdWJDb25uZWN0aW9uIHRoYXQgaXMgbm90IGluIHRoZSAnRGlzY29ubmVjdGVkJyBzdGF0ZS5cIikpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gSHViQ29ubmVjdGlvblN0YXRlLkNvbm5lY3Rpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIlN0YXJ0aW5nIEh1YkNvbm5lY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzEsIDMsICwgNF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdGFydEludGVybmFsKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IEh1YkNvbm5lY3Rpb25TdGF0ZS5Db25uZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiSHViQ29ubmVjdGlvbiBjb25uZWN0ZWQgc3VjY2Vzc2Z1bGx5LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICBlXzEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9IEh1YkNvbm5lY3Rpb25TdGF0ZS5EaXNjb25uZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIkh1YkNvbm5lY3Rpb24gZmFpbGVkIHRvIHN0YXJ0IHN1Y2Nlc3NmdWxseSBiZWNhdXNlIG9mIGVycm9yICdcIiArIGVfMSArIFwiJy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgUHJvbWlzZS5yZWplY3QoZV8xKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLnN0YXJ0SW50ZXJuYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBoYW5kc2hha2VQcm9taXNlLCBoYW5kc2hha2VSZXF1ZXN0LCBlXzI7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wRHVyaW5nU3RhcnRFcnJvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjZWl2ZWRIYW5kc2hha2VSZXNwb25zZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZHNoYWtlUHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kc2hha2VSZXNvbHZlciA9IHJlc29sdmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFuZHNoYWtlUmVqZWN0ZXIgPSByZWplY3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuY29ubmVjdGlvbi5zdGFydCh0aGlzLnByb3RvY29sLnRyYW5zZmVyRm9ybWF0KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsyLCA1LCAsIDddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRzaGFrZVJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6IHRoaXMucHJvdG9jb2wubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB0aGlzLnByb3RvY29sLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJTZW5kaW5nIGhhbmRzaGFrZSByZXF1ZXN0LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc2VuZE1lc3NhZ2UodGhpcy5oYW5kc2hha2VQcm90b2NvbC53cml0ZUhhbmRzaGFrZVJlcXVlc3QoaGFuZHNoYWtlUmVxdWVzdCkpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5JbmZvcm1hdGlvbiwgXCJVc2luZyBIdWJQcm90b2NvbCAnXCIgKyB0aGlzLnByb3RvY29sLm5hbWUgKyBcIicuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVmZW5zaXZlbHkgY2xlYW51cCB0aW1lb3V0IGluIGNhc2Ugd2UgcmVjZWl2ZSBhIG1lc3NhZ2UgZnJvbSB0aGUgc2VydmVyIGJlZm9yZSB3ZSBmaW5pc2ggc3RhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYW51cFRpbWVvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXRUaW1lb3V0UGVyaW9kKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0S2VlcEFsaXZlSW50ZXJ2YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGhhbmRzaGFrZVByb21pc2VdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJdCdzIGltcG9ydGFudCB0byBjaGVjayB0aGUgc3RvcER1cmluZ1N0YXJ0RXJyb3IgaW5zdGVhZCBvZiBqdXN0IHJlbHlpbmcgb24gdGhlIGhhbmRzaGFrZVByb21pc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlaW5nIHJlamVjdGVkIG9uIGNsb3NlLCBiZWNhdXNlIHRoaXMgY29udGludWF0aW9uIGNhbiBydW4gYWZ0ZXIgYm90aCB0aGUgaGFuZHNoYWtlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0aGUgY29ubmVjdGlvbiB3YXMgY2xvc2VkLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RvcER1cmluZ1N0YXJ0RXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJdCdzIGltcG9ydGFudCB0byB0aHJvdyBpbnN0ZWFkIG9mIHJldHVybmluZyBhIHJlamVjdGVkIHByb21pc2UsIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCB0byBhbGxvdyBhbnkgc3RhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0cmFuc2l0aW9ucyB0byBvY2N1ciBiZXR3ZWVuIG5vdyBhbmQgdGhlIGNhbGxpbmcgY29kZSBvYnNlcnZpbmcgdGhlIGV4Y2VwdGlvbnMuIFJldHVybmluZyBhIHJlamVjdGVkIHByb21pc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aWxsIGNhdXNlIHRoZSBjYWxsaW5nIGNvbnRpbnVhdGlvbiB0byBnZXQgc2NoZWR1bGVkIHRvIHJ1biBsYXRlci5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnN0b3BEdXJpbmdTdGFydEVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgN107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfMiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiSHViIGhhbmRzaGFrZSBmYWlsZWQgd2l0aCBlcnJvciAnXCIgKyBlXzIgKyBcIicgZHVyaW5nIHN0YXJ0KCkuIFN0b3BwaW5nIEh1YkNvbm5lY3Rpb24uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhbnVwVGltZW91dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhbnVwUGluZ1RpbWVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIdHRwQ29ubmVjdGlvbi5zdG9wKCkgc2hvdWxkIG5vdCBjb21wbGV0ZSB1bnRpbCBhZnRlciB0aGUgb25jbG9zZSBjYWxsYmFjayBpcyBpbnZva2VkLlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIHRyYW5zaXRpb24gdGhlIEh1YkNvbm5lY3Rpb24gdG8gdGhlIGRpc2Nvbm5lY3RlZCBzdGF0ZSBiZWZvcmUgSHR0cENvbm5lY3Rpb24uc3RvcCgpIGNvbXBsZXRlcy5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuY29ubmVjdGlvbi5zdG9wKGVfMildO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIdHRwQ29ubmVjdGlvbi5zdG9wKCkgc2hvdWxkIG5vdCBjb21wbGV0ZSB1bnRpbCBhZnRlciB0aGUgb25jbG9zZSBjYWxsYmFjayBpcyBpbnZva2VkLlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIHRyYW5zaXRpb24gdGhlIEh1YkNvbm5lY3Rpb24gdG8gdGhlIGRpc2Nvbm5lY3RlZCBzdGF0ZSBiZWZvcmUgSHR0cENvbm5lY3Rpb24uc3RvcCgpIGNvbXBsZXRlcy5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVfMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqIFN0b3BzIHRoZSBjb25uZWN0aW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGNvbm5lY3Rpb24gaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IHRlcm1pbmF0ZWQsIG9yIHJlamVjdHMgd2l0aCBhbiBlcnJvci5cbiAgICAgKi9cbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnRQcm9taXNlLCBlXzM7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFByb21pc2UgPSB0aGlzLnN0YXJ0UHJvbWlzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcFByb21pc2UgPSB0aGlzLnN0b3BJbnRlcm5hbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdG9wUHJvbWlzZV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsyLCA0LCAsIDVdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF3YWl0aW5nIHVuZGVmaW5lZCBjb250aW51ZXMgaW1tZWRpYXRlbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHN0YXJ0UHJvbWlzZV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF3YWl0aW5nIHVuZGVmaW5lZCBjb250aW51ZXMgaW1tZWRpYXRlbHlcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBlXzMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA1XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuc3RvcEludGVybmFsID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9PT0gSHViQ29ubmVjdGlvblN0YXRlLkRpc2Nvbm5lY3RlZCkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJDYWxsIHRvIEh1YkNvbm5lY3Rpb24uc3RvcChcIiArIGVycm9yICsgXCIpIGlnbm9yZWQgYmVjYXVzZSBpdCBpcyBhbHJlYWR5IGluIHRoZSBkaXNjb25uZWN0ZWQgc3RhdGUuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9PT0gSHViQ29ubmVjdGlvblN0YXRlLkRpc2Nvbm5lY3RpbmcpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiQ2FsbCB0byBIdHRwQ29ubmVjdGlvbi5zdG9wKFwiICsgZXJyb3IgKyBcIikgaWdub3JlZCBiZWNhdXNlIHRoZSBjb25uZWN0aW9uIGlzIGFscmVhZHkgaW4gdGhlIGRpc2Nvbm5lY3Rpbmcgc3RhdGUuXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcFByb21pc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBIdWJDb25uZWN0aW9uU3RhdGUuRGlzY29ubmVjdGluZztcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZywgXCJTdG9wcGluZyBIdWJDb25uZWN0aW9uLlwiKTtcbiAgICAgICAgaWYgKHRoaXMucmVjb25uZWN0RGVsYXlIYW5kbGUpIHtcbiAgICAgICAgICAgIC8vIFdlJ3JlIGluIGEgcmVjb25uZWN0IGRlbGF5IHdoaWNoIG1lYW5zIHRoZSB1bmRlcmx5aW5nIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IGFscmVhZHkgc3RvcHBlZC5cbiAgICAgICAgICAgIC8vIEp1c3QgY2xlYXIgdGhlIGhhbmRsZSB0byBzdG9wIHRoZSByZWNvbm5lY3QgbG9vcCAod2hpY2ggbm8gb25lIGlzIHdhaXRpbmcgb24gdGhhbmtmdWxseSkgYW5kXG4gICAgICAgICAgICAvLyBmaXJlIHRoZSBvbmNsb3NlIGNhbGxiYWNrcy5cbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiQ29ubmVjdGlvbiBzdG9wcGVkIGR1cmluZyByZWNvbm5lY3QgZGVsYXkuIERvbmUgcmVjb25uZWN0aW5nLlwiKTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJlY29ubmVjdERlbGF5SGFuZGxlKTtcbiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlIYW5kbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlQ2xvc2UoKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsZWFudXBUaW1lb3V0KCk7XG4gICAgICAgIHRoaXMuY2xlYW51cFBpbmdUaW1lcigpO1xuICAgICAgICB0aGlzLnN0b3BEdXJpbmdTdGFydEVycm9yID0gZXJyb3IgfHwgbmV3IEVycm9yKFwiVGhlIGNvbm5lY3Rpb24gd2FzIHN0b3BwZWQgYmVmb3JlIHRoZSBodWIgaGFuZHNoYWtlIGNvdWxkIGNvbXBsZXRlLlwiKTtcbiAgICAgICAgLy8gSHR0cENvbm5lY3Rpb24uc3RvcCgpIHNob3VsZCBub3QgY29tcGxldGUgdW50aWwgYWZ0ZXIgZWl0aGVyIEh0dHBDb25uZWN0aW9uLnN0YXJ0KCkgZmFpbHNcbiAgICAgICAgLy8gb3IgdGhlIG9uY2xvc2UgY2FsbGJhY2sgaXMgaW52b2tlZC4gVGhlIG9uY2xvc2UgY2FsbGJhY2sgd2lsbCB0cmFuc2l0aW9uIHRoZSBIdWJDb25uZWN0aW9uXG4gICAgICAgIC8vIHRvIHRoZSBkaXNjb25uZWN0ZWQgc3RhdGUgaWYgbmVlZCBiZSBiZWZvcmUgSHR0cENvbm5lY3Rpb24uc3RvcCgpIGNvbXBsZXRlcy5cbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbi5zdG9wKGVycm9yKTtcbiAgICB9O1xuICAgIC8qKiBJbnZva2VzIGEgc3RyZWFtaW5nIGh1YiBtZXRob2Qgb24gdGhlIHNlcnZlciB1c2luZyB0aGUgc3BlY2lmaWVkIG5hbWUgYW5kIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIEB0eXBlcGFyYW0gVCBUaGUgdHlwZSBvZiB0aGUgaXRlbXMgcmV0dXJuZWQgYnkgdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kTmFtZSBUaGUgbmFtZSBvZiB0aGUgc2VydmVyIG1ldGhvZCB0byBpbnZva2UuXG4gICAgICogQHBhcmFtIHthbnlbXX0gYXJncyBUaGUgYXJndW1lbnRzIHVzZWQgdG8gaW52b2tlIHRoZSBzZXJ2ZXIgbWV0aG9kLlxuICAgICAqIEByZXR1cm5zIHtJU3RyZWFtUmVzdWx0PFQ+fSBBbiBvYmplY3QgdGhhdCB5aWVsZHMgcmVzdWx0cyBmcm9tIHRoZSBzZXJ2ZXIgYXMgdGhleSBhcmUgcmVjZWl2ZWQuXG4gICAgICovXG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuc3RyZWFtID0gZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGFyZ3NbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9hID0gdGhpcy5yZXBsYWNlU3RyZWFtaW5nUGFyYW1zKGFyZ3MpLCBzdHJlYW1zID0gX2FbMF0sIHN0cmVhbUlkcyA9IF9hWzFdO1xuICAgICAgICB2YXIgaW52b2NhdGlvbkRlc2NyaXB0b3IgPSB0aGlzLmNyZWF0ZVN0cmVhbUludm9jYXRpb24obWV0aG9kTmFtZSwgYXJncywgc3RyZWFtSWRzKTtcbiAgICAgICAgdmFyIHByb21pc2VRdWV1ZTtcbiAgICAgICAgdmFyIHN1YmplY3QgPSBuZXcgU3ViamVjdF8xLlN1YmplY3QoKTtcbiAgICAgICAgc3ViamVjdC5jYW5jZWxDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjYW5jZWxJbnZvY2F0aW9uID0gX3RoaXMuY3JlYXRlQ2FuY2VsSW52b2NhdGlvbihpbnZvY2F0aW9uRGVzY3JpcHRvci5pbnZvY2F0aW9uSWQpO1xuICAgICAgICAgICAgZGVsZXRlIF90aGlzLmNhbGxiYWNrc1tpbnZvY2F0aW9uRGVzY3JpcHRvci5pbnZvY2F0aW9uSWRdO1xuICAgICAgICAgICAgcmV0dXJuIHByb21pc2VRdWV1ZS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2VuZFdpdGhQcm90b2NvbChjYW5jZWxJbnZvY2F0aW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNhbGxiYWNrc1tpbnZvY2F0aW9uRGVzY3JpcHRvci5pbnZvY2F0aW9uSWRdID0gZnVuY3Rpb24gKGludm9jYXRpb25FdmVudCwgZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHN1YmplY3QuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGludm9jYXRpb25FdmVudCkge1xuICAgICAgICAgICAgICAgIC8vIGludm9jYXRpb25FdmVudCB3aWxsIG5vdCBiZSBudWxsIHdoZW4gYW4gZXJyb3IgaXMgbm90IHBhc3NlZCB0byB0aGUgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICBpZiAoaW52b2NhdGlvbkV2ZW50LnR5cGUgPT09IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkNvbXBsZXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGludm9jYXRpb25FdmVudC5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdC5lcnJvcihuZXcgRXJyb3IoaW52b2NhdGlvbkV2ZW50LmVycm9yKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dCgoaW52b2NhdGlvbkV2ZW50Lml0ZW0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHByb21pc2VRdWV1ZSA9IHRoaXMuc2VuZFdpdGhQcm90b2NvbChpbnZvY2F0aW9uRGVzY3JpcHRvcilcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgc3ViamVjdC5lcnJvcihlKTtcbiAgICAgICAgICAgIGRlbGV0ZSBfdGhpcy5jYWxsYmFja3NbaW52b2NhdGlvbkRlc2NyaXB0b3IuaW52b2NhdGlvbklkXTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGF1bmNoU3RyZWFtcyhzdHJlYW1zLCBwcm9taXNlUXVldWUpO1xuICAgICAgICByZXR1cm4gc3ViamVjdDtcbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5yZXNldEtlZXBBbGl2ZUludGVydmFsKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24uc2VuZChtZXNzYWdlKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFNlbmRzIGEganMgb2JqZWN0IHRvIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIGpzIG9iamVjdCB0byBzZXJpYWxpemUgYW5kIHNlbmQuXG4gICAgICovXG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuc2VuZFdpdGhQcm90b2NvbCA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbmRNZXNzYWdlKHRoaXMucHJvdG9jb2wud3JpdGVNZXNzYWdlKG1lc3NhZ2UpKTtcbiAgICB9O1xuICAgIC8qKiBJbnZva2VzIGEgaHViIG1ldGhvZCBvbiB0aGUgc2VydmVyIHVzaW5nIHRoZSBzcGVjaWZpZWQgbmFtZSBhbmQgYXJndW1lbnRzLiBEb2VzIG5vdCB3YWl0IGZvciBhIHJlc3BvbnNlIGZyb20gdGhlIHJlY2VpdmVyLlxuICAgICAqXG4gICAgICogVGhlIFByb21pc2UgcmV0dXJuZWQgYnkgdGhpcyBtZXRob2QgcmVzb2x2ZXMgd2hlbiB0aGUgY2xpZW50IGhhcyBzZW50IHRoZSBpbnZvY2F0aW9uIHRvIHRoZSBzZXJ2ZXIuIFRoZSBzZXJ2ZXIgbWF5IHN0aWxsXG4gICAgICogYmUgcHJvY2Vzc2luZyB0aGUgaW52b2NhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2ROYW1lIFRoZSBuYW1lIG9mIHRoZSBzZXJ2ZXIgbWV0aG9kIHRvIGludm9rZS5cbiAgICAgKiBAcGFyYW0ge2FueVtdfSBhcmdzIFRoZSBhcmd1bWVudHMgdXNlZCB0byBpbnZva2UgdGhlIHNlcnZlciBtZXRob2QuXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dm9pZD59IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGludm9jYXRpb24gaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IHNlbnQsIG9yIHJlamVjdHMgd2l0aCBhbiBlcnJvci5cbiAgICAgKi9cbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGFyZ3NbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9hID0gdGhpcy5yZXBsYWNlU3RyZWFtaW5nUGFyYW1zKGFyZ3MpLCBzdHJlYW1zID0gX2FbMF0sIHN0cmVhbUlkcyA9IF9hWzFdO1xuICAgICAgICB2YXIgc2VuZFByb21pc2UgPSB0aGlzLnNlbmRXaXRoUHJvdG9jb2wodGhpcy5jcmVhdGVJbnZvY2F0aW9uKG1ldGhvZE5hbWUsIGFyZ3MsIHRydWUsIHN0cmVhbUlkcykpO1xuICAgICAgICB0aGlzLmxhdW5jaFN0cmVhbXMoc3RyZWFtcywgc2VuZFByb21pc2UpO1xuICAgICAgICByZXR1cm4gc2VuZFByb21pc2U7XG4gICAgfTtcbiAgICAvKiogSW52b2tlcyBhIGh1YiBtZXRob2Qgb24gdGhlIHNlcnZlciB1c2luZyB0aGUgc3BlY2lmaWVkIG5hbWUgYW5kIGFyZ3VtZW50cy5cbiAgICAgKlxuICAgICAqIFRoZSBQcm9taXNlIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kIHJlc29sdmVzIHdoZW4gdGhlIHNlcnZlciBpbmRpY2F0ZXMgaXQgaGFzIGZpbmlzaGVkIGludm9raW5nIHRoZSBtZXRob2QuIFdoZW4gdGhlIHByb21pc2VcbiAgICAgKiByZXNvbHZlcywgdGhlIHNlcnZlciBoYXMgZmluaXNoZWQgaW52b2tpbmcgdGhlIG1ldGhvZC4gSWYgdGhlIHNlcnZlciBtZXRob2QgcmV0dXJucyBhIHJlc3VsdCwgaXQgaXMgcHJvZHVjZWQgYXMgdGhlIHJlc3VsdCBvZlxuICAgICAqIHJlc29sdmluZyB0aGUgUHJvbWlzZS5cbiAgICAgKlxuICAgICAqIEB0eXBlcGFyYW0gVCBUaGUgZXhwZWN0ZWQgcmV0dXJuIHR5cGUuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZE5hbWUgVGhlIG5hbWUgb2YgdGhlIHNlcnZlciBtZXRob2QgdG8gaW52b2tlLlxuICAgICAqIEBwYXJhbSB7YW55W119IGFyZ3MgVGhlIGFyZ3VtZW50cyB1c2VkIHRvIGludm9rZSB0aGUgc2VydmVyIG1ldGhvZC5cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgcmVzdWx0IG9mIHRoZSBzZXJ2ZXIgbWV0aG9kIChpZiBhbnkpLCBvciByZWplY3RzIHdpdGggYW4gZXJyb3IuXG4gICAgICovXG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuaW52b2tlID0gZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGFyZ3NbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9hID0gdGhpcy5yZXBsYWNlU3RyZWFtaW5nUGFyYW1zKGFyZ3MpLCBzdHJlYW1zID0gX2FbMF0sIHN0cmVhbUlkcyA9IF9hWzFdO1xuICAgICAgICB2YXIgaW52b2NhdGlvbkRlc2NyaXB0b3IgPSB0aGlzLmNyZWF0ZUludm9jYXRpb24obWV0aG9kTmFtZSwgYXJncywgZmFsc2UsIHN0cmVhbUlkcyk7XG4gICAgICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgLy8gaW52b2NhdGlvbklkIHdpbGwgYWx3YXlzIGhhdmUgYSB2YWx1ZSBmb3IgYSBub24tYmxvY2tpbmcgaW52b2NhdGlvblxuICAgICAgICAgICAgX3RoaXMuY2FsbGJhY2tzW2ludm9jYXRpb25EZXNjcmlwdG9yLmludm9jYXRpb25JZF0gPSBmdW5jdGlvbiAoaW52b2NhdGlvbkV2ZW50LCBlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGludm9jYXRpb25FdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBpbnZvY2F0aW9uRXZlbnQgd2lsbCBub3QgYmUgbnVsbCB3aGVuIGFuIGVycm9yIGlzIG5vdCBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnZvY2F0aW9uRXZlbnQudHlwZSA9PT0gSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuQ29tcGxldGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludm9jYXRpb25FdmVudC5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoaW52b2NhdGlvbkV2ZW50LmVycm9yKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGludm9jYXRpb25FdmVudC5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgbWVzc2FnZSB0eXBlOiBcIiArIGludm9jYXRpb25FdmVudC50eXBlKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIHByb21pc2VRdWV1ZSA9IF90aGlzLnNlbmRXaXRoUHJvdG9jb2woaW52b2NhdGlvbkRlc2NyaXB0b3IpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgIC8vIGludm9jYXRpb25JZCB3aWxsIGFsd2F5cyBoYXZlIGEgdmFsdWUgZm9yIGEgbm9uLWJsb2NraW5nIGludm9jYXRpb25cbiAgICAgICAgICAgICAgICBkZWxldGUgX3RoaXMuY2FsbGJhY2tzW2ludm9jYXRpb25EZXNjcmlwdG9yLmludm9jYXRpb25JZF07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF90aGlzLmxhdW5jaFN0cmVhbXMoc3RyZWFtcywgcHJvbWlzZVF1ZXVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwO1xuICAgIH07XG4gICAgLyoqIFJlZ2lzdGVycyBhIGhhbmRsZXIgdGhhdCB3aWxsIGJlIGludm9rZWQgd2hlbiB0aGUgaHViIG1ldGhvZCB3aXRoIHRoZSBzcGVjaWZpZWQgbWV0aG9kIG5hbWUgaXMgaW52b2tlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2ROYW1lIFRoZSBuYW1lIG9mIHRoZSBodWIgbWV0aG9kIHRvIGRlZmluZS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBuZXdNZXRob2QgVGhlIGhhbmRsZXIgdGhhdCB3aWxsIGJlIHJhaXNlZCB3aGVuIHRoZSBodWIgbWV0aG9kIGlzIGludm9rZWQuXG4gICAgICovXG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAobWV0aG9kTmFtZSwgbmV3TWV0aG9kKSB7XG4gICAgICAgIGlmICghbWV0aG9kTmFtZSB8fCAhbmV3TWV0aG9kKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbWV0aG9kTmFtZSA9IG1ldGhvZE5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKCF0aGlzLm1ldGhvZHNbbWV0aG9kTmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMubWV0aG9kc1ttZXRob2ROYW1lXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIC8vIFByZXZlbnRpbmcgYWRkaW5nIHRoZSBzYW1lIGhhbmRsZXIgbXVsdGlwbGUgdGltZXMuXG4gICAgICAgIGlmICh0aGlzLm1ldGhvZHNbbWV0aG9kTmFtZV0uaW5kZXhPZihuZXdNZXRob2QpICE9PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWV0aG9kc1ttZXRob2ROYW1lXS5wdXNoKG5ld01ldGhvZCk7XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAobWV0aG9kTmFtZSwgbWV0aG9kKSB7XG4gICAgICAgIGlmICghbWV0aG9kTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIG1ldGhvZE5hbWUgPSBtZXRob2ROYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciBoYW5kbGVycyA9IHRoaXMubWV0aG9kc1ttZXRob2ROYW1lXTtcbiAgICAgICAgaWYgKCFoYW5kbGVycykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtZXRob2QpIHtcbiAgICAgICAgICAgIHZhciByZW1vdmVJZHggPSBoYW5kbGVycy5pbmRleE9mKG1ldGhvZCk7XG4gICAgICAgICAgICBpZiAocmVtb3ZlSWR4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXJzLnNwbGljZShyZW1vdmVJZHgsIDEpO1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMubWV0aG9kc1ttZXRob2ROYW1lXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5tZXRob2RzW21ldGhvZE5hbWVdO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKiogUmVnaXN0ZXJzIGEgaGFuZGxlciB0aGF0IHdpbGwgYmUgaW52b2tlZCB3aGVuIHRoZSBjb25uZWN0aW9uIGlzIGNsb3NlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBoYW5kbGVyIHRoYXQgd2lsbCBiZSBpbnZva2VkIHdoZW4gdGhlIGNvbm5lY3Rpb24gaXMgY2xvc2VkLiBPcHRpb25hbGx5IHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IGNvbnRhaW5pbmcgdGhlIGVycm9yIHRoYXQgY2F1c2VkIHRoZSBjb25uZWN0aW9uIHRvIGNsb3NlIChpZiBhbnkpLlxuICAgICAqL1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLm9uY2xvc2UgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlZENhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqIFJlZ2lzdGVycyBhIGhhbmRsZXIgdGhhdCB3aWxsIGJlIGludm9rZWQgd2hlbiB0aGUgY29ubmVjdGlvbiBzdGFydHMgcmVjb25uZWN0aW5nLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGhhbmRsZXIgdGhhdCB3aWxsIGJlIGludm9rZWQgd2hlbiB0aGUgY29ubmVjdGlvbiBzdGFydHMgcmVjb25uZWN0aW5nLiBPcHRpb25hbGx5IHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IGNvbnRhaW5pbmcgdGhlIGVycm9yIHRoYXQgY2F1c2VkIHRoZSBjb25uZWN0aW9uIHRvIHN0YXJ0IHJlY29ubmVjdGluZyAoaWYgYW55KS5cbiAgICAgKi9cbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5vbnJlY29ubmVjdGluZyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0aW5nQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKiogUmVnaXN0ZXJzIGEgaGFuZGxlciB0aGF0IHdpbGwgYmUgaW52b2tlZCB3aGVuIHRoZSBjb25uZWN0aW9uIHN1Y2Nlc3NmdWxseSByZWNvbm5lY3RzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGhhbmRsZXIgdGhhdCB3aWxsIGJlIGludm9rZWQgd2hlbiB0aGUgY29ubmVjdGlvbiBzdWNjZXNzZnVsbHkgcmVjb25uZWN0cy5cbiAgICAgKi9cbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5vbnJlY29ubmVjdGVkID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RlZENhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUucHJvY2Vzc0luY29taW5nRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuY2xlYW51cFRpbWVvdXQoKTtcbiAgICAgICAgaWYgKCF0aGlzLnJlY2VpdmVkSGFuZHNoYWtlUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLnByb2Nlc3NIYW5kc2hha2VSZXNwb25zZShkYXRhKTtcbiAgICAgICAgICAgIHRoaXMucmVjZWl2ZWRIYW5kc2hha2VSZXNwb25zZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRGF0YSBtYXkgaGF2ZSBhbGwgYmVlbiByZWFkIHdoZW4gcHJvY2Vzc2luZyBoYW5kc2hha2UgcmVzcG9uc2VcbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIC8vIFBhcnNlIHRoZSBtZXNzYWdlc1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gdGhpcy5wcm90b2NvbC5wYXJzZU1lc3NhZ2VzKGRhdGEsIHRoaXMubG9nZ2VyKTtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgbWVzc2FnZXNfMSA9IG1lc3NhZ2VzOyBfaSA8IG1lc3NhZ2VzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBtZXNzYWdlc18xW19pXTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG1lc3NhZ2UudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkludm9jYXRpb246XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludm9rZUNsaWVudE1ldGhvZChtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLlN0cmVhbUl0ZW06XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuQ29tcGxldGlvbjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IHRoaXMuY2FsbGJhY2tzW21lc3NhZ2UuaW52b2NhdGlvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnR5cGUgPT09IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkNvbXBsZXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY2FsbGJhY2tzW21lc3NhZ2UuaW52b2NhdGlvbklkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5QaW5nOlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgY2FyZSBhYm91dCBwaW5nc1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuQ2xvc2U6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uLCBcIkNsb3NlIG1lc3NhZ2UgcmVjZWl2ZWQgZnJvbSBzZXJ2ZXIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbWVzc2FnZS5lcnJvciA/IG5ldyBFcnJvcihcIlNlcnZlciByZXR1cm5lZCBhbiBlcnJvciBvbiBjbG9zZTogXCIgKyBtZXNzYWdlLmVycm9yKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmFsbG93UmVjb25uZWN0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXQgZmVlbHMgd3Jvbmcgbm90IHRvIGF3YWl0IGNvbm5lY3Rpb24uc3RvcCgpIGhlcmUsIGJ1dCBwcm9jZXNzSW5jb21pbmdEYXRhIGlzIGNhbGxlZCBhcyBwYXJ0IG9mIGFuIG9ucmVjZWl2ZSBjYWxsYmFjayB3aGljaCBpcyBub3QgYXN5bmMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBhbHJlYWR5IHRoZSBiZWhhdmlvciBmb3Igc2VydmVyVGltZW91dCgpLCBhbmQgSHR0cENvbm5lY3Rpb24uU3RvcCgpIHNob3VsZCBjYXRjaCBhbmQgbG9nIGFsbCBwb3NzaWJsZSBleGNlcHRpb25zLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5zdG9wKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGNhbm5vdCBhd2FpdCBzdG9wSW50ZXJuYWwoKSBoZXJlLCBidXQgc3Vic2VxdWVudCBjYWxscyB0byBzdG9wKCkgd2lsbCBhd2FpdCB0aGlzIGlmIHN0b3BJbnRlcm5hbCgpIGlzIHN0aWxsIG9uZ29pbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wUHJvbWlzZSA9IHRoaXMuc3RvcEludGVybmFsKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5XYXJuaW5nLCBcIkludmFsaWQgbWVzc2FnZSB0eXBlOiBcIiArIG1lc3NhZ2UudHlwZSArIFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc2V0VGltZW91dFBlcmlvZCgpO1xuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUucHJvY2Vzc0hhbmRzaGFrZVJlc3BvbnNlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB2YXIgcmVzcG9uc2VNZXNzYWdlO1xuICAgICAgICB2YXIgcmVtYWluaW5nRGF0YTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIF9hID0gdGhpcy5oYW5kc2hha2VQcm90b2NvbC5wYXJzZUhhbmRzaGFrZVJlc3BvbnNlKGRhdGEpLCByZW1haW5pbmdEYXRhID0gX2FbMF0sIHJlc3BvbnNlTWVzc2FnZSA9IF9hWzFdO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiRXJyb3IgcGFyc2luZyBoYW5kc2hha2UgcmVzcG9uc2U6IFwiICsgZTtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgICAgICAgICAgdGhpcy5oYW5kc2hha2VSZWplY3RlcihlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzcG9uc2VNZXNzYWdlLmVycm9yKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiU2VydmVyIHJldHVybmVkIGhhbmRzaGFrZSBlcnJvcjogXCIgKyByZXNwb25zZU1lc3NhZ2UuZXJyb3I7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZHNoYWtlUmVqZWN0ZXIoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIlNlcnZlciBoYW5kc2hha2UgY29tcGxldGUuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFuZHNoYWtlUmVzb2x2ZXIoKTtcbiAgICAgICAgcmV0dXJuIHJlbWFpbmluZ0RhdGE7XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5yZXNldEtlZXBBbGl2ZUludGVydmFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uLmZlYXR1cmVzLmluaGVyZW50S2VlcEFsaXZlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGVhbnVwUGluZ1RpbWVyKCk7XG4gICAgICAgIHRoaXMucGluZ1NlcnZlckhhbmRsZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2IubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy5jb25uZWN0aW9uU3RhdGUgPT09IEh1YkNvbm5lY3Rpb25TdGF0ZS5Db25uZWN0ZWQpKSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2IudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc2VuZE1lc3NhZ2UodGhpcy5jYWNoZWRQaW5nTWVzc2FnZSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA0XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EgPSBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IHRoZSBlcnJvci4gSXQgc2hvdWxkIGJlIHNlZW4gZWxzZXdoZXJlIGluIHRoZSBjbGllbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgY29ubmVjdGlvbiBpcyBwcm9iYWJseSBpbiBhIGJhZCBvciBjbG9zZWQgc3RhdGUgbm93LCBjbGVhbnVwIHRoZSB0aW1lciBzbyBpdCBzdG9wcyB0cmlnZ2VyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFudXBQaW5nVGltZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7IH0sIHRoaXMua2VlcEFsaXZlSW50ZXJ2YWxJbk1pbGxpc2Vjb25kcyk7XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5yZXNldFRpbWVvdXRQZXJpb2QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5jb25uZWN0aW9uLmZlYXR1cmVzIHx8ICF0aGlzLmNvbm5lY3Rpb24uZmVhdHVyZXMuaW5oZXJlbnRLZWVwQWxpdmUpIHtcbiAgICAgICAgICAgIC8vIFNldCB0aGUgdGltZW91dCB0aW1lclxuICAgICAgICAgICAgdGhpcy50aW1lb3V0SGFuZGxlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXJ2ZXJUaW1lb3V0KCk7IH0sIHRoaXMuc2VydmVyVGltZW91dEluTWlsbGlzZWNvbmRzKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuc2VydmVyVGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVGhlIHNlcnZlciBoYXNuJ3QgdGFsa2VkIHRvIHVzIGluIGEgd2hpbGUuIEl0IGRvZXNuJ3QgbGlrZSB1cyBhbnltb3JlIC4uLiA6KFxuICAgICAgICAvLyBUZXJtaW5hdGUgdGhlIGNvbm5lY3Rpb24sIGJ1dCB3ZSBkb24ndCBuZWVkIHRvIHdhaXQgb24gdGhlIHByb21pc2UuIFRoaXMgY291bGQgdHJpZ2dlciByZWNvbm5lY3RpbmcuXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc3RvcChuZXcgRXJyb3IoXCJTZXJ2ZXIgdGltZW91dCBlbGFwc2VkIHdpdGhvdXQgcmVjZWl2aW5nIGEgbWVzc2FnZSBmcm9tIHRoZSBzZXJ2ZXIuXCIpKTtcbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLmludm9rZUNsaWVudE1ldGhvZCA9IGZ1bmN0aW9uIChpbnZvY2F0aW9uTWVzc2FnZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgbWV0aG9kcyA9IHRoaXMubWV0aG9kc1tpbnZvY2F0aW9uTWVzc2FnZS50YXJnZXQudG9Mb3dlckNhc2UoKV07XG4gICAgICAgIGlmIChtZXRob2RzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIG1ldGhvZHMuZm9yRWFjaChmdW5jdGlvbiAobSkgeyByZXR1cm4gbS5hcHBseShfdGhpcywgaW52b2NhdGlvbk1lc3NhZ2UuYXJndW1lbnRzKTsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiQSBjYWxsYmFjayBmb3IgdGhlIG1ldGhvZCBcIiArIGludm9jYXRpb25NZXNzYWdlLnRhcmdldC50b0xvd2VyQ2FzZSgpICsgXCIgdGhyZXcgZXJyb3IgJ1wiICsgZSArIFwiJy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW52b2NhdGlvbk1lc3NhZ2UuaW52b2NhdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBub3Qgc3VwcG9ydGVkIGluIHYxLiBTbyB3ZSByZXR1cm4gYW4gZXJyb3IgdG8gYXZvaWQgYmxvY2tpbmcgdGhlIHNlcnZlciB3YWl0aW5nIGZvciB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIlNlcnZlciByZXF1ZXN0ZWQgYSByZXNwb25zZSwgd2hpY2ggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIHZlcnNpb24gb2YgdGhlIGNsaWVudC5cIjtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCB3YW50IHRvIHdhaXQgb24gdGhlIHN0b3AgaXRzZWxmLlxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcFByb21pc2UgPSB0aGlzLnN0b3BJbnRlcm5hbChuZXcgRXJyb3IobWVzc2FnZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5XYXJuaW5nLCBcIk5vIGNsaWVudCBtZXRob2Qgd2l0aCB0aGUgbmFtZSAnXCIgKyBpbnZvY2F0aW9uTWVzc2FnZS50YXJnZXQgKyBcIicgZm91bmQuXCIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5jb25uZWN0aW9uQ2xvc2VkID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiSHViQ29ubmVjdGlvbi5jb25uZWN0aW9uQ2xvc2VkKFwiICsgZXJyb3IgKyBcIikgY2FsbGVkIHdoaWxlIGluIHN0YXRlIFwiICsgdGhpcy5jb25uZWN0aW9uU3RhdGUgKyBcIi5cIik7XG4gICAgICAgIC8vIFRyaWdnZXJpbmcgdGhpcy5oYW5kc2hha2VSZWplY3RlciBpcyBpbnN1ZmZpY2llbnQgYmVjYXVzZSBpdCBjb3VsZCBhbHJlYWR5IGJlIHJlc29sdmVkIHdpdGhvdXQgdGhlIGNvbnRpbnVhdGlvbiBoYXZpbmcgcnVuIHlldC5cbiAgICAgICAgdGhpcy5zdG9wRHVyaW5nU3RhcnRFcnJvciA9IHRoaXMuc3RvcER1cmluZ1N0YXJ0RXJyb3IgfHwgZXJyb3IgfHwgbmV3IEVycm9yKFwiVGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbiB3YXMgY2xvc2VkIGJlZm9yZSB0aGUgaHViIGhhbmRzaGFrZSBjb3VsZCBjb21wbGV0ZS5cIik7XG4gICAgICAgIC8vIElmIHRoZSBoYW5kc2hha2UgaXMgaW4gcHJvZ3Jlc3MsIHN0YXJ0IHdpbGwgYmUgd2FpdGluZyBmb3IgdGhlIGhhbmRzaGFrZSBwcm9taXNlLCBzbyB3ZSBjb21wbGV0ZSBpdC5cbiAgICAgICAgLy8gSWYgaXQgaGFzIGFscmVhZHkgY29tcGxldGVkLCB0aGlzIHNob3VsZCBqdXN0IG5vb3AuXG4gICAgICAgIGlmICh0aGlzLmhhbmRzaGFrZVJlc29sdmVyKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRzaGFrZVJlc29sdmVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW5jZWxDYWxsYmFja3NXaXRoRXJyb3IoZXJyb3IgfHwgbmV3IEVycm9yKFwiSW52b2NhdGlvbiBjYW5jZWxlZCBkdWUgdG8gdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbiBiZWluZyBjbG9zZWQuXCIpKTtcbiAgICAgICAgdGhpcy5jbGVhbnVwVGltZW91dCgpO1xuICAgICAgICB0aGlzLmNsZWFudXBQaW5nVGltZXIoKTtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXRlID09PSBIdWJDb25uZWN0aW9uU3RhdGUuRGlzY29ubmVjdGluZykge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZUNsb3NlKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSA9PT0gSHViQ29ubmVjdGlvblN0YXRlLkNvbm5lY3RlZCAmJiB0aGlzLnJlY29ubmVjdFBvbGljeSkge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgICAgICB0aGlzLnJlY29ubmVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5jb25uZWN0aW9uU3RhdGUgPT09IEh1YkNvbm5lY3Rpb25TdGF0ZS5Db25uZWN0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVDbG9zZShlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgbm9uZSBvZiB0aGUgYWJvdmUgaWYgY29uZGl0aW9ucyB3ZXJlIHRydWUgd2VyZSBjYWxsZWQgdGhlIEh1YkNvbm5lY3Rpb24gbXVzdCBiZSBpbiBlaXRoZXI6XG4gICAgICAgIC8vIDEuIFRoZSBDb25uZWN0aW5nIHN0YXRlIGluIHdoaWNoIGNhc2UgdGhlIGhhbmRzaGFrZVJlc29sdmVyIHdpbGwgY29tcGxldGUgaXQgYW5kIHN0b3BEdXJpbmdTdGFydEVycm9yIHdpbGwgZmFpbCBpdC5cbiAgICAgICAgLy8gMi4gVGhlIFJlY29ubmVjdGluZyBzdGF0ZSBpbiB3aGljaCBjYXNlIHRoZSBoYW5kc2hha2VSZXNvbHZlciB3aWxsIGNvbXBsZXRlIGl0IGFuZCBzdG9wRHVyaW5nU3RhcnRFcnJvciB3aWxsIGZhaWwgdGhlIGN1cnJlbnQgcmVjb25uZWN0IGF0dGVtcHRcbiAgICAgICAgLy8gICAgYW5kIHBvdGVudGlhbGx5IGNvbnRpbnVlIHRoZSByZWNvbm5lY3QoKSBsb29wLlxuICAgICAgICAvLyAzLiBUaGUgRGlzY29ubmVjdGVkIHN0YXRlIGluIHdoaWNoIGNhc2Ugd2UncmUgYWxyZWFkeSBkb25lLlxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY29tcGxldGVDbG9zZSA9IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uU3RhcnRlZCkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBIdWJDb25uZWN0aW9uU3RhdGUuRGlzY29ubmVjdGVkO1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlZENhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLmFwcGx5KF90aGlzLCBbZXJyb3JdKTsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiQW4gb25jbG9zZSBjYWxsYmFjayBjYWxsZWQgd2l0aCBlcnJvciAnXCIgKyBlcnJvciArIFwiJyB0aHJldyBlcnJvciAnXCIgKyBlICsgXCInLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUucmVjb25uZWN0ID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByZWNvbm5lY3RTdGFydFRpbWUsIHByZXZpb3VzUmVjb25uZWN0QXR0ZW1wdHMsIHJldHJ5RXJyb3IsIG5leHRSZXRyeURlbGF5LCBlXzQ7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzUmVjb25uZWN0QXR0ZW1wdHMgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlFcnJvciA9IGVycm9yICE9PSB1bmRlZmluZWQgPyBlcnJvciA6IG5ldyBFcnJvcihcIkF0dGVtcHRpbmcgdG8gcmVjb25uZWN0IGR1ZSB0byBhIHVua25vd24gZXJyb3IuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFJldHJ5RGVsYXkgPSB0aGlzLmdldE5leHRSZXRyeURlbGF5KHByZXZpb3VzUmVjb25uZWN0QXR0ZW1wdHMrKywgMCwgcmV0cnlFcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFJldHJ5RGVsYXkgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIkNvbm5lY3Rpb24gbm90IHJlY29ubmVjdGluZyBiZWNhdXNlIHRoZSBJUmV0cnlQb2xpY3kgcmV0dXJuZWQgbnVsbCBvbiB0aGUgZmlyc3QgcmVjb25uZWN0IGF0dGVtcHQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVDbG9zZShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBIdWJDb25uZWN0aW9uU3RhdGUuUmVjb25uZWN0aW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5JbmZvcm1hdGlvbiwgXCJDb25uZWN0aW9uIHJlY29ubmVjdGluZyBiZWNhdXNlIG9mIGVycm9yICdcIiArIGVycm9yICsgXCInLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiQ29ubmVjdGlvbiByZWNvbm5lY3RpbmcuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25yZWNvbm5lY3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdGluZ0NhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLmFwcGx5KF90aGlzLCBbZXJyb3JdKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiQW4gb25yZWNvbm5lY3RpbmcgY2FsbGJhY2sgY2FsbGVkIHdpdGggZXJyb3IgJ1wiICsgZXJyb3IgKyBcIicgdGhyZXcgZXJyb3IgJ1wiICsgZSArIFwiJy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4aXQgZWFybHkgaWYgYW4gb25yZWNvbm5lY3RpbmcgY2FsbGJhY2sgY2FsbGVkIGNvbm5lY3Rpb24uc3RvcCgpLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gSHViQ29ubmVjdGlvblN0YXRlLlJlY29ubmVjdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkRlYnVnLCBcIkNvbm5lY3Rpb24gbGVmdCB0aGUgcmVjb25uZWN0aW5nIHN0YXRlIGluIG9ucmVjb25uZWN0aW5nIGNhbGxiYWNrLiBEb25lIHJlY29ubmVjdGluZy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG5leHRSZXRyeURlbGF5ICE9PSBudWxsKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgN107XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uLCBcIlJlY29ubmVjdCBhdHRlbXB0IG51bWJlciBcIiArIHByZXZpb3VzUmVjb25uZWN0QXR0ZW1wdHMgKyBcIiB3aWxsIHN0YXJ0IGluIFwiICsgbmV4dFJldHJ5RGVsYXkgKyBcIiBtcy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZWNvbm5lY3REZWxheUhhbmRsZSA9IHNldFRpbWVvdXQocmVzb2x2ZSwgbmV4dFJldHJ5RGVsYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3REZWxheUhhbmRsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gSHViQ29ubmVjdGlvblN0YXRlLlJlY29ubmVjdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiQ29ubmVjdGlvbiBsZWZ0IHRoZSByZWNvbm5lY3Rpbmcgc3RhdGUgZHVyaW5nIHJlY29ubmVjdCBkZWxheS4gRG9uZSByZWNvbm5lY3RpbmcuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFszLCA1LCAsIDZdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc3RhcnRJbnRlcm5hbCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBIdWJDb25uZWN0aW9uU3RhdGUuQ29ubmVjdGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5JbmZvcm1hdGlvbiwgXCJIdWJDb25uZWN0aW9uIHJlY29ubmVjdGVkIHN1Y2Nlc3NmdWxseS5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbnJlY29ubmVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RlZENhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLmFwcGx5KF90aGlzLCBbX3RoaXMuY29ubmVjdGlvbi5jb25uZWN0aW9uSWRdKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiQW4gb25yZWNvbm5lY3RlZCBjYWxsYmFjayBjYWxsZWQgd2l0aCBjb25uZWN0aW9uSWQgJ1wiICsgdGhpcy5jb25uZWN0aW9uLmNvbm5lY3Rpb25JZCArIFwiOyB0aHJldyBlcnJvciAnXCIgKyBlICsgXCInLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfNCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiUmVjb25uZWN0IGF0dGVtcHQgZmFpbGVkIGJlY2F1c2Ugb2YgZXJyb3IgJ1wiICsgZV80ICsgXCInLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0ZSAhPT0gSHViQ29ubmVjdGlvblN0YXRlLlJlY29ubmVjdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRGVidWcsIFwiQ29ubmVjdGlvbiBsZWZ0IHRoZSByZWNvbm5lY3Rpbmcgc3RhdGUgZHVyaW5nIHJlY29ubmVjdCBhdHRlbXB0LiBEb25lIHJlY29ubmVjdGluZy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlFcnJvciA9IGVfNCBpbnN0YW5jZW9mIEVycm9yID8gZV80IDogbmV3IEVycm9yKGVfNC50b1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRSZXRyeURlbGF5ID0gdGhpcy5nZXROZXh0UmV0cnlEZWxheShwcmV2aW91c1JlY29ubmVjdEF0dGVtcHRzKyssIERhdGUubm93KCkgLSByZWNvbm5lY3RTdGFydFRpbWUsIHJldHJ5RXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjogcmV0dXJuIFszIC8qYnJlYWsqLywgMV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiUmVjb25uZWN0IHJldHJpZXMgaGF2ZSBiZWVuIGV4aGF1c3RlZCBhZnRlciBcIiArIChEYXRlLm5vdygpIC0gcmVjb25uZWN0U3RhcnRUaW1lKSArIFwiIG1zIGFuZCBcIiArIHByZXZpb3VzUmVjb25uZWN0QXR0ZW1wdHMgKyBcIiBmYWlsZWQgYXR0ZW1wdHMuIENvbm5lY3Rpb24gZGlzY29ubmVjdGluZy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlQ2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXROZXh0UmV0cnlEZWxheSA9IGZ1bmN0aW9uIChwcmV2aW91c1JldHJ5Q291bnQsIGVsYXBzZWRNaWxsaXNlY29uZHMsIHJldHJ5UmVhc29uKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZWNvbm5lY3RQb2xpY3kubmV4dFJldHJ5RGVsYXlJbk1pbGxpc2Vjb25kcyh7XG4gICAgICAgICAgICAgICAgZWxhcHNlZE1pbGxpc2Vjb25kczogZWxhcHNlZE1pbGxpc2Vjb25kcyxcbiAgICAgICAgICAgICAgICBwcmV2aW91c1JldHJ5Q291bnQ6IHByZXZpb3VzUmV0cnlDb3VudCxcbiAgICAgICAgICAgICAgICByZXRyeVJlYXNvbjogcmV0cnlSZWFzb24sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5FcnJvciwgXCJJUmV0cnlQb2xpY3kubmV4dFJldHJ5RGVsYXlJbk1pbGxpc2Vjb25kcyhcIiArIHByZXZpb3VzUmV0cnlDb3VudCArIFwiLCBcIiArIGVsYXBzZWRNaWxsaXNlY29uZHMgKyBcIikgdGhyZXcgZXJyb3IgJ1wiICsgZSArIFwiJy5cIik7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY2FuY2VsQ2FsbGJhY2tzV2l0aEVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIHZhciBjYWxsYmFja3MgPSB0aGlzLmNhbGxiYWNrcztcbiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSB7fTtcbiAgICAgICAgT2JqZWN0LmtleXMoY2FsbGJhY2tzKVxuICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzW2tleV07XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY2xlYW51cFBpbmdUaW1lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGluZ1NlcnZlckhhbmRsZSkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucGluZ1NlcnZlckhhbmRsZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLmNsZWFudXBUaW1lb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy50aW1lb3V0SGFuZGxlKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0SGFuZGxlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlSW52b2NhdGlvbiA9IGZ1bmN0aW9uIChtZXRob2ROYW1lLCBhcmdzLCBub25ibG9ja2luZywgc3RyZWFtSWRzKSB7XG4gICAgICAgIGlmIChub25ibG9ja2luZykge1xuICAgICAgICAgICAgaWYgKHN0cmVhbUlkcy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGFyZ3MsXG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbUlkczogc3RyZWFtSWRzLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IG1ldGhvZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkludm9jYXRpb24sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogYXJncyxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBtZXRob2ROYW1lLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5JbnZvY2F0aW9uLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgaW52b2NhdGlvbklkID0gdGhpcy5pbnZvY2F0aW9uSWQ7XG4gICAgICAgICAgICB0aGlzLmludm9jYXRpb25JZCsrO1xuICAgICAgICAgICAgaWYgKHN0cmVhbUlkcy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGFyZ3MsXG4gICAgICAgICAgICAgICAgICAgIGludm9jYXRpb25JZDogaW52b2NhdGlvbklkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbUlkczogc3RyZWFtSWRzLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IG1ldGhvZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkludm9jYXRpb24sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogYXJncyxcbiAgICAgICAgICAgICAgICAgICAgaW52b2NhdGlvbklkOiBpbnZvY2F0aW9uSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBtZXRob2ROYW1lLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5JbnZvY2F0aW9uLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLmxhdW5jaFN0cmVhbXMgPSBmdW5jdGlvbiAoc3RyZWFtcywgcHJvbWlzZVF1ZXVlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChzdHJlYW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFN5bmNocm9uaXplIHN0cmVhbSBkYXRhIHNvIHRoZXkgYXJyaXZlIGluLW9yZGVyIG9uIHRoZSBzZXJ2ZXJcbiAgICAgICAgaWYgKCFwcm9taXNlUXVldWUpIHtcbiAgICAgICAgICAgIHByb21pc2VRdWV1ZSA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKHN0cmVhbUlkKSB7XG4gICAgICAgICAgICBzdHJlYW1zW3N0cmVhbUlkXS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2VRdWV1ZSA9IHByb21pc2VRdWV1ZS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbmRXaXRoUHJvdG9jb2woX3RoaXMuY3JlYXRlQ29tcGxldGlvbk1lc3NhZ2Uoc3RyZWFtSWQpKTsgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gZXJyLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyICYmIGVyci50b1N0cmluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IGVyci50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiVW5rbm93biBlcnJvclwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2VRdWV1ZSA9IHByb21pc2VRdWV1ZS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbmRXaXRoUHJvdG9jb2woX3RoaXMuY3JlYXRlQ29tcGxldGlvbk1lc3NhZ2Uoc3RyZWFtSWQsIG1lc3NhZ2UpKTsgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlUXVldWUgPSBwcm9taXNlUXVldWUudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZW5kV2l0aFByb3RvY29sKF90aGlzLmNyZWF0ZVN0cmVhbUl0ZW1NZXNzYWdlKHN0cmVhbUlkLCBpdGVtKSk7IH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gV2Ugd2FudCB0byBpdGVyYXRlIG92ZXIgdGhlIGtleXMsIHNpbmNlIHRoZSBrZXlzIGFyZSB0aGUgc3RyZWFtIGlkc1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Zm9yaW5cbiAgICAgICAgZm9yICh2YXIgc3RyZWFtSWQgaW4gc3RyZWFtcykge1xuICAgICAgICAgICAgX2xvb3BfMShzdHJlYW1JZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb24ucHJvdG90eXBlLnJlcGxhY2VTdHJlYW1pbmdQYXJhbXMgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB2YXIgc3RyZWFtcyA9IFtdO1xuICAgICAgICB2YXIgc3RyZWFtSWRzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGFyZ3VtZW50ID0gYXJnc1tpXTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzT2JzZXJ2YWJsZShhcmd1bWVudCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RyZWFtSWQgPSB0aGlzLmludm9jYXRpb25JZDtcbiAgICAgICAgICAgICAgICB0aGlzLmludm9jYXRpb25JZCsrO1xuICAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBzdHJlYW0gZm9yIGxhdGVyIHVzZVxuICAgICAgICAgICAgICAgIHN0cmVhbXNbc3RyZWFtSWRdID0gYXJndW1lbnQ7XG4gICAgICAgICAgICAgICAgc3RyZWFtSWRzLnB1c2goc3RyZWFtSWQudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHN0cmVhbSBmcm9tIGFyZ3NcbiAgICAgICAgICAgICAgICBhcmdzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW3N0cmVhbXMsIHN0cmVhbUlkc107XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5pc09ic2VydmFibGUgPSBmdW5jdGlvbiAoYXJnKSB7XG4gICAgICAgIC8vIFRoaXMgYWxsb3dzIG90aGVyIHN0cmVhbSBpbXBsZW1lbnRhdGlvbnMgdG8ganVzdCB3b3JrIChsaWtlIHJ4anMpXG4gICAgICAgIHJldHVybiBhcmcgJiYgYXJnLnN1YnNjcmliZSAmJiB0eXBlb2YgYXJnLnN1YnNjcmliZSA9PT0gXCJmdW5jdGlvblwiO1xuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlU3RyZWFtSW52b2NhdGlvbiA9IGZ1bmN0aW9uIChtZXRob2ROYW1lLCBhcmdzLCBzdHJlYW1JZHMpIHtcbiAgICAgICAgdmFyIGludm9jYXRpb25JZCA9IHRoaXMuaW52b2NhdGlvbklkO1xuICAgICAgICB0aGlzLmludm9jYXRpb25JZCsrO1xuICAgICAgICBpZiAoc3RyZWFtSWRzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGFyZ3MsXG4gICAgICAgICAgICAgICAgaW52b2NhdGlvbklkOiBpbnZvY2F0aW9uSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBzdHJlYW1JZHM6IHN0cmVhbUlkcyxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IG1ldGhvZE5hbWUsXG4gICAgICAgICAgICAgICAgdHlwZTogSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuU3RyZWFtSW52b2NhdGlvbixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFyZ3VtZW50czogYXJncyxcbiAgICAgICAgICAgICAgICBpbnZvY2F0aW9uSWQ6IGludm9jYXRpb25JZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHRhcmdldDogbWV0aG9kTmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5TdHJlYW1JbnZvY2F0aW9uLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlQ2FuY2VsSW52b2NhdGlvbiA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaW52b2NhdGlvbklkOiBpZCxcbiAgICAgICAgICAgIHR5cGU6IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkNhbmNlbEludm9jYXRpb24sXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBIdWJDb25uZWN0aW9uLnByb3RvdHlwZS5jcmVhdGVTdHJlYW1JdGVtTWVzc2FnZSA9IGZ1bmN0aW9uIChpZCwgaXRlbSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaW52b2NhdGlvbklkOiBpZCxcbiAgICAgICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgICAgICB0eXBlOiBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5TdHJlYW1JdGVtLFxuICAgICAgICB9O1xuICAgIH07XG4gICAgSHViQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlQ29tcGxldGlvbk1lc3NhZ2UgPSBmdW5jdGlvbiAoaWQsIGVycm9yLCByZXN1bHQpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvcixcbiAgICAgICAgICAgICAgICBpbnZvY2F0aW9uSWQ6IGlkLFxuICAgICAgICAgICAgICAgIHR5cGU6IElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLkNvbXBsZXRpb24sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbnZvY2F0aW9uSWQ6IGlkLFxuICAgICAgICAgICAgcmVzdWx0OiByZXN1bHQsXG4gICAgICAgICAgICB0eXBlOiBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5Db21wbGV0aW9uLFxuICAgICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIEh1YkNvbm5lY3Rpb247XG59KCkpO1xuZXhwb3J0cy5IdWJDb25uZWN0aW9uID0gSHViQ29ubmVjdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUh1YkNvbm5lY3Rpb24uanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcSHViQ29ubmVjdGlvbi5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcbiAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgfVxuICAgIHJldHVybiB0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBEZWZhdWx0UmVjb25uZWN0UG9saWN5XzEgPSByZXF1aXJlKFwiLi9EZWZhdWx0UmVjb25uZWN0UG9saWN5XCIpO1xudmFyIEh0dHBDb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9IdHRwQ29ubmVjdGlvblwiKTtcbnZhciBIdWJDb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9IdWJDb25uZWN0aW9uXCIpO1xudmFyIElMb2dnZXJfMSA9IHJlcXVpcmUoXCIuL0lMb2dnZXJcIik7XG52YXIgSnNvbkh1YlByb3RvY29sXzEgPSByZXF1aXJlKFwiLi9Kc29uSHViUHJvdG9jb2xcIik7XG52YXIgTG9nZ2Vyc18xID0gcmVxdWlyZShcIi4vTG9nZ2Vyc1wiKTtcbnZhciBVdGlsc18xID0gcmVxdWlyZShcIi4vVXRpbHNcIik7XG4vLyB0c2xpbnQ6ZGlzYWJsZTpvYmplY3QtbGl0ZXJhbC1zb3J0LWtleXNcbnZhciBMb2dMZXZlbE5hbWVNYXBwaW5nID0ge1xuICAgIHRyYWNlOiBJTG9nZ2VyXzEuTG9nTGV2ZWwuVHJhY2UsXG4gICAgZGVidWc6IElMb2dnZXJfMS5Mb2dMZXZlbC5EZWJ1ZyxcbiAgICBpbmZvOiBJTG9nZ2VyXzEuTG9nTGV2ZWwuSW5mb3JtYXRpb24sXG4gICAgaW5mb3JtYXRpb246IElMb2dnZXJfMS5Mb2dMZXZlbC5JbmZvcm1hdGlvbixcbiAgICB3YXJuOiBJTG9nZ2VyXzEuTG9nTGV2ZWwuV2FybmluZyxcbiAgICB3YXJuaW5nOiBJTG9nZ2VyXzEuTG9nTGV2ZWwuV2FybmluZyxcbiAgICBlcnJvcjogSUxvZ2dlcl8xLkxvZ0xldmVsLkVycm9yLFxuICAgIGNyaXRpY2FsOiBJTG9nZ2VyXzEuTG9nTGV2ZWwuQ3JpdGljYWwsXG4gICAgbm9uZTogSUxvZ2dlcl8xLkxvZ0xldmVsLk5vbmUsXG59O1xuZnVuY3Rpb24gcGFyc2VMb2dMZXZlbChuYW1lKSB7XG4gICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBtYXRjaGluZyB2aWEgbG93ZXItY2FzaW5nXG4gICAgLy8gWWVzLCBJIGtub3cgY2FzZS1mb2xkaW5nIGlzIGEgY29tcGxpY2F0ZWQgcHJvYmxlbSBpbiBVbmljb2RlLCBidXQgd2Ugb25seSBzdXBwb3J0XG4gICAgLy8gdGhlIEFTQ0lJIHN0cmluZ3MgZGVmaW5lZCBpbiBMb2dMZXZlbE5hbWVNYXBwaW5nIGFueXdheSwgc28gaXQncyBmaW5lIC1hbnVyc2UuXG4gICAgdmFyIG1hcHBpbmcgPSBMb2dMZXZlbE5hbWVNYXBwaW5nW25hbWUudG9Mb3dlckNhc2UoKV07XG4gICAgaWYgKHR5cGVvZiBtYXBwaW5nICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHJldHVybiBtYXBwaW5nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBsb2cgbGV2ZWw6IFwiICsgbmFtZSk7XG4gICAgfVxufVxuLyoqIEEgYnVpbGRlciBmb3IgY29uZmlndXJpbmcge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5IdWJDb25uZWN0aW9ufSBpbnN0YW5jZXMuICovXG52YXIgSHViQ29ubmVjdGlvbkJ1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSHViQ29ubmVjdGlvbkJ1aWxkZXIoKSB7XG4gICAgfVxuICAgIEh1YkNvbm5lY3Rpb25CdWlsZGVyLnByb3RvdHlwZS5jb25maWd1cmVMb2dnaW5nID0gZnVuY3Rpb24gKGxvZ2dpbmcpIHtcbiAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZChsb2dnaW5nLCBcImxvZ2dpbmdcIik7XG4gICAgICAgIGlmIChpc0xvZ2dlcihsb2dnaW5nKSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIgPSBsb2dnaW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBsb2dnaW5nID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB2YXIgbG9nTGV2ZWwgPSBwYXJzZUxvZ0xldmVsKGxvZ2dpbmcpO1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIgPSBuZXcgVXRpbHNfMS5Db25zb2xlTG9nZ2VyKGxvZ0xldmVsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyID0gbmV3IFV0aWxzXzEuQ29uc29sZUxvZ2dlcihsb2dnaW5nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb25CdWlsZGVyLnByb3RvdHlwZS53aXRoVXJsID0gZnVuY3Rpb24gKHVybCwgdHJhbnNwb3J0VHlwZU9yT3B0aW9ucykge1xuICAgICAgICBVdGlsc18xLkFyZy5pc1JlcXVpcmVkKHVybCwgXCJ1cmxcIik7XG4gICAgICAgIFV0aWxzXzEuQXJnLmlzTm90RW1wdHkodXJsLCBcInVybFwiKTtcbiAgICAgICAgdGhpcy51cmwgPSB1cmw7XG4gICAgICAgIC8vIEZsb3ctdHlwaW5nIGtub3dzIHdoZXJlIGl0J3MgYXQuIFNpbmNlIEh0dHBUcmFuc3BvcnRUeXBlIGlzIGEgbnVtYmVyIGFuZCBJSHR0cENvbm5lY3Rpb25PcHRpb25zIGlzIGd1YXJhbnRlZWRcbiAgICAgICAgLy8gdG8gYmUgYW4gb2JqZWN0LCB3ZSBrbm93IChhcyBkb2VzIFR5cGVTY3JpcHQpIHRoaXMgY29tcGFyaXNvbiBpcyBhbGwgd2UgbmVlZCB0byBmaWd1cmUgb3V0IHdoaWNoIG92ZXJsb2FkIHdhcyBjYWxsZWQuXG4gICAgICAgIGlmICh0eXBlb2YgdHJhbnNwb3J0VHlwZU9yT3B0aW9ucyA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgdGhpcy5odHRwQ29ubmVjdGlvbk9wdGlvbnMgPSBfX2Fzc2lnbih7fSwgdGhpcy5odHRwQ29ubmVjdGlvbk9wdGlvbnMsIHRyYW5zcG9ydFR5cGVPck9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5odHRwQ29ubmVjdGlvbk9wdGlvbnMgPSBfX2Fzc2lnbih7fSwgdGhpcy5odHRwQ29ubmVjdGlvbk9wdGlvbnMsIHsgdHJhbnNwb3J0OiB0cmFuc3BvcnRUeXBlT3JPcHRpb25zIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqIENvbmZpZ3VyZXMgdGhlIHtAbGluayBAbWljcm9zb2Z0L3NpZ25hbHIuSHViQ29ubmVjdGlvbn0gdG8gdXNlIHRoZSBzcGVjaWZpZWQgSHViIFByb3RvY29sLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtJSHViUHJvdG9jb2x9IHByb3RvY29sIFRoZSB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLklIdWJQcm90b2NvbH0gaW1wbGVtZW50YXRpb24gdG8gdXNlLlxuICAgICAqL1xuICAgIEh1YkNvbm5lY3Rpb25CdWlsZGVyLnByb3RvdHlwZS53aXRoSHViUHJvdG9jb2wgPSBmdW5jdGlvbiAocHJvdG9jb2wpIHtcbiAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZChwcm90b2NvbCwgXCJwcm90b2NvbFwiKTtcbiAgICAgICAgdGhpcy5wcm90b2NvbCA9IHByb3RvY29sO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEh1YkNvbm5lY3Rpb25CdWlsZGVyLnByb3RvdHlwZS53aXRoQXV0b21hdGljUmVjb25uZWN0ID0gZnVuY3Rpb24gKHJldHJ5RGVsYXlzT3JSZWNvbm5lY3RQb2xpY3kpIHtcbiAgICAgICAgaWYgKHRoaXMucmVjb25uZWN0UG9saWN5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBIHJlY29ubmVjdFBvbGljeSBoYXMgYWxyZWFkeSBiZWVuIHNldC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXRyeURlbGF5c09yUmVjb25uZWN0UG9saWN5KSB7XG4gICAgICAgICAgICB0aGlzLnJlY29ubmVjdFBvbGljeSA9IG5ldyBEZWZhdWx0UmVjb25uZWN0UG9saWN5XzEuRGVmYXVsdFJlY29ubmVjdFBvbGljeSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmV0cnlEZWxheXNPclJlY29ubmVjdFBvbGljeSkpIHtcbiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0UG9saWN5ID0gbmV3IERlZmF1bHRSZWNvbm5lY3RQb2xpY3lfMS5EZWZhdWx0UmVjb25uZWN0UG9saWN5KHJldHJ5RGVsYXlzT3JSZWNvbm5lY3RQb2xpY3kpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3RQb2xpY3kgPSByZXRyeURlbGF5c09yUmVjb25uZWN0UG9saWN5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqIENyZWF0ZXMgYSB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLkh1YkNvbm5lY3Rpb259IGZyb20gdGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyBzcGVjaWZpZWQgaW4gdGhpcyBidWlsZGVyLlxuICAgICAqXG4gICAgICogQHJldHVybnMge0h1YkNvbm5lY3Rpb259IFRoZSBjb25maWd1cmVkIHtAbGluayBAbWljcm9zb2Z0L3NpZ25hbHIuSHViQ29ubmVjdGlvbn0uXG4gICAgICovXG4gICAgSHViQ29ubmVjdGlvbkJ1aWxkZXIucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBJZiBodHRwQ29ubmVjdGlvbk9wdGlvbnMgaGFzIGEgbG9nZ2VyLCB1c2UgaXQuIE90aGVyd2lzZSwgb3ZlcnJpZGUgaXQgd2l0aCB0aGUgb25lXG4gICAgICAgIC8vIHByb3ZpZGVkIHRvIGNvbmZpZ3VyZUxvZ2dlclxuICAgICAgICB2YXIgaHR0cENvbm5lY3Rpb25PcHRpb25zID0gdGhpcy5odHRwQ29ubmVjdGlvbk9wdGlvbnMgfHwge307XG4gICAgICAgIC8vIElmIGl0J3MgJ251bGwnLCB0aGUgdXNlciAqKmV4cGxpY2l0bHkqKiBhc2tlZCBmb3IgbnVsbCwgZG9uJ3QgbWVzcyB3aXRoIGl0LlxuICAgICAgICBpZiAoaHR0cENvbm5lY3Rpb25PcHRpb25zLmxvZ2dlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyBJZiBvdXIgbG9nZ2VyIGlzIHVuZGVmaW5lZCBvciBudWxsLCB0aGF0J3MgT0ssIHRoZSBIdHRwQ29ubmVjdGlvbiBjb25zdHJ1Y3RvciB3aWxsIGhhbmRsZSBpdC5cbiAgICAgICAgICAgIGh0dHBDb25uZWN0aW9uT3B0aW9ucy5sb2dnZXIgPSB0aGlzLmxvZ2dlcjtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb3cgY3JlYXRlIHRoZSBjb25uZWN0aW9uXG4gICAgICAgIGlmICghdGhpcy51cmwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSAnSHViQ29ubmVjdGlvbkJ1aWxkZXIud2l0aFVybCcgbWV0aG9kIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBidWlsZGluZyB0aGUgY29ubmVjdGlvbi5cIik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBuZXcgSHR0cENvbm5lY3Rpb25fMS5IdHRwQ29ubmVjdGlvbih0aGlzLnVybCwgaHR0cENvbm5lY3Rpb25PcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIEh1YkNvbm5lY3Rpb25fMS5IdWJDb25uZWN0aW9uLmNyZWF0ZShjb25uZWN0aW9uLCB0aGlzLmxvZ2dlciB8fCBMb2dnZXJzXzEuTnVsbExvZ2dlci5pbnN0YW5jZSwgdGhpcy5wcm90b2NvbCB8fCBuZXcgSnNvbkh1YlByb3RvY29sXzEuSnNvbkh1YlByb3RvY29sKCksIHRoaXMucmVjb25uZWN0UG9saWN5KTtcbiAgICB9O1xuICAgIHJldHVybiBIdWJDb25uZWN0aW9uQnVpbGRlcjtcbn0oKSk7XG5leHBvcnRzLkh1YkNvbm5lY3Rpb25CdWlsZGVyID0gSHViQ29ubmVjdGlvbkJ1aWxkZXI7XG5mdW5jdGlvbiBpc0xvZ2dlcihsb2dnZXIpIHtcbiAgICByZXR1cm4gbG9nZ2VyLmxvZyAhPT0gdW5kZWZpbmVkO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SHViQ29ubmVjdGlvbkJ1aWxkZXIuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcSHViQ29ubmVjdGlvbkJ1aWxkZXIuanNcIixcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLyoqIERlZmluZXMgdGhlIHR5cGUgb2YgYSBIdWIgTWVzc2FnZS4gKi9cbnZhciBNZXNzYWdlVHlwZTtcbihmdW5jdGlvbiAoTWVzc2FnZVR5cGUpIHtcbiAgICAvKiogSW5kaWNhdGVzIHRoZSBtZXNzYWdlIGlzIGFuIEludm9jYXRpb24gbWVzc2FnZSBhbmQgaW1wbGVtZW50cyB0aGUge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5JbnZvY2F0aW9uTWVzc2FnZX0gaW50ZXJmYWNlLiAqL1xuICAgIE1lc3NhZ2VUeXBlW01lc3NhZ2VUeXBlW1wiSW52b2NhdGlvblwiXSA9IDFdID0gXCJJbnZvY2F0aW9uXCI7XG4gICAgLyoqIEluZGljYXRlcyB0aGUgbWVzc2FnZSBpcyBhIFN0cmVhbUl0ZW0gbWVzc2FnZSBhbmQgaW1wbGVtZW50cyB0aGUge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5TdHJlYW1JdGVtTWVzc2FnZX0gaW50ZXJmYWNlLiAqL1xuICAgIE1lc3NhZ2VUeXBlW01lc3NhZ2VUeXBlW1wiU3RyZWFtSXRlbVwiXSA9IDJdID0gXCJTdHJlYW1JdGVtXCI7XG4gICAgLyoqIEluZGljYXRlcyB0aGUgbWVzc2FnZSBpcyBhIENvbXBsZXRpb24gbWVzc2FnZSBhbmQgaW1wbGVtZW50cyB0aGUge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5Db21wbGV0aW9uTWVzc2FnZX0gaW50ZXJmYWNlLiAqL1xuICAgIE1lc3NhZ2VUeXBlW01lc3NhZ2VUeXBlW1wiQ29tcGxldGlvblwiXSA9IDNdID0gXCJDb21wbGV0aW9uXCI7XG4gICAgLyoqIEluZGljYXRlcyB0aGUgbWVzc2FnZSBpcyBhIFN0cmVhbSBJbnZvY2F0aW9uIG1lc3NhZ2UgYW5kIGltcGxlbWVudHMgdGhlIHtAbGluayBAbWljcm9zb2Z0L3NpZ25hbHIuU3RyZWFtSW52b2NhdGlvbk1lc3NhZ2V9IGludGVyZmFjZS4gKi9cbiAgICBNZXNzYWdlVHlwZVtNZXNzYWdlVHlwZVtcIlN0cmVhbUludm9jYXRpb25cIl0gPSA0XSA9IFwiU3RyZWFtSW52b2NhdGlvblwiO1xuICAgIC8qKiBJbmRpY2F0ZXMgdGhlIG1lc3NhZ2UgaXMgYSBDYW5jZWwgSW52b2NhdGlvbiBtZXNzYWdlIGFuZCBpbXBsZW1lbnRzIHRoZSB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLkNhbmNlbEludm9jYXRpb25NZXNzYWdlfSBpbnRlcmZhY2UuICovXG4gICAgTWVzc2FnZVR5cGVbTWVzc2FnZVR5cGVbXCJDYW5jZWxJbnZvY2F0aW9uXCJdID0gNV0gPSBcIkNhbmNlbEludm9jYXRpb25cIjtcbiAgICAvKiogSW5kaWNhdGVzIHRoZSBtZXNzYWdlIGlzIGEgUGluZyBtZXNzYWdlIGFuZCBpbXBsZW1lbnRzIHRoZSB7QGxpbmsgQG1pY3Jvc29mdC9zaWduYWxyLlBpbmdNZXNzYWdlfSBpbnRlcmZhY2UuICovXG4gICAgTWVzc2FnZVR5cGVbTWVzc2FnZVR5cGVbXCJQaW5nXCJdID0gNl0gPSBcIlBpbmdcIjtcbiAgICAvKiogSW5kaWNhdGVzIHRoZSBtZXNzYWdlIGlzIGEgQ2xvc2UgbWVzc2FnZSBhbmQgaW1wbGVtZW50cyB0aGUge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5DbG9zZU1lc3NhZ2V9IGludGVyZmFjZS4gKi9cbiAgICBNZXNzYWdlVHlwZVtNZXNzYWdlVHlwZVtcIkNsb3NlXCJdID0gN10gPSBcIkNsb3NlXCI7XG59KShNZXNzYWdlVHlwZSA9IGV4cG9ydHMuTWVzc2FnZVR5cGUgfHwgKGV4cG9ydHMuTWVzc2FnZVR5cGUgPSB7fSkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SUh1YlByb3RvY29sLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXElIdWJQcm90b2NvbC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLyBUaGVzZSB2YWx1ZXMgYXJlIGRlc2lnbmVkIHRvIG1hdGNoIHRoZSBBU1AuTkVUIExvZyBMZXZlbHMgc2luY2UgdGhhdCdzIHRoZSBwYXR0ZXJuIHdlJ3JlIGVtdWxhdGluZyBoZXJlLlxuLyoqIEluZGljYXRlcyB0aGUgc2V2ZXJpdHkgb2YgYSBsb2cgbWVzc2FnZS5cbiAqXG4gKiBMb2cgTGV2ZWxzIGFyZSBvcmRlcmVkIGluIGluY3JlYXNpbmcgc2V2ZXJpdHkuIFNvIGBEZWJ1Z2AgaXMgbW9yZSBzZXZlcmUgdGhhbiBgVHJhY2VgLCBldGMuXG4gKi9cbnZhciBMb2dMZXZlbDtcbihmdW5jdGlvbiAoTG9nTGV2ZWwpIHtcbiAgICAvKiogTG9nIGxldmVsIGZvciB2ZXJ5IGxvdyBzZXZlcml0eSBkaWFnbm9zdGljIG1lc3NhZ2VzLiAqL1xuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiVHJhY2VcIl0gPSAwXSA9IFwiVHJhY2VcIjtcbiAgICAvKiogTG9nIGxldmVsIGZvciBsb3cgc2V2ZXJpdHkgZGlhZ25vc3RpYyBtZXNzYWdlcy4gKi9cbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkRlYnVnXCJdID0gMV0gPSBcIkRlYnVnXCI7XG4gICAgLyoqIExvZyBsZXZlbCBmb3IgaW5mb3JtYXRpb25hbCBkaWFnbm9zdGljIG1lc3NhZ2VzLiAqL1xuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiSW5mb3JtYXRpb25cIl0gPSAyXSA9IFwiSW5mb3JtYXRpb25cIjtcbiAgICAvKiogTG9nIGxldmVsIGZvciBkaWFnbm9zdGljIG1lc3NhZ2VzIHRoYXQgaW5kaWNhdGUgYSBub24tZmF0YWwgcHJvYmxlbS4gKi9cbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIldhcm5pbmdcIl0gPSAzXSA9IFwiV2FybmluZ1wiO1xuICAgIC8qKiBMb2cgbGV2ZWwgZm9yIGRpYWdub3N0aWMgbWVzc2FnZXMgdGhhdCBpbmRpY2F0ZSBhIGZhaWx1cmUgaW4gdGhlIGN1cnJlbnQgb3BlcmF0aW9uLiAqL1xuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiRXJyb3JcIl0gPSA0XSA9IFwiRXJyb3JcIjtcbiAgICAvKiogTG9nIGxldmVsIGZvciBkaWFnbm9zdGljIG1lc3NhZ2VzIHRoYXQgaW5kaWNhdGUgYSBmYWlsdXJlIHRoYXQgd2lsbCB0ZXJtaW5hdGUgdGhlIGVudGlyZSBhcHBsaWNhdGlvbi4gKi9cbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIkNyaXRpY2FsXCJdID0gNV0gPSBcIkNyaXRpY2FsXCI7XG4gICAgLyoqIFRoZSBoaWdoZXN0IHBvc3NpYmxlIGxvZyBsZXZlbC4gVXNlZCB3aGVuIGNvbmZpZ3VyaW5nIGxvZ2dpbmcgdG8gaW5kaWNhdGUgdGhhdCBubyBsb2cgbWVzc2FnZXMgc2hvdWxkIGJlIGVtaXR0ZWQuICovXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJOb25lXCJdID0gNl0gPSBcIk5vbmVcIjtcbn0pKExvZ0xldmVsID0gZXhwb3J0cy5Mb2dMZXZlbCB8fCAoZXhwb3J0cy5Mb2dMZXZlbCA9IHt9KSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1JTG9nZ2VyLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXElMb2dnZXIuanNcIixcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDb3B5cmlnaHQgKGMpIC5ORVQgRm91bmRhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLy8gVGhpcyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBiaXQgZmxhZyBpbiB0aGUgZnV0dXJlLCBzbyB3ZSBrZWVwIGl0IHVzaW5nIHBvd2VyLW9mLXR3byB2YWx1ZXMuXG4vKiogU3BlY2lmaWVzIGEgc3BlY2lmaWMgSFRUUCB0cmFuc3BvcnQgdHlwZS4gKi9cbnZhciBIdHRwVHJhbnNwb3J0VHlwZTtcbihmdW5jdGlvbiAoSHR0cFRyYW5zcG9ydFR5cGUpIHtcbiAgICAvKiogU3BlY2lmaWVzIG5vIHRyYW5zcG9ydCBwcmVmZXJlbmNlLiAqL1xuICAgIEh0dHBUcmFuc3BvcnRUeXBlW0h0dHBUcmFuc3BvcnRUeXBlW1wiTm9uZVwiXSA9IDBdID0gXCJOb25lXCI7XG4gICAgLyoqIFNwZWNpZmllcyB0aGUgV2ViU29ja2V0cyB0cmFuc3BvcnQuICovXG4gICAgSHR0cFRyYW5zcG9ydFR5cGVbSHR0cFRyYW5zcG9ydFR5cGVbXCJXZWJTb2NrZXRzXCJdID0gMV0gPSBcIldlYlNvY2tldHNcIjtcbiAgICAvKiogU3BlY2lmaWVzIHRoZSBTZXJ2ZXItU2VudCBFdmVudHMgdHJhbnNwb3J0LiAqL1xuICAgIEh0dHBUcmFuc3BvcnRUeXBlW0h0dHBUcmFuc3BvcnRUeXBlW1wiU2VydmVyU2VudEV2ZW50c1wiXSA9IDJdID0gXCJTZXJ2ZXJTZW50RXZlbnRzXCI7XG4gICAgLyoqIFNwZWNpZmllcyB0aGUgTG9uZyBQb2xsaW5nIHRyYW5zcG9ydC4gKi9cbiAgICBIdHRwVHJhbnNwb3J0VHlwZVtIdHRwVHJhbnNwb3J0VHlwZVtcIkxvbmdQb2xsaW5nXCJdID0gNF0gPSBcIkxvbmdQb2xsaW5nXCI7XG59KShIdHRwVHJhbnNwb3J0VHlwZSA9IGV4cG9ydHMuSHR0cFRyYW5zcG9ydFR5cGUgfHwgKGV4cG9ydHMuSHR0cFRyYW5zcG9ydFR5cGUgPSB7fSkpO1xuLyoqIFNwZWNpZmllcyB0aGUgdHJhbnNmZXIgZm9ybWF0IGZvciBhIGNvbm5lY3Rpb24uICovXG52YXIgVHJhbnNmZXJGb3JtYXQ7XG4oZnVuY3Rpb24gKFRyYW5zZmVyRm9ybWF0KSB7XG4gICAgLyoqIFNwZWNpZmllcyB0aGF0IG9ubHkgdGV4dCBkYXRhIHdpbGwgYmUgdHJhbnNtaXR0ZWQgb3ZlciB0aGUgY29ubmVjdGlvbi4gKi9cbiAgICBUcmFuc2ZlckZvcm1hdFtUcmFuc2ZlckZvcm1hdFtcIlRleHRcIl0gPSAxXSA9IFwiVGV4dFwiO1xuICAgIC8qKiBTcGVjaWZpZXMgdGhhdCBiaW5hcnkgZGF0YSB3aWxsIGJlIHRyYW5zbWl0dGVkIG92ZXIgdGhlIGNvbm5lY3Rpb24uICovXG4gICAgVHJhbnNmZXJGb3JtYXRbVHJhbnNmZXJGb3JtYXRbXCJCaW5hcnlcIl0gPSAyXSA9IFwiQmluYXJ5XCI7XG59KShUcmFuc2ZlckZvcm1hdCA9IGV4cG9ydHMuVHJhbnNmZXJGb3JtYXQgfHwgKGV4cG9ydHMuVHJhbnNmZXJGb3JtYXQgPSB7fSkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SVRyYW5zcG9ydC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxJVHJhbnNwb3J0LmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBJSHViUHJvdG9jb2xfMSA9IHJlcXVpcmUoXCIuL0lIdWJQcm90b2NvbFwiKTtcbnZhciBJTG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9JTG9nZ2VyXCIpO1xudmFyIElUcmFuc3BvcnRfMSA9IHJlcXVpcmUoXCIuL0lUcmFuc3BvcnRcIik7XG52YXIgTG9nZ2Vyc18xID0gcmVxdWlyZShcIi4vTG9nZ2Vyc1wiKTtcbnZhciBUZXh0TWVzc2FnZUZvcm1hdF8xID0gcmVxdWlyZShcIi4vVGV4dE1lc3NhZ2VGb3JtYXRcIik7XG52YXIgSlNPTl9IVUJfUFJPVE9DT0xfTkFNRSA9IFwianNvblwiO1xuLyoqIEltcGxlbWVudHMgdGhlIEpTT04gSHViIFByb3RvY29sLiAqL1xudmFyIEpzb25IdWJQcm90b2NvbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBKc29uSHViUHJvdG9jb2woKSB7XG4gICAgICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBKU09OX0hVQl9QUk9UT0NPTF9OQU1FO1xuICAgICAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICAgICAgdGhpcy52ZXJzaW9uID0gMTtcbiAgICAgICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgICAgIHRoaXMudHJhbnNmZXJGb3JtYXQgPSBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXQuVGV4dDtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYW4gYXJyYXkgb2Yge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5IdWJNZXNzYWdlfSBvYmplY3RzIGZyb20gdGhlIHNwZWNpZmllZCBzZXJpYWxpemVkIHJlcHJlc2VudGF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlucHV0IEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNlcmlhbGl6ZWQgcmVwcmVzZW50YXRpb24uXG4gICAgICogQHBhcmFtIHtJTG9nZ2VyfSBsb2dnZXIgQSBsb2dnZXIgdGhhdCB3aWxsIGJlIHVzZWQgdG8gbG9nIG1lc3NhZ2VzIHRoYXQgb2NjdXIgZHVyaW5nIHBhcnNpbmcuXG4gICAgICovXG4gICAgSnNvbkh1YlByb3RvY29sLnByb3RvdHlwZS5wYXJzZU1lc3NhZ2VzID0gZnVuY3Rpb24gKGlucHV0LCBsb2dnZXIpIHtcbiAgICAgICAgLy8gVGhlIGludGVyZmFjZSBkb2VzIGFsbG93IFwiQXJyYXlCdWZmZXJcIiB0byBiZSBwYXNzZWQgaW4sIGJ1dCB0aGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90LiBTbyBsZXQncyB0aHJvdyBhIHVzZWZ1bCBlcnJvci5cbiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBpbnB1dCBmb3IgSlNPTiBodWIgcHJvdG9jb2wuIEV4cGVjdGVkIGEgc3RyaW5nLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlucHV0KSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvZ2dlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgbG9nZ2VyID0gTG9nZ2Vyc18xLk51bGxMb2dnZXIuaW5zdGFuY2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFyc2UgdGhlIG1lc3NhZ2VzXG4gICAgICAgIHZhciBtZXNzYWdlcyA9IFRleHRNZXNzYWdlRm9ybWF0XzEuVGV4dE1lc3NhZ2VGb3JtYXQucGFyc2UoaW5wdXQpO1xuICAgICAgICB2YXIgaHViTWVzc2FnZXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBtZXNzYWdlc18xID0gbWVzc2FnZXM7IF9pIDwgbWVzc2FnZXNfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbWVzc2FnZXNfMVtfaV07XG4gICAgICAgICAgICB2YXIgcGFyc2VkTWVzc2FnZSA9IEpTT04ucGFyc2UobWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcnNlZE1lc3NhZ2UudHlwZSAhPT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF5bG9hZC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcnNlZE1lc3NhZ2UudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuSW52b2NhdGlvbjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ludm9jYXRpb25NZXNzYWdlKHBhcnNlZE1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIElIdWJQcm90b2NvbF8xLk1lc3NhZ2VUeXBlLlN0cmVhbUl0ZW06XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNTdHJlYW1JdGVtTWVzc2FnZShwYXJzZWRNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBJSHViUHJvdG9jb2xfMS5NZXNzYWdlVHlwZS5Db21wbGV0aW9uOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQ29tcGxldGlvbk1lc3NhZ2UocGFyc2VkTWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuUGluZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gU2luZ2xlIHZhbHVlLCBubyBuZWVkIHRvIHZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGUuQ2xvc2U6XG4gICAgICAgICAgICAgICAgICAgIC8vIEFsbCBvcHRpb25hbCB2YWx1ZXMsIG5vIG5lZWQgdG8gdmFsaWRhdGVcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgLy8gRnV0dXJlIHByb3RvY29sIGNoYW5nZXMgY2FuIGFkZCBtZXNzYWdlIHR5cGVzLCBvbGQgY2xpZW50cyBjYW4gaWdub3JlIHRoZW1cbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuSW5mb3JtYXRpb24sIFwiVW5rbm93biBtZXNzYWdlIHR5cGUgJ1wiICsgcGFyc2VkTWVzc2FnZS50eXBlICsgXCInIGlnbm9yZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGh1Yk1lc3NhZ2VzLnB1c2gocGFyc2VkTWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGh1Yk1lc3NhZ2VzO1xuICAgIH07XG4gICAgLyoqIFdyaXRlcyB0aGUgc3BlY2lmaWVkIHtAbGluayBAbWljcm9zb2Z0L3NpZ25hbHIuSHViTWVzc2FnZX0gdG8gYSBzdHJpbmcgYW5kIHJldHVybnMgaXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0h1Yk1lc3NhZ2V9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gd3JpdGUuXG4gICAgICogQHJldHVybnMge3N0cmluZ30gQSBzdHJpbmcgY29udGFpbmluZyB0aGUgc2VyaWFsaXplZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWVzc2FnZS5cbiAgICAgKi9cbiAgICBKc29uSHViUHJvdG9jb2wucHJvdG90eXBlLndyaXRlTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHJldHVybiBUZXh0TWVzc2FnZUZvcm1hdF8xLlRleHRNZXNzYWdlRm9ybWF0LndyaXRlKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcbiAgICB9O1xuICAgIEpzb25IdWJQcm90b2NvbC5wcm90b3R5cGUuaXNJbnZvY2F0aW9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90RW1wdHlTdHJpbmcobWVzc2FnZS50YXJnZXQsIFwiSW52YWxpZCBwYXlsb2FkIGZvciBJbnZvY2F0aW9uIG1lc3NhZ2UuXCIpO1xuICAgICAgICBpZiAobWVzc2FnZS5pbnZvY2F0aW9uSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5hc3NlcnROb3RFbXB0eVN0cmluZyhtZXNzYWdlLmludm9jYXRpb25JZCwgXCJJbnZhbGlkIHBheWxvYWQgZm9yIEludm9jYXRpb24gbWVzc2FnZS5cIik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEpzb25IdWJQcm90b2NvbC5wcm90b3R5cGUuaXNTdHJlYW1JdGVtTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90RW1wdHlTdHJpbmcobWVzc2FnZS5pbnZvY2F0aW9uSWQsIFwiSW52YWxpZCBwYXlsb2FkIGZvciBTdHJlYW1JdGVtIG1lc3NhZ2UuXCIpO1xuICAgICAgICBpZiAobWVzc2FnZS5pdGVtID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF5bG9hZCBmb3IgU3RyZWFtSXRlbSBtZXNzYWdlLlwiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSnNvbkh1YlByb3RvY29sLnByb3RvdHlwZS5pc0NvbXBsZXRpb25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2UucmVzdWx0ICYmIG1lc3NhZ2UuZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF5bG9hZCBmb3IgQ29tcGxldGlvbiBtZXNzYWdlLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW1lc3NhZ2UucmVzdWx0ICYmIG1lc3NhZ2UuZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuYXNzZXJ0Tm90RW1wdHlTdHJpbmcobWVzc2FnZS5lcnJvciwgXCJJbnZhbGlkIHBheWxvYWQgZm9yIENvbXBsZXRpb24gbWVzc2FnZS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hc3NlcnROb3RFbXB0eVN0cmluZyhtZXNzYWdlLmludm9jYXRpb25JZCwgXCJJbnZhbGlkIHBheWxvYWQgZm9yIENvbXBsZXRpb24gbWVzc2FnZS5cIik7XG4gICAgfTtcbiAgICBKc29uSHViUHJvdG9jb2wucHJvdG90eXBlLmFzc2VydE5vdEVtcHR5U3RyaW5nID0gZnVuY3Rpb24gKHZhbHVlLCBlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiB8fCB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBKc29uSHViUHJvdG9jb2w7XG59KCkpO1xuZXhwb3J0cy5Kc29uSHViUHJvdG9jb2wgPSBKc29uSHViUHJvdG9jb2w7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Kc29uSHViUHJvdG9jb2wuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcSnNvbkh1YlByb3RvY29sLmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8qKiBBIGxvZ2dlciB0aGF0IGRvZXMgbm90aGluZyB3aGVuIGxvZyBtZXNzYWdlcyBhcmUgc2VudCB0byBpdC4gKi9cbnZhciBOdWxsTG9nZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE51bGxMb2dnZXIoKSB7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuICAgIE51bGxMb2dnZXIucHJvdG90eXBlLmxvZyA9IGZ1bmN0aW9uIChfbG9nTGV2ZWwsIF9tZXNzYWdlKSB7XG4gICAgfTtcbiAgICAvKiogVGhlIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIEBtaWNyb3NvZnQvc2lnbmFsci5OdWxsTG9nZ2VyfS4gKi9cbiAgICBOdWxsTG9nZ2VyLmluc3RhbmNlID0gbmV3IE51bGxMb2dnZXIoKTtcbiAgICByZXR1cm4gTnVsbExvZ2dlcjtcbn0oKSk7XG5leHBvcnRzLk51bGxMb2dnZXIgPSBOdWxsTG9nZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9TG9nZ2Vycy5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxMb2dnZXJzLmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xuICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBBYm9ydENvbnRyb2xsZXJfMSA9IHJlcXVpcmUoXCIuL0Fib3J0Q29udHJvbGxlclwiKTtcbnZhciBFcnJvcnNfMSA9IHJlcXVpcmUoXCIuL0Vycm9yc1wiKTtcbnZhciBJTG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9JTG9nZ2VyXCIpO1xudmFyIElUcmFuc3BvcnRfMSA9IHJlcXVpcmUoXCIuL0lUcmFuc3BvcnRcIik7XG52YXIgVXRpbHNfMSA9IHJlcXVpcmUoXCIuL1V0aWxzXCIpO1xuLy8gTm90IGV4cG9ydGVkIGZyb20gJ2luZGV4JywgdGhpcyB0eXBlIGlzIGludGVybmFsLlxuLyoqIEBwcml2YXRlICovXG52YXIgTG9uZ1BvbGxpbmdUcmFuc3BvcnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTG9uZ1BvbGxpbmdUcmFuc3BvcnQoaHR0cENsaWVudCwgYWNjZXNzVG9rZW5GYWN0b3J5LCBsb2dnZXIsIGxvZ01lc3NhZ2VDb250ZW50LCB3aXRoQ3JlZGVudGlhbHMsIGhlYWRlcnMpIHtcbiAgICAgICAgdGhpcy5odHRwQ2xpZW50ID0gaHR0cENsaWVudDtcbiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkgPSBhY2Nlc3NUb2tlbkZhY3Rvcnk7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuICAgICAgICB0aGlzLnBvbGxBYm9ydCA9IG5ldyBBYm9ydENvbnRyb2xsZXJfMS5BYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlQ29udGVudCA9IGxvZ01lc3NhZ2VDb250ZW50O1xuICAgICAgICB0aGlzLndpdGhDcmVkZW50aWFscyA9IHdpdGhDcmVkZW50aWFscztcbiAgICAgICAgdGhpcy5oZWFkZXJzID0gaGVhZGVycztcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25yZWNlaXZlID0gbnVsbDtcbiAgICAgICAgdGhpcy5vbmNsb3NlID0gbnVsbDtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KExvbmdQb2xsaW5nVHJhbnNwb3J0LnByb3RvdHlwZSwgXCJwb2xsQWJvcnRlZFwiLCB7XG4gICAgICAgIC8vIFRoaXMgaXMgYW4gaW50ZXJuYWwgdHlwZSwgbm90IGV4cG9ydGVkIGZyb20gJ2luZGV4JyBzbyB0aGlzIGlzIHJlYWxseSBqdXN0IGludGVybmFsLlxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBvbGxBYm9ydC5hYm9ydGVkO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBMb25nUG9sbGluZ1RyYW5zcG9ydC5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uICh1cmwsIHRyYW5zZmVyRm9ybWF0KSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgX2IsIG5hbWUsIHZhbHVlLCBoZWFkZXJzLCBwb2xsT3B0aW9ucywgdG9rZW4sIHBvbGxVcmwsIHJlc3BvbnNlO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2MubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZCh1cmwsIFwidXJsXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHNfMS5BcmcuaXNSZXF1aXJlZCh0cmFuc2ZlckZvcm1hdCwgXCJ0cmFuc2ZlckZvcm1hdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzXzEuQXJnLmlzSW4odHJhbnNmZXJGb3JtYXQsIElUcmFuc3BvcnRfMS5UcmFuc2ZlckZvcm1hdCwgXCJ0cmFuc2ZlckZvcm1hdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXJsID0gdXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoTG9uZ1BvbGxpbmcgdHJhbnNwb3J0KSBDb25uZWN0aW5nLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsbG93IGJpbmFyeSBmb3JtYXQgb24gTm9kZSBhbmQgQnJvd3NlcnMgdGhhdCBzdXBwb3J0IGJpbmFyeSBjb250ZW50IChpbmRpY2F0ZWQgYnkgdGhlIHByZXNlbmNlIG9mIHJlc3BvbnNlVHlwZSBwcm9wZXJ0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdCA9PT0gSVRyYW5zcG9ydF8xLlRyYW5zZmVyRm9ybWF0LkJpbmFyeSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2YgWE1MSHR0cFJlcXVlc3QgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIG5ldyBYTUxIdHRwUmVxdWVzdCgpLnJlc3BvbnNlVHlwZSAhPT0gXCJzdHJpbmdcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJCaW5hcnkgcHJvdG9jb2xzIG92ZXIgWG1sSHR0cFJlcXVlc3Qgbm90IGltcGxlbWVudGluZyBhZHZhbmNlZCBmZWF0dXJlcyBhcmUgbm90IHN1cHBvcnRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfYiA9IFV0aWxzXzEuZ2V0VXNlckFnZW50SGVhZGVyKCksIG5hbWUgPSBfYlswXSwgdmFsdWUgPSBfYlsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSBfX2Fzc2lnbigoX2EgPSB7fSwgX2FbbmFtZV0gPSB2YWx1ZSwgX2EpLCB0aGlzLmhlYWRlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9sbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRTaWduYWw6IHRoaXMucG9sbEFib3J0LnNpZ25hbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDEwMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdCA9PT0gSVRyYW5zcG9ydF8xLlRyYW5zZmVyRm9ybWF0LkJpbmFyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvbGxPcHRpb25zLnJlc3BvbnNlVHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuZ2V0QWNjZXNzVG9rZW4oKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVIZWFkZXJUb2tlbihwb2xsT3B0aW9ucywgdG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9sbFVybCA9IHVybCArIFwiJl89XCIgKyBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoTG9uZ1BvbGxpbmcgdHJhbnNwb3J0KSBwb2xsaW5nOiBcIiArIHBvbGxVcmwgKyBcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmh0dHBDbGllbnQuZ2V0KHBvbGxVcmwsIHBvbGxPcHRpb25zKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgIT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3IsIFwiKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgVW5leHBlY3RlZCByZXNwb25zZSBjb2RlOiBcIiArIHJlc3BvbnNlLnN0YXR1c0NvZGUgKyBcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBydW5uaW5nIGFzIGZhbHNlIHNvIHRoYXQgdGhlIHBvbGwgaW1tZWRpYXRlbHkgZW5kcyBhbmQgcnVucyB0aGUgY2xvc2UgbG9naWNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRXJyb3IgPSBuZXcgRXJyb3JzXzEuSHR0cEVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQgfHwgXCJcIiwgcmVzcG9uc2Uuc3RhdHVzQ29kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNlaXZpbmcgPSB0aGlzLnBvbGwodGhpcy51cmwsIHBvbGxPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBMb25nUG9sbGluZ1RyYW5zcG9ydC5wcm90b3R5cGUuZ2V0QWNjZXNzVG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIF9hLnNlbnQoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG51bGxdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIExvbmdQb2xsaW5nVHJhbnNwb3J0LnByb3RvdHlwZS51cGRhdGVIZWFkZXJUb2tlbiA9IGZ1bmN0aW9uIChyZXF1ZXN0LCB0b2tlbikge1xuICAgICAgICBpZiAoIXJlcXVlc3QuaGVhZGVycykge1xuICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tc3RyaW5nLWxpdGVyYWxcbiAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVyc1tcIkF1dGhvcml6YXRpb25cIl0gPSBcIkJlYXJlciBcIiArIHRva2VuO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1zdHJpbmctbGl0ZXJhbFxuICAgICAgICBpZiAocmVxdWVzdC5oZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSkge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXN0cmluZy1saXRlcmFsXG4gICAgICAgICAgICBkZWxldGUgcmVxdWVzdC5oZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTG9uZ1BvbGxpbmdUcmFuc3BvcnQucHJvdG90eXBlLnBvbGwgPSBmdW5jdGlvbiAodXJsLCBwb2xsT3B0aW9ucykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdG9rZW4sIHBvbGxVcmwsIHJlc3BvbnNlLCBlXzE7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzAsICwgOCwgOV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucnVubmluZykgcmV0dXJuIFszIC8qYnJlYWsqLywgN107XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmdldEFjY2Vzc1Rva2VuKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSGVhZGVyVG9rZW4ocG9sbE9wdGlvbnMsIHRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFszLCA1LCAsIDZdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvbGxVcmwgPSB1cmwgKyBcIiZfPVwiICsgRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuVHJhY2UsIFwiKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgcG9sbGluZzogXCIgKyBwb2xsVXJsICsgXCIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5odHRwQ2xpZW50LmdldChwb2xsVXJsLCBwb2xsT3B0aW9ucyldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIFBvbGwgdGVybWluYXRlZCBieSBzZXJ2ZXIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSAhPT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5FcnJvciwgXCIoTG9uZ1BvbGxpbmcgdHJhbnNwb3J0KSBVbmV4cGVjdGVkIHJlc3BvbnNlIGNvZGU6IFwiICsgcmVzcG9uc2Uuc3RhdHVzQ29kZSArIFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVbmV4cGVjdGVkIHN0YXR1cyBjb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVycm9yID0gbmV3IEVycm9yc18xLkh0dHBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0IHx8IFwiXCIsIHJlc3BvbnNlLnN0YXR1c0NvZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIGRhdGEgcmVjZWl2ZWQuIFwiICsgVXRpbHNfMS5nZXREYXRhRGV0YWlsKHJlc3BvbnNlLmNvbnRlbnQsIHRoaXMubG9nTWVzc2FnZUNvbnRlbnQpICsgXCIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbnJlY2VpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25yZWNlaXZlKHJlc3BvbnNlLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGFub3RoZXIgd2F5IHRpbWVvdXQgbWFuaWZlc3QuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuVHJhY2UsIFwiKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgUG9sbCB0aW1lZCBvdXQsIHJlaXNzdWluZy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfMSA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5ydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGJ1dCBkaXNyZWdhcmQgZXJyb3JzIHRoYXQgb2NjdXIgYWZ0ZXIgc3RvcHBpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIFBvbGwgZXJyb3JlZCBhZnRlciBzaHV0ZG93bjogXCIgKyBlXzEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZV8xIGluc3RhbmNlb2YgRXJyb3JzXzEuVGltZW91dEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSB0aW1lb3V0cyBhbmQgcmVpc3N1ZSB0aGUgcG9sbC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoTG9uZ1BvbGxpbmcgdHJhbnNwb3J0KSBQb2xsIHRpbWVkIG91dCwgcmVpc3N1aW5nLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsb3NlIHRoZSBjb25uZWN0aW9uIHdpdGggdGhlIGVycm9yIGFzIHRoZSByZXN1bHQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFcnJvciA9IGVfMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjogcmV0dXJuIFszIC8qYnJlYWsqLywgMV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNzogcmV0dXJuIFszIC8qYnJlYWsqLywgOV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuVHJhY2UsIFwiKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgUG9sbGluZyBjb21wbGV0ZS5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSB3aWxsIHJlYWNoIGhlcmUgd2l0aCBwb2xsQWJvcnRlZD09ZmFsc2Ugd2hlbiB0aGUgc2VydmVyIHJldHVybmVkIGEgcmVzcG9uc2UgY2F1c2luZyB0aGUgdHJhbnNwb3J0IHRvIHN0b3AuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBwb2xsQWJvcnRlZD09dHJ1ZSB0aGVuIGNsaWVudCBpbml0aWF0ZWQgdGhlIHN0b3AgYW5kIHRoZSBzdG9wIG1ldGhvZCB3aWxsIHJhaXNlIHRoZSBjbG9zZSBldmVudCBhZnRlciBERUxFVEUgaXMgc2VudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5wb2xsQWJvcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmFpc2VPbkNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzcgLyplbmRmaW5hbGx5Ki9dO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDk6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBMb25nUG9sbGluZ1RyYW5zcG9ydC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucnVubmluZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiQ2Fubm90IHNlbmQgdW50aWwgdGhlIHRyYW5zcG9ydCBpcyBjb25uZWN0ZWRcIikpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFV0aWxzXzEuc2VuZE1lc3NhZ2UodGhpcy5sb2dnZXIsIFwiTG9uZ1BvbGxpbmdcIiwgdGhpcy5odHRwQ2xpZW50LCB0aGlzLnVybCwgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnksIGRhdGEsIHRoaXMubG9nTWVzc2FnZUNvbnRlbnQsIHRoaXMud2l0aENyZWRlbnRpYWxzLCB0aGlzLmhlYWRlcnMpXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIExvbmdQb2xsaW5nVHJhbnNwb3J0LnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVycywgX2EsIG5hbWVfMSwgdmFsdWUsIGRlbGV0ZU9wdGlvbnMsIHRva2VuO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2IubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoTG9uZ1BvbGxpbmcgdHJhbnNwb3J0KSBTdG9wcGluZyBwb2xsaW5nLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRlbGwgcmVjZWl2aW5nIGxvb3AgdG8gc3RvcCwgYWJvcnQgYW55IGN1cnJlbnQgcmVxdWVzdCwgYW5kIHRoZW4gd2FpdCBmb3IgaXQgdG8gZmluaXNoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9sbEFib3J0LmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iLnRyeXMucHVzaChbMSwgLCA1LCA2XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnJlY2VpdmluZ107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgREVMRVRFIHRvIGNsZWFuIHVwIGxvbmcgcG9sbGluZyBvbiB0aGUgc2VydmVyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIHNlbmRpbmcgREVMRVRFIHJlcXVlc3QgdG8gXCIgKyB0aGlzLnVybCArIFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hID0gVXRpbHNfMS5nZXRVc2VyQWdlbnRIZWFkZXIoKSwgbmFtZV8xID0gX2FbMF0sIHZhbHVlID0gX2FbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW25hbWVfMV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZU9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogX19hc3NpZ24oe30sIGhlYWRlcnMsIHRoaXMuaGVhZGVycyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0aGlzLndpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmdldEFjY2Vzc1Rva2VuKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSGVhZGVyVG9rZW4oZGVsZXRlT3B0aW9ucywgdG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5odHRwQ2xpZW50LmRlbGV0ZSh0aGlzLnVybCwgZGVsZXRlT3B0aW9ucyldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIERFTEVURSByZXF1ZXN0IHNlbnQuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNl07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuVHJhY2UsIFwiKExvbmdQb2xsaW5nIHRyYW5zcG9ydCkgU3RvcCBmaW5pc2hlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSYWlzZSBjbG9zZSBldmVudCBoZXJlIGluc3RlYWQgb2YgaW4gcG9sbGluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXQgbmVlZHMgdG8gaGFwcGVuIGFmdGVyIHRoZSBERUxFVEUgcmVxdWVzdCBpcyBzZW50XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJhaXNlT25DbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs3IC8qZW5kZmluYWxseSovXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTG9uZ1BvbGxpbmdUcmFuc3BvcnQucHJvdG90eXBlLnJhaXNlT25DbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMub25jbG9zZSkge1xuICAgICAgICAgICAgdmFyIGxvZ01lc3NhZ2UgPSBcIihMb25nUG9sbGluZyB0cmFuc3BvcnQpIEZpcmluZyBvbmNsb3NlIGV2ZW50LlwiO1xuICAgICAgICAgICAgaWYgKHRoaXMuY2xvc2VFcnJvcikge1xuICAgICAgICAgICAgICAgIGxvZ01lc3NhZ2UgKz0gXCIgRXJyb3I6IFwiICsgdGhpcy5jbG9zZUVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgbG9nTWVzc2FnZSk7XG4gICAgICAgICAgICB0aGlzLm9uY2xvc2UodGhpcy5jbG9zZUVycm9yKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIExvbmdQb2xsaW5nVHJhbnNwb3J0O1xufSgpKTtcbmV4cG9ydHMuTG9uZ1BvbGxpbmdUcmFuc3BvcnQgPSBMb25nUG9sbGluZ1RyYW5zcG9ydDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxvbmdQb2xsaW5nVHJhbnNwb3J0LmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXExvbmdQb2xsaW5nVHJhbnNwb3J0LmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xuICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBJTG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9JTG9nZ2VyXCIpO1xudmFyIElUcmFuc3BvcnRfMSA9IHJlcXVpcmUoXCIuL0lUcmFuc3BvcnRcIik7XG52YXIgVXRpbHNfMSA9IHJlcXVpcmUoXCIuL1V0aWxzXCIpO1xuLyoqIEBwcml2YXRlICovXG52YXIgU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0KGh0dHBDbGllbnQsIGFjY2Vzc1Rva2VuRmFjdG9yeSwgbG9nZ2VyLCBsb2dNZXNzYWdlQ29udGVudCwgZXZlbnRTb3VyY2VDb25zdHJ1Y3Rvciwgd2l0aENyZWRlbnRpYWxzLCBoZWFkZXJzKSB7XG4gICAgICAgIHRoaXMuaHR0cENsaWVudCA9IGh0dHBDbGllbnQ7XG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW5GYWN0b3J5ID0gYWNjZXNzVG9rZW5GYWN0b3J5O1xuICAgICAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlQ29udGVudCA9IGxvZ01lc3NhZ2VDb250ZW50O1xuICAgICAgICB0aGlzLndpdGhDcmVkZW50aWFscyA9IHdpdGhDcmVkZW50aWFscztcbiAgICAgICAgdGhpcy5ldmVudFNvdXJjZUNvbnN0cnVjdG9yID0gZXZlbnRTb3VyY2VDb25zdHJ1Y3RvcjtcbiAgICAgICAgdGhpcy5oZWFkZXJzID0gaGVhZGVycztcbiAgICAgICAgdGhpcy5vbnJlY2VpdmUgPSBudWxsO1xuICAgICAgICB0aGlzLm9uY2xvc2UgPSBudWxsO1xuICAgIH1cbiAgICBTZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKHVybCwgdHJhbnNmZXJGb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRva2VuO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzXzEuQXJnLmlzUmVxdWlyZWQodXJsLCBcInVybFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzXzEuQXJnLmlzUmVxdWlyZWQodHJhbnNmZXJGb3JtYXQsIFwidHJhbnNmZXJGb3JtYXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsc18xLkFyZy5pc0luKHRyYW5zZmVyRm9ybWF0LCBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXQsIFwidHJhbnNmZXJGb3JtYXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihTU0UgdHJhbnNwb3J0KSBDb25uZWN0aW5nLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB1cmwgYmVmb3JlIGFjY2Vzc1Rva2VuRmFjdG9yeSBiZWNhdXNlIHRoaXMudXJsIGlzIG9ubHkgZm9yIHNlbmQgYW5kIHdlIHNldCB0aGUgYXV0aCBoZWFkZXIgaW5zdGVhZCBvZiB0aGUgcXVlcnkgc3RyaW5nIGZvciBzZW5kXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVybCA9IHVybDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5hY2Nlc3NUb2tlbkZhY3RvcnkoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsICs9ICh1cmwuaW5kZXhPZihcIj9cIikgPCAwID8gXCI/XCIgOiBcIiZcIikgKyAoXCJhY2Nlc3NfdG9rZW49XCIgKyBlbmNvZGVVUklDb21wb25lbnQodG9rZW4pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOiByZXR1cm4gWzIgLypyZXR1cm4qLywgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJhbnNmZXJGb3JtYXQgIT09IElUcmFuc3BvcnRfMS5UcmFuc2ZlckZvcm1hdC5UZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJUaGUgU2VydmVyLVNlbnQgRXZlbnRzIHRyYW5zcG9ydCBvbmx5IHN1cHBvcnRzIHRoZSAnVGV4dCcgdHJhbnNmZXIgZm9ybWF0XCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRTb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFV0aWxzXzEuUGxhdGZvcm0uaXNCcm93c2VyIHx8IFV0aWxzXzEuUGxhdGZvcm0uaXNXZWJXb3JrZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTb3VyY2UgPSBuZXcgX3RoaXMuZXZlbnRTb3VyY2VDb25zdHJ1Y3Rvcih1cmwsIHsgd2l0aENyZWRlbnRpYWxzOiBfdGhpcy53aXRoQ3JlZGVudGlhbHMgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb24tYnJvd3NlciBwYXNzZXMgY29va2llcyB2aWEgdGhlIGRpY3Rpb25hcnlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb2tpZXMgPSBfdGhpcy5odHRwQ2xpZW50LmdldENvb2tpZVN0cmluZyh1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZGVycyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLkNvb2tpZSA9IGNvb2tpZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYSA9IFV0aWxzXzEuZ2V0VXNlckFnZW50SGVhZGVyKCksIG5hbWVfMSA9IF9hWzBdLCB2YWx1ZSA9IF9hWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW25hbWVfMV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTb3VyY2UgPSBuZXcgX3RoaXMuZXZlbnRTb3VyY2VDb25zdHJ1Y3Rvcih1cmwsIHsgd2l0aENyZWRlbnRpYWxzOiBfdGhpcy53aXRoQ3JlZGVudGlhbHMsIGhlYWRlcnM6IF9fYXNzaWduKHt9LCBoZWFkZXJzLCBfdGhpcy5oZWFkZXJzKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTb3VyY2Uub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5vbnJlY2VpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoU1NFIHRyYW5zcG9ydCkgZGF0YSByZWNlaXZlZC4gXCIgKyBVdGlsc18xLmdldERhdGFEZXRhaWwoZS5kYXRhLCBfdGhpcy5sb2dNZXNzYWdlQ29udGVudCkgKyBcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9ucmVjZWl2ZShlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xvc2UoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFNvdXJjZS5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBFcnJvcihlLmRhdGEgfHwgXCJFcnJvciBvY2N1cnJlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcGVuZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbG9zZShlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFNvdXJjZS5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5JbmZvcm1hdGlvbiwgXCJTU0UgY29ubmVjdGVkIHRvIFwiICsgX3RoaXMudXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmV2ZW50U291cmNlID0gZXZlbnRTb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZXZlbnRTb3VyY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkNhbm5vdCBzZW5kIHVudGlsIHRoZSB0cmFuc3BvcnQgaXMgY29ubmVjdGVkXCIpKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBVdGlsc18xLnNlbmRNZXNzYWdlKHRoaXMubG9nZ2VyLCBcIlNTRVwiLCB0aGlzLmh0dHBDbGllbnQsIHRoaXMudXJsLCB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSwgZGF0YSwgdGhpcy5sb2dNZXNzYWdlQ29udGVudCwgdGhpcy53aXRoQ3JlZGVudGlhbHMsIHRoaXMuaGVhZGVycyldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfTtcbiAgICBTZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICh0aGlzLmV2ZW50U291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50U291cmNlLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50U291cmNlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgaWYgKHRoaXMub25jbG9zZSkge1xuICAgICAgICAgICAgICAgIHRoaXMub25jbG9zZShlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIFNlcnZlclNlbnRFdmVudHNUcmFuc3BvcnQ7XG59KCkpO1xuZXhwb3J0cy5TZXJ2ZXJTZW50RXZlbnRzVHJhbnNwb3J0ID0gU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNlcnZlclNlbnRFdmVudHNUcmFuc3BvcnQuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcU2VydmVyU2VudEV2ZW50c1RyYW5zcG9ydC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgVXRpbHNfMSA9IHJlcXVpcmUoXCIuL1V0aWxzXCIpO1xuLyoqIFN0cmVhbSBpbXBsZW1lbnRhdGlvbiB0byBzdHJlYW0gaXRlbXMgdG8gdGhlIHNlcnZlci4gKi9cbnZhciBTdWJqZWN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN1YmplY3QoKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gW107XG4gICAgfVxuICAgIFN1YmplY3QucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5vYnNlcnZlcnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBfYVtfaV07XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGl0ZW0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTdWJqZWN0LnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMub2JzZXJ2ZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgdmFyIG9ic2VydmVyID0gX2FbX2ldO1xuICAgICAgICAgICAgaWYgKG9ic2VydmVyLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgU3ViamVjdC5wcm90b3R5cGUuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLm9ic2VydmVyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBvYnNlcnZlciA9IF9hW19pXTtcbiAgICAgICAgICAgIGlmIChvYnNlcnZlci5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFN1YmplY3QucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIChvYnNlcnZlcikge1xuICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTtcbiAgICAgICAgcmV0dXJuIG5ldyBVdGlsc18xLlN1YmplY3RTdWJzY3JpcHRpb24odGhpcywgb2JzZXJ2ZXIpO1xuICAgIH07XG4gICAgcmV0dXJuIFN1YmplY3Q7XG59KCkpO1xuZXhwb3J0cy5TdWJqZWN0ID0gU3ViamVjdDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVN1YmplY3QuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcXFxcU3ViamVjdC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLyBOb3QgZXhwb3J0ZWQgZnJvbSBpbmRleFxuLyoqIEBwcml2YXRlICovXG52YXIgVGV4dE1lc3NhZ2VGb3JtYXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGV4dE1lc3NhZ2VGb3JtYXQoKSB7XG4gICAgfVxuICAgIFRleHRNZXNzYWdlRm9ybWF0LndyaXRlID0gZnVuY3Rpb24gKG91dHB1dCkge1xuICAgICAgICByZXR1cm4gXCJcIiArIG91dHB1dCArIFRleHRNZXNzYWdlRm9ybWF0LlJlY29yZFNlcGFyYXRvcjtcbiAgICB9O1xuICAgIFRleHRNZXNzYWdlRm9ybWF0LnBhcnNlID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgIGlmIChpbnB1dFtpbnB1dC5sZW5ndGggLSAxXSAhPT0gVGV4dE1lc3NhZ2VGb3JtYXQuUmVjb3JkU2VwYXJhdG9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXNzYWdlIGlzIGluY29tcGxldGUuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtZXNzYWdlcyA9IGlucHV0LnNwbGl0KFRleHRNZXNzYWdlRm9ybWF0LlJlY29yZFNlcGFyYXRvcik7XG4gICAgICAgIG1lc3NhZ2VzLnBvcCgpO1xuICAgICAgICByZXR1cm4gbWVzc2FnZXM7XG4gICAgfTtcbiAgICBUZXh0TWVzc2FnZUZvcm1hdC5SZWNvcmRTZXBhcmF0b3JDb2RlID0gMHgxZTtcbiAgICBUZXh0TWVzc2FnZUZvcm1hdC5SZWNvcmRTZXBhcmF0b3IgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKFRleHRNZXNzYWdlRm9ybWF0LlJlY29yZFNlcGFyYXRvckNvZGUpO1xuICAgIHJldHVybiBUZXh0TWVzc2FnZUZvcm1hdDtcbn0oKSk7XG5leHBvcnRzLlRleHRNZXNzYWdlRm9ybWF0ID0gVGV4dE1lc3NhZ2VGb3JtYXQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1UZXh0TWVzc2FnZUZvcm1hdC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxUZXh0TWVzc2FnZUZvcm1hdC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcbiAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgfVxuICAgIHJldHVybiB0O1xufTtcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xudmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHtcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xuICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xuICAgICAgICB3aGlsZSAoXykgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xuICAgIH1cbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgSUxvZ2dlcl8xID0gcmVxdWlyZShcIi4vSUxvZ2dlclwiKTtcbnZhciBMb2dnZXJzXzEgPSByZXF1aXJlKFwiLi9Mb2dnZXJzXCIpO1xuLy8gVmVyc2lvbiB0b2tlbiB0aGF0IHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIHByZXBhY2sgY29tbWFuZFxuLyoqIFRoZSB2ZXJzaW9uIG9mIHRoZSBTaWduYWxSIGNsaWVudC4gKi9cbmV4cG9ydHMuVkVSU0lPTiA9IFwiNS4wLjVcIjtcbi8qKiBAcHJpdmF0ZSAqL1xudmFyIEFyZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBcmcoKSB7XG4gICAgfVxuICAgIEFyZy5pc1JlcXVpcmVkID0gZnVuY3Rpb24gKHZhbCwgbmFtZSkge1xuICAgICAgICBpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1wiICsgbmFtZSArIFwiJyBhcmd1bWVudCBpcyByZXF1aXJlZC5cIik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFyZy5pc05vdEVtcHR5ID0gZnVuY3Rpb24gKHZhbCwgbmFtZSkge1xuICAgICAgICBpZiAoIXZhbCB8fCB2YWwubWF0Y2goL15cXHMqJC8pKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgJ1wiICsgbmFtZSArIFwiJyBhcmd1bWVudCBzaG91bGQgbm90IGJlIGVtcHR5LlwiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQXJnLmlzSW4gPSBmdW5jdGlvbiAodmFsLCB2YWx1ZXMsIG5hbWUpIHtcbiAgICAgICAgLy8gVHlwZVNjcmlwdCBlbnVtcyBoYXZlIGtleXMgZm9yICoqYm90aCoqIHRoZSBuYW1lIGFuZCB0aGUgdmFsdWUgb2YgZWFjaCBlbnVtIG1lbWJlciBvbiB0aGUgdHlwZSBpdHNlbGYuXG4gICAgICAgIGlmICghKHZhbCBpbiB2YWx1ZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIFwiICsgbmFtZSArIFwiIHZhbHVlOiBcIiArIHZhbCArIFwiLlwiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIEFyZztcbn0oKSk7XG5leHBvcnRzLkFyZyA9IEFyZztcbi8qKiBAcHJpdmF0ZSAqL1xudmFyIFBsYXRmb3JtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFBsYXRmb3JtKCkge1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUGxhdGZvcm0sIFwiaXNCcm93c2VyXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHdpbmRvdyA9PT0gXCJvYmplY3RcIjtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFBsYXRmb3JtLCBcImlzV2ViV29ya2VyXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHNlbGYgPT09IFwib2JqZWN0XCIgJiYgXCJpbXBvcnRTY3JpcHRzXCIgaW4gc2VsZjtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFBsYXRmb3JtLCBcImlzTm9kZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzQnJvd3NlciAmJiAhdGhpcy5pc1dlYldvcmtlcjtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIFBsYXRmb3JtO1xufSgpKTtcbmV4cG9ydHMuUGxhdGZvcm0gPSBQbGF0Zm9ybTtcbi8qKiBAcHJpdmF0ZSAqL1xuZnVuY3Rpb24gZ2V0RGF0YURldGFpbChkYXRhLCBpbmNsdWRlQ29udGVudCkge1xuICAgIHZhciBkZXRhaWwgPSBcIlwiO1xuICAgIGlmIChpc0FycmF5QnVmZmVyKGRhdGEpKSB7XG4gICAgICAgIGRldGFpbCA9IFwiQmluYXJ5IGRhdGEgb2YgbGVuZ3RoIFwiICsgZGF0YS5ieXRlTGVuZ3RoO1xuICAgICAgICBpZiAoaW5jbHVkZUNvbnRlbnQpIHtcbiAgICAgICAgICAgIGRldGFpbCArPSBcIi4gQ29udGVudDogJ1wiICsgZm9ybWF0QXJyYXlCdWZmZXIoZGF0YSkgKyBcIidcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBkZXRhaWwgPSBcIlN0cmluZyBkYXRhIG9mIGxlbmd0aCBcIiArIGRhdGEubGVuZ3RoO1xuICAgICAgICBpZiAoaW5jbHVkZUNvbnRlbnQpIHtcbiAgICAgICAgICAgIGRldGFpbCArPSBcIi4gQ29udGVudDogJ1wiICsgZGF0YSArIFwiJ1wiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkZXRhaWw7XG59XG5leHBvcnRzLmdldERhdGFEZXRhaWwgPSBnZXREYXRhRGV0YWlsO1xuLyoqIEBwcml2YXRlICovXG5mdW5jdGlvbiBmb3JtYXRBcnJheUJ1ZmZlcihkYXRhKSB7XG4gICAgdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShkYXRhKTtcbiAgICAvLyBVaW50OEFycmF5Lm1hcCBvbmx5IHN1cHBvcnRzIHJldHVybmluZyBhbm90aGVyIFVpbnQ4QXJyYXk/XG4gICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgdmlldy5mb3JFYWNoKGZ1bmN0aW9uIChudW0pIHtcbiAgICAgICAgdmFyIHBhZCA9IG51bSA8IDE2ID8gXCIwXCIgOiBcIlwiO1xuICAgICAgICBzdHIgKz0gXCIweFwiICsgcGFkICsgbnVtLnRvU3RyaW5nKDE2KSArIFwiIFwiO1xuICAgIH0pO1xuICAgIC8vIFRyaW0gb2YgdHJhaWxpbmcgc3BhY2UuXG4gICAgcmV0dXJuIHN0ci5zdWJzdHIoMCwgc3RyLmxlbmd0aCAtIDEpO1xufVxuZXhwb3J0cy5mb3JtYXRBcnJheUJ1ZmZlciA9IGZvcm1hdEFycmF5QnVmZmVyO1xuLy8gQWxzbyBpbiBzaWduYWxyLXByb3RvY29sLW1zZ3BhY2svVXRpbHMudHNcbi8qKiBAcHJpdmF0ZSAqL1xuZnVuY3Rpb24gaXNBcnJheUJ1ZmZlcih2YWwpIHtcbiAgICByZXR1cm4gdmFsICYmIHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgICAodmFsIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgfHxcbiAgICAgICAgICAgIC8vIFNvbWV0aW1lcyB3ZSBnZXQgYW4gQXJyYXlCdWZmZXIgdGhhdCBkb2Vzbid0IHNhdGlzZnkgaW5zdGFuY2VvZlxuICAgICAgICAgICAgKHZhbC5jb25zdHJ1Y3RvciAmJiB2YWwuY29uc3RydWN0b3IubmFtZSA9PT0gXCJBcnJheUJ1ZmZlclwiKSk7XG59XG5leHBvcnRzLmlzQXJyYXlCdWZmZXIgPSBpc0FycmF5QnVmZmVyO1xuLyoqIEBwcml2YXRlICovXG5mdW5jdGlvbiBzZW5kTWVzc2FnZShsb2dnZXIsIHRyYW5zcG9ydE5hbWUsIGh0dHBDbGllbnQsIHVybCwgYWNjZXNzVG9rZW5GYWN0b3J5LCBjb250ZW50LCBsb2dNZXNzYWdlQ29udGVudCwgd2l0aENyZWRlbnRpYWxzLCBkZWZhdWx0SGVhZGVycykge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hLCBoZWFkZXJzLCB0b2tlbiwgX2IsIG5hbWUsIHZhbHVlLCByZXNwb25zZVR5cGUsIHJlc3BvbnNlO1xuICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKF9jLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzID0ge307XG4gICAgICAgICAgICAgICAgICAgIGlmICghYWNjZXNzVG9rZW5GYWN0b3J5KSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYWNjZXNzVG9rZW5GYWN0b3J5KCldO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IChfYSA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hW1wiQXV0aG9yaXphdGlvblwiXSA9IFwiQmVhcmVyIFwiICsgdG9rZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF9jLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIF9iID0gZ2V0VXNlckFnZW50SGVhZGVyKCksIG5hbWUgPSBfYlswXSwgdmFsdWUgPSBfYlsxXTtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoXCIgKyB0cmFuc3BvcnROYW1lICsgXCIgdHJhbnNwb3J0KSBzZW5kaW5nIGRhdGEuIFwiICsgZ2V0RGF0YURldGFpbChjb250ZW50LCBsb2dNZXNzYWdlQ29udGVudCkgKyBcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZSA9IGlzQXJyYXlCdWZmZXIoY29udGVudCkgPyBcImFycmF5YnVmZmVyXCIgOiBcInRleHRcIjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgaHR0cENsaWVudC5wb3N0KHVybCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogX19hc3NpZ24oe30sIGhlYWRlcnMsIGRlZmF1bHRIZWFkZXJzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6IHJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHdpdGhDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoXCIgKyB0cmFuc3BvcnROYW1lICsgXCIgdHJhbnNwb3J0KSByZXF1ZXN0IGNvbXBsZXRlLiBSZXNwb25zZSBzdGF0dXM6IFwiICsgcmVzcG9uc2Uuc3RhdHVzQ29kZSArIFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuc2VuZE1lc3NhZ2UgPSBzZW5kTWVzc2FnZTtcbi8qKiBAcHJpdmF0ZSAqL1xuZnVuY3Rpb24gY3JlYXRlTG9nZ2VyKGxvZ2dlcikge1xuICAgIGlmIChsb2dnZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gbmV3IENvbnNvbGVMb2dnZXIoSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uKTtcbiAgICB9XG4gICAgaWYgKGxvZ2dlciA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gTG9nZ2Vyc18xLk51bGxMb2dnZXIuaW5zdGFuY2U7XG4gICAgfVxuICAgIGlmIChsb2dnZXIubG9nKSB7XG4gICAgICAgIHJldHVybiBsb2dnZXI7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQ29uc29sZUxvZ2dlcihsb2dnZXIpO1xufVxuZXhwb3J0cy5jcmVhdGVMb2dnZXIgPSBjcmVhdGVMb2dnZXI7XG4vKiogQHByaXZhdGUgKi9cbnZhciBTdWJqZWN0U3Vic2NyaXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN1YmplY3RTdWJzY3JpcHRpb24oc3ViamVjdCwgb2JzZXJ2ZXIpIHtcbiAgICAgICAgdGhpcy5zdWJqZWN0ID0gc3ViamVjdDtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgIH1cbiAgICBTdWJqZWN0U3Vic2NyaXB0aW9uLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLnN1YmplY3Qub2JzZXJ2ZXJzLmluZGV4T2YodGhpcy5vYnNlcnZlcik7XG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLnN1YmplY3Qub2JzZXJ2ZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3ViamVjdC5vYnNlcnZlcnMubGVuZ3RoID09PSAwICYmIHRoaXMuc3ViamVjdC5jYW5jZWxDYWxsYmFjaykge1xuICAgICAgICAgICAgdGhpcy5zdWJqZWN0LmNhbmNlbENhbGxiYWNrKCkuY2F0Y2goZnVuY3Rpb24gKF8pIHsgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBTdWJqZWN0U3Vic2NyaXB0aW9uO1xufSgpKTtcbmV4cG9ydHMuU3ViamVjdFN1YnNjcmlwdGlvbiA9IFN1YmplY3RTdWJzY3JpcHRpb247XG4vKiogQHByaXZhdGUgKi9cbnZhciBDb25zb2xlTG9nZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbnNvbGVMb2dnZXIobWluaW11bUxvZ0xldmVsKSB7XG4gICAgICAgIHRoaXMubWluaW11bUxvZ0xldmVsID0gbWluaW11bUxvZ0xldmVsO1xuICAgICAgICB0aGlzLm91dHB1dENvbnNvbGUgPSBjb25zb2xlO1xuICAgIH1cbiAgICBDb25zb2xlTG9nZ2VyLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiAobG9nTGV2ZWwsIG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKGxvZ0xldmVsID49IHRoaXMubWluaW11bUxvZ0xldmVsKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGxvZ0xldmVsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBJTG9nZ2VyXzEuTG9nTGV2ZWwuQ3JpdGljYWw6XG4gICAgICAgICAgICAgICAgY2FzZSBJTG9nZ2VyXzEuTG9nTGV2ZWwuRXJyb3I6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3V0cHV0Q29uc29sZS5lcnJvcihcIltcIiArIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSArIFwiXSBcIiArIElMb2dnZXJfMS5Mb2dMZXZlbFtsb2dMZXZlbF0gKyBcIjogXCIgKyBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBJTG9nZ2VyXzEuTG9nTGV2ZWwuV2FybmluZzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdXRwdXRDb25zb2xlLndhcm4oXCJbXCIgKyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgKyBcIl0gXCIgKyBJTG9nZ2VyXzEuTG9nTGV2ZWxbbG9nTGV2ZWxdICsgXCI6IFwiICsgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgSUxvZ2dlcl8xLkxvZ0xldmVsLkluZm9ybWF0aW9uOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm91dHB1dENvbnNvbGUuaW5mbyhcIltcIiArIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSArIFwiXSBcIiArIElMb2dnZXJfMS5Mb2dMZXZlbFtsb2dMZXZlbF0gKyBcIjogXCIgKyBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5kZWJ1ZyBvbmx5IGdvZXMgdG8gYXR0YWNoZWQgZGVidWdnZXJzIGluIE5vZGUsIHNvIHdlIHVzZSBjb25zb2xlLmxvZyBmb3IgVHJhY2UgYW5kIERlYnVnXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3V0cHV0Q29uc29sZS5sb2coXCJbXCIgKyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgKyBcIl0gXCIgKyBJTG9nZ2VyXzEuTG9nTGV2ZWxbbG9nTGV2ZWxdICsgXCI6IFwiICsgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gQ29uc29sZUxvZ2dlcjtcbn0oKSk7XG5leHBvcnRzLkNvbnNvbGVMb2dnZXIgPSBDb25zb2xlTG9nZ2VyO1xuLyoqIEBwcml2YXRlICovXG5mdW5jdGlvbiBnZXRVc2VyQWdlbnRIZWFkZXIoKSB7XG4gICAgdmFyIHVzZXJBZ2VudEhlYWRlck5hbWUgPSBcIlgtU2lnbmFsUi1Vc2VyLUFnZW50XCI7XG4gICAgaWYgKFBsYXRmb3JtLmlzTm9kZSkge1xuICAgICAgICB1c2VyQWdlbnRIZWFkZXJOYW1lID0gXCJVc2VyLUFnZW50XCI7XG4gICAgfVxuICAgIHJldHVybiBbdXNlckFnZW50SGVhZGVyTmFtZSwgY29uc3RydWN0VXNlckFnZW50KGV4cG9ydHMuVkVSU0lPTiwgZ2V0T3NOYW1lKCksIGdldFJ1bnRpbWUoKSwgZ2V0UnVudGltZVZlcnNpb24oKSldO1xufVxuZXhwb3J0cy5nZXRVc2VyQWdlbnRIZWFkZXIgPSBnZXRVc2VyQWdlbnRIZWFkZXI7XG4vKiogQHByaXZhdGUgKi9cbmZ1bmN0aW9uIGNvbnN0cnVjdFVzZXJBZ2VudCh2ZXJzaW9uLCBvcywgcnVudGltZSwgcnVudGltZVZlcnNpb24pIHtcbiAgICAvLyBNaWNyb3NvZnQgU2lnbmFsUi9bVmVyc2lvbl0gKFtEZXRhaWxlZCBWZXJzaW9uXTsgW09wZXJhdGluZyBTeXN0ZW1dOyBbUnVudGltZV07IFtSdW50aW1lIFZlcnNpb25dKVxuICAgIHZhciB1c2VyQWdlbnQgPSBcIk1pY3Jvc29mdCBTaWduYWxSL1wiO1xuICAgIHZhciBtYWpvckFuZE1pbm9yID0gdmVyc2lvbi5zcGxpdChcIi5cIik7XG4gICAgdXNlckFnZW50ICs9IG1ham9yQW5kTWlub3JbMF0gKyBcIi5cIiArIG1ham9yQW5kTWlub3JbMV07XG4gICAgdXNlckFnZW50ICs9IFwiIChcIiArIHZlcnNpb24gKyBcIjsgXCI7XG4gICAgaWYgKG9zICYmIG9zICE9PSBcIlwiKSB7XG4gICAgICAgIHVzZXJBZ2VudCArPSBvcyArIFwiOyBcIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHVzZXJBZ2VudCArPSBcIlVua25vd24gT1M7IFwiO1xuICAgIH1cbiAgICB1c2VyQWdlbnQgKz0gXCJcIiArIHJ1bnRpbWU7XG4gICAgaWYgKHJ1bnRpbWVWZXJzaW9uKSB7XG4gICAgICAgIHVzZXJBZ2VudCArPSBcIjsgXCIgKyBydW50aW1lVmVyc2lvbjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHVzZXJBZ2VudCArPSBcIjsgVW5rbm93biBSdW50aW1lIFZlcnNpb25cIjtcbiAgICB9XG4gICAgdXNlckFnZW50ICs9IFwiKVwiO1xuICAgIHJldHVybiB1c2VyQWdlbnQ7XG59XG5leHBvcnRzLmNvbnN0cnVjdFVzZXJBZ2VudCA9IGNvbnN0cnVjdFVzZXJBZ2VudDtcbmZ1bmN0aW9uIGdldE9zTmFtZSgpIHtcbiAgICBpZiAoUGxhdGZvcm0uaXNOb2RlKSB7XG4gICAgICAgIHN3aXRjaCAocHJvY2Vzcy5wbGF0Zm9ybSkge1xuICAgICAgICAgICAgY2FzZSBcIndpbjMyXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiV2luZG93cyBOVFwiO1xuICAgICAgICAgICAgY2FzZSBcImRhcndpblwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIm1hY09TXCI7XG4gICAgICAgICAgICBjYXNlIFwibGludXhcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJMaW51eFwiO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzcy5wbGF0Zm9ybTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0UnVudGltZVZlcnNpb24oKSB7XG4gICAgaWYgKFBsYXRmb3JtLmlzTm9kZSkge1xuICAgICAgICByZXR1cm4gcHJvY2Vzcy52ZXJzaW9ucy5ub2RlO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gZ2V0UnVudGltZSgpIHtcbiAgICBpZiAoUGxhdGZvcm0uaXNOb2RlKSB7XG4gICAgICAgIHJldHVybiBcIk5vZGVKU1wiO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiQnJvd3NlclwiO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVV0aWxzLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXFV0aWxzLmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xuICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGc7XG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XG4gICAgZnVuY3Rpb24gc3RlcChvcCkge1xuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gICAgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBJTG9nZ2VyXzEgPSByZXF1aXJlKFwiLi9JTG9nZ2VyXCIpO1xudmFyIElUcmFuc3BvcnRfMSA9IHJlcXVpcmUoXCIuL0lUcmFuc3BvcnRcIik7XG52YXIgVXRpbHNfMSA9IHJlcXVpcmUoXCIuL1V0aWxzXCIpO1xuLyoqIEBwcml2YXRlICovXG52YXIgV2ViU29ja2V0VHJhbnNwb3J0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdlYlNvY2tldFRyYW5zcG9ydChodHRwQ2xpZW50LCBhY2Nlc3NUb2tlbkZhY3RvcnksIGxvZ2dlciwgbG9nTWVzc2FnZUNvbnRlbnQsIHdlYlNvY2tldENvbnN0cnVjdG9yLCBoZWFkZXJzKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuRmFjdG9yeSA9IGFjY2Vzc1Rva2VuRmFjdG9yeTtcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlQ29udGVudCA9IGxvZ01lc3NhZ2VDb250ZW50O1xuICAgICAgICB0aGlzLndlYlNvY2tldENvbnN0cnVjdG9yID0gd2ViU29ja2V0Q29uc3RydWN0b3I7XG4gICAgICAgIHRoaXMuaHR0cENsaWVudCA9IGh0dHBDbGllbnQ7XG4gICAgICAgIHRoaXMub25yZWNlaXZlID0gbnVsbDtcbiAgICAgICAgdGhpcy5vbmNsb3NlID0gbnVsbDtcbiAgICAgICAgdGhpcy5oZWFkZXJzID0gaGVhZGVycztcbiAgICB9XG4gICAgV2ViU29ja2V0VHJhbnNwb3J0LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKHVybCwgdHJhbnNmZXJGb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRva2VuO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzXzEuQXJnLmlzUmVxdWlyZWQodXJsLCBcInVybFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzXzEuQXJnLmlzUmVxdWlyZWQodHJhbnNmZXJGb3JtYXQsIFwidHJhbnNmZXJGb3JtYXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsc18xLkFyZy5pc0luKHRyYW5zZmVyRm9ybWF0LCBJVHJhbnNwb3J0XzEuVHJhbnNmZXJGb3JtYXQsIFwidHJhbnNmZXJGb3JtYXRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihXZWJTb2NrZXRzIHRyYW5zcG9ydCkgQ29ubmVjdGluZy5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYWNjZXNzVG9rZW5GYWN0b3J5KSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuYWNjZXNzVG9rZW5GYWN0b3J5KCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSAodXJsLmluZGV4T2YoXCI/XCIpIDwgMCA/IFwiP1wiIDogXCImXCIpICsgKFwiYWNjZXNzX3Rva2VuPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHRva2VuKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDI7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgvXmh0dHAvLCBcIndzXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3ZWJTb2NrZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb2tpZXMgPSBfdGhpcy5odHRwQ2xpZW50LmdldENvb2tpZVN0cmluZyh1cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXRpbHNfMS5QbGF0Zm9ybS5pc05vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hID0gVXRpbHNfMS5nZXRVc2VyQWdlbnRIZWFkZXIoKSwgbmFtZV8xID0gX2FbMF0sIHZhbHVlID0gX2FbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbbmFtZV8xXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29va2llcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tcIkNvb2tpZVwiXSA9IFwiXCIgKyBjb29raWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgcGFzcyBoZWFkZXJzIHdoZW4gaW4gbm9uLWJyb3dzZXIgZW52aXJvbm1lbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlYlNvY2tldCA9IG5ldyBfdGhpcy53ZWJTb2NrZXRDb25zdHJ1Y3Rvcih1cmwsIHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogX19hc3NpZ24oe30sIGhlYWRlcnMsIF90aGlzLmhlYWRlcnMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF3ZWJTb2NrZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hyb21lIGlzIG5vdCBoYXBweSB3aXRoIHBhc3NpbmcgJ3VuZGVmaW5lZCcgYXMgcHJvdG9jb2xcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2ViU29ja2V0ID0gbmV3IF90aGlzLndlYlNvY2tldENvbnN0cnVjdG9yKHVybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2ZlckZvcm1hdCA9PT0gSVRyYW5zcG9ydF8xLlRyYW5zZmVyRm9ybWF0LkJpbmFyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWJTb2NrZXQuYmluYXJ5VHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWJTb2NrZXQub25vcGVuID0gZnVuY3Rpb24gKF9ldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5JbmZvcm1hdGlvbiwgXCJXZWJTb2NrZXQgY29ubmVjdGVkIHRvIFwiICsgdXJsICsgXCIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy53ZWJTb2NrZXQgPSB3ZWJTb2NrZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlYlNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVycm9yRXZlbnQgaXMgYSBicm93c2VyIG9ubHkgdHlwZSB3ZSBuZWVkIHRvIGNoZWNrIGlmIHRoZSB0eXBlIGV4aXN0cyBiZWZvcmUgdXNpbmcgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBFcnJvckV2ZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIGV2ZW50IGluc3RhbmNlb2YgRXJyb3JFdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBldmVudC5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gbmV3IEVycm9yKFwiVGhlcmUgd2FzIGFuIGVycm9yIHdpdGggdGhlIHRyYW5zcG9ydC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlYlNvY2tldC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5UcmFjZSwgXCIoV2ViU29ja2V0cyB0cmFuc3BvcnQpIGRhdGEgcmVjZWl2ZWQuIFwiICsgVXRpbHNfMS5nZXREYXRhRGV0YWlsKG1lc3NhZ2UuZGF0YSwgX3RoaXMubG9nTWVzc2FnZUNvbnRlbnQpICsgXCIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMub25yZWNlaXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9ucmVjZWl2ZShtZXNzYWdlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xvc2UoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2ViU29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgY2FsbCBjbG9zZSBoYW5kbGVyIGlmIGNvbm5lY3Rpb24gd2FzIG5ldmVyIGVzdGFibGlzaGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlJ2xsIHJlamVjdCB0aGUgY29ubmVjdCBjYWxsIGluc3RlYWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xvc2UoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVycm9yRXZlbnQgaXMgYSBicm93c2VyIG9ubHkgdHlwZSB3ZSBuZWVkIHRvIGNoZWNrIGlmIHRoZSB0eXBlIGV4aXN0cyBiZWZvcmUgdXNpbmcgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgRXJyb3JFdmVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBldmVudCBpbnN0YW5jZW9mIEVycm9yRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGV2ZW50LmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBuZXcgRXJyb3IoXCJUaGVyZSB3YXMgYW4gZXJyb3Igd2l0aCB0aGUgdHJhbnNwb3J0LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFdlYlNvY2tldFRyYW5zcG9ydC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmICh0aGlzLndlYlNvY2tldCAmJiB0aGlzLndlYlNvY2tldC5yZWFkeVN0YXRlID09PSB0aGlzLndlYlNvY2tldENvbnN0cnVjdG9yLk9QRU4pIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuVHJhY2UsIFwiKFdlYlNvY2tldHMgdHJhbnNwb3J0KSBzZW5kaW5nIGRhdGEuIFwiICsgVXRpbHNfMS5nZXREYXRhRGV0YWlsKGRhdGEsIHRoaXMubG9nTWVzc2FnZUNvbnRlbnQpICsgXCIuXCIpO1xuICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuc2VuZChkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoXCJXZWJTb2NrZXQgaXMgbm90IGluIHRoZSBPUEVOIHN0YXRlXCIpO1xuICAgIH07XG4gICAgV2ViU29ja2V0VHJhbnNwb3J0LnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy53ZWJTb2NrZXQpIHtcbiAgICAgICAgICAgIC8vIE1hbnVhbGx5IGludm9rZSBvbmNsb3NlIGNhbGxiYWNrIGlubGluZSBzbyB3ZSBrbm93IHRoZSBIdHRwQ29ubmVjdGlvbiB3YXMgY2xvc2VkIHByb3Blcmx5IGJlZm9yZSByZXR1cm5pbmdcbiAgICAgICAgICAgIC8vIFRoaXMgYWxzbyBzb2x2ZXMgYW4gaXNzdWUgd2hlcmUgd2Vic29ja2V0Lm9uY2xvc2UgY291bGQgdGFrZSAxOCsgc2Vjb25kcyB0byB0cmlnZ2VyIGR1cmluZyBuZXR3b3JrIGRpc2Nvbm5lY3RzXG4gICAgICAgICAgICB0aGlzLmNsb3NlKHVuZGVmaW5lZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH07XG4gICAgV2ViU29ja2V0VHJhbnNwb3J0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAvLyB3ZWJTb2NrZXQgd2lsbCBiZSBudWxsIGlmIHRoZSB0cmFuc3BvcnQgZGlkIG5vdCBzdGFydCBzdWNjZXNzZnVsbHlcbiAgICAgICAgaWYgKHRoaXMud2ViU29ja2V0KSB7XG4gICAgICAgICAgICAvLyBDbGVhciB3ZWJzb2NrZXQgaGFuZGxlcnMgYmVjYXVzZSB3ZSBhcmUgY29uc2lkZXJpbmcgdGhlIHNvY2tldCBjbG9zZWQgbm93XG4gICAgICAgICAgICB0aGlzLndlYlNvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQub25lcnJvciA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLndlYlNvY2tldCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coSUxvZ2dlcl8xLkxvZ0xldmVsLlRyYWNlLCBcIihXZWJTb2NrZXRzIHRyYW5zcG9ydCkgc29ja2V0IGNsb3NlZC5cIik7XG4gICAgICAgIGlmICh0aGlzLm9uY2xvc2UpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2xvc2VFdmVudChldmVudCkgJiYgKGV2ZW50Lndhc0NsZWFuID09PSBmYWxzZSB8fCBldmVudC5jb2RlICE9PSAxMDAwKSkge1xuICAgICAgICAgICAgICAgIHRoaXMub25jbG9zZShuZXcgRXJyb3IoXCJXZWJTb2NrZXQgY2xvc2VkIHdpdGggc3RhdHVzIGNvZGU6IFwiICsgZXZlbnQuY29kZSArIFwiIChcIiArIGV2ZW50LnJlYXNvbiArIFwiKS5cIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMub25jbG9zZShldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgV2ViU29ja2V0VHJhbnNwb3J0LnByb3RvdHlwZS5pc0Nsb3NlRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50ICYmIHR5cGVvZiBldmVudC53YXNDbGVhbiA9PT0gXCJib29sZWFuXCIgJiYgdHlwZW9mIGV2ZW50LmNvZGUgPT09IFwibnVtYmVyXCI7XG4gICAgfTtcbiAgICByZXR1cm4gV2ViU29ja2V0VHJhbnNwb3J0O1xufSgpKTtcbmV4cG9ydHMuV2ViU29ja2V0VHJhbnNwb3J0ID0gV2ViU29ja2V0VHJhbnNwb3J0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9V2ViU29ja2V0VHJhbnNwb3J0LmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcQG1pY3Jvc29mdFxcXFxzaWduYWxyXFxcXGRpc3RcXFxcY2pzXFxcXFdlYlNvY2tldFRyYW5zcG9ydC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgLk5FVCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMC4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBFcnJvcnNfMSA9IHJlcXVpcmUoXCIuL0Vycm9yc1wiKTtcbnZhciBIdHRwQ2xpZW50XzEgPSByZXF1aXJlKFwiLi9IdHRwQ2xpZW50XCIpO1xudmFyIElMb2dnZXJfMSA9IHJlcXVpcmUoXCIuL0lMb2dnZXJcIik7XG52YXIgWGhySHR0cENsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoWGhySHR0cENsaWVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBYaHJIdHRwQ2xpZW50KGxvZ2dlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgWGhySHR0cENsaWVudC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIC8vIENoZWNrIHRoYXQgYWJvcnQgd2FzIG5vdCBzaWduYWxlZCBiZWZvcmUgY2FsbGluZyBzZW5kXG4gICAgICAgIGlmIChyZXF1ZXN0LmFib3J0U2lnbmFsICYmIHJlcXVlc3QuYWJvcnRTaWduYWwuYWJvcnRlZCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcnNfMS5BYm9ydEVycm9yKCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcmVxdWVzdC5tZXRob2QpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJObyBtZXRob2QgZGVmaW5lZC5cIikpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcmVxdWVzdC51cmwpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJObyB1cmwgZGVmaW5lZC5cIikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICB4aHIub3BlbihyZXF1ZXN0Lm1ldGhvZCwgcmVxdWVzdC51cmwsIHRydWUpO1xuICAgICAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHJlcXVlc3Qud2l0aENyZWRlbnRpYWxzID09PSB1bmRlZmluZWQgPyB0cnVlIDogcmVxdWVzdC53aXRoQ3JlZGVudGlhbHM7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcbiAgICAgICAgICAgIC8vIEV4cGxpY2l0bHkgc2V0dGluZyB0aGUgQ29udGVudC1UeXBlIGhlYWRlciBmb3IgUmVhY3QgTmF0aXZlIG9uIEFuZHJvaWQgcGxhdGZvcm0uXG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcInRleHQvcGxhaW47Y2hhcnNldD1VVEYtOFwiKTtcbiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gcmVxdWVzdC5oZWFkZXJzO1xuICAgICAgICAgICAgaWYgKGhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhoZWFkZXJzKVxuICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoaGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgaGVhZGVyc1toZWFkZXJdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnJlc3BvbnNlVHlwZSkge1xuICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSByZXF1ZXN0LnJlc3BvbnNlVHlwZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmFib3J0U2lnbmFsKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5hYm9ydFNpZ25hbC5vbmFib3J0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB4aHIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcnNfMS5BYm9ydEVycm9yKCkpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVxdWVzdC50aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgeGhyLnRpbWVvdXQgPSByZXF1ZXN0LnRpbWVvdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0LmFib3J0U2lnbmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuYWJvcnRTaWduYWwub25hYm9ydCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobmV3IEh0dHBDbGllbnRfMS5IdHRwUmVzcG9uc2UoeGhyLnN0YXR1cywgeGhyLnN0YXR1c1RleHQsIHhoci5yZXNwb25zZSB8fCB4aHIucmVzcG9uc2VUZXh0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yc18xLkh0dHBFcnJvcih4aHIuc3RhdHVzVGV4dCwgeGhyLnN0YXR1cykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIubG9nKElMb2dnZXJfMS5Mb2dMZXZlbC5XYXJuaW5nLCBcIkVycm9yIGZyb20gSFRUUCByZXF1ZXN0LiBcIiArIHhoci5zdGF0dXMgKyBcIjogXCIgKyB4aHIuc3RhdHVzVGV4dCArIFwiLlwiKTtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yc18xLkh0dHBFcnJvcih4aHIuc3RhdHVzVGV4dCwgeGhyLnN0YXR1cykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vbnRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLmxvZyhJTG9nZ2VyXzEuTG9nTGV2ZWwuV2FybmluZywgXCJUaW1lb3V0IGZyb20gSFRUUCByZXF1ZXN0LlwiKTtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yc18xLlRpbWVvdXRFcnJvcigpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB4aHIuc2VuZChyZXF1ZXN0LmNvbnRlbnQgfHwgXCJcIik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFhockh0dHBDbGllbnQ7XG59KEh0dHBDbGllbnRfMS5IdHRwQ2xpZW50KSk7XG5leHBvcnRzLlhockh0dHBDbGllbnQgPSBYaHJIdHRwQ2xpZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9WGhySHR0cENsaWVudC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxYaHJIdHRwQ2xpZW50LmpzXCIsXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xuLy8gQ29weXJpZ2h0IChjKSAuTkVUIEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBFcnJvcnNfMSA9IHJlcXVpcmUoXCIuL0Vycm9yc1wiKTtcbmV4cG9ydHMuQWJvcnRFcnJvciA9IEVycm9yc18xLkFib3J0RXJyb3I7XG5leHBvcnRzLkh0dHBFcnJvciA9IEVycm9yc18xLkh0dHBFcnJvcjtcbmV4cG9ydHMuVGltZW91dEVycm9yID0gRXJyb3JzXzEuVGltZW91dEVycm9yO1xudmFyIEh0dHBDbGllbnRfMSA9IHJlcXVpcmUoXCIuL0h0dHBDbGllbnRcIik7XG5leHBvcnRzLkh0dHBDbGllbnQgPSBIdHRwQ2xpZW50XzEuSHR0cENsaWVudDtcbmV4cG9ydHMuSHR0cFJlc3BvbnNlID0gSHR0cENsaWVudF8xLkh0dHBSZXNwb25zZTtcbnZhciBEZWZhdWx0SHR0cENsaWVudF8xID0gcmVxdWlyZShcIi4vRGVmYXVsdEh0dHBDbGllbnRcIik7XG5leHBvcnRzLkRlZmF1bHRIdHRwQ2xpZW50ID0gRGVmYXVsdEh0dHBDbGllbnRfMS5EZWZhdWx0SHR0cENsaWVudDtcbnZhciBIdWJDb25uZWN0aW9uXzEgPSByZXF1aXJlKFwiLi9IdWJDb25uZWN0aW9uXCIpO1xuZXhwb3J0cy5IdWJDb25uZWN0aW9uID0gSHViQ29ubmVjdGlvbl8xLkh1YkNvbm5lY3Rpb247XG5leHBvcnRzLkh1YkNvbm5lY3Rpb25TdGF0ZSA9IEh1YkNvbm5lY3Rpb25fMS5IdWJDb25uZWN0aW9uU3RhdGU7XG52YXIgSHViQ29ubmVjdGlvbkJ1aWxkZXJfMSA9IHJlcXVpcmUoXCIuL0h1YkNvbm5lY3Rpb25CdWlsZGVyXCIpO1xuZXhwb3J0cy5IdWJDb25uZWN0aW9uQnVpbGRlciA9IEh1YkNvbm5lY3Rpb25CdWlsZGVyXzEuSHViQ29ubmVjdGlvbkJ1aWxkZXI7XG52YXIgSUh1YlByb3RvY29sXzEgPSByZXF1aXJlKFwiLi9JSHViUHJvdG9jb2xcIik7XG5leHBvcnRzLk1lc3NhZ2VUeXBlID0gSUh1YlByb3RvY29sXzEuTWVzc2FnZVR5cGU7XG52YXIgSUxvZ2dlcl8xID0gcmVxdWlyZShcIi4vSUxvZ2dlclwiKTtcbmV4cG9ydHMuTG9nTGV2ZWwgPSBJTG9nZ2VyXzEuTG9nTGV2ZWw7XG52YXIgSVRyYW5zcG9ydF8xID0gcmVxdWlyZShcIi4vSVRyYW5zcG9ydFwiKTtcbmV4cG9ydHMuSHR0cFRyYW5zcG9ydFR5cGUgPSBJVHJhbnNwb3J0XzEuSHR0cFRyYW5zcG9ydFR5cGU7XG5leHBvcnRzLlRyYW5zZmVyRm9ybWF0ID0gSVRyYW5zcG9ydF8xLlRyYW5zZmVyRm9ybWF0O1xudmFyIExvZ2dlcnNfMSA9IHJlcXVpcmUoXCIuL0xvZ2dlcnNcIik7XG5leHBvcnRzLk51bGxMb2dnZXIgPSBMb2dnZXJzXzEuTnVsbExvZ2dlcjtcbnZhciBKc29uSHViUHJvdG9jb2xfMSA9IHJlcXVpcmUoXCIuL0pzb25IdWJQcm90b2NvbFwiKTtcbmV4cG9ydHMuSnNvbkh1YlByb3RvY29sID0gSnNvbkh1YlByb3RvY29sXzEuSnNvbkh1YlByb3RvY29sO1xudmFyIFN1YmplY3RfMSA9IHJlcXVpcmUoXCIuL1N1YmplY3RcIik7XG5leHBvcnRzLlN1YmplY3QgPSBTdWJqZWN0XzEuU3ViamVjdDtcbnZhciBVdGlsc18xID0gcmVxdWlyZShcIi4vVXRpbHNcIik7XG5leHBvcnRzLlZFUlNJT04gPSBVdGlsc18xLlZFUlNJT047XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXEBtaWNyb3NvZnRcXFxcc2lnbmFsclxcXFxkaXN0XFxcXGNqc1xcXFxpbmRleC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxAbWljcm9zb2Z0XFxcXHNpZ25hbHJcXFxcZGlzdFxcXFxjanNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG52YXIgbG9va3VwID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nO1xuXG47KGZ1bmN0aW9uIChleHBvcnRzKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuICB2YXIgQXJyID0gKHR5cGVvZiBVaW50OEFycmF5ICE9PSAndW5kZWZpbmVkJylcbiAgICA/IFVpbnQ4QXJyYXlcbiAgICA6IEFycmF5XG5cblx0dmFyIFBMVVMgICA9ICcrJy5jaGFyQ29kZUF0KDApXG5cdHZhciBTTEFTSCAgPSAnLycuY2hhckNvZGVBdCgwKVxuXHR2YXIgTlVNQkVSID0gJzAnLmNoYXJDb2RlQXQoMClcblx0dmFyIExPV0VSICA9ICdhJy5jaGFyQ29kZUF0KDApXG5cdHZhciBVUFBFUiAgPSAnQScuY2hhckNvZGVBdCgwKVxuXHR2YXIgUExVU19VUkxfU0FGRSA9ICctJy5jaGFyQ29kZUF0KDApXG5cdHZhciBTTEFTSF9VUkxfU0FGRSA9ICdfJy5jaGFyQ29kZUF0KDApXG5cblx0ZnVuY3Rpb24gZGVjb2RlIChlbHQpIHtcblx0XHR2YXIgY29kZSA9IGVsdC5jaGFyQ29kZUF0KDApXG5cdFx0aWYgKGNvZGUgPT09IFBMVVMgfHxcblx0XHQgICAgY29kZSA9PT0gUExVU19VUkxfU0FGRSlcblx0XHRcdHJldHVybiA2MiAvLyAnKydcblx0XHRpZiAoY29kZSA9PT0gU0xBU0ggfHxcblx0XHQgICAgY29kZSA9PT0gU0xBU0hfVVJMX1NBRkUpXG5cdFx0XHRyZXR1cm4gNjMgLy8gJy8nXG5cdFx0aWYgKGNvZGUgPCBOVU1CRVIpXG5cdFx0XHRyZXR1cm4gLTEgLy9ubyBtYXRjaFxuXHRcdGlmIChjb2RlIDwgTlVNQkVSICsgMTApXG5cdFx0XHRyZXR1cm4gY29kZSAtIE5VTUJFUiArIDI2ICsgMjZcblx0XHRpZiAoY29kZSA8IFVQUEVSICsgMjYpXG5cdFx0XHRyZXR1cm4gY29kZSAtIFVQUEVSXG5cdFx0aWYgKGNvZGUgPCBMT1dFUiArIDI2KVxuXHRcdFx0cmV0dXJuIGNvZGUgLSBMT1dFUiArIDI2XG5cdH1cblxuXHRmdW5jdGlvbiBiNjRUb0J5dGVBcnJheSAoYjY0KSB7XG5cdFx0dmFyIGksIGosIGwsIHRtcCwgcGxhY2VIb2xkZXJzLCBhcnJcblxuXHRcdGlmIChiNjQubGVuZ3RoICUgNCA+IDApIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNCcpXG5cdFx0fVxuXG5cdFx0Ly8gdGhlIG51bWJlciBvZiBlcXVhbCBzaWducyAocGxhY2UgaG9sZGVycylcblx0XHQvLyBpZiB0aGVyZSBhcmUgdHdvIHBsYWNlaG9sZGVycywgdGhhbiB0aGUgdHdvIGNoYXJhY3RlcnMgYmVmb3JlIGl0XG5cdFx0Ly8gcmVwcmVzZW50IG9uZSBieXRlXG5cdFx0Ly8gaWYgdGhlcmUgaXMgb25seSBvbmUsIHRoZW4gdGhlIHRocmVlIGNoYXJhY3RlcnMgYmVmb3JlIGl0IHJlcHJlc2VudCAyIGJ5dGVzXG5cdFx0Ly8gdGhpcyBpcyBqdXN0IGEgY2hlYXAgaGFjayB0byBub3QgZG8gaW5kZXhPZiB0d2ljZVxuXHRcdHZhciBsZW4gPSBiNjQubGVuZ3RoXG5cdFx0cGxhY2VIb2xkZXJzID0gJz0nID09PSBiNjQuY2hhckF0KGxlbiAtIDIpID8gMiA6ICc9JyA9PT0gYjY0LmNoYXJBdChsZW4gLSAxKSA/IDEgOiAwXG5cblx0XHQvLyBiYXNlNjQgaXMgNC8zICsgdXAgdG8gdHdvIGNoYXJhY3RlcnMgb2YgdGhlIG9yaWdpbmFsIGRhdGFcblx0XHRhcnIgPSBuZXcgQXJyKGI2NC5sZW5ndGggKiAzIC8gNCAtIHBsYWNlSG9sZGVycylcblxuXHRcdC8vIGlmIHRoZXJlIGFyZSBwbGFjZWhvbGRlcnMsIG9ubHkgZ2V0IHVwIHRvIHRoZSBsYXN0IGNvbXBsZXRlIDQgY2hhcnNcblx0XHRsID0gcGxhY2VIb2xkZXJzID4gMCA/IGI2NC5sZW5ndGggLSA0IDogYjY0Lmxlbmd0aFxuXG5cdFx0dmFyIEwgPSAwXG5cblx0XHRmdW5jdGlvbiBwdXNoICh2KSB7XG5cdFx0XHRhcnJbTCsrXSA9IHZcblx0XHR9XG5cblx0XHRmb3IgKGkgPSAwLCBqID0gMDsgaSA8IGw7IGkgKz0gNCwgaiArPSAzKSB7XG5cdFx0XHR0bXAgPSAoZGVjb2RlKGI2NC5jaGFyQXQoaSkpIDw8IDE4KSB8IChkZWNvZGUoYjY0LmNoYXJBdChpICsgMSkpIDw8IDEyKSB8IChkZWNvZGUoYjY0LmNoYXJBdChpICsgMikpIDw8IDYpIHwgZGVjb2RlKGI2NC5jaGFyQXQoaSArIDMpKVxuXHRcdFx0cHVzaCgodG1wICYgMHhGRjAwMDApID4+IDE2KVxuXHRcdFx0cHVzaCgodG1wICYgMHhGRjAwKSA+PiA4KVxuXHRcdFx0cHVzaCh0bXAgJiAweEZGKVxuXHRcdH1cblxuXHRcdGlmIChwbGFjZUhvbGRlcnMgPT09IDIpIHtcblx0XHRcdHRtcCA9IChkZWNvZGUoYjY0LmNoYXJBdChpKSkgPDwgMikgfCAoZGVjb2RlKGI2NC5jaGFyQXQoaSArIDEpKSA+PiA0KVxuXHRcdFx0cHVzaCh0bXAgJiAweEZGKVxuXHRcdH0gZWxzZSBpZiAocGxhY2VIb2xkZXJzID09PSAxKSB7XG5cdFx0XHR0bXAgPSAoZGVjb2RlKGI2NC5jaGFyQXQoaSkpIDw8IDEwKSB8IChkZWNvZGUoYjY0LmNoYXJBdChpICsgMSkpIDw8IDQpIHwgKGRlY29kZShiNjQuY2hhckF0KGkgKyAyKSkgPj4gMilcblx0XHRcdHB1c2goKHRtcCA+PiA4KSAmIDB4RkYpXG5cdFx0XHRwdXNoKHRtcCAmIDB4RkYpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFyclxuXHR9XG5cblx0ZnVuY3Rpb24gdWludDhUb0Jhc2U2NCAodWludDgpIHtcblx0XHR2YXIgaSxcblx0XHRcdGV4dHJhQnl0ZXMgPSB1aW50OC5sZW5ndGggJSAzLCAvLyBpZiB3ZSBoYXZlIDEgYnl0ZSBsZWZ0LCBwYWQgMiBieXRlc1xuXHRcdFx0b3V0cHV0ID0gXCJcIixcblx0XHRcdHRlbXAsIGxlbmd0aFxuXG5cdFx0ZnVuY3Rpb24gZW5jb2RlIChudW0pIHtcblx0XHRcdHJldHVybiBsb29rdXAuY2hhckF0KG51bSlcblx0XHR9XG5cblx0XHRmdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQgKG51bSkge1xuXHRcdFx0cmV0dXJuIGVuY29kZShudW0gPj4gMTggJiAweDNGKSArIGVuY29kZShudW0gPj4gMTIgJiAweDNGKSArIGVuY29kZShudW0gPj4gNiAmIDB4M0YpICsgZW5jb2RlKG51bSAmIDB4M0YpXG5cdFx0fVxuXG5cdFx0Ly8gZ28gdGhyb3VnaCB0aGUgYXJyYXkgZXZlcnkgdGhyZWUgYnl0ZXMsIHdlJ2xsIGRlYWwgd2l0aCB0cmFpbGluZyBzdHVmZiBsYXRlclxuXHRcdGZvciAoaSA9IDAsIGxlbmd0aCA9IHVpbnQ4Lmxlbmd0aCAtIGV4dHJhQnl0ZXM7IGkgPCBsZW5ndGg7IGkgKz0gMykge1xuXHRcdFx0dGVtcCA9ICh1aW50OFtpXSA8PCAxNikgKyAodWludDhbaSArIDFdIDw8IDgpICsgKHVpbnQ4W2kgKyAyXSlcblx0XHRcdG91dHB1dCArPSB0cmlwbGV0VG9CYXNlNjQodGVtcClcblx0XHR9XG5cblx0XHQvLyBwYWQgdGhlIGVuZCB3aXRoIHplcm9zLCBidXQgbWFrZSBzdXJlIHRvIG5vdCBmb3JnZXQgdGhlIGV4dHJhIGJ5dGVzXG5cdFx0c3dpdGNoIChleHRyYUJ5dGVzKSB7XG5cdFx0XHRjYXNlIDE6XG5cdFx0XHRcdHRlbXAgPSB1aW50OFt1aW50OC5sZW5ndGggLSAxXVxuXHRcdFx0XHRvdXRwdXQgKz0gZW5jb2RlKHRlbXAgPj4gMilcblx0XHRcdFx0b3V0cHV0ICs9IGVuY29kZSgodGVtcCA8PCA0KSAmIDB4M0YpXG5cdFx0XHRcdG91dHB1dCArPSAnPT0nXG5cdFx0XHRcdGJyZWFrXG5cdFx0XHRjYXNlIDI6XG5cdFx0XHRcdHRlbXAgPSAodWludDhbdWludDgubGVuZ3RoIC0gMl0gPDwgOCkgKyAodWludDhbdWludDgubGVuZ3RoIC0gMV0pXG5cdFx0XHRcdG91dHB1dCArPSBlbmNvZGUodGVtcCA+PiAxMClcblx0XHRcdFx0b3V0cHV0ICs9IGVuY29kZSgodGVtcCA+PiA0KSAmIDB4M0YpXG5cdFx0XHRcdG91dHB1dCArPSBlbmNvZGUoKHRlbXAgPDwgMikgJiAweDNGKVxuXHRcdFx0XHRvdXRwdXQgKz0gJz0nXG5cdFx0XHRcdGJyZWFrXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dFxuXHR9XG5cblx0ZXhwb3J0cy50b0J5dGVBcnJheSA9IGI2NFRvQnl0ZUFycmF5XG5cdGV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IHVpbnQ4VG9CYXNlNjRcbn0odHlwZW9mIGV4cG9ydHMgPT09ICd1bmRlZmluZWQnID8gKHRoaXMuYmFzZTY0anMgPSB7fSkgOiBleHBvcnRzKSlcblxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcYmFzZTY0LWpzXFxcXGxpYlxcXFxiNjQuanNcIixcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcYmFzZTY0LWpzXFxcXGxpYlwiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcbi8qIVxuICogVGhlIGJ1ZmZlciBtb2R1bGUgZnJvbSBub2RlLmpzLCBmb3IgdGhlIGJyb3dzZXIuXG4gKlxuICogQGF1dGhvciAgIEZlcm9zcyBBYm91a2hhZGlqZWggPGZlcm9zc0BmZXJvc3Mub3JnPiA8aHR0cDovL2Zlcm9zcy5vcmc+XG4gKiBAbGljZW5zZSAgTUlUXG4gKi9cblxudmFyIGJhc2U2NCA9IHJlcXVpcmUoJ2Jhc2U2NC1qcycpXG52YXIgaWVlZTc1NCA9IHJlcXVpcmUoJ2llZWU3NTQnKVxuXG5leHBvcnRzLkJ1ZmZlciA9IEJ1ZmZlclxuZXhwb3J0cy5TbG93QnVmZmVyID0gQnVmZmVyXG5leHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTID0gNTBcbkJ1ZmZlci5wb29sU2l6ZSA9IDgxOTJcblxuLyoqXG4gKiBJZiBgQnVmZmVyLl91c2VUeXBlZEFycmF5c2A6XG4gKiAgID09PSB0cnVlICAgIFVzZSBVaW50OEFycmF5IGltcGxlbWVudGF0aW9uIChmYXN0ZXN0KVxuICogICA9PT0gZmFsc2UgICBVc2UgT2JqZWN0IGltcGxlbWVudGF0aW9uIChjb21wYXRpYmxlIGRvd24gdG8gSUU2KVxuICovXG5CdWZmZXIuX3VzZVR5cGVkQXJyYXlzID0gKGZ1bmN0aW9uICgpIHtcbiAgLy8gRGV0ZWN0IGlmIGJyb3dzZXIgc3VwcG9ydHMgVHlwZWQgQXJyYXlzLiBTdXBwb3J0ZWQgYnJvd3NlcnMgYXJlIElFIDEwKywgRmlyZWZveCA0KyxcbiAgLy8gQ2hyb21lIDcrLCBTYWZhcmkgNS4xKywgT3BlcmEgMTEuNissIGlPUyA0LjIrLiBJZiB0aGUgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IGFkZGluZ1xuICAvLyBwcm9wZXJ0aWVzIHRvIGBVaW50OEFycmF5YCBpbnN0YW5jZXMsIHRoZW4gdGhhdCdzIHRoZSBzYW1lIGFzIG5vIGBVaW50OEFycmF5YCBzdXBwb3J0XG4gIC8vIGJlY2F1c2Ugd2UgbmVlZCB0byBiZSBhYmxlIHRvIGFkZCBhbGwgdGhlIG5vZGUgQnVmZmVyIEFQSSBtZXRob2RzLiBUaGlzIGlzIGFuIGlzc3VlXG4gIC8vIGluIEZpcmVmb3ggNC0yOS4gTm93IGZpeGVkOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02OTU0MzhcbiAgdHJ5IHtcbiAgICB2YXIgYnVmID0gbmV3IEFycmF5QnVmZmVyKDApXG4gICAgdmFyIGFyciA9IG5ldyBVaW50OEFycmF5KGJ1ZilcbiAgICBhcnIuZm9vID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gNDIgfVxuICAgIHJldHVybiA0MiA9PT0gYXJyLmZvbygpICYmXG4gICAgICAgIHR5cGVvZiBhcnIuc3ViYXJyYXkgPT09ICdmdW5jdGlvbicgLy8gQ2hyb21lIDktMTAgbGFjayBgc3ViYXJyYXlgXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufSkoKVxuXG4vKipcbiAqIENsYXNzOiBCdWZmZXJcbiAqID09PT09PT09PT09PT1cbiAqXG4gKiBUaGUgQnVmZmVyIGNvbnN0cnVjdG9yIHJldHVybnMgaW5zdGFuY2VzIG9mIGBVaW50OEFycmF5YCB0aGF0IGFyZSBhdWdtZW50ZWRcbiAqIHdpdGggZnVuY3Rpb24gcHJvcGVydGllcyBmb3IgYWxsIHRoZSBub2RlIGBCdWZmZXJgIEFQSSBmdW5jdGlvbnMuIFdlIHVzZVxuICogYFVpbnQ4QXJyYXlgIHNvIHRoYXQgc3F1YXJlIGJyYWNrZXQgbm90YXRpb24gd29ya3MgYXMgZXhwZWN0ZWQgLS0gaXQgcmV0dXJuc1xuICogYSBzaW5nbGUgb2N0ZXQuXG4gKlxuICogQnkgYXVnbWVudGluZyB0aGUgaW5zdGFuY2VzLCB3ZSBjYW4gYXZvaWQgbW9kaWZ5aW5nIHRoZSBgVWludDhBcnJheWBcbiAqIHByb3RvdHlwZS5cbiAqL1xuZnVuY3Rpb24gQnVmZmVyIChzdWJqZWN0LCBlbmNvZGluZywgbm9aZXJvKSB7XG4gIGlmICghKHRoaXMgaW5zdGFuY2VvZiBCdWZmZXIpKVxuICAgIHJldHVybiBuZXcgQnVmZmVyKHN1YmplY3QsIGVuY29kaW5nLCBub1plcm8pXG5cbiAgdmFyIHR5cGUgPSB0eXBlb2Ygc3ViamVjdFxuXG4gIC8vIFdvcmthcm91bmQ6IG5vZGUncyBiYXNlNjQgaW1wbGVtZW50YXRpb24gYWxsb3dzIGZvciBub24tcGFkZGVkIHN0cmluZ3NcbiAgLy8gd2hpbGUgYmFzZTY0LWpzIGRvZXMgbm90LlxuICBpZiAoZW5jb2RpbmcgPT09ICdiYXNlNjQnICYmIHR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgc3ViamVjdCA9IHN0cmluZ3RyaW0oc3ViamVjdClcbiAgICB3aGlsZSAoc3ViamVjdC5sZW5ndGggJSA0ICE9PSAwKSB7XG4gICAgICBzdWJqZWN0ID0gc3ViamVjdCArICc9J1xuICAgIH1cbiAgfVxuXG4gIC8vIEZpbmQgdGhlIGxlbmd0aFxuICB2YXIgbGVuZ3RoXG4gIGlmICh0eXBlID09PSAnbnVtYmVyJylcbiAgICBsZW5ndGggPSBjb2VyY2Uoc3ViamVjdClcbiAgZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmluZycpXG4gICAgbGVuZ3RoID0gQnVmZmVyLmJ5dGVMZW5ndGgoc3ViamVjdCwgZW5jb2RpbmcpXG4gIGVsc2UgaWYgKHR5cGUgPT09ICdvYmplY3QnKVxuICAgIGxlbmd0aCA9IGNvZXJjZShzdWJqZWN0Lmxlbmd0aCkgLy8gYXNzdW1lIHRoYXQgb2JqZWN0IGlzIGFycmF5LWxpa2VcbiAgZWxzZVxuICAgIHRocm93IG5ldyBFcnJvcignRmlyc3QgYXJndW1lbnQgbmVlZHMgdG8gYmUgYSBudW1iZXIsIGFycmF5IG9yIHN0cmluZy4nKVxuXG4gIHZhciBidWZcbiAgaWYgKEJ1ZmZlci5fdXNlVHlwZWRBcnJheXMpIHtcbiAgICAvLyBQcmVmZXJyZWQ6IFJldHVybiBhbiBhdWdtZW50ZWQgYFVpbnQ4QXJyYXlgIGluc3RhbmNlIGZvciBiZXN0IHBlcmZvcm1hbmNlXG4gICAgYnVmID0gQnVmZmVyLl9hdWdtZW50KG5ldyBVaW50OEFycmF5KGxlbmd0aCkpXG4gIH0gZWxzZSB7XG4gICAgLy8gRmFsbGJhY2s6IFJldHVybiBUSElTIGluc3RhbmNlIG9mIEJ1ZmZlciAoY3JlYXRlZCBieSBgbmV3YClcbiAgICBidWYgPSB0aGlzXG4gICAgYnVmLmxlbmd0aCA9IGxlbmd0aFxuICAgIGJ1Zi5faXNCdWZmZXIgPSB0cnVlXG4gIH1cblxuICB2YXIgaVxuICBpZiAoQnVmZmVyLl91c2VUeXBlZEFycmF5cyAmJiB0eXBlb2Ygc3ViamVjdC5ieXRlTGVuZ3RoID09PSAnbnVtYmVyJykge1xuICAgIC8vIFNwZWVkIG9wdGltaXphdGlvbiAtLSB1c2Ugc2V0IGlmIHdlJ3JlIGNvcHlpbmcgZnJvbSBhIHR5cGVkIGFycmF5XG4gICAgYnVmLl9zZXQoc3ViamVjdClcbiAgfSBlbHNlIGlmIChpc0FycmF5aXNoKHN1YmplY3QpKSB7XG4gICAgLy8gVHJlYXQgYXJyYXktaXNoIG9iamVjdHMgYXMgYSBieXRlIGFycmF5XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoQnVmZmVyLmlzQnVmZmVyKHN1YmplY3QpKVxuICAgICAgICBidWZbaV0gPSBzdWJqZWN0LnJlYWRVSW50OChpKVxuICAgICAgZWxzZVxuICAgICAgICBidWZbaV0gPSBzdWJqZWN0W2ldXG4gICAgfVxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgYnVmLndyaXRlKHN1YmplY3QsIDAsIGVuY29kaW5nKVxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdudW1iZXInICYmICFCdWZmZXIuX3VzZVR5cGVkQXJyYXlzICYmICFub1plcm8pIHtcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGJ1ZltpXSA9IDBcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYnVmXG59XG5cbi8vIFNUQVRJQyBNRVRIT0RTXG4vLyA9PT09PT09PT09PT09PVxuXG5CdWZmZXIuaXNFbmNvZGluZyA9IGZ1bmN0aW9uIChlbmNvZGluZykge1xuICBzd2l0Y2ggKFN0cmluZyhlbmNvZGluZykudG9Mb3dlckNhc2UoKSkge1xuICAgIGNhc2UgJ2hleCc6XG4gICAgY2FzZSAndXRmOCc6XG4gICAgY2FzZSAndXRmLTgnOlxuICAgIGNhc2UgJ2FzY2lpJzpcbiAgICBjYXNlICdiaW5hcnknOlxuICAgIGNhc2UgJ2Jhc2U2NCc6XG4gICAgY2FzZSAncmF3JzpcbiAgICBjYXNlICd1Y3MyJzpcbiAgICBjYXNlICd1Y3MtMic6XG4gICAgY2FzZSAndXRmMTZsZSc6XG4gICAgY2FzZSAndXRmLTE2bGUnOlxuICAgICAgcmV0dXJuIHRydWVcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuQnVmZmVyLmlzQnVmZmVyID0gZnVuY3Rpb24gKGIpIHtcbiAgcmV0dXJuICEhKGIgIT09IG51bGwgJiYgYiAhPT0gdW5kZWZpbmVkICYmIGIuX2lzQnVmZmVyKVxufVxuXG5CdWZmZXIuYnl0ZUxlbmd0aCA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7XG4gIHZhciByZXRcbiAgc3RyID0gc3RyICsgJydcbiAgc3dpdGNoIChlbmNvZGluZyB8fCAndXRmOCcpIHtcbiAgICBjYXNlICdoZXgnOlxuICAgICAgcmV0ID0gc3RyLmxlbmd0aCAvIDJcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAndXRmOCc6XG4gICAgY2FzZSAndXRmLTgnOlxuICAgICAgcmV0ID0gdXRmOFRvQnl0ZXMoc3RyKS5sZW5ndGhcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnYXNjaWknOlxuICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgY2FzZSAncmF3JzpcbiAgICAgIHJldCA9IHN0ci5sZW5ndGhcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnYmFzZTY0JzpcbiAgICAgIHJldCA9IGJhc2U2NFRvQnl0ZXMoc3RyKS5sZW5ndGhcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAndWNzMic6XG4gICAgY2FzZSAndWNzLTInOlxuICAgIGNhc2UgJ3V0ZjE2bGUnOlxuICAgIGNhc2UgJ3V0Zi0xNmxlJzpcbiAgICAgIHJldCA9IHN0ci5sZW5ndGggKiAyXG4gICAgICBicmVha1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZW5jb2RpbmcnKVxuICB9XG4gIHJldHVybiByZXRcbn1cblxuQnVmZmVyLmNvbmNhdCA9IGZ1bmN0aW9uIChsaXN0LCB0b3RhbExlbmd0aCkge1xuICBhc3NlcnQoaXNBcnJheShsaXN0KSwgJ1VzYWdlOiBCdWZmZXIuY29uY2F0KGxpc3QsIFt0b3RhbExlbmd0aF0pXFxuJyArXG4gICAgICAnbGlzdCBzaG91bGQgYmUgYW4gQXJyYXkuJylcblxuICBpZiAobGlzdC5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gbmV3IEJ1ZmZlcigwKVxuICB9IGVsc2UgaWYgKGxpc3QubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGxpc3RbMF1cbiAgfVxuXG4gIHZhciBpXG4gIGlmICh0eXBlb2YgdG90YWxMZW5ndGggIT09ICdudW1iZXInKSB7XG4gICAgdG90YWxMZW5ndGggPSAwXG4gICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRvdGFsTGVuZ3RoICs9IGxpc3RbaV0ubGVuZ3RoXG4gICAgfVxuICB9XG5cbiAgdmFyIGJ1ZiA9IG5ldyBCdWZmZXIodG90YWxMZW5ndGgpXG4gIHZhciBwb3MgPSAwXG4gIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGl0ZW0gPSBsaXN0W2ldXG4gICAgaXRlbS5jb3B5KGJ1ZiwgcG9zKVxuICAgIHBvcyArPSBpdGVtLmxlbmd0aFxuICB9XG4gIHJldHVybiBidWZcbn1cblxuLy8gQlVGRkVSIElOU1RBTkNFIE1FVEhPRFNcbi8vID09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIF9oZXhXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIG9mZnNldCA9IE51bWJlcihvZmZzZXQpIHx8IDBcbiAgdmFyIHJlbWFpbmluZyA9IGJ1Zi5sZW5ndGggLSBvZmZzZXRcbiAgaWYgKCFsZW5ndGgpIHtcbiAgICBsZW5ndGggPSByZW1haW5pbmdcbiAgfSBlbHNlIHtcbiAgICBsZW5ndGggPSBOdW1iZXIobGVuZ3RoKVxuICAgIGlmIChsZW5ndGggPiByZW1haW5pbmcpIHtcbiAgICAgIGxlbmd0aCA9IHJlbWFpbmluZ1xuICAgIH1cbiAgfVxuXG4gIC8vIG11c3QgYmUgYW4gZXZlbiBudW1iZXIgb2YgZGlnaXRzXG4gIHZhciBzdHJMZW4gPSBzdHJpbmcubGVuZ3RoXG4gIGFzc2VydChzdHJMZW4gJSAyID09PSAwLCAnSW52YWxpZCBoZXggc3RyaW5nJylcblxuICBpZiAobGVuZ3RoID4gc3RyTGVuIC8gMikge1xuICAgIGxlbmd0aCA9IHN0ckxlbiAvIDJcbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGJ5dGUgPSBwYXJzZUludChzdHJpbmcuc3Vic3RyKGkgKiAyLCAyKSwgMTYpXG4gICAgYXNzZXJ0KCFpc05hTihieXRlKSwgJ0ludmFsaWQgaGV4IHN0cmluZycpXG4gICAgYnVmW29mZnNldCArIGldID0gYnl0ZVxuICB9XG4gIEJ1ZmZlci5fY2hhcnNXcml0dGVuID0gaSAqIDJcbiAgcmV0dXJuIGlcbn1cblxuZnVuY3Rpb24gX3V0ZjhXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHZhciBjaGFyc1dyaXR0ZW4gPSBCdWZmZXIuX2NoYXJzV3JpdHRlbiA9XG4gICAgYmxpdEJ1ZmZlcih1dGY4VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKVxuICByZXR1cm4gY2hhcnNXcml0dGVuXG59XG5cbmZ1bmN0aW9uIF9hc2NpaVdyaXRlIChidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgdmFyIGNoYXJzV3JpdHRlbiA9IEJ1ZmZlci5fY2hhcnNXcml0dGVuID1cbiAgICBibGl0QnVmZmVyKGFzY2lpVG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKVxuICByZXR1cm4gY2hhcnNXcml0dGVuXG59XG5cbmZ1bmN0aW9uIF9iaW5hcnlXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHJldHVybiBfYXNjaWlXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG59XG5cbmZ1bmN0aW9uIF9iYXNlNjRXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHZhciBjaGFyc1dyaXR0ZW4gPSBCdWZmZXIuX2NoYXJzV3JpdHRlbiA9XG4gICAgYmxpdEJ1ZmZlcihiYXNlNjRUb0J5dGVzKHN0cmluZyksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpXG4gIHJldHVybiBjaGFyc1dyaXR0ZW5cbn1cblxuZnVuY3Rpb24gX3V0ZjE2bGVXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHZhciBjaGFyc1dyaXR0ZW4gPSBCdWZmZXIuX2NoYXJzV3JpdHRlbiA9XG4gICAgYmxpdEJ1ZmZlcih1dGYxNmxlVG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKVxuICByZXR1cm4gY2hhcnNXcml0dGVuXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAoc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCwgZW5jb2RpbmcpIHtcbiAgLy8gU3VwcG9ydCBib3RoIChzdHJpbmcsIG9mZnNldCwgbGVuZ3RoLCBlbmNvZGluZylcbiAgLy8gYW5kIHRoZSBsZWdhY3kgKHN0cmluZywgZW5jb2RpbmcsIG9mZnNldCwgbGVuZ3RoKVxuICBpZiAoaXNGaW5pdGUob2Zmc2V0KSkge1xuICAgIGlmICghaXNGaW5pdGUobGVuZ3RoKSkge1xuICAgICAgZW5jb2RpbmcgPSBsZW5ndGhcbiAgICAgIGxlbmd0aCA9IHVuZGVmaW5lZFxuICAgIH1cbiAgfSBlbHNlIHsgIC8vIGxlZ2FjeVxuICAgIHZhciBzd2FwID0gZW5jb2RpbmdcbiAgICBlbmNvZGluZyA9IG9mZnNldFxuICAgIG9mZnNldCA9IGxlbmd0aFxuICAgIGxlbmd0aCA9IHN3YXBcbiAgfVxuXG4gIG9mZnNldCA9IE51bWJlcihvZmZzZXQpIHx8IDBcbiAgdmFyIHJlbWFpbmluZyA9IHRoaXMubGVuZ3RoIC0gb2Zmc2V0XG4gIGlmICghbGVuZ3RoKSB7XG4gICAgbGVuZ3RoID0gcmVtYWluaW5nXG4gIH0gZWxzZSB7XG4gICAgbGVuZ3RoID0gTnVtYmVyKGxlbmd0aClcbiAgICBpZiAobGVuZ3RoID4gcmVtYWluaW5nKSB7XG4gICAgICBsZW5ndGggPSByZW1haW5pbmdcbiAgICB9XG4gIH1cbiAgZW5jb2RpbmcgPSBTdHJpbmcoZW5jb2RpbmcgfHwgJ3V0ZjgnKS50b0xvd2VyQ2FzZSgpXG5cbiAgdmFyIHJldFxuICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgY2FzZSAnaGV4JzpcbiAgICAgIHJldCA9IF9oZXhXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICd1dGY4JzpcbiAgICBjYXNlICd1dGYtOCc6XG4gICAgICByZXQgPSBfdXRmOFdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2FzY2lpJzpcbiAgICAgIHJldCA9IF9hc2NpaVdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgICByZXQgPSBfYmluYXJ5V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aClcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnYmFzZTY0JzpcbiAgICAgIHJldCA9IF9iYXNlNjRXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICd1Y3MyJzpcbiAgICBjYXNlICd1Y3MtMic6XG4gICAgY2FzZSAndXRmMTZsZSc6XG4gICAgY2FzZSAndXRmLTE2bGUnOlxuICAgICAgcmV0ID0gX3V0ZjE2bGVXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuICAgICAgYnJlYWtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGVuY29kaW5nJylcbiAgfVxuICByZXR1cm4gcmV0XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcsIHN0YXJ0LCBlbmQpIHtcbiAgdmFyIHNlbGYgPSB0aGlzXG5cbiAgZW5jb2RpbmcgPSBTdHJpbmcoZW5jb2RpbmcgfHwgJ3V0ZjgnKS50b0xvd2VyQ2FzZSgpXG4gIHN0YXJ0ID0gTnVtYmVyKHN0YXJ0KSB8fCAwXG4gIGVuZCA9IChlbmQgIT09IHVuZGVmaW5lZClcbiAgICA/IE51bWJlcihlbmQpXG4gICAgOiBlbmQgPSBzZWxmLmxlbmd0aFxuXG4gIC8vIEZhc3RwYXRoIGVtcHR5IHN0cmluZ3NcbiAgaWYgKGVuZCA9PT0gc3RhcnQpXG4gICAgcmV0dXJuICcnXG5cbiAgdmFyIHJldFxuICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgY2FzZSAnaGV4JzpcbiAgICAgIHJldCA9IF9oZXhTbGljZShzZWxmLCBzdGFydCwgZW5kKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICd1dGY4JzpcbiAgICBjYXNlICd1dGYtOCc6XG4gICAgICByZXQgPSBfdXRmOFNsaWNlKHNlbGYsIHN0YXJ0LCBlbmQpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2FzY2lpJzpcbiAgICAgIHJldCA9IF9hc2NpaVNsaWNlKHNlbGYsIHN0YXJ0LCBlbmQpXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgICByZXQgPSBfYmluYXJ5U2xpY2Uoc2VsZiwgc3RhcnQsIGVuZClcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnYmFzZTY0JzpcbiAgICAgIHJldCA9IF9iYXNlNjRTbGljZShzZWxmLCBzdGFydCwgZW5kKVxuICAgICAgYnJlYWtcbiAgICBjYXNlICd1Y3MyJzpcbiAgICBjYXNlICd1Y3MtMic6XG4gICAgY2FzZSAndXRmMTZsZSc6XG4gICAgY2FzZSAndXRmLTE2bGUnOlxuICAgICAgcmV0ID0gX3V0ZjE2bGVTbGljZShzZWxmLCBzdGFydCwgZW5kKVxuICAgICAgYnJlYWtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGVuY29kaW5nJylcbiAgfVxuICByZXR1cm4gcmV0XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdCdWZmZXInLFxuICAgIGRhdGE6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMuX2FyciB8fCB0aGlzLCAwKVxuICB9XG59XG5cbi8vIGNvcHkodGFyZ2V0QnVmZmVyLCB0YXJnZXRTdGFydD0wLCBzb3VyY2VTdGFydD0wLCBzb3VyY2VFbmQ9YnVmZmVyLmxlbmd0aClcbkJ1ZmZlci5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICh0YXJnZXQsIHRhcmdldF9zdGFydCwgc3RhcnQsIGVuZCkge1xuICB2YXIgc291cmNlID0gdGhpc1xuXG4gIGlmICghc3RhcnQpIHN0YXJ0ID0gMFxuICBpZiAoIWVuZCAmJiBlbmQgIT09IDApIGVuZCA9IHRoaXMubGVuZ3RoXG4gIGlmICghdGFyZ2V0X3N0YXJ0KSB0YXJnZXRfc3RhcnQgPSAwXG5cbiAgLy8gQ29weSAwIGJ5dGVzOyB3ZSdyZSBkb25lXG4gIGlmIChlbmQgPT09IHN0YXJ0KSByZXR1cm5cbiAgaWYgKHRhcmdldC5sZW5ndGggPT09IDAgfHwgc291cmNlLmxlbmd0aCA9PT0gMCkgcmV0dXJuXG5cbiAgLy8gRmF0YWwgZXJyb3IgY29uZGl0aW9uc1xuICBhc3NlcnQoZW5kID49IHN0YXJ0LCAnc291cmNlRW5kIDwgc291cmNlU3RhcnQnKVxuICBhc3NlcnQodGFyZ2V0X3N0YXJ0ID49IDAgJiYgdGFyZ2V0X3N0YXJ0IDwgdGFyZ2V0Lmxlbmd0aCxcbiAgICAgICd0YXJnZXRTdGFydCBvdXQgb2YgYm91bmRzJylcbiAgYXNzZXJ0KHN0YXJ0ID49IDAgJiYgc3RhcnQgPCBzb3VyY2UubGVuZ3RoLCAnc291cmNlU3RhcnQgb3V0IG9mIGJvdW5kcycpXG4gIGFzc2VydChlbmQgPj0gMCAmJiBlbmQgPD0gc291cmNlLmxlbmd0aCwgJ3NvdXJjZUVuZCBvdXQgb2YgYm91bmRzJylcblxuICAvLyBBcmUgd2Ugb29iP1xuICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpXG4gICAgZW5kID0gdGhpcy5sZW5ndGhcbiAgaWYgKHRhcmdldC5sZW5ndGggLSB0YXJnZXRfc3RhcnQgPCBlbmQgLSBzdGFydClcbiAgICBlbmQgPSB0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0X3N0YXJ0ICsgc3RhcnRcblxuICB2YXIgbGVuID0gZW5kIC0gc3RhcnRcblxuICBpZiAobGVuIDwgMTAwIHx8ICFCdWZmZXIuX3VzZVR5cGVkQXJyYXlzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKylcbiAgICAgIHRhcmdldFtpICsgdGFyZ2V0X3N0YXJ0XSA9IHRoaXNbaSArIHN0YXJ0XVxuICB9IGVsc2Uge1xuICAgIHRhcmdldC5fc2V0KHRoaXMuc3ViYXJyYXkoc3RhcnQsIHN0YXJ0ICsgbGVuKSwgdGFyZ2V0X3N0YXJ0KVxuICB9XG59XG5cbmZ1bmN0aW9uIF9iYXNlNjRTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIGlmIChzdGFydCA9PT0gMCAmJiBlbmQgPT09IGJ1Zi5sZW5ndGgpIHtcbiAgICByZXR1cm4gYmFzZTY0LmZyb21CeXRlQXJyYXkoYnVmKVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBiYXNlNjQuZnJvbUJ5dGVBcnJheShidWYuc2xpY2Uoc3RhcnQsIGVuZCkpXG4gIH1cbn1cblxuZnVuY3Rpb24gX3V0ZjhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIHZhciByZXMgPSAnJ1xuICB2YXIgdG1wID0gJydcbiAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKVxuXG4gIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgaWYgKGJ1ZltpXSA8PSAweDdGKSB7XG4gICAgICByZXMgKz0gZGVjb2RlVXRmOENoYXIodG1wKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKVxuICAgICAgdG1wID0gJydcbiAgICB9IGVsc2Uge1xuICAgICAgdG1wICs9ICclJyArIGJ1ZltpXS50b1N0cmluZygxNilcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzICsgZGVjb2RlVXRmOENoYXIodG1wKVxufVxuXG5mdW5jdGlvbiBfYXNjaWlTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIHZhciByZXQgPSAnJ1xuICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpXG5cbiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspXG4gICAgcmV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKVxuICByZXR1cm4gcmV0XG59XG5cbmZ1bmN0aW9uIF9iaW5hcnlTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIHJldHVybiBfYXNjaWlTbGljZShidWYsIHN0YXJ0LCBlbmQpXG59XG5cbmZ1bmN0aW9uIF9oZXhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7XG4gIHZhciBsZW4gPSBidWYubGVuZ3RoXG5cbiAgaWYgKCFzdGFydCB8fCBzdGFydCA8IDApIHN0YXJ0ID0gMFxuICBpZiAoIWVuZCB8fCBlbmQgPCAwIHx8IGVuZCA+IGxlbikgZW5kID0gbGVuXG5cbiAgdmFyIG91dCA9ICcnXG4gIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgb3V0ICs9IHRvSGV4KGJ1ZltpXSlcbiAgfVxuICByZXR1cm4gb3V0XG59XG5cbmZ1bmN0aW9uIF91dGYxNmxlU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICB2YXIgYnl0ZXMgPSBidWYuc2xpY2Uoc3RhcnQsIGVuZClcbiAgdmFyIHJlcyA9ICcnXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpICs9IDIpIHtcbiAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSArIGJ5dGVzW2krMV0gKiAyNTYpXG4gIH1cbiAgcmV0dXJuIHJlc1xufVxuXG5CdWZmZXIucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoXG4gIHN0YXJ0ID0gY2xhbXAoc3RhcnQsIGxlbiwgMClcbiAgZW5kID0gY2xhbXAoZW5kLCBsZW4sIGxlbilcblxuICBpZiAoQnVmZmVyLl91c2VUeXBlZEFycmF5cykge1xuICAgIHJldHVybiBCdWZmZXIuX2F1Z21lbnQodGhpcy5zdWJhcnJheShzdGFydCwgZW5kKSlcbiAgfSBlbHNlIHtcbiAgICB2YXIgc2xpY2VMZW4gPSBlbmQgLSBzdGFydFxuICAgIHZhciBuZXdCdWYgPSBuZXcgQnVmZmVyKHNsaWNlTGVuLCB1bmRlZmluZWQsIHRydWUpXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbGljZUxlbjsgaSsrKSB7XG4gICAgICBuZXdCdWZbaV0gPSB0aGlzW2kgKyBzdGFydF1cbiAgICB9XG4gICAgcmV0dXJuIG5ld0J1ZlxuICB9XG59XG5cbi8vIGBnZXRgIHdpbGwgYmUgcmVtb3ZlZCBpbiBOb2RlIDAuMTMrXG5CdWZmZXIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChvZmZzZXQpIHtcbiAgY29uc29sZS5sb2coJy5nZXQoKSBpcyBkZXByZWNhdGVkLiBBY2Nlc3MgdXNpbmcgYXJyYXkgaW5kZXhlcyBpbnN0ZWFkLicpXG4gIHJldHVybiB0aGlzLnJlYWRVSW50OChvZmZzZXQpXG59XG5cbi8vIGBzZXRgIHdpbGwgYmUgcmVtb3ZlZCBpbiBOb2RlIDAuMTMrXG5CdWZmZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICh2LCBvZmZzZXQpIHtcbiAgY29uc29sZS5sb2coJy5zZXQoKSBpcyBkZXByZWNhdGVkLiBBY2Nlc3MgdXNpbmcgYXJyYXkgaW5kZXhlcyBpbnN0ZWFkLicpXG4gIHJldHVybiB0aGlzLndyaXRlVUludDgodiwgb2Zmc2V0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50OCA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLCAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgPCB0aGlzLmxlbmd0aCwgJ1RyeWluZyB0byByZWFkIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbiAgfVxuXG4gIGlmIChvZmZzZXQgPj0gdGhpcy5sZW5ndGgpXG4gICAgcmV0dXJuXG5cbiAgcmV0dXJuIHRoaXNbb2Zmc2V0XVxufVxuXG5mdW5jdGlvbiBfcmVhZFVJbnQxNiAoYnVmLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIGFzc2VydCh0eXBlb2YgbGl0dGxlRW5kaWFuID09PSAnYm9vbGVhbicsICdtaXNzaW5nIG9yIGludmFsaWQgZW5kaWFuJylcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLCAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgKyAxIDwgYnVmLmxlbmd0aCwgJ1RyeWluZyB0byByZWFkIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbiAgfVxuXG4gIHZhciBsZW4gPSBidWYubGVuZ3RoXG4gIGlmIChvZmZzZXQgPj0gbGVuKVxuICAgIHJldHVyblxuXG4gIHZhciB2YWxcbiAgaWYgKGxpdHRsZUVuZGlhbikge1xuICAgIHZhbCA9IGJ1ZltvZmZzZXRdXG4gICAgaWYgKG9mZnNldCArIDEgPCBsZW4pXG4gICAgICB2YWwgfD0gYnVmW29mZnNldCArIDFdIDw8IDhcbiAgfSBlbHNlIHtcbiAgICB2YWwgPSBidWZbb2Zmc2V0XSA8PCA4XG4gICAgaWYgKG9mZnNldCArIDEgPCBsZW4pXG4gICAgICB2YWwgfD0gYnVmW29mZnNldCArIDFdXG4gIH1cbiAgcmV0dXJuIHZhbFxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZMRSA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiBfcmVhZFVJbnQxNih0aGlzLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiBfcmVhZFVJbnQxNih0aGlzLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydClcbn1cblxuZnVuY3Rpb24gX3JlYWRVSW50MzIgKGJ1Ziwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQodHlwZW9mIGxpdHRsZUVuZGlhbiA9PT0gJ2Jvb2xlYW4nLCAnbWlzc2luZyBvciBpbnZhbGlkIGVuZGlhbicpXG4gICAgYXNzZXJ0KG9mZnNldCAhPT0gdW5kZWZpbmVkICYmIG9mZnNldCAhPT0gbnVsbCwgJ21pc3Npbmcgb2Zmc2V0JylcbiAgICBhc3NlcnQob2Zmc2V0ICsgMyA8IGJ1Zi5sZW5ndGgsICdUcnlpbmcgdG8gcmVhZCBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG4gIH1cblxuICB2YXIgbGVuID0gYnVmLmxlbmd0aFxuICBpZiAob2Zmc2V0ID49IGxlbilcbiAgICByZXR1cm5cblxuICB2YXIgdmFsXG4gIGlmIChsaXR0bGVFbmRpYW4pIHtcbiAgICBpZiAob2Zmc2V0ICsgMiA8IGxlbilcbiAgICAgIHZhbCA9IGJ1ZltvZmZzZXQgKyAyXSA8PCAxNlxuICAgIGlmIChvZmZzZXQgKyAxIDwgbGVuKVxuICAgICAgdmFsIHw9IGJ1ZltvZmZzZXQgKyAxXSA8PCA4XG4gICAgdmFsIHw9IGJ1ZltvZmZzZXRdXG4gICAgaWYgKG9mZnNldCArIDMgPCBsZW4pXG4gICAgICB2YWwgPSB2YWwgKyAoYnVmW29mZnNldCArIDNdIDw8IDI0ID4+PiAwKVxuICB9IGVsc2Uge1xuICAgIGlmIChvZmZzZXQgKyAxIDwgbGVuKVxuICAgICAgdmFsID0gYnVmW29mZnNldCArIDFdIDw8IDE2XG4gICAgaWYgKG9mZnNldCArIDIgPCBsZW4pXG4gICAgICB2YWwgfD0gYnVmW29mZnNldCArIDJdIDw8IDhcbiAgICBpZiAob2Zmc2V0ICsgMyA8IGxlbilcbiAgICAgIHZhbCB8PSBidWZbb2Zmc2V0ICsgM11cbiAgICB2YWwgPSB2YWwgKyAoYnVmW29mZnNldF0gPDwgMjQgPj4+IDApXG4gIH1cbiAgcmV0dXJuIHZhbFxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJMRSA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiBfcmVhZFVJbnQzMih0aGlzLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJCRSA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiBfcmVhZFVJbnQzMih0aGlzLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50OCA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLFxuICAgICAgICAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgPCB0aGlzLmxlbmd0aCwgJ1RyeWluZyB0byByZWFkIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbiAgfVxuXG4gIGlmIChvZmZzZXQgPj0gdGhpcy5sZW5ndGgpXG4gICAgcmV0dXJuXG5cbiAgdmFyIG5lZyA9IHRoaXNbb2Zmc2V0XSAmIDB4ODBcbiAgaWYgKG5lZylcbiAgICByZXR1cm4gKDB4ZmYgLSB0aGlzW29mZnNldF0gKyAxKSAqIC0xXG4gIGVsc2VcbiAgICByZXR1cm4gdGhpc1tvZmZzZXRdXG59XG5cbmZ1bmN0aW9uIF9yZWFkSW50MTYgKGJ1Ziwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQodHlwZW9mIGxpdHRsZUVuZGlhbiA9PT0gJ2Jvb2xlYW4nLCAnbWlzc2luZyBvciBpbnZhbGlkIGVuZGlhbicpXG4gICAgYXNzZXJ0KG9mZnNldCAhPT0gdW5kZWZpbmVkICYmIG9mZnNldCAhPT0gbnVsbCwgJ21pc3Npbmcgb2Zmc2V0JylcbiAgICBhc3NlcnQob2Zmc2V0ICsgMSA8IGJ1Zi5sZW5ndGgsICdUcnlpbmcgdG8gcmVhZCBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG4gIH1cblxuICB2YXIgbGVuID0gYnVmLmxlbmd0aFxuICBpZiAob2Zmc2V0ID49IGxlbilcbiAgICByZXR1cm5cblxuICB2YXIgdmFsID0gX3JlYWRVSW50MTYoYnVmLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgdHJ1ZSlcbiAgdmFyIG5lZyA9IHZhbCAmIDB4ODAwMFxuICBpZiAobmVnKVxuICAgIHJldHVybiAoMHhmZmZmIC0gdmFsICsgMSkgKiAtMVxuICBlbHNlXG4gICAgcmV0dXJuIHZhbFxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkxFID0gZnVuY3Rpb24gKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIF9yZWFkSW50MTYodGhpcywgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiBfcmVhZEludDE2KHRoaXMsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5mdW5jdGlvbiBfcmVhZEludDMyIChidWYsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgYXNzZXJ0KHR5cGVvZiBsaXR0bGVFbmRpYW4gPT09ICdib29sZWFuJywgJ21pc3Npbmcgb3IgaW52YWxpZCBlbmRpYW4nKVxuICAgIGFzc2VydChvZmZzZXQgIT09IHVuZGVmaW5lZCAmJiBvZmZzZXQgIT09IG51bGwsICdtaXNzaW5nIG9mZnNldCcpXG4gICAgYXNzZXJ0KG9mZnNldCArIDMgPCBidWYubGVuZ3RoLCAnVHJ5aW5nIHRvIHJlYWQgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKVxuICB9XG5cbiAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGhcbiAgaWYgKG9mZnNldCA+PSBsZW4pXG4gICAgcmV0dXJuXG5cbiAgdmFyIHZhbCA9IF9yZWFkVUludDMyKGJ1Ziwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIHRydWUpXG4gIHZhciBuZWcgPSB2YWwgJiAweDgwMDAwMDAwXG4gIGlmIChuZWcpXG4gICAgcmV0dXJuICgweGZmZmZmZmZmIC0gdmFsICsgMSkgKiAtMVxuICBlbHNlXG4gICAgcmV0dXJuIHZhbFxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRJbnQzMkxFID0gZnVuY3Rpb24gKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIF9yZWFkSW50MzIodGhpcywgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiBfcmVhZEludDMyKHRoaXMsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5mdW5jdGlvbiBfcmVhZEZsb2F0IChidWYsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgYXNzZXJ0KHR5cGVvZiBsaXR0bGVFbmRpYW4gPT09ICdib29sZWFuJywgJ21pc3Npbmcgb3IgaW52YWxpZCBlbmRpYW4nKVxuICAgIGFzc2VydChvZmZzZXQgKyAzIDwgYnVmLmxlbmd0aCwgJ1RyeWluZyB0byByZWFkIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbiAgfVxuXG4gIHJldHVybiBpZWVlNzU0LnJlYWQoYnVmLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgMjMsIDQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiAob2Zmc2V0LCBub0Fzc2VydCkge1xuICByZXR1cm4gX3JlYWRGbG9hdCh0aGlzLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRGbG9hdEJFID0gZnVuY3Rpb24gKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIF9yZWFkRmxvYXQodGhpcywgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpXG59XG5cbmZ1bmN0aW9uIF9yZWFkRG91YmxlIChidWYsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgYXNzZXJ0KHR5cGVvZiBsaXR0bGVFbmRpYW4gPT09ICdib29sZWFuJywgJ21pc3Npbmcgb3IgaW52YWxpZCBlbmRpYW4nKVxuICAgIGFzc2VydChvZmZzZXQgKyA3IDwgYnVmLmxlbmd0aCwgJ1RyeWluZyB0byByZWFkIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbiAgfVxuXG4gIHJldHVybiBpZWVlNzU0LnJlYWQoYnVmLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgNTIsIDgpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIF9yZWFkRG91YmxlKHRoaXMsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZERvdWJsZUJFID0gZnVuY3Rpb24gKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIF9yZWFkRG91YmxlKHRoaXMsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbiAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIGFzc2VydCh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsLCAnbWlzc2luZyB2YWx1ZScpXG4gICAgYXNzZXJ0KG9mZnNldCAhPT0gdW5kZWZpbmVkICYmIG9mZnNldCAhPT0gbnVsbCwgJ21pc3Npbmcgb2Zmc2V0JylcbiAgICBhc3NlcnQob2Zmc2V0IDwgdGhpcy5sZW5ndGgsICd0cnlpbmcgdG8gd3JpdGUgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKVxuICAgIHZlcmlmdWludCh2YWx1ZSwgMHhmZilcbiAgfVxuXG4gIGlmIChvZmZzZXQgPj0gdGhpcy5sZW5ndGgpIHJldHVyblxuXG4gIHRoaXNbb2Zmc2V0XSA9IHZhbHVlXG59XG5cbmZ1bmN0aW9uIF93cml0ZVVJbnQxNiAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCwgJ21pc3NpbmcgdmFsdWUnKVxuICAgIGFzc2VydCh0eXBlb2YgbGl0dGxlRW5kaWFuID09PSAnYm9vbGVhbicsICdtaXNzaW5nIG9yIGludmFsaWQgZW5kaWFuJylcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLCAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgKyAxIDwgYnVmLmxlbmd0aCwgJ3RyeWluZyB0byB3cml0ZSBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG4gICAgdmVyaWZ1aW50KHZhbHVlLCAweGZmZmYpXG4gIH1cblxuICB2YXIgbGVuID0gYnVmLmxlbmd0aFxuICBpZiAob2Zmc2V0ID49IGxlbilcbiAgICByZXR1cm5cblxuICBmb3IgKHZhciBpID0gMCwgaiA9IE1hdGgubWluKGxlbiAtIG9mZnNldCwgMik7IGkgPCBqOyBpKyspIHtcbiAgICBidWZbb2Zmc2V0ICsgaV0gPVxuICAgICAgICAodmFsdWUgJiAoMHhmZiA8PCAoOCAqIChsaXR0bGVFbmRpYW4gPyBpIDogMSAtIGkpKSkpID4+PlxuICAgICAgICAgICAgKGxpdHRsZUVuZGlhbiA/IGkgOiAxIC0gaSkgKiA4XG4gIH1cbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQxNkxFID0gZnVuY3Rpb24gKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIF93cml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24gKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIF93cml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpXG59XG5cbmZ1bmN0aW9uIF93cml0ZVVJbnQzMiAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCwgJ21pc3NpbmcgdmFsdWUnKVxuICAgIGFzc2VydCh0eXBlb2YgbGl0dGxlRW5kaWFuID09PSAnYm9vbGVhbicsICdtaXNzaW5nIG9yIGludmFsaWQgZW5kaWFuJylcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLCAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgKyAzIDwgYnVmLmxlbmd0aCwgJ3RyeWluZyB0byB3cml0ZSBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG4gICAgdmVyaWZ1aW50KHZhbHVlLCAweGZmZmZmZmZmKVxuICB9XG5cbiAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGhcbiAgaWYgKG9mZnNldCA+PSBsZW4pXG4gICAgcmV0dXJuXG5cbiAgZm9yICh2YXIgaSA9IDAsIGogPSBNYXRoLm1pbihsZW4gLSBvZmZzZXQsIDQpOyBpIDwgajsgaSsrKSB7XG4gICAgYnVmW29mZnNldCArIGldID1cbiAgICAgICAgKHZhbHVlID4+PiAobGl0dGxlRW5kaWFuID8gaSA6IDMgLSBpKSAqIDgpICYgMHhmZlxuICB9XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MzJMRSA9IGZ1bmN0aW9uICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICBfd3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MzJCRSA9IGZ1bmN0aW9uICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICBfd3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgYXNzZXJ0KHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwsICdtaXNzaW5nIHZhbHVlJylcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLCAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgPCB0aGlzLmxlbmd0aCwgJ1RyeWluZyB0byB3cml0ZSBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG4gICAgdmVyaWZzaW50KHZhbHVlLCAweDdmLCAtMHg4MClcbiAgfVxuXG4gIGlmIChvZmZzZXQgPj0gdGhpcy5sZW5ndGgpXG4gICAgcmV0dXJuXG5cbiAgaWYgKHZhbHVlID49IDApXG4gICAgdGhpcy53cml0ZVVJbnQ4KHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KVxuICBlbHNlXG4gICAgdGhpcy53cml0ZVVJbnQ4KDB4ZmYgKyB2YWx1ZSArIDEsIG9mZnNldCwgbm9Bc3NlcnQpXG59XG5cbmZ1bmN0aW9uIF93cml0ZUludDE2IChidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIGFzc2VydCh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsLCAnbWlzc2luZyB2YWx1ZScpXG4gICAgYXNzZXJ0KHR5cGVvZiBsaXR0bGVFbmRpYW4gPT09ICdib29sZWFuJywgJ21pc3Npbmcgb3IgaW52YWxpZCBlbmRpYW4nKVxuICAgIGFzc2VydChvZmZzZXQgIT09IHVuZGVmaW5lZCAmJiBvZmZzZXQgIT09IG51bGwsICdtaXNzaW5nIG9mZnNldCcpXG4gICAgYXNzZXJ0KG9mZnNldCArIDEgPCBidWYubGVuZ3RoLCAnVHJ5aW5nIHRvIHdyaXRlIGJleW9uZCBidWZmZXIgbGVuZ3RoJylcbiAgICB2ZXJpZnNpbnQodmFsdWUsIDB4N2ZmZiwgLTB4ODAwMClcbiAgfVxuXG4gIHZhciBsZW4gPSBidWYubGVuZ3RoXG4gIGlmIChvZmZzZXQgPj0gbGVuKVxuICAgIHJldHVyblxuXG4gIGlmICh2YWx1ZSA+PSAwKVxuICAgIF93cml0ZVVJbnQxNihidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpXG4gIGVsc2VcbiAgICBfd3JpdGVVSW50MTYoYnVmLCAweGZmZmYgKyB2YWx1ZSArIDEsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDE2TEUgPSBmdW5jdGlvbiAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgX3dyaXRlSW50MTYodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQxNkJFID0gZnVuY3Rpb24gKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIF93cml0ZUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydClcbn1cblxuZnVuY3Rpb24gX3dyaXRlSW50MzIgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgYXNzZXJ0KHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwsICdtaXNzaW5nIHZhbHVlJylcbiAgICBhc3NlcnQodHlwZW9mIGxpdHRsZUVuZGlhbiA9PT0gJ2Jvb2xlYW4nLCAnbWlzc2luZyBvciBpbnZhbGlkIGVuZGlhbicpXG4gICAgYXNzZXJ0KG9mZnNldCAhPT0gdW5kZWZpbmVkICYmIG9mZnNldCAhPT0gbnVsbCwgJ21pc3Npbmcgb2Zmc2V0JylcbiAgICBhc3NlcnQob2Zmc2V0ICsgMyA8IGJ1Zi5sZW5ndGgsICdUcnlpbmcgdG8gd3JpdGUgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKVxuICAgIHZlcmlmc2ludCh2YWx1ZSwgMHg3ZmZmZmZmZiwgLTB4ODAwMDAwMDApXG4gIH1cblxuICB2YXIgbGVuID0gYnVmLmxlbmd0aFxuICBpZiAob2Zmc2V0ID49IGxlbilcbiAgICByZXR1cm5cblxuICBpZiAodmFsdWUgPj0gMClcbiAgICBfd3JpdGVVSW50MzIoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KVxuICBlbHNlXG4gICAgX3dyaXRlVUludDMyKGJ1ZiwgMHhmZmZmZmZmZiArIHZhbHVlICsgMSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJMRSA9IGZ1bmN0aW9uICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICBfd3JpdGVJbnQzMih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDMyQkUgPSBmdW5jdGlvbiAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgX3dyaXRlSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5mdW5jdGlvbiBfd3JpdGVGbG9hdCAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICBhc3NlcnQodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCwgJ21pc3NpbmcgdmFsdWUnKVxuICAgIGFzc2VydCh0eXBlb2YgbGl0dGxlRW5kaWFuID09PSAnYm9vbGVhbicsICdtaXNzaW5nIG9yIGludmFsaWQgZW5kaWFuJylcbiAgICBhc3NlcnQob2Zmc2V0ICE9PSB1bmRlZmluZWQgJiYgb2Zmc2V0ICE9PSBudWxsLCAnbWlzc2luZyBvZmZzZXQnKVxuICAgIGFzc2VydChvZmZzZXQgKyAzIDwgYnVmLmxlbmd0aCwgJ1RyeWluZyB0byB3cml0ZSBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG4gICAgdmVyaWZJRUVFNzU0KHZhbHVlLCAzLjQwMjgyMzQ2NjM4NTI4ODZlKzM4LCAtMy40MDI4MjM0NjYzODUyODg2ZSszOClcbiAgfVxuXG4gIHZhciBsZW4gPSBidWYubGVuZ3RoXG4gIGlmIChvZmZzZXQgPj0gbGVuKVxuICAgIHJldHVyblxuXG4gIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDIzLCA0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlRmxvYXRMRSA9IGZ1bmN0aW9uICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICBfd3JpdGVGbG9hdCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUZsb2F0QkUgPSBmdW5jdGlvbiAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgX3dyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG5mdW5jdGlvbiBfd3JpdGVEb3VibGUgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgYXNzZXJ0KHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwsICdtaXNzaW5nIHZhbHVlJylcbiAgICBhc3NlcnQodHlwZW9mIGxpdHRsZUVuZGlhbiA9PT0gJ2Jvb2xlYW4nLCAnbWlzc2luZyBvciBpbnZhbGlkIGVuZGlhbicpXG4gICAgYXNzZXJ0KG9mZnNldCAhPT0gdW5kZWZpbmVkICYmIG9mZnNldCAhPT0gbnVsbCwgJ21pc3Npbmcgb2Zmc2V0JylcbiAgICBhc3NlcnQob2Zmc2V0ICsgNyA8IGJ1Zi5sZW5ndGgsXG4gICAgICAgICdUcnlpbmcgdG8gd3JpdGUgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKVxuICAgIHZlcmlmSUVFRTc1NCh2YWx1ZSwgMS43OTc2OTMxMzQ4NjIzMTU3RSszMDgsIC0xLjc5NzY5MzEzNDg2MjMxNTdFKzMwOClcbiAgfVxuXG4gIHZhciBsZW4gPSBidWYubGVuZ3RoXG4gIGlmIChvZmZzZXQgPj0gbGVuKVxuICAgIHJldHVyblxuXG4gIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDUyLCA4KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbiAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgX3dyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgX3dyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydClcbn1cblxuLy8gZmlsbCh2YWx1ZSwgc3RhcnQ9MCwgZW5kPWJ1ZmZlci5sZW5ndGgpXG5CdWZmZXIucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbiAodmFsdWUsIHN0YXJ0LCBlbmQpIHtcbiAgaWYgKCF2YWx1ZSkgdmFsdWUgPSAwXG4gIGlmICghc3RhcnQpIHN0YXJ0ID0gMFxuICBpZiAoIWVuZCkgZW5kID0gdGhpcy5sZW5ndGhcblxuICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gdmFsdWUuY2hhckNvZGVBdCgwKVxuICB9XG5cbiAgYXNzZXJ0KHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZhbHVlKSwgJ3ZhbHVlIGlzIG5vdCBhIG51bWJlcicpXG4gIGFzc2VydChlbmQgPj0gc3RhcnQsICdlbmQgPCBzdGFydCcpXG5cbiAgLy8gRmlsbCAwIGJ5dGVzOyB3ZSdyZSBkb25lXG4gIGlmIChlbmQgPT09IHN0YXJ0KSByZXR1cm5cbiAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm5cblxuICBhc3NlcnQoc3RhcnQgPj0gMCAmJiBzdGFydCA8IHRoaXMubGVuZ3RoLCAnc3RhcnQgb3V0IG9mIGJvdW5kcycpXG4gIGFzc2VydChlbmQgPj0gMCAmJiBlbmQgPD0gdGhpcy5sZW5ndGgsICdlbmQgb3V0IG9mIGJvdW5kcycpXG5cbiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICB0aGlzW2ldID0gdmFsdWVcbiAgfVxufVxuXG5CdWZmZXIucHJvdG90eXBlLmluc3BlY3QgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBvdXQgPSBbXVxuICB2YXIgbGVuID0gdGhpcy5sZW5ndGhcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgIG91dFtpXSA9IHRvSGV4KHRoaXNbaV0pXG4gICAgaWYgKGkgPT09IGV4cG9ydHMuSU5TUEVDVF9NQVhfQllURVMpIHtcbiAgICAgIG91dFtpICsgMV0gPSAnLi4uJ1xuICAgICAgYnJlYWtcbiAgICB9XG4gIH1cbiAgcmV0dXJuICc8QnVmZmVyICcgKyBvdXQuam9pbignICcpICsgJz4nXG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgQXJyYXlCdWZmZXJgIHdpdGggdGhlICpjb3BpZWQqIG1lbW9yeSBvZiB0aGUgYnVmZmVyIGluc3RhbmNlLlxuICogQWRkZWQgaW4gTm9kZSAwLjEyLiBPbmx5IGF2YWlsYWJsZSBpbiBicm93c2VycyB0aGF0IHN1cHBvcnQgQXJyYXlCdWZmZXIuXG4gKi9cbkJ1ZmZlci5wcm90b3R5cGUudG9BcnJheUJ1ZmZlciA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHR5cGVvZiBVaW50OEFycmF5ICE9PSAndW5kZWZpbmVkJykge1xuICAgIGlmIChCdWZmZXIuX3VzZVR5cGVkQXJyYXlzKSB7XG4gICAgICByZXR1cm4gKG5ldyBCdWZmZXIodGhpcykpLmJ1ZmZlclxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgYnVmID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5sZW5ndGgpXG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYnVmLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKVxuICAgICAgICBidWZbaV0gPSB0aGlzW2ldXG4gICAgICByZXR1cm4gYnVmLmJ1ZmZlclxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0J1ZmZlci50b0FycmF5QnVmZmVyIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyJylcbiAgfVxufVxuXG4vLyBIRUxQRVIgRlVOQ1RJT05TXG4vLyA9PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIHN0cmluZ3RyaW0gKHN0cikge1xuICBpZiAoc3RyLnRyaW0pIHJldHVybiBzdHIudHJpbSgpXG4gIHJldHVybiBzdHIucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpXG59XG5cbnZhciBCUCA9IEJ1ZmZlci5wcm90b3R5cGVcblxuLyoqXG4gKiBBdWdtZW50IGEgVWludDhBcnJheSAqaW5zdGFuY2UqIChub3QgdGhlIFVpbnQ4QXJyYXkgY2xhc3MhKSB3aXRoIEJ1ZmZlciBtZXRob2RzXG4gKi9cbkJ1ZmZlci5fYXVnbWVudCA9IGZ1bmN0aW9uIChhcnIpIHtcbiAgYXJyLl9pc0J1ZmZlciA9IHRydWVcblxuICAvLyBzYXZlIHJlZmVyZW5jZSB0byBvcmlnaW5hbCBVaW50OEFycmF5IGdldC9zZXQgbWV0aG9kcyBiZWZvcmUgb3ZlcndyaXRpbmdcbiAgYXJyLl9nZXQgPSBhcnIuZ2V0XG4gIGFyci5fc2V0ID0gYXJyLnNldFxuXG4gIC8vIGRlcHJlY2F0ZWQsIHdpbGwgYmUgcmVtb3ZlZCBpbiBub2RlIDAuMTMrXG4gIGFyci5nZXQgPSBCUC5nZXRcbiAgYXJyLnNldCA9IEJQLnNldFxuXG4gIGFyci53cml0ZSA9IEJQLndyaXRlXG4gIGFyci50b1N0cmluZyA9IEJQLnRvU3RyaW5nXG4gIGFyci50b0xvY2FsZVN0cmluZyA9IEJQLnRvU3RyaW5nXG4gIGFyci50b0pTT04gPSBCUC50b0pTT05cbiAgYXJyLmNvcHkgPSBCUC5jb3B5XG4gIGFyci5zbGljZSA9IEJQLnNsaWNlXG4gIGFyci5yZWFkVUludDggPSBCUC5yZWFkVUludDhcbiAgYXJyLnJlYWRVSW50MTZMRSA9IEJQLnJlYWRVSW50MTZMRVxuICBhcnIucmVhZFVJbnQxNkJFID0gQlAucmVhZFVJbnQxNkJFXG4gIGFyci5yZWFkVUludDMyTEUgPSBCUC5yZWFkVUludDMyTEVcbiAgYXJyLnJlYWRVSW50MzJCRSA9IEJQLnJlYWRVSW50MzJCRVxuICBhcnIucmVhZEludDggPSBCUC5yZWFkSW50OFxuICBhcnIucmVhZEludDE2TEUgPSBCUC5yZWFkSW50MTZMRVxuICBhcnIucmVhZEludDE2QkUgPSBCUC5yZWFkSW50MTZCRVxuICBhcnIucmVhZEludDMyTEUgPSBCUC5yZWFkSW50MzJMRVxuICBhcnIucmVhZEludDMyQkUgPSBCUC5yZWFkSW50MzJCRVxuICBhcnIucmVhZEZsb2F0TEUgPSBCUC5yZWFkRmxvYXRMRVxuICBhcnIucmVhZEZsb2F0QkUgPSBCUC5yZWFkRmxvYXRCRVxuICBhcnIucmVhZERvdWJsZUxFID0gQlAucmVhZERvdWJsZUxFXG4gIGFyci5yZWFkRG91YmxlQkUgPSBCUC5yZWFkRG91YmxlQkVcbiAgYXJyLndyaXRlVUludDggPSBCUC53cml0ZVVJbnQ4XG4gIGFyci53cml0ZVVJbnQxNkxFID0gQlAud3JpdGVVSW50MTZMRVxuICBhcnIud3JpdGVVSW50MTZCRSA9IEJQLndyaXRlVUludDE2QkVcbiAgYXJyLndyaXRlVUludDMyTEUgPSBCUC53cml0ZVVJbnQzMkxFXG4gIGFyci53cml0ZVVJbnQzMkJFID0gQlAud3JpdGVVSW50MzJCRVxuICBhcnIud3JpdGVJbnQ4ID0gQlAud3JpdGVJbnQ4XG4gIGFyci53cml0ZUludDE2TEUgPSBCUC53cml0ZUludDE2TEVcbiAgYXJyLndyaXRlSW50MTZCRSA9IEJQLndyaXRlSW50MTZCRVxuICBhcnIud3JpdGVJbnQzMkxFID0gQlAud3JpdGVJbnQzMkxFXG4gIGFyci53cml0ZUludDMyQkUgPSBCUC53cml0ZUludDMyQkVcbiAgYXJyLndyaXRlRmxvYXRMRSA9IEJQLndyaXRlRmxvYXRMRVxuICBhcnIud3JpdGVGbG9hdEJFID0gQlAud3JpdGVGbG9hdEJFXG4gIGFyci53cml0ZURvdWJsZUxFID0gQlAud3JpdGVEb3VibGVMRVxuICBhcnIud3JpdGVEb3VibGVCRSA9IEJQLndyaXRlRG91YmxlQkVcbiAgYXJyLmZpbGwgPSBCUC5maWxsXG4gIGFyci5pbnNwZWN0ID0gQlAuaW5zcGVjdFxuICBhcnIudG9BcnJheUJ1ZmZlciA9IEJQLnRvQXJyYXlCdWZmZXJcblxuICByZXR1cm4gYXJyXG59XG5cbi8vIHNsaWNlKHN0YXJ0LCBlbmQpXG5mdW5jdGlvbiBjbGFtcCAoaW5kZXgsIGxlbiwgZGVmYXVsdFZhbHVlKSB7XG4gIGlmICh0eXBlb2YgaW5kZXggIT09ICdudW1iZXInKSByZXR1cm4gZGVmYXVsdFZhbHVlXG4gIGluZGV4ID0gfn5pbmRleDsgIC8vIENvZXJjZSB0byBpbnRlZ2VyLlxuICBpZiAoaW5kZXggPj0gbGVuKSByZXR1cm4gbGVuXG4gIGlmIChpbmRleCA+PSAwKSByZXR1cm4gaW5kZXhcbiAgaW5kZXggKz0gbGVuXG4gIGlmIChpbmRleCA+PSAwKSByZXR1cm4gaW5kZXhcbiAgcmV0dXJuIDBcbn1cblxuZnVuY3Rpb24gY29lcmNlIChsZW5ndGgpIHtcbiAgLy8gQ29lcmNlIGxlbmd0aCB0byBhIG51bWJlciAocG9zc2libHkgTmFOKSwgcm91bmQgdXBcbiAgLy8gaW4gY2FzZSBpdCdzIGZyYWN0aW9uYWwgKGUuZy4gMTIzLjQ1NikgdGhlbiBkbyBhXG4gIC8vIGRvdWJsZSBuZWdhdGUgdG8gY29lcmNlIGEgTmFOIHRvIDAuIEVhc3ksIHJpZ2h0P1xuICBsZW5ndGggPSB+fk1hdGguY2VpbCgrbGVuZ3RoKVxuICByZXR1cm4gbGVuZ3RoIDwgMCA/IDAgOiBsZW5ndGhcbn1cblxuZnVuY3Rpb24gaXNBcnJheSAoc3ViamVjdCkge1xuICByZXR1cm4gKEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKHN1YmplY3QpIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHN1YmplY3QpID09PSAnW29iamVjdCBBcnJheV0nXG4gIH0pKHN1YmplY3QpXG59XG5cbmZ1bmN0aW9uIGlzQXJyYXlpc2ggKHN1YmplY3QpIHtcbiAgcmV0dXJuIGlzQXJyYXkoc3ViamVjdCkgfHwgQnVmZmVyLmlzQnVmZmVyKHN1YmplY3QpIHx8XG4gICAgICBzdWJqZWN0ICYmIHR5cGVvZiBzdWJqZWN0ID09PSAnb2JqZWN0JyAmJlxuICAgICAgdHlwZW9mIHN1YmplY3QubGVuZ3RoID09PSAnbnVtYmVyJ1xufVxuXG5mdW5jdGlvbiB0b0hleCAobikge1xuICBpZiAobiA8IDE2KSByZXR1cm4gJzAnICsgbi50b1N0cmluZygxNilcbiAgcmV0dXJuIG4udG9TdHJpbmcoMTYpXG59XG5cbmZ1bmN0aW9uIHV0ZjhUb0J5dGVzIChzdHIpIHtcbiAgdmFyIGJ5dGVBcnJheSA9IFtdXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGIgPSBzdHIuY2hhckNvZGVBdChpKVxuICAgIGlmIChiIDw9IDB4N0YpXG4gICAgICBieXRlQXJyYXkucHVzaChzdHIuY2hhckNvZGVBdChpKSlcbiAgICBlbHNlIHtcbiAgICAgIHZhciBzdGFydCA9IGlcbiAgICAgIGlmIChiID49IDB4RDgwMCAmJiBiIDw9IDB4REZGRikgaSsrXG4gICAgICB2YXIgaCA9IGVuY29kZVVSSUNvbXBvbmVudChzdHIuc2xpY2Uoc3RhcnQsIGkrMSkpLnN1YnN0cigxKS5zcGxpdCgnJScpXG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGgubGVuZ3RoOyBqKyspXG4gICAgICAgIGJ5dGVBcnJheS5wdXNoKHBhcnNlSW50KGhbal0sIDE2KSlcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJ5dGVBcnJheVxufVxuXG5mdW5jdGlvbiBhc2NpaVRvQnl0ZXMgKHN0cikge1xuICB2YXIgYnl0ZUFycmF5ID0gW11cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICAvLyBOb2RlJ3MgY29kZSBzZWVtcyB0byBiZSBkb2luZyB0aGlzIGFuZCBub3QgJiAweDdGLi5cbiAgICBieXRlQXJyYXkucHVzaChzdHIuY2hhckNvZGVBdChpKSAmIDB4RkYpXG4gIH1cbiAgcmV0dXJuIGJ5dGVBcnJheVxufVxuXG5mdW5jdGlvbiB1dGYxNmxlVG9CeXRlcyAoc3RyKSB7XG4gIHZhciBjLCBoaSwgbG9cbiAgdmFyIGJ5dGVBcnJheSA9IFtdXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgYyA9IHN0ci5jaGFyQ29kZUF0KGkpXG4gICAgaGkgPSBjID4+IDhcbiAgICBsbyA9IGMgJSAyNTZcbiAgICBieXRlQXJyYXkucHVzaChsbylcbiAgICBieXRlQXJyYXkucHVzaChoaSlcbiAgfVxuXG4gIHJldHVybiBieXRlQXJyYXlcbn1cblxuZnVuY3Rpb24gYmFzZTY0VG9CeXRlcyAoc3RyKSB7XG4gIHJldHVybiBiYXNlNjQudG9CeXRlQXJyYXkoc3RyKVxufVxuXG5mdW5jdGlvbiBibGl0QnVmZmVyIChzcmMsIGRzdCwgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgdmFyIHBvc1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKChpICsgb2Zmc2V0ID49IGRzdC5sZW5ndGgpIHx8IChpID49IHNyYy5sZW5ndGgpKVxuICAgICAgYnJlYWtcbiAgICBkc3RbaSArIG9mZnNldF0gPSBzcmNbaV1cbiAgfVxuICByZXR1cm4gaVxufVxuXG5mdW5jdGlvbiBkZWNvZGVVdGY4Q2hhciAoc3RyKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHIpXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4RkZGRCkgLy8gVVRGIDggaW52YWxpZCBjaGFyXG4gIH1cbn1cblxuLypcbiAqIFdlIGhhdmUgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHZhbHVlIGlzIGEgdmFsaWQgaW50ZWdlci4gVGhpcyBtZWFucyB0aGF0IGl0XG4gKiBpcyBub24tbmVnYXRpdmUuIEl0IGhhcyBubyBmcmFjdGlvbmFsIGNvbXBvbmVudCBhbmQgdGhhdCBpdCBkb2VzIG5vdFxuICogZXhjZWVkIHRoZSBtYXhpbXVtIGFsbG93ZWQgdmFsdWUuXG4gKi9cbmZ1bmN0aW9uIHZlcmlmdWludCAodmFsdWUsIG1heCkge1xuICBhc3NlcnQodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJywgJ2Nhbm5vdCB3cml0ZSBhIG5vbi1udW1iZXIgYXMgYSBudW1iZXInKVxuICBhc3NlcnQodmFsdWUgPj0gMCwgJ3NwZWNpZmllZCBhIG5lZ2F0aXZlIHZhbHVlIGZvciB3cml0aW5nIGFuIHVuc2lnbmVkIHZhbHVlJylcbiAgYXNzZXJ0KHZhbHVlIDw9IG1heCwgJ3ZhbHVlIGlzIGxhcmdlciB0aGFuIG1heGltdW0gdmFsdWUgZm9yIHR5cGUnKVxuICBhc3NlcnQoTWF0aC5mbG9vcih2YWx1ZSkgPT09IHZhbHVlLCAndmFsdWUgaGFzIGEgZnJhY3Rpb25hbCBjb21wb25lbnQnKVxufVxuXG5mdW5jdGlvbiB2ZXJpZnNpbnQgKHZhbHVlLCBtYXgsIG1pbikge1xuICBhc3NlcnQodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJywgJ2Nhbm5vdCB3cml0ZSBhIG5vbi1udW1iZXIgYXMgYSBudW1iZXInKVxuICBhc3NlcnQodmFsdWUgPD0gbWF4LCAndmFsdWUgbGFyZ2VyIHRoYW4gbWF4aW11bSBhbGxvd2VkIHZhbHVlJylcbiAgYXNzZXJ0KHZhbHVlID49IG1pbiwgJ3ZhbHVlIHNtYWxsZXIgdGhhbiBtaW5pbXVtIGFsbG93ZWQgdmFsdWUnKVxuICBhc3NlcnQoTWF0aC5mbG9vcih2YWx1ZSkgPT09IHZhbHVlLCAndmFsdWUgaGFzIGEgZnJhY3Rpb25hbCBjb21wb25lbnQnKVxufVxuXG5mdW5jdGlvbiB2ZXJpZklFRUU3NTQgKHZhbHVlLCBtYXgsIG1pbikge1xuICBhc3NlcnQodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJywgJ2Nhbm5vdCB3cml0ZSBhIG5vbi1udW1iZXIgYXMgYSBudW1iZXInKVxuICBhc3NlcnQodmFsdWUgPD0gbWF4LCAndmFsdWUgbGFyZ2VyIHRoYW4gbWF4aW11bSBhbGxvd2VkIHZhbHVlJylcbiAgYXNzZXJ0KHZhbHVlID49IG1pbiwgJ3ZhbHVlIHNtYWxsZXIgdGhhbiBtaW5pbXVtIGFsbG93ZWQgdmFsdWUnKVxufVxuXG5mdW5jdGlvbiBhc3NlcnQgKHRlc3QsIG1lc3NhZ2UpIHtcbiAgaWYgKCF0ZXN0KSB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSB8fCAnRmFpbGVkIGFzc2VydGlvbicpXG59XG5cbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXGJ1ZmZlclxcXFxpbmRleC5qc1wiLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxidWZmZXJcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5leHBvcnRzLnJlYWQgPSBmdW5jdGlvbiAoYnVmZmVyLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykge1xuICB2YXIgZSwgbVxuICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxXG4gIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxXG4gIHZhciBlQmlhcyA9IGVNYXggPj4gMVxuICB2YXIgbkJpdHMgPSAtN1xuICB2YXIgaSA9IGlzTEUgPyAobkJ5dGVzIC0gMSkgOiAwXG4gIHZhciBkID0gaXNMRSA/IC0xIDogMVxuICB2YXIgcyA9IGJ1ZmZlcltvZmZzZXQgKyBpXVxuXG4gIGkgKz0gZFxuXG4gIGUgPSBzICYgKCgxIDw8ICgtbkJpdHMpKSAtIDEpXG4gIHMgPj49ICgtbkJpdHMpXG4gIG5CaXRzICs9IGVMZW5cbiAgZm9yICg7IG5CaXRzID4gMDsgZSA9IChlICogMjU2KSArIGJ1ZmZlcltvZmZzZXQgKyBpXSwgaSArPSBkLCBuQml0cyAtPSA4KSB7fVxuXG4gIG0gPSBlICYgKCgxIDw8ICgtbkJpdHMpKSAtIDEpXG4gIGUgPj49ICgtbkJpdHMpXG4gIG5CaXRzICs9IG1MZW5cbiAgZm9yICg7IG5CaXRzID4gMDsgbSA9IChtICogMjU2KSArIGJ1ZmZlcltvZmZzZXQgKyBpXSwgaSArPSBkLCBuQml0cyAtPSA4KSB7fVxuXG4gIGlmIChlID09PSAwKSB7XG4gICAgZSA9IDEgLSBlQmlhc1xuICB9IGVsc2UgaWYgKGUgPT09IGVNYXgpIHtcbiAgICByZXR1cm4gbSA/IE5hTiA6ICgocyA/IC0xIDogMSkgKiBJbmZpbml0eSlcbiAgfSBlbHNlIHtcbiAgICBtID0gbSArIE1hdGgucG93KDIsIG1MZW4pXG4gICAgZSA9IGUgLSBlQmlhc1xuICB9XG4gIHJldHVybiAocyA/IC0xIDogMSkgKiBtICogTWF0aC5wb3coMiwgZSAtIG1MZW4pXG59XG5cbmV4cG9ydHMud3JpdGUgPSBmdW5jdGlvbiAoYnVmZmVyLCB2YWx1ZSwgb2Zmc2V0LCBpc0xFLCBtTGVuLCBuQnl0ZXMpIHtcbiAgdmFyIGUsIG0sIGNcbiAgdmFyIGVMZW4gPSAobkJ5dGVzICogOCkgLSBtTGVuIC0gMVxuICB2YXIgZU1heCA9ICgxIDw8IGVMZW4pIC0gMVxuICB2YXIgZUJpYXMgPSBlTWF4ID4+IDFcbiAgdmFyIHJ0ID0gKG1MZW4gPT09IDIzID8gTWF0aC5wb3coMiwgLTI0KSAtIE1hdGgucG93KDIsIC03NykgOiAwKVxuICB2YXIgaSA9IGlzTEUgPyAwIDogKG5CeXRlcyAtIDEpXG4gIHZhciBkID0gaXNMRSA/IDEgOiAtMVxuICB2YXIgcyA9IHZhbHVlIDwgMCB8fCAodmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMCkgPyAxIDogMFxuXG4gIHZhbHVlID0gTWF0aC5hYnModmFsdWUpXG5cbiAgaWYgKGlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA9PT0gSW5maW5pdHkpIHtcbiAgICBtID0gaXNOYU4odmFsdWUpID8gMSA6IDBcbiAgICBlID0gZU1heFxuICB9IGVsc2Uge1xuICAgIGUgPSBNYXRoLmZsb29yKE1hdGgubG9nKHZhbHVlKSAvIE1hdGguTE4yKVxuICAgIGlmICh2YWx1ZSAqIChjID0gTWF0aC5wb3coMiwgLWUpKSA8IDEpIHtcbiAgICAgIGUtLVxuICAgICAgYyAqPSAyXG4gICAgfVxuICAgIGlmIChlICsgZUJpYXMgPj0gMSkge1xuICAgICAgdmFsdWUgKz0gcnQgLyBjXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlICs9IHJ0ICogTWF0aC5wb3coMiwgMSAtIGVCaWFzKVxuICAgIH1cbiAgICBpZiAodmFsdWUgKiBjID49IDIpIHtcbiAgICAgIGUrK1xuICAgICAgYyAvPSAyXG4gICAgfVxuXG4gICAgaWYgKGUgKyBlQmlhcyA+PSBlTWF4KSB7XG4gICAgICBtID0gMFxuICAgICAgZSA9IGVNYXhcbiAgICB9IGVsc2UgaWYgKGUgKyBlQmlhcyA+PSAxKSB7XG4gICAgICBtID0gKCh2YWx1ZSAqIGMpIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKVxuICAgICAgZSA9IGUgKyBlQmlhc1xuICAgIH0gZWxzZSB7XG4gICAgICBtID0gdmFsdWUgKiBNYXRoLnBvdygyLCBlQmlhcyAtIDEpICogTWF0aC5wb3coMiwgbUxlbilcbiAgICAgIGUgPSAwXG4gICAgfVxuICB9XG5cbiAgZm9yICg7IG1MZW4gPj0gODsgYnVmZmVyW29mZnNldCArIGldID0gbSAmIDB4ZmYsIGkgKz0gZCwgbSAvPSAyNTYsIG1MZW4gLT0gOCkge31cblxuICBlID0gKGUgPDwgbUxlbikgfCBtXG4gIGVMZW4gKz0gbUxlblxuICBmb3IgKDsgZUxlbiA+IDA7IGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGUgJiAweGZmLCBpICs9IGQsIGUgLz0gMjU2LCBlTGVuIC09IDgpIHt9XG5cbiAgYnVmZmVyW29mZnNldCArIGkgLSBkXSB8PSBzICogMTI4XG59XG5cbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvLi5cXFxcLi5cXFxcbm9kZV9tb2R1bGVzXFxcXGllZWU3NTRcXFxcaW5kZXguanNcIixcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxcaWVlZTc1NFwiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcbi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxuXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbnByb2Nlc3MubmV4dFRpY2sgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBjYW5TZXRJbW1lZGlhdGUgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5zZXRJbW1lZGlhdGU7XG4gICAgdmFyIGNhblBvc3QgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5wb3N0TWVzc2FnZSAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lclxuICAgIDtcblxuICAgIGlmIChjYW5TZXRJbW1lZGlhdGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChmKSB7IHJldHVybiB3aW5kb3cuc2V0SW1tZWRpYXRlKGYpIH07XG4gICAgfVxuXG4gICAgaWYgKGNhblBvc3QpIHtcbiAgICAgICAgdmFyIHF1ZXVlID0gW107XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICB2YXIgc291cmNlID0gZXYuc291cmNlO1xuICAgICAgICAgICAgaWYgKChzb3VyY2UgPT09IHdpbmRvdyB8fCBzb3VyY2UgPT09IG51bGwpICYmIGV2LmRhdGEgPT09ICdwcm9jZXNzLXRpY2snKSB7XG4gICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBuZXh0VGljayhmbikge1xuICAgICAgICAgICAgcXVldWUucHVzaChmbik7XG4gICAgICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2UoJ3Byb2Nlc3MtdGljaycsICcqJyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG5leHRUaWNrKGZuKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZm4sIDApO1xuICAgIH07XG59KSgpO1xuXG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn1cblxuLy8gVE9ETyhzaHR5bG1hbilcbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiLy4uXFxcXC4uXFxcXG5vZGVfbW9kdWxlc1xcXFxwcm9jZXNzXFxcXGJyb3dzZXIuanNcIixcIi8uLlxcXFwuLlxcXFxub2RlX21vZHVsZXNcXFxccHJvY2Vzc1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQXNrRGlhbG9nID0gZXhwb3J0cy5Bc2tEaWFsb2dQcm9wcyA9IHZvaWQgMDtcclxudmFyIHJhbmRvbV8xID0gcmVxdWlyZShcIi4uL3V0aWwvcmFuZG9tXCIpO1xyXG52YXIgQXNrRGlhbG9nUHJvcHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBc2tEaWFsb2dQcm9wcygpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBBc2tEaWFsb2dQcm9wcztcclxufSgpKTtcclxuZXhwb3J0cy5Bc2tEaWFsb2dQcm9wcyA9IEFza0RpYWxvZ1Byb3BzO1xyXG52YXIgQXNrRGlhbG9nID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQXNrRGlhbG9nKHByb3BzKSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcyA9IHByb3BzO1xyXG4gICAgfVxyXG4gICAgQXNrRGlhbG9nLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGFsbG93QnV0dG9uSWQgPSBcImFsbG93LVwiICsgcmFuZG9tXzEucmFuZG9tU2Vzc29uSWQoKTtcclxuICAgICAgICB2YXIgZGVueUJ1dHRvbklkID0gXCJkZW55LVwiICsgcmFuZG9tXzEucmFuZG9tU2Vzc29uSWQoKTtcclxuICAgICAgICB2YXIgY29udGVudCA9IHRoaXMucHJvcHMubWVzc2FnZSArIFwiXFxuICAgICAgICAgICAgPHA+XFxuICAgICAgICAgICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIGlkPVxcXCJcIiArIGFsbG93QnV0dG9uSWQgKyBcIlxcXCIgY2xhc3M9XFxcImJ0biBidG4tc21cXFwiPkFjY2VwdDwvYnV0dG9uPlxcbiAgICAgICAgICAgICAgICA8YSBocmVmPVxcXCIjXFxcIiBpZD1cXFwiXCIgKyBkZW55QnV0dG9uSWQgKyBcIlxcXCIgY2xhc3M9XFxcImJ0biBidG4tc21cXFwiPkRlbnk8L2J1dHRvbj5cXG4gICAgICAgICAgICA8L3A+XCI7XHJcbiAgICAgICAgJC50b2FzdCh7XHJcbiAgICAgICAgICAgIGhlYWRpbmc6IHRoaXMucHJvcHMudGl0bGUsXHJcbiAgICAgICAgICAgIHRleHQ6IGNvbnRlbnQsXHJcbiAgICAgICAgICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJ3NsaWRlJyxcclxuICAgICAgICAgICAgaGlkZUFmdGVyOiBmYWxzZSxcclxuICAgICAgICAgICAgYmdDb2xvcjogdGhpcy5wcm9wcy5pc1dhcm5pbmcgPyBcIiM4MDAwMDBcIiA6IFwiIzE2NDE1N1wiLFxyXG4gICAgICAgICAgICBpY29uOiB0aGlzLnByb3BzLmljb24sXHJcbiAgICAgICAgICAgIHN0YWNrOiA1LFxyXG4gICAgICAgICAgICBsb2FkZXI6IGZhbHNlLFxyXG4gICAgICAgICAgICBhZnRlclNob3duOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5hbGxvd0J1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhbGxvd0J1dHRvbklkKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmRlbnlCdXR0b25FbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGVueUJ1dHRvbklkKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLnJvb3QgPSAkKF90aGlzLmFsbG93QnV0dG9uRWxlbWVudCkuY2xvc2VzdChcIi5qcS10b2FzdC1zaW5nbGVcIilbMF07XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRhY2hIYW5kbGVycygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQXNrRGlhbG9nLnByb3RvdHlwZS5hdHRhY2hIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuYWxsb3dCdXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzLnByb3BzLmFsbG93Q2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLmFsbG93Q2FsbGJhY2soX3RoaXMucHJvcHMucGFyYW0pO1xyXG4gICAgICAgICAgICAoX3RoaXMucm9vdCkucmVtb3ZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5kZW55QnV0dG9uRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBfdGhpcy5wcm9wcy5kZW55Q2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucHJvcHMuZGVueUNhbGxiYWNrKF90aGlzLnByb3BzLnBhcmFtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKF90aGlzLnJvb3QpLnJlbW92ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBBc2tEaWFsb2c7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQXNrRGlhbG9nID0gQXNrRGlhbG9nO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Bc2tEaWFsb2cuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2NvbXBvbmVudHNcXFxcQXNrRGlhbG9nLmpzXCIsXCIvY29tcG9uZW50c1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xyXG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tKSB7XHJcbiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBmcm9tLmxlbmd0aCwgaiA9IHRvLmxlbmd0aDsgaSA8IGlsOyBpKyssIGorKylcclxuICAgICAgICB0b1tqXSA9IGZyb21baV07XHJcbiAgICByZXR1cm4gdG87XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5DaGF0dGluZ1dpZGdldCA9IGV4cG9ydHMuQ2hhdHRpbmdQYW5lbFByb3BzID0gdm9pZCAwO1xyXG52YXIgRmlsZVJlY2VpdmVyXzEgPSByZXF1aXJlKFwiLi4vZmlsZS9GaWxlUmVjZWl2ZXJcIik7XHJcbnZhciBGaWxlU2VuZGVyXzEgPSByZXF1aXJlKFwiLi4vZmlsZS9GaWxlU2VuZGVyXCIpO1xyXG52YXIgcmFuZG9tXzEgPSByZXF1aXJlKFwiLi4vdXRpbC9yYW5kb21cIik7XHJcbnZhciBzbmlwcGV0XzEgPSByZXF1aXJlKFwiLi4vdXRpbC9zbmlwcGV0XCIpO1xyXG52YXIgVGltZVV0aWxfMSA9IHJlcXVpcmUoXCIuLi91dGlsL1RpbWVVdGlsXCIpO1xyXG52YXIgQ2hhdHRpbmdQYW5lbFByb3BzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ2hhdHRpbmdQYW5lbFByb3BzKCkge1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIENoYXR0aW5nUGFuZWxQcm9wcztcclxufSgpKTtcclxuZXhwb3J0cy5DaGF0dGluZ1BhbmVsUHJvcHMgPSBDaGF0dGluZ1BhbmVsUHJvcHM7XHJcbnZhciBDaGF0dGluZ1dpZGdldCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENoYXR0aW5nV2lkZ2V0KCkge1xyXG4gICAgICAgIHRoaXMudW5yZWFkQ291bnQgPSAwO1xyXG4gICAgICAgIHRoaXMuaXNQcml2YXRlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5uYW1lQ29sb3JzID0gW107XHJcbiAgICAgICAgdGhpcy5yZW1haW5Db2xvcnMgPSBbXTtcclxuICAgICAgICB0aGlzLmZpbGVTZW5kaW5nUG9vbCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmZpbGVSZWNlaXZpbmdQb29sID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAocHJvcHMpIHtcclxuICAgICAgICB0aGlzLnByb3BzID0gcHJvcHM7XHJcbiAgICAgICAgdGhpcy5yb290ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzaWRlVG9vbGJhckNvbnRhaW5lclwiKTtcclxuICAgICAgICB0aGlzLmNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jaGF0LWNsb3NlLWJ1dHRvblwiKTtcclxuICAgICAgICB0aGlzLmlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NoYXQtaW5wdXQgI3VzZXJtc2dcIik7XHJcbiAgICAgICAgdGhpcy5zZW5kQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZW5kLWJ1dHRvblwiKTtcclxuICAgICAgICB0aGlzLmZpbGVzZW5kQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5maWxlLXNoYXJlLWJ1dHRvblwiKTtcclxuICAgICAgICB0aGlzLmZpbGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmaWxlLXNlbGVjdG9yXCIpO1xyXG4gICAgICAgIHRoaXMuZmlsZVNlbmRpbmdQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZmlsZS1zZW5kaW5nXCIpO1xyXG4gICAgICAgIHRoaXMucHJpdmF0ZVBhbmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjaGF0LXJlY2lwaWVudFwiKTtcclxuICAgICAgICB0aGlzLnByaXZhdGVMYWJlbEVsZW1lbnQgPSAkKHRoaXMucHJpdmF0ZVBhbmVsKS5maW5kKFwiPnNwYW5cIilbMF07XHJcbiAgICAgICAgdGhpcy5wcml2YXRlQ2xvc2VFbGVtZW50ID0gJCh0aGlzLnByaXZhdGVQYW5lbCkuZmluZChcIj5kaXZcIilbMF07XHJcbiAgICAgICAgdGhpcy5uYW1lQ29sb3JzLnB1c2goXCIjMDBiZmZmXCIpOyAvL2RlZXBza3libHVlXHJcbiAgICAgICAgdGhpcy5uYW1lQ29sb3JzLnB1c2goXCIjOWFjZDMyXCIpOyAvL3llbGxvd2dyZWVuXHJcbiAgICAgICAgdGhpcy5uYW1lQ29sb3JzLnB1c2goXCIjZDI2OTFlXCIpOyAvL2Nob2NvbGF0ZVxyXG4gICAgICAgIHRoaXMubmFtZUNvbG9ycy5wdXNoKFwiI2VlODJlZVwiKTsgLy92aW9sZXRcclxuICAgICAgICB0aGlzLm5hbWVDb2xvcnMucHVzaChcIiM2NDk1ZWRcIik7IC8vY29ybmZsb3dlcmJsdWVcclxuICAgICAgICB0aGlzLm5hbWVDb2xvcnMucHVzaChcIiNmZmQ3MDBcIik7IC8vZ29sZFxyXG4gICAgICAgIHRoaXMubmFtZUNvbG9ycy5wdXNoKFwiIzgwODAwMFwiKTsgLy9vbGl2ZVxyXG4gICAgICAgIHRoaXMubmFtZUNvbG9ycy5wdXNoKFwiI2NkODUzZlwiKTsgLy9wZXJ1XHJcbiAgICAgICAgdGhpcy5yZW1haW5Db2xvcnMgPSBfX3NwcmVhZEFycmF5KFtdLCB0aGlzLm5hbWVDb2xvcnMpO1xyXG4gICAgICAgIHRoaXMubmFtZUNvbG9yTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIHRoaXMuYXR0YWNoRXZlbnRIYW5kbGVycygpO1xyXG4gICAgICAgIHRoaXMub3Blbih0aGlzLm9wZW5lZCk7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLmF0dGFjaEV2ZW50SGFuZGxlcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzXzEgPSB0aGlzO1xyXG4gICAgICAgICQodGhpcy5jbG9zZUJ1dHRvbikub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpc18xLm9wZW4oZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy5pbnB1dEZpZWxkKS5rZXlwcmVzcyhmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoKGUua2V5Q29kZSB8fCBlLndoaWNoKSA9PSAxMykgeyAvL0VudGVyIGtleWNvZGVcclxuICAgICAgICAgICAgICAgIGlmICghZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpc18xLm9uU2VuZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLnNlbmRCdXR0b24pLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXNfMS5vblNlbmQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICQoXCIuc21pbGV5Q29udGFpbmVyXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGlkID0gJCh0aGlzKS5hdHRyKFwiaWRcIik7XHJcbiAgICAgICAgICAgIHZhciBpbW9uYW1lID0gX3RoaXMuaWRUb0Vtb25hbWUoaWQpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpbW9uYW1lKTtcclxuICAgICAgICAgICAgdmFyIHNlbmRlbCA9ICQoXCIjdXNlcm1zZ1wiKTtcclxuICAgICAgICAgICAgdmFyIHNtcyA9IHNlbmRlbC52YWwoKTtcclxuICAgICAgICAgICAgc21zICs9IGltb25hbWU7XHJcbiAgICAgICAgICAgIHNlbmRlbC52YWwoc21zKTtcclxuICAgICAgICAgICAgLy92YXIgZWwgPSAkKFwiLnNtaWxleXMtcGFuZWxcIik7XHJcbiAgICAgICAgICAgIC8vZWwucmVtb3ZlQ2xhc3MoXCJzaG93LXNtaWxleXNcIik7XHJcbiAgICAgICAgICAgIC8vZWwuYWRkQ2xhc3MoXCJoaWRlLXNtaWxleXNcIik7XHJcbiAgICAgICAgICAgIHNlbmRlbC5mb2N1cygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQoXCIjc21pbGV5c1wiKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBlbCA9ICQoXCIuc21pbGV5cy1wYW5lbFwiKTtcclxuICAgICAgICAgICAgaWYgKGVsLmhhc0NsYXNzKFwiaGlkZS1zbWlsZXlzXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5yZW1vdmVDbGFzcyhcImhpZGUtc21pbGV5c1wiKTtcclxuICAgICAgICAgICAgICAgIGVsLmFkZENsYXNzKFwic2hvdy1zbWlsZXlzXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWwucmVtb3ZlQ2xhc3MoXCJzaG93LXNtaWxleXNcIik7XHJcbiAgICAgICAgICAgICAgICBlbC5hZGRDbGFzcyhcImhpZGUtc21pbGV5c1wiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy5wcml2YXRlQ2xvc2VFbGVtZW50KS5jbGljayhmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICBfdGhpc18xLmNsZWFyUHJpdmF0ZVN0YXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLmZpbGVzZW5kQnV0dG9uKS5jbGljayhmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAkKF90aGlzXzEuZmlsZUVsZW1lbnQpLmNsaWNrKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLmZpbGVFbGVtZW50KS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICBfdGhpc18xLnNlbmRGaWxlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAob3BlbmVkKSB7XHJcbiAgICAgICAgaWYgKG9wZW5lZCkge1xyXG4gICAgICAgICAgICAkKFwiI3ZpZGVvLXBhbmVsXCIpLmFkZENsYXNzKFwic2hpZnQtcmlnaHRcIik7XHJcbiAgICAgICAgICAgICQoXCIjbmV3LXRvb2xib3hcIikuYWRkQ2xhc3MoXCJzaGlmdC1yaWdodFwiKTtcclxuICAgICAgICAgICAgJCh0aGlzLnJvb3QpLnJlbW92ZUNsYXNzKFwiaW52aXNpYmxlXCIpO1xyXG4gICAgICAgICAgICAkKHRoaXMuaW5wdXRGaWVsZCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgLy8kKFwiLnRvb2xib3gtaWNvblwiLCB0aGlzLnByb3BzLmNoYXRPcGVuQnV0dG9uKS5hZGRDbGFzcyhcInRvZ2dsZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAkKFwiI3ZpZGVvLXBhbmVsXCIpLnJlbW92ZUNsYXNzKFwic2hpZnQtcmlnaHRcIik7XHJcbiAgICAgICAgICAgICQoXCIjbmV3LXRvb2xib3hcIikucmVtb3ZlQ2xhc3MoXCJzaGlmdC1yaWdodFwiKTtcclxuICAgICAgICAgICAgJCh0aGlzLnJvb3QpLmFkZENsYXNzKFwiaW52aXNpYmxlXCIpO1xyXG4gICAgICAgICAgICAvLyQoXCIudG9vbGJveC1pY29uXCIsIHRoaXMucHJvcHMuY2hhdE9wZW5CdXR0b24pLnJlbW92ZUNsYXNzKFwidG9nZ2xlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51bnJlYWRDb3VudCA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5zaG93VW5yZWFkQmFkZ2UoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMub3BlbmVkID0gb3BlbmVkO1xyXG4gICAgICAgIHRoaXMucHJvcHMub3BlbkNhbGxiYWNrKCk7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLmNsZWFySW5wdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCh0aGlzLmlucHV0RmllbGQpLnZhbCgnJyk7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLnRvZ2dsZU9wZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuZWQgPSAhdGhpcy5vcGVuZWQ7XHJcbiAgICAgICAgdGhpcy5vcGVuKHRoaXMub3BlbmVkKTtcclxuICAgIH07XHJcbiAgICBDaGF0dGluZ1dpZGdldC5wcm90b3R5cGUub25TZW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBtc2cgPSAkKHRoaXMuaW5wdXRGaWVsZCkudmFsKCkudG9TdHJpbmcoKS50cmltKCk7XHJcbiAgICAgICAgdGhpcy5jbGVhcklucHV0KCk7XHJcbiAgICAgICAgaWYgKCFtc2cpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICBtc2cgPSB0aGlzLmVtb25hbWVUb0Vtb2ljb24obXNnKTtcclxuICAgICAgICB2YXIgdGltZSA9IFRpbWVVdGlsXzEuZ2V0Q3VyVGltZSgpO1xyXG4gICAgICAgIHZhciBwcml2YXRlQ2xhc3MgPSB0aGlzLmlzUHJpdmF0ZSA/IFwicHJpdmF0ZVwiIDogXCJcIjtcclxuICAgICAgICB2YXIgcHJpdmF0ZURldGFpbCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNQcml2YXRlKSB7XHJcbiAgICAgICAgICAgIHByaXZhdGVEZXRhaWwgPSBcIjxkaXYgc3R5bGU9XFxcImNvbG9yOiM3Nzg4OTlcXFwiPnByaXZhdGU6IFwiICsgdGhpcy5wcml2YXRlU2VuZGVyTmFtZSArIFwiPC9kaXY+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBlbCA9ICQoXCIuc21pbGV5cy1wYW5lbFwiKTtcclxuICAgICAgICBlbC5yZW1vdmVDbGFzcyhcInNob3ctc21pbGV5c1wiKTtcclxuICAgICAgICBlbC5hZGRDbGFzcyhcImhpZGUtc21pbGV5c1wiKTtcclxuICAgICAgICB2YXIgc2VsID0gJChcIiNjaGF0Y29udmVyc2F0aW9uIGRpdi5jaGF0LW1lc3NhZ2UtZ3JvdXA6bGFzdC1jaGlsZFwiKTtcclxuICAgICAgICBpZiAoc2VsLmhhc0NsYXNzKFwibG9jYWxcIikpIHtcclxuICAgICAgICAgICAgc2VsLmZpbmQoXCIudGltZXN0YW1wXCIpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBzZWwuYXBwZW5kKFwiPGRpdiBjbGFzcz0gXFxcImNoYXRtZXNzYWdlLXdyYXBwZXJcXFwiID4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2hhdG1lc3NhZ2UgXCIgKyBwcml2YXRlQ2xhc3MgKyBcIlxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJyZXBseXdyYXBwZXJcXFwiPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1lc3NhZ2Vjb250ZW50XFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwidXNlcm1lc3NhZ2VcXFwiPiBcIiArIG1zZyArIFwiIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIiArIHByaXZhdGVEZXRhaWwgKyBcIlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ0aW1lc3RhbXBcXFwiPiBcIiArIHRpbWUgKyBcIiA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgICA8L2RpdiA+XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgJChcIiNjaGF0Y29udmVyc2F0aW9uXCIpLmFwcGVuZChcIjxkaXYgY2xhc3M9XFxcImNoYXQtbWVzc2FnZS1ncm91cCBsb2NhbFxcXCI+ICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0gXFxcImNoYXRtZXNzYWdlLXdyYXBwZXJcXFwiID4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjaGF0bWVzc2FnZSBcIiArIHByaXZhdGVDbGFzcyArIFwiXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmVwbHl3cmFwcGVyXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcIm1lc3NhZ2Vjb250ZW50XFxcIj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ1c2VybWVzc2FnZVxcXCI+IFwiICsgbXNnICsgXCIgPC9kaXY+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIgKyBwcml2YXRlRGV0YWlsICsgXCJcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ0aW1lc3RhbXBcXFwiPiBcIiArIHRpbWUgKyBcIiA8L2Rpdj4gICAgICAgICAgICAgICAgICAgIDwvZGl2ID4gICAgICAgICAgICAgICAgPC9kaXY+XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNQcml2YXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcHMuc2VuZFByaXZhdGVDaGF0KHRoaXMucHJpdmF0ZVNlbmRlcklkLCBtc2cpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9wcy5zZW5kQ2hhdChtc2cpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvL2NoYXRcclxuICAgIENoYXR0aW5nV2lkZ2V0LnByb3RvdHlwZS5yZWNlaXZlTWVzc2FnZSA9IGZ1bmN0aW9uIChpZCwgdXNlcm5hbWUsIG1lc3NhZ2UsIGlzUHJpdmF0ZSkge1xyXG4gICAgICAgIGlmIChpc1ByaXZhdGUgPT09IHZvaWQgMCkgeyBpc1ByaXZhdGUgPSBmYWxzZTsgfVxyXG4gICAgICAgIC8vdXBkYXRlIHVucmVhZCBjb3VudFxyXG4gICAgICAgIGlmICghdGhpcy5vcGVuZWQpIHtcclxuICAgICAgICAgICAgdGhpcy51bnJlYWRDb3VudCsrO1xyXG4gICAgICAgICAgICB0aGlzLnByb3BzLnNldFVucmVhZENvdW50KHRoaXMudW5yZWFkQ291bnQpO1xyXG4gICAgICAgICAgICB0aGlzLnByb3BzLnNob3dVbnJlYWRCYWRnZSh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy91cGRhdGUgdWlcclxuICAgICAgICB2YXIgZW1vTWVzc2FnZSA9IHRoaXMuZW1vbmFtZVRvRW1vaWNvbihtZXNzYWdlKTtcclxuICAgICAgICB2YXIgbmFtZUNvbG9yID0gdGhpcy5nZXROYW1lQ29sb3IodXNlcm5hbWUpO1xyXG4gICAgICAgIHZhciBwcml2YXRlQ2xhc3MgPSBpc1ByaXZhdGUgPyBcInByaXZhdGVcIiA6IFwiXCI7XHJcbiAgICAgICAgdmFyIHJlcGx5RWxlbSA9IFwiXCI7XHJcbiAgICAgICAgaWYgKGlzUHJpdmF0ZSkge1xyXG4gICAgICAgICAgICByZXBseUVsZW0gPSBcIlxcbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwiaml0c2ktaWNvblxcXCIgaml0c2ktaWQ9XFxcIlwiICsgaWQgKyBcIlxcXCIgaml0c2ktbmFtZT1cXFwiXCIgKyB1c2VybmFtZSArIFwiXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDxzdmcgaGVpZ2h0PVxcXCIyMlxcXCIgd2lkdGg9XFxcIjIyXFxcIiB2aWV3Qm94PVxcXCIwIDAgMzYgMzZcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9XFxcIk0zMCwyOWExLDEsMCwwLDEtLjgxLS40MWwtMi4xMi0yLjkyQTE4LjY2LDE4LjY2LDAsMCwwLDE1LDE4LjI1VjIyYTEsMSwwLDAsMS0xLjYuOGwtMTItOWExLDEsMCwwLDEsMC0xLjZsMTItOUExLDEsMCwwLDEsMTUsNFY4LjI0QTE5LDE5LDAsMCwxLDMxLDI3djFhMSwxLDAsMCwxLS42OS45NUExLjEyLDEuMTIsMCwwLDEsMzAsMjlaTTE0LDE2LjExaC4xQTIwLjY4LDIwLjY4LDAsMCwxLDI4LjY5LDI0LjVsLjE2LjIxYTE3LDE3LDAsMCwwLTE1LTE0LjYsMSwxLDAsMCwxLS44OS0xVjZMMy42NywxMywxMywyMFYxNy4xMWExLDEsMCwwLDEsLjMzLS43NEExLDEsMCwwLDEsMTQsMTYuMTFaXFxcIj48L3BhdGg+XFxuICAgICAgICAgICAgICAgICAgICA8L3N2Zz5cXG4gICAgICAgICAgICAgICAgPC9zcGFuPlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgJGNoYXRpdGVtID0gJChcIjxkaXYgY2xhc3M9XFxcImNoYXQtbWVzc2FnZS1ncm91cCByZW1vdGVcXFwiPiAgICAgICAgIDxkaXYgY2xhc3M9IFxcXCJjaGF0bWVzc2FnZS13cmFwcGVyXFxcIiA+ICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImNoYXRtZXNzYWdlIFwiICsgcHJpdmF0ZUNsYXNzICsgXCJcXFwiPiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmVwbHl3cmFwcGVyXFxcIj4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlY29udGVudFxcXCI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpc3BsYXktbmFtZVxcXCIgc3R5bGU9XFxcImNvbG9yOlwiICsgbmFtZUNvbG9yICsgXCJcXFwiPlwiICsgdXNlcm5hbWUgKyByZXBseUVsZW0gKyAnPC9kaXY+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidXNlcm1lc3NhZ2VcIj4nICsgZW1vTWVzc2FnZSArICc8L2Rpdj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lc3RhbXBcIj4nICsgVGltZVV0aWxfMS5nZXRDdXJUaW1lKCkgKyAnPC9kaXY+XFxcbiAgICAgICAgICAgIDwvZGl2ID5cXFxuICAgICAgICA8L2Rpdj4nKTtcclxuICAgICAgICAkKFwiI2NoYXRjb252ZXJzYXRpb25cIikuYXBwZW5kKCRjaGF0aXRlbSk7XHJcbiAgICAgICAgaWYgKGlzUHJpdmF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXNfMiA9IHRoaXM7XHJcbiAgICAgICAgICAgICRjaGF0aXRlbS5maW5kKFwiLmppdHNpLWljb25cIikuY2xpY2soZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZCA9ICQodGhpcykuYXR0cihcImppdHNpLWlkXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSAkKHRoaXMpLmF0dHIoXCJqaXRzaS1uYW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXNfMi5zZXRQcml2YXRlU3RhdGUoaWQsIG5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xyXG4gICAgICAgIGlmIChpc1ByaXZhdGUpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJpdmF0ZVN0YXRlKGlkLCB1c2VybmFtZSk7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLnNjcm9sbFRvQm90dG9tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBvdmVyaGVpZ2h0ID0gMDtcclxuICAgICAgICAkKFwiLmNoYXQtbWVzc2FnZS1ncm91cFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgb3ZlcmhlaWdodCArPSAkKHRoaXMpLmhlaWdodCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciBsaW1pdCA9ICQoJyNjaGF0Y29udmVyc2F0aW9uJykuaGVpZ2h0KCk7XHJcbiAgICAgICAgdmFyIHBvcyA9IG92ZXJoZWlnaHQgLSBsaW1pdDtcclxuICAgICAgICAkKFwiI2NoYXRjb252ZXJzYXRpb25cIikuYW5pbWF0ZSh7IHNjcm9sbFRvcDogcG9zIH0sIDIwMCk7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLmlkVG9FbW9uYW1lID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXkxJylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5iDJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTInKVxyXG4gICAgICAgICAgICByZXR1cm4gJ/CfmKYnO1xyXG4gICAgICAgIGlmIChpZCA9PSAnc21pbGV5MycpXHJcbiAgICAgICAgICAgIHJldHVybiAn8J+YhCc7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXk0JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5GNJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTUnKVxyXG4gICAgICAgICAgICByZXR1cm4gJ/CfmJsnO1xyXG4gICAgICAgIGlmIChpZCA9PSAnc21pbGV5NicpXHJcbiAgICAgICAgICAgIHJldHVybiAn8J+Riyc7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXk3JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5iKJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTgnKVxyXG4gICAgICAgICAgICByZXR1cm4gJ/CfmYInO1xyXG4gICAgICAgIGlmIChpZCA9PSAnc21pbGV5OScpXHJcbiAgICAgICAgICAgIHJldHVybiAn8J+YsSc7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXkxMCcpXHJcbiAgICAgICAgICAgIHJldHVybiAn8J+Ylyc7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXkxMScpXHJcbiAgICAgICAgICAgIHJldHVybiAn8J+Rjic7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXkxMicpXHJcbiAgICAgICAgICAgIHJldHVybiAn8J+UjSc7XHJcbiAgICAgICAgaWYgKGlkID09ICdzbWlsZXkxMycpXHJcbiAgICAgICAgICAgIHJldHVybiAn4p2k77iPJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTE0JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5iHJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTE1JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5igJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTE2JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5G8JztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTE3JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5itJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTE4JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5GPJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTE5JylcclxuICAgICAgICAgICAgcmV0dXJuICfwn5iJJztcclxuICAgICAgICBpZiAoaWQgPT0gJ3NtaWxleTIwJylcclxuICAgICAgICAgICAgcmV0dXJuICfwn426JztcclxuICAgIH07XHJcbiAgICBDaGF0dGluZ1dpZGdldC5wcm90b3R5cGUuZW1vbmFtZVRvRW1vaWNvbiA9IGZ1bmN0aW9uIChzbXMpIHtcclxuICAgICAgICB2YXIgc21zb3V0ID0gc21zO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6KScsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiIHN0eWxlPVwid2lkdGg6IDIwcHg7IGhlaWdodDoyMHB4O1wiPvCfmIM8L3NwYW4+Jyk7XHJcbiAgICAgICAgc21zb3V0ID0gc21zb3V0LnJlcGxhY2UoJzooJywgJzxzcGFuIGNsYXNzPVwic21pbGV5XCI+8J+Ypjwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOkQnLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5iEPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6KzE6JywgJzxzcGFuIGNsYXNzPVwic21pbGV5XCI+8J+RjTwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOlAnLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5ibPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6d2F2ZTonLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5GLPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6Ymx1c2g6JywgJzxzcGFuIGNsYXNzPVwic21pbGV5XCI+8J+Yijwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOnNsaWdodGx5X3NtaWxpbmdfZmFjZTonLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5mCPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6c2NyZWFtOicsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiPvCfmLE8L3NwYW4+Jyk7XHJcbiAgICAgICAgc21zb3V0ID0gc21zb3V0LnJlcGxhY2UoJzoqJywgJzxzcGFuIGNsYXNzPVwic21pbGV5XCI+8J+Ylzwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOi0xOicsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiPvCfkY48L3NwYW4+Jyk7XHJcbiAgICAgICAgc21zb3V0ID0gc21zb3V0LnJlcGxhY2UoJzptYWc6JywgJzxzcGFuIGNsYXNzPVwic21pbGV5XCI+8J+UjTwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOmhlYXJ0OicsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiPuKdpO+4jzwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOmlubm9jZW50OicsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiPvCfmIc8L3NwYW4+Jyk7XHJcbiAgICAgICAgc21zb3V0ID0gc21zb3V0LnJlcGxhY2UoJzphbmdyeTonLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5igPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6YW5nZWw6JywgJzxzcGFuIGNsYXNzPVwic21pbGV5XCI+8J+RvDwvc3Bhbj4nKTtcclxuICAgICAgICBzbXNvdXQgPSBzbXNvdXQucmVwbGFjZSgnOygnLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5itPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc6Y2xhcDonLCAnPHNwYW4gY2xhc3M9XCJzbWlsZXlcIj7wn5GPPC9zcGFuPicpO1xyXG4gICAgICAgIHNtc291dCA9IHNtc291dC5yZXBsYWNlKCc7KScsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiPvCfmIk8L3NwYW4+Jyk7XHJcbiAgICAgICAgc21zb3V0ID0gc21zb3V0LnJlcGxhY2UoJzpiZWVyOicsICc8c3BhbiBjbGFzcz1cInNtaWxleVwiPvCfjbo8L3NwYW4+Jyk7XHJcbiAgICAgICAgcmV0dXJuIHNtc291dDtcclxuICAgIH07XHJcbiAgICBDaGF0dGluZ1dpZGdldC5wcm90b3R5cGUuZ2V0TmFtZUNvbG9yID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5uYW1lQ29sb3JNYXAuaGFzKG5hbWUpKVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lQ29sb3JNYXAuZ2V0KG5hbWUpO1xyXG4gICAgICAgIGlmICh0aGlzLnJlbWFpbkNvbG9ycy5sZW5ndGggPD0gMClcclxuICAgICAgICAgICAgdGhpcy5yZW1haW5Db2xvcnMgPSBfX3NwcmVhZEFycmF5KFtdLCB0aGlzLm5hbWVDb2xvcnMpO1xyXG4gICAgICAgIC8vW21pbiwgbWF4KVxyXG4gICAgICAgIHZhciByYW5kSW5kZXggPSBzbmlwcGV0XzEucmFuZG9tKDAsIHRoaXMucmVtYWluQ29sb3JzLmxlbmd0aCk7XHJcbiAgICAgICAgdmFyIHJhbmRvbUNvbG9yID0gdGhpcy5yZW1haW5Db2xvcnNbcmFuZEluZGV4XTtcclxuICAgICAgICB0aGlzLnJlbWFpbkNvbG9ycy5zcGxpY2UocmFuZEluZGV4LCAxKTtcclxuICAgICAgICB0aGlzLm5hbWVDb2xvck1hcC5zZXQobmFtZSwgcmFuZG9tQ29sb3IpO1xyXG4gICAgICAgIHJldHVybiByYW5kb21Db2xvcjtcclxuICAgIH07XHJcbiAgICBDaGF0dGluZ1dpZGdldC5wcm90b3R5cGUuc2V0UHJpdmF0ZVN0YXRlID0gZnVuY3Rpb24gKGppdHNpSWQsIG5hbWUpIHtcclxuICAgICAgICB0aGlzLmlzUHJpdmF0ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5wcml2YXRlU2VuZGVySWQgPSBqaXRzaUlkO1xyXG4gICAgICAgIHRoaXMucHJpdmF0ZVNlbmRlck5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMucHJpdmF0ZVBhbmVsLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcclxuICAgICAgICB0aGlzLnByaXZhdGVMYWJlbEVsZW1lbnQuaW5uZXJIVE1MID0gXCJQcml2YXRlIG1lc3NhZ2UgdG8gXCIgKyBuYW1lO1xyXG4gICAgfTtcclxuICAgIENoYXR0aW5nV2lkZ2V0LnByb3RvdHlwZS5jbGVhclByaXZhdGVTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmlzUHJpdmF0ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucHJpdmF0ZVNlbmRlcklkID0gbnVsbDtcclxuICAgICAgICB0aGlzLnByaXZhdGVQYW5lbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICB9O1xyXG4gICAgQ2hhdHRpbmdXaWRnZXQucHJvdG90eXBlLnNlbmRGaWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwcm9wcyA9IG5ldyBGaWxlU2VuZGVyXzEuRmlsZVNlbmRlclByb3BzKCk7XHJcbiAgICAgICAgcHJvcHMuZmlsZUVsZW1lbnQgPSB0aGlzLmZpbGVFbGVtZW50O1xyXG4gICAgICAgIHByb3BzLmZpbGVTZW5kaW5nUGFuZWwgPSB0aGlzLmZpbGVTZW5kaW5nUGFuZWw7XHJcbiAgICAgICAgcHJvcHMuc2Vzc2lvbklkID0gcmFuZG9tXzEucmFuZG9tU2Vzc29uSWQoKTtcclxuICAgICAgICBwcm9wcy5vbkVycm9yID0gdGhpcy5wcm9wcy5vbkZpbGVTZW5kRXJycm9yO1xyXG4gICAgICAgIHByb3BzLm9uRmluaXNoZWQgPSB0aGlzLnByb3BzLm9uRmlsZVNlbmRGaW5pc2hlZDtcclxuICAgICAgICBwcm9wcy5zZW5kRmlsZURhdGEgPSB0aGlzLnByb3BzLnNlbmRGaWxlRGF0YTtcclxuICAgICAgICBwcm9wcy5zZW5kRmlsZU1ldGEgPSB0aGlzLnByb3BzLnNlbmRGaWxlTWV0YTtcclxuICAgICAgICAvL3Byb3BzLmFkZENoYXRJdGVtID0gdGhpcy5vblNlbmQuYmluZCh0aGlzKTsgLy9hZGRlZCBtYXR2ZXlcclxuICAgICAgICB2YXIgZmlsZVNlbmRlciA9IG5ldyBGaWxlU2VuZGVyXzEuRmlsZVNlbmRlcihwcm9wcyk7XHJcbiAgICAgICAgZmlsZVNlbmRlci5zZW5kRmlsZSgpO1xyXG4gICAgfTtcclxuICAgIENoYXR0aW5nV2lkZ2V0LnByb3RvdHlwZS5vbkZpbGVNZXRhID0gZnVuY3Rpb24gKHNlc3Npb25JZCwgbWV0YSwgc2VuZGVySWQsIHNlbmRlck5hbWUpIHtcclxuICAgICAgICB2YXIgcHJvcHMgPSBuZXcgRmlsZVJlY2VpdmVyXzEuRmlsZVJlY2VpdmVyUHJvcHMoKTtcclxuICAgICAgICBwcm9wcy5tZXRhID0gbWV0YTtcclxuICAgICAgICBwcm9wcy5zZW5kZXJJZCA9IHNlbmRlcklkO1xyXG4gICAgICAgIHByb3BzLnNlbmRlck5hbWUgPSBzZW5kZXJOYW1lO1xyXG4gICAgICAgIHByb3BzLm9uRmluaXNoZWQgPSB0aGlzLm9uRmlsZVJlY2VpdmVGaW5pc2hlZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHByb3BzLm9uRXJyb3IgPSB0aGlzLm9uRmlsZVJlY2VpdmVFcnJvci5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHByb3BzLmFkZENoYXRJdGVtID0gdGhpcy5yZWNlaXZlTWVzc2FnZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHZhciByZWNlaXZlciA9IG5ldyBGaWxlUmVjZWl2ZXJfMS5GaWxlUmVjZWl2ZXIocHJvcHMpO1xyXG4gICAgICAgIHRoaXMuZmlsZVJlY2VpdmluZ1Bvb2wuc2V0KHNlc3Npb25JZCwgcmVjZWl2ZXIpO1xyXG4gICAgICAgIHJlY2VpdmVyLnNob3coKTtcclxuICAgIH07XHJcbiAgICBDaGF0dGluZ1dpZGdldC5wcm90b3R5cGUub25GaWxlRGF0YSA9IGZ1bmN0aW9uIChzZXNzaW9uSWQsIGRhdGEpIHtcclxuICAgICAgICB2YXIgcmVjZWl2ZXIgPSB0aGlzLmZpbGVSZWNlaXZpbmdQb29sLmdldChzZXNzaW9uSWQpO1xyXG4gICAgICAgIGlmIChyZWNlaXZlcilcclxuICAgICAgICAgICAgcmVjZWl2ZXIucmVhZEZpbGVEYXRhKGRhdGEpO1xyXG4gICAgfTtcclxuICAgIENoYXR0aW5nV2lkZ2V0LnByb3RvdHlwZS5vbkZpbGVSZWNlaXZlRXJyb3IgPSBmdW5jdGlvbiAoc2Vzc2lvbklkLCBmaWxlbmFtZSwgbWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMuZmlsZVJlY2VpdmluZ1Bvb2wuZGVsZXRlKHNlc3Npb25JZCk7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbGVSZWNlaXZlRXJyb3IoZmlsZW5hbWUsIG1lc3NhZ2UpO1xyXG4gICAgfTtcclxuICAgIENoYXR0aW5nV2lkZ2V0LnByb3RvdHlwZS5vbkZpbGVSZWNlaXZlRmluaXNoZWQgPSBmdW5jdGlvbiAoc2Vzc2lvbklkLCBmaWxlbmFtZSwgbWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMuZmlsZVJlY2VpdmluZ1Bvb2wuZGVsZXRlKHNlc3Npb25JZCk7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkZpbGVSZWNlaXZlRmluaXNoZWQoZmlsZW5hbWUsIG1lc3NhZ2UpO1xyXG4gICAgfTtcclxuICAgIENoYXR0aW5nV2lkZ2V0LnByb3RvdHlwZS5vcGVuUHJpdmF0ZUNoYXQgPSBmdW5jdGlvbiAoaml0c2lJZCwgbmFtZSkge1xyXG4gICAgICAgIHRoaXMub3Blbih0cnVlKTtcclxuICAgICAgICB0aGlzLnNldFByaXZhdGVTdGF0ZShqaXRzaUlkLCBuYW1lKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ2hhdHRpbmdXaWRnZXQ7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQ2hhdHRpbmdXaWRnZXQgPSBDaGF0dGluZ1dpZGdldDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhdHRpbmdQYW5lbC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvY29tcG9uZW50c1xcXFxDaGF0dGluZ1BhbmVsLmpzXCIsXCIvY29tcG9uZW50c1wiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0ID0gdm9pZCAwO1xyXG52YXIgTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0KCkge1xyXG4gICAgICAgIC8vc3RhdGVcclxuICAgICAgICB0aGlzLmZpcnN0VXBkYXRlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnRpbWUgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuc3ViamVjdCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5yb290ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zdWJqZWN0XCIpO1xyXG4gICAgICAgIHRoaXMuc3ViamVjdEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnN1YmplY3QtdGV4dFwiKTtcclxuICAgICAgICB0aGlzLnRpbWVzdGFtcEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnN1YmplY3QtdGltZXJcIik7XHJcbiAgICB9XHJcbiAgICBNZWV0aW5nRGVzY3JpcHRpb25XaWRnZXQucHJvdG90eXBlLnVwZGF0ZVRpbWUgPSBmdW5jdGlvbiAodGltZSkge1xyXG4gICAgICAgIHRoaXMudGltZSA9IHRpbWUudHJpbSgpO1xyXG4gICAgICAgIHRoaXMudGltZXN0YW1wRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLnRpbWU7XHJcbiAgICAgICAgdGhpcy5zaG93T25Jbml0KCk7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0LnByb3RvdHlwZS5zZXRTdWJqZWN0ID0gZnVuY3Rpb24gKHN1YmplY3QsIGhvc3ROYW1lKSB7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0ID0gc3ViamVjdC50cmltKCk7XHJcbiAgICAgICAgdmFyIHN1YmplY3RMYWJlbCA9IHRoaXMuc3ViamVjdDtcclxuICAgICAgICBpZiAoaG9zdE5hbWUgJiYgaG9zdE5hbWUudHJpbSgpLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHN1YmplY3RMYWJlbCArPSBcIihcIiArIGhvc3ROYW1lLnRyaW0oKSArIFwiKVwiO1xyXG4gICAgICAgIHRoaXMuc3ViamVjdEVsZW1lbnQuaW5uZXJIVE1MID0gc3ViamVjdExhYmVsO1xyXG4gICAgICAgIHRoaXMuc2hvd09uSW5pdCgpO1xyXG4gICAgfTtcclxuICAgIE1lZXRpbmdEZXNjcmlwdGlvbldpZGdldC5wcm90b3R5cGUuc2hvd09uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5maXJzdFVwZGF0ZSAmJiB0aGlzLnRpbWUubGVuZ3RoID4gMCAmJiB0aGlzLnN1YmplY3QubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpcnN0VXBkYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZmFkZUluKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE1lZXRpbmdEZXNjcmlwdGlvbldpZGdldC5wcm90b3R5cGUuZmFkZUluID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcy5yb290KS5hZGRDbGFzcyhcInZpc2libGVcIik7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0LnByb3RvdHlwZS5mYWRlT3V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcy5yb290KS5yZW1vdmVDbGFzcyhcInZpc2libGVcIik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE1lZXRpbmdEZXNjcmlwdGlvbldpZGdldDtcclxufSgpKTtcclxuZXhwb3J0cy5NZWV0aW5nRGVzY3JpcHRpb25XaWRnZXQgPSBNZWV0aW5nRGVzY3JpcHRpb25XaWRnZXQ7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPU1lZXRpbmdEZXNjcmlwdGlvbldpZGdldC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvY29tcG9uZW50c1xcXFxNZWV0aW5nRGVzY3JpcHRpb25XaWRnZXQuanNcIixcIi9jb21wb25lbnRzXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5QYXJ0aWNpcGFudExpc3RXaWRnZXQgPSBleHBvcnRzLlBhcnRpY2lwYW50TGlzdFBhbmVsUHJvcHMgPSB2b2lkIDA7XHJcbnZhciBzbmlwcGV0XzEgPSByZXF1aXJlKFwiLi4vdXRpbC9zbmlwcGV0XCIpO1xyXG52YXIgdmVjdG9yX2ljb25fMSA9IHJlcXVpcmUoXCIuL3ZlY3Rvcl9pY29uXCIpO1xyXG52YXIgUGFydGljaXBhbnRJdGVtUHJvcHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQYXJ0aWNpcGFudEl0ZW1Qcm9wcygpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBQYXJ0aWNpcGFudEl0ZW1Qcm9wcztcclxufSgpKTtcclxudmFyIFBhcnRpY2lwYW50SXRlbSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFBhcnRpY2lwYW50SXRlbShwcm9wcykge1xyXG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcclxuICAgICAgICB0aGlzLm11dGVDYW1lcmEgPSB0aGlzLnByb3BzLm11dGVDYW1lcmE7XHJcbiAgICAgICAgdGhpcy5tdXRlTWljID0gdGhpcy5wcm9wcy5tdXRlTWljO1xyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG4gICAgUGFydGljaXBhbnRJdGVtLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGJvZHkgPSAnJztcclxuICAgICAgICBpZiAoIXRoaXMucHJvcHMuaXNNaWNEaXNhYmxlKSB7XHJcbiAgICAgICAgICAgIGJvZHkgPSBcIlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJqaXRzaS1wYXJ0aWNpcGFudFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwYXJ0aWNpcGFudC1hdmF0YXJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImF2YXRhciAgdXNlckF2YXRhciB3LTQwcHggaC00MHB4XFxcIiBzdHlsZT1cXFwiYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyMzQsIDI1NSwgMTI4LCAwLjQpO1xcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9XFxcImF2YXRhci1zdmdcXFwiIHZpZXdCb3g9XFxcIjAgMCAxMDAgMTAwXFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiIHhtbG5zOnhsaW5rPVxcXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0IGRvbWluYW50LWJhc2VsaW5lPVxcXCJjZW50cmFsXFxcIiBmaWxsPVxcXCJyZ2JhKDI1NSwyNTUsMjU1LC42KVxcXCIgZm9udC1zaXplPVxcXCI0MHB0XFxcIiB0ZXh0LWFuY2hvcj1cXFwibWlkZGxlXFxcIiB4PVxcXCI1MFxcXCIgeT1cXFwiNTBcXFwiPj88L3RleHQ+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwYXJ0aWNpcGFudC1jb250ZW50XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibmFtZVxcXCIgY2xhc3M9XFxcImZzLTIgZnctYm9sZGVyXFxcIj4/PC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJzcGFjZXJcXFwiPjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJqaXRzaS1pY29uIGNhbWVyYS10b2dnbGUtYnV0dG9uXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBpZD1cXFwiY2FtZXJhLWRpc2FibGVkXFxcIiB3aWR0aD1cXFwiMjBcXFwiIGhlaWdodD1cXFwiMjBcXFwiIHZpZXdCb3g9XFxcIjAgMCAyMCAyMFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPVxcXCJcXFwiPjwvcGF0aD5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaml0c2ktaWNvbiBtaWMtdG9nZ2xlLWJ1dHRvblxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgaWQ9XFxcIm1pYy1kaXNhYmxlZFxcXCIgd2lkdGg9XFxcIjIwXFxcIiBoZWlnaHQ9XFxcIjIwXFxcIiB2aWV3Qm94PVxcXCIwIDAgMjAgMjBcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD1cXFwiXFxcIj48L3BhdGg+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYm9keSA9IFwiXFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImppdHNpLXBhcnRpY2lwYW50XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBhcnRpY2lwYW50LWF2YXRhclxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiYXZhdGFyICB1c2VyQXZhdGFyIHctNDBweCBoLTQwcHhcXFwiIHN0eWxlPVxcXCJiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDIzNCwgMjU1LCAxMjgsIDAuNCk7XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz1cXFwiYXZhdGFyLXN2Z1xcXCIgdmlld0JveD1cXFwiMCAwIDEwMCAxMDBcXFwiIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCIgeG1sbnM6eGxpbms9XFxcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHQgZG9taW5hbnQtYmFzZWxpbmU9XFxcImNlbnRyYWxcXFwiIGZpbGw9XFxcInJnYmEoMjU1LDI1NSwyNTUsLjYpXFxcIiBmb250LXNpemU9XFxcIjQwcHRcXFwiIHRleHQtYW5jaG9yPVxcXCJtaWRkbGVcXFwiIHg9XFxcIjUwXFxcIiB5PVxcXCI1MFxcXCI+PzwvdGV4dD5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInBhcnRpY2lwYW50LWNvbnRlbnRcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJuYW1lXFxcIiBjbGFzcz1cXFwiZnMtMiBmdy1ib2xkZXJcXFwiPj88L3NwYW4+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNwYWNlclxcXCI+PC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImppdHNpLWljb24gY2FtZXJhLXRvZ2dsZS1idXR0b25cXFwiIHN0eWxlPVxcXCJwb2ludGVyLWV2ZW50czogbm9uZTtcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGlkPVxcXCJjYW1lcmEtZGlzYWJsZWRcXFwiIHdpZHRoPVxcXCIyMFxcXCIgaGVpZ2h0PVxcXCIyMFxcXCIgdmlld0JveD1cXFwiMCAwIDIwIDIwXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9XFxcIlxcXCI+PC9wYXRoPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3N2Zz5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJqaXRzaS1pY29uIG1pYy10b2dnbGUtYnV0dG9uXFxcIiBzdHlsZT1cXFwicG9pbnRlci1ldmVudHM6IG5vbmU7XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBpZD1cXFwibWljLWRpc2FibGVkXFxcIiB3aWR0aD1cXFwiMjBcXFwiIGhlaWdodD1cXFwiMjBcXFwiIHZpZXdCb3g9XFxcIjAgMCAyMCAyMFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPVxcXCJcXFwiPjwvcGF0aD5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciAkcm9vdCA9ICQoYm9keSk7XHJcbiAgICAgICAgdGhpcy5yb290RWxlbWVudCA9ICRyb290WzBdO1xyXG4gICAgICAgIHRoaXMuYXZhdGFyRWxlbWVudCA9ICRyb290LmZpbmQoXCIuYXZhdGFyXCIpWzBdO1xyXG4gICAgICAgIHRoaXMuYXZhdGFyVGV4dEVsZW1lbnQgPSAkKHRoaXMuYXZhdGFyRWxlbWVudCkuZmluZChcInRleHRcIilbMF07XHJcbiAgICAgICAgdGhpcy5uYW1lRWxlbWVudCA9ICRyb290LmZpbmQoXCIubmFtZVwiKVswXTtcclxuICAgICAgICB0aGlzLmNhbWVyYUJ1dHRvbkVsZW1lbnQgPSAkcm9vdC5maW5kKFwiLmNhbWVyYS10b2dnbGUtYnV0dG9uXCIpWzBdO1xyXG4gICAgICAgIHRoaXMubWljQnV0dG9uRWxlbWVudCA9ICRyb290LmZpbmQoXCIubWljLXRvZ2dsZS1idXR0b25cIilbMF07XHJcbiAgICAgICAgdGhpcy5jYW1lcmFJY29uRWxlbWVudCA9ICQodGhpcy5jYW1lcmFCdXR0b25FbGVtZW50KS5maW5kKFwicGF0aFwiKVswXTtcclxuICAgICAgICB0aGlzLm1pY0ljb25FbGVtZW50ID0gJCh0aGlzLm1pY0J1dHRvbkVsZW1lbnQpLmZpbmQoXCJwYXRoXCIpWzBdO1xyXG4gICAgICAgIC8vYXZhdGFyXHJcbiAgICAgICAgdGhpcy5hdmF0YXJUZXh0RWxlbWVudC5pbm5lckhUTUwgPSBzbmlwcGV0XzEuYXZhdGFyTmFtZSh0aGlzLnByb3BzLm5hbWUpO1xyXG4gICAgICAgIHZhciBhdmF0YXJDb2xvcnMgPSBbXHJcbiAgICAgICAgICAgIFwicmdiYSgyMzQsIDI1NSwgMTI4LCAwLjQpXCIsXHJcbiAgICAgICAgICAgIFwicmdiYSgxMTQsIDkxLCA2MCwgMS4wKVwiLFxyXG4gICAgICAgICAgICBcInJnYmEoNjMsIDY1LCAxMTMsIDEuMClcIixcclxuICAgICAgICAgICAgXCJyZ2JhKDU2LCAxMDUsIDkxLCAxLjApXCJcclxuICAgICAgICBdO1xyXG4gICAgICAgICQodGhpcy5hdmF0YXJFbGVtZW50KS5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIGF2YXRhckNvbG9yc1tzbmlwcGV0XzEucmFuZG9tKDAsIGF2YXRhckNvbG9ycy5sZW5ndGgpXSk7XHJcbiAgICAgICAgLy9uYW1lXHJcbiAgICAgICAgaWYgKHRoaXMucHJvcHMubWUpXHJcbiAgICAgICAgICAgICQodGhpcy5uYW1lRWxlbWVudCkuaHRtbCh0aGlzLnByb3BzLm5hbWUgKyBcIiAoTWUpXCIpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgJCh0aGlzLm5hbWVFbGVtZW50KS5odG1sKHRoaXMucHJvcHMubmFtZSk7XHJcbiAgICAgICAgLy9pY29uXHJcbiAgICAgICAgdGhpcy51cGRhdGVDYW1lcmFJY29uKCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVNaWNJY29uKCk7XHJcbiAgICAgICAgJCh0aGlzLmNhbWVyYUJ1dHRvbkVsZW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChfKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uVG9nZ2xlQ2FtZXJhKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLm1pY0J1dHRvbkVsZW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChfKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uVG9nZ2xlTWljKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRJdGVtLnByb3RvdHlwZS5lbGVtZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJvb3RFbGVtZW50O1xyXG4gICAgfTtcclxuICAgIFBhcnRpY2lwYW50SXRlbS5wcm90b3R5cGUucmVtb3ZlU2VsZiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMucm9vdEVsZW1lbnQpLnJlbW92ZSgpO1xyXG4gICAgfTtcclxuICAgIFBhcnRpY2lwYW50SXRlbS5wcm90b3R5cGUub25Ub2dnbGVDYW1lcmEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzSG9zdClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vdGhpcy5tdXRlQ2FtZXJhID0gIXRoaXMubXV0ZUNhbWVyYTtcclxuICAgICAgICAvL3RoaXMudXBkYXRlQ2FtZXJhSWNvbigpO1xyXG4gICAgICAgIHRoaXMucHJvcHMub25NdXRlQ2FtZXJhKHRoaXMucHJvcHMuaml0c2lJZCwgIXRoaXMubXV0ZUNhbWVyYSk7XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRJdGVtLnByb3RvdHlwZS5vblRvZ2dsZU1pYyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNIb3N0KVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy90aGlzLm11dGVNaWMgPSAhdGhpcy5tdXRlTWljO1xyXG4gICAgICAgIC8vdGhpcy51cGRhdGVNaWNJY29uKCk7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbk11dGVNaWModGhpcy5wcm9wcy5qaXRzaUlkLCAhdGhpcy5tdXRlTWljKTtcclxuICAgIH07XHJcbiAgICBQYXJ0aWNpcGFudEl0ZW0ucHJvdG90eXBlLmJsb2NrTWljID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5tdXRlTWljKVxyXG4gICAgICAgICAgICB0aGlzLm9uVG9nZ2xlTWljKCk7XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRJdGVtLnByb3RvdHlwZS5zZXRNdXRlQXVkaW8gPSBmdW5jdGlvbiAodXNlKSB7XHJcbiAgICAgICAgdGhpcy5tdXRlTWljID0gdXNlO1xyXG4gICAgICAgIHRoaXMudXBkYXRlTWljSWNvbigpO1xyXG4gICAgfTtcclxuICAgIFBhcnRpY2lwYW50SXRlbS5wcm90b3R5cGUuc2V0TXV0ZUNhbWVyYSA9IGZ1bmN0aW9uICh1c2UpIHtcclxuICAgICAgICB0aGlzLm11dGVDYW1lcmEgPSB1c2U7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDYW1lcmFJY29uKCk7XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRJdGVtLnByb3RvdHlwZS5zZXRSb2xlID0gZnVuY3Rpb24gKGlzSG9zdCkge1xyXG4gICAgICAgIHRoaXMuaXNIb3N0ID0gaXNIb3N0O1xyXG4gICAgfTtcclxuICAgIFBhcnRpY2lwYW50SXRlbS5wcm90b3R5cGUudXBkYXRlQ2FtZXJhSWNvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaWNvbiA9IHRoaXMubXV0ZUNhbWVyYSA/IHZlY3Rvcl9pY29uXzEuVmVjdG9ySWNvbi5WSURFT19NVVRFX0lDT04gOiB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uVklERU9fVU5NVVRFX0lDT047XHJcbiAgICAgICAgJCh0aGlzLmNhbWVyYUljb25FbGVtZW50KS5hdHRyKFwiZFwiLCBpY29uKTtcclxuICAgIH07XHJcbiAgICBQYXJ0aWNpcGFudEl0ZW0ucHJvdG90eXBlLnVwZGF0ZU1pY0ljb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGljb24gPSB0aGlzLm11dGVNaWMgPyB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uQVVESU9fTVVURV9JQ09OIDogdmVjdG9yX2ljb25fMS5WZWN0b3JJY29uLkFVRElPX1VOTVVURV9JQ09OO1xyXG4gICAgICAgICQodGhpcy5taWNJY29uRWxlbWVudCkuYXR0cihcImRcIiwgaWNvbik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFBhcnRpY2lwYW50SXRlbTtcclxufSgpKTtcclxudmFyIFBhcnRpY2lwYW50TGlzdFBhbmVsUHJvcHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQYXJ0aWNpcGFudExpc3RQYW5lbFByb3BzKCkge1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFBhcnRpY2lwYW50TGlzdFBhbmVsUHJvcHM7XHJcbn0oKSk7XHJcbmV4cG9ydHMuUGFydGljaXBhbnRMaXN0UGFuZWxQcm9wcyA9IFBhcnRpY2lwYW50TGlzdFBhbmVsUHJvcHM7XHJcbnZhciBQYXJ0aWNpcGFudExpc3RXaWRnZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQYXJ0aWNpcGFudExpc3RXaWRnZXQoKSB7XHJcbiAgICAgICAgLy9zdGF0ZXNcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50SXRlbU1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmlzSG9zdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucm9vdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBhcnRpY2lwYW50cy1saXN0XCIpO1xyXG4gICAgICAgIHZhciAkcm9vdCA9ICQodGhpcy5yb290RWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNpcGFudENvdW50RWxlbWVudCA9ICRyb290LmZpbmQoXCIjcGFydGljaXBhbnQtY291bnRcIilbMF07XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNpcGFudExpc3RFbGVtZW50ID0gJHJvb3QuZmluZChcIiNwYXJ0aWNpcGFudHMtbGlzdC1ib2R5XCIpWzBdO1xyXG4gICAgICAgIHRoaXMubXV0ZUFsbEJ1dHRvbkVsZW1lbnQgPSAkcm9vdC5maW5kKFwiI3BhcnRpY2lwYW50cy1saXN0LWZvb3Rlcj4uYnRuXCIpWzBdO1xyXG4gICAgICAgIHRoaXMudG9nZ2xlQ29weUpvaW5pbmdJbmZvRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY29weS1qb2luaW5nLWluZm9cIik7XHJcbiAgICAgICAgdGhpcy5qb2luaW5nSW5mb0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2pvaW5pbmctaW5mb1wiKTtcclxuICAgIH1cclxuICAgIFBhcnRpY2lwYW50TGlzdFdpZGdldC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChwcm9wcykge1xyXG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcclxuICAgICAgICB0aGlzLnVwZGF0ZVBhcnRpY2lwYW50Q291bnQoKTtcclxuICAgICAgICB0aGlzLmF0dGFjaEhhbmRsZXJzKCk7XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRMaXN0V2lkZ2V0LnByb3RvdHlwZS5hdHRhY2hIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICQodGhpcy5tdXRlQWxsQnV0dG9uRWxlbWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaXNIb3N0KVxyXG4gICAgICAgICAgICAgICAgX3RoaXMucGFydGljaXBhbnRJdGVtTWFwLmZvckVhY2goZnVuY3Rpb24gKHBhcnRpY2lwYW50SXRlbSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhbnRJdGVtLmJsb2NrTWljKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKHRoaXMudG9nZ2xlQ29weUpvaW5pbmdJbmZvRWxlbWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKF8pIHtcclxuICAgICAgICAgICAgX3RoaXMucHJvcHMudG9nZ2xlQ29weUpvaW5pbmdJbmZvKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRMaXN0V2lkZ2V0LnByb3RvdHlwZS5hZGRQYXJ0aWNpcGFudCA9IGZ1bmN0aW9uIChqaXRzaUlkLCBuYW1lLCBtZSwgaXNNaWNEaXNhYmxlLCBpc1ZpZGVvRGlhYmxlLCBtdXRlQ2FtZXJhLCBtdXRlTWljKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFydGljaXBhbnRJdGVtTWFwLmhhcyhqaXRzaUlkKSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZVBhcnRpY2lwYW50KGppdHNpSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcHJvcHMgPSBuZXcgUGFydGljaXBhbnRJdGVtUHJvcHMoKTtcclxuICAgICAgICBwcm9wcy5qaXRzaUlkID0gaml0c2lJZDtcclxuICAgICAgICBwcm9wcy5uYW1lID0gbmFtZTtcclxuICAgICAgICBwcm9wcy5tZSA9IG1lO1xyXG4gICAgICAgIHByb3BzLmlzTWljRGlzYWJsZSA9IGlzTWljRGlzYWJsZTtcclxuICAgICAgICBwcm9wcy5pc1ZpZGVvRGlzYWJsZSA9IGlzVmlkZW9EaWFibGU7XHJcbiAgICAgICAgcHJvcHMubXV0ZUNhbWVyYSA9IG11dGVDYW1lcmE7XHJcbiAgICAgICAgcHJvcHMubXV0ZU1pYyA9IG11dGVNaWM7XHJcbiAgICAgICAgcHJvcHMub25NdXRlQ2FtZXJhID0gdGhpcy5wcm9wcy5vbk11dGVDYW1lcmE7XHJcbiAgICAgICAgcHJvcHMub25NdXRlTWljID0gdGhpcy5wcm9wcy5vbk11dGVNaWM7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBuZXcgUGFydGljaXBhbnRJdGVtKHByb3BzKTtcclxuICAgICAgICBpdGVtLnNldFJvbGUodGhpcy5pc0hvc3QpO1xyXG4gICAgICAgIHRoaXMucGFydGljaXBhbnRJdGVtTWFwLnNldChqaXRzaUlkLCBpdGVtKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVBhcnRpY2lwYW50Q291bnQoKTtcclxuICAgICAgICBpZiAobWUgJiYgKGlzTWljRGlzYWJsZSB8fCBpc1ZpZGVvRGlhYmxlKSkge1xyXG4gICAgICAgICAgICAvL2lmIChtZSkge1xyXG4gICAgICAgICAgICAkKHRoaXMucGFydGljaXBhbnRMaXN0RWxlbWVudCkucHJlcGVuZChpdGVtLmVsZW1lbnQoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAkKHRoaXMucGFydGljaXBhbnRMaXN0RWxlbWVudCkuYXBwZW5kKGl0ZW0uZWxlbWVudCgpKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFydGljaXBhbnRMaXN0V2lkZ2V0LnByb3RvdHlwZS5yZW1vdmVQYXJ0aWNpcGFudCA9IGZ1bmN0aW9uIChqaXRzaUlkKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnBhcnRpY2lwYW50SXRlbU1hcC5oYXMoaml0c2lJZCkpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50SXRlbU1hcC5nZXQoaml0c2lJZCkucmVtb3ZlU2VsZigpO1xyXG4gICAgICAgIHRoaXMucGFydGljaXBhbnRJdGVtTWFwLmRlbGV0ZShqaXRzaUlkKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVBhcnRpY2lwYW50Q291bnQoKTtcclxuICAgIH07XHJcbiAgICBQYXJ0aWNpcGFudExpc3RXaWRnZXQucHJvdG90eXBlLnVwZGF0ZUpvaW5pbmdJbmZvID0gZnVuY3Rpb24gKGluZm8pIHtcclxuICAgICAgICB0aGlzLmpvaW5pbmdJbmZvRWxlbWVudC5pbm5lckhUTUwgPSBpbmZvO1xyXG4gICAgfTtcclxuICAgIFBhcnRpY2lwYW50TGlzdFdpZGdldC5wcm90b3R5cGUudXBkYXRlUGFydGljaXBhbnRDb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50Q291bnRFbGVtZW50LmlubmVySFRNTCA9IFwiXCIgKyB0aGlzLnBhcnRpY2lwYW50SXRlbU1hcC5zaXplO1xyXG4gICAgfTtcclxuICAgIFBhcnRpY2lwYW50TGlzdFdpZGdldC5wcm90b3R5cGUuc2V0TXV0ZUNhbWVyYSA9IGZ1bmN0aW9uIChqaXRzaUlkLCBtdXRlQ2FtZXJhKSB7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLnBhcnRpY2lwYW50SXRlbU1hcC5nZXQoaml0c2lJZCk7XHJcbiAgICAgICAgaWYgKGl0ZW0pXHJcbiAgICAgICAgICAgIGl0ZW0uc2V0TXV0ZUNhbWVyYShtdXRlQ2FtZXJhKTtcclxuICAgIH07XHJcbiAgICBQYXJ0aWNpcGFudExpc3RXaWRnZXQucHJvdG90eXBlLnNldE11dGVNaWMgPSBmdW5jdGlvbiAoaml0c2lJZCwgbXV0ZU1pYykge1xyXG4gICAgICAgIHZhciBpdGVtID0gdGhpcy5wYXJ0aWNpcGFudEl0ZW1NYXAuZ2V0KGppdHNpSWQpO1xyXG4gICAgICAgIGlmIChpdGVtKVxyXG4gICAgICAgICAgICBpdGVtLnNldE11dGVBdWRpbyhtdXRlTWljKTtcclxuICAgIH07XHJcbiAgICBQYXJ0aWNpcGFudExpc3RXaWRnZXQucHJvdG90eXBlLnVwZGF0ZUJ5Um9sZSA9IGZ1bmN0aW9uIChpc0hvc3QpIHtcclxuICAgICAgICB0aGlzLmlzSG9zdCA9IGlzSG9zdDtcclxuICAgICAgICBpZiAoaXNIb3N0KVxyXG4gICAgICAgICAgICAkKHRoaXMucm9vdEVsZW1lbnQpLmFkZENsYXNzKFwiaXMtaG9zdFwiKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICQodGhpcy5yb290RWxlbWVudCkucmVtb3ZlQ2xhc3MoXCJpcy1ob3N0XCIpO1xyXG4gICAgICAgIHRoaXMubXV0ZUFsbEJ1dHRvbkVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9IGlzSG9zdCA/IFwidmlzaWJsZVwiIDogXCJoaWRkZW5cIjtcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50SXRlbU1hcC5mb3JFYWNoKGZ1bmN0aW9uIChwYXJ0aWNpcGFudEl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICBwYXJ0aWNpcGFudEl0ZW0uc2V0Um9sZShpc0hvc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBQYXJ0aWNpcGFudExpc3RXaWRnZXQ7XHJcbn0oKSk7XHJcbmV4cG9ydHMuUGFydGljaXBhbnRMaXN0V2lkZ2V0ID0gUGFydGljaXBhbnRMaXN0V2lkZ2V0O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1QYXJ0aWNpcGFudExpc3RQYW5lbC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvY29tcG9uZW50c1xcXFxQYXJ0aWNpcGFudExpc3RQYW5lbC5qc1wiLFwiL2NvbXBvbmVudHNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlNldHRpbmdEaWFsb2cgPSBleHBvcnRzLlNldHRpbmdEaWFsb2dQcm9wcyA9IHZvaWQgMDtcclxudmFyIE1lZGlhVHlwZV8xID0gcmVxdWlyZShcIi4uL2VudW0vTWVkaWFUeXBlXCIpO1xyXG52YXIgQWN0aXZlRGV2aWNlc18xID0gcmVxdWlyZShcIi4uL21vZGVsL0FjdGl2ZURldmljZXNcIik7XHJcbnZhciBTZXR0aW5nRGlhbG9nUHJvcHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTZXR0aW5nRGlhbG9nUHJvcHMoKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gU2V0dGluZ0RpYWxvZ1Byb3BzO1xyXG59KCkpO1xyXG5leHBvcnRzLlNldHRpbmdEaWFsb2dQcm9wcyA9IFNldHRpbmdEaWFsb2dQcm9wcztcclxudmFyIFNldHRpbmdEaWFsb2cgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTZXR0aW5nRGlhbG9nKCkge1xyXG4gICAgICAgIHRoaXMuSml0c2lNZWV0SlMgPSB3aW5kb3cuSml0c2lNZWV0SlM7XHJcbiAgICAgICAgdGhpcy5hdWRpb1RyYWNrRXJyb3IgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlkZW9UcmFja0Vycm9yID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFjdGl2ZUNhbWVyYURldmljZUlkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFjdGl2ZU1pY0RldmljZUlkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFjdGl2ZVNwZWFrZXJEZXZpY2VJZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5sb2NhbFRyYWNrcyA9IFtdO1xyXG4gICAgfVxyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChwcm9wcykge1xyXG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcclxuICAgICAgICB0aGlzLmRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2V0dGluZy1kaWFsb2ctd3JhcHBlclwiKTtcclxuICAgICAgICB0aGlzLnNob3dCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNldHRpbmctZGlhbG9nLXdyYXBwZXI+YnV0dG9uXCIpO1xyXG4gICAgICAgICQodGhpcy5kaWFsb2cpLmFkZENsYXNzKFwiZC1ub25lXCIpO1xyXG4gICAgICAgIHRoaXMub2tCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3NldHRpbmctZGlhbG9nLW9rLWJ1dHRvblwiKTtcclxuICAgICAgICB0aGlzLmNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzZXR0aW5nLWRpYWxvZy1jYW5jZWwtYnV0dG9uXCIpO1xyXG4gICAgICAgIHRoaXMudmlkZW9QcmV2aWV3RWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FtZXJhLXByZXZpZXdcIik7XHJcbiAgICAgICAgdGhpcy5hdWRpb1ByZXZpZXdFbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWMtcHJldmlld1wiKTtcclxuICAgICAgICB0aGlzLmNhbWVyYUxpc3RFbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYW1lcmEtbGlzdFwiKTtcclxuICAgICAgICB0aGlzLm1pY0xpc3RFbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWMtbGlzdFwiKTtcclxuICAgICAgICB0aGlzLnNwZWFrZXJMaXN0RWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3BlYWtlci1saXN0XCIpO1xyXG4gICAgICAgIHRoaXMuYXR0YWNoRXZlbnRIYW5kbGVycygpO1xyXG4gICAgICAgIHRoaXMucmVmcmVzaERldmljZUxpc3QoKTtcclxuICAgIH07XHJcbiAgICBTZXR0aW5nRGlhbG9nLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcy5kaWFsb2cpLnJlbW92ZUNsYXNzKFwiZC1ub25lXCIpO1xyXG4gICAgICAgICQodGhpcy5zaG93QnV0dG9uKS50cmlnZ2VyKFwiY2xpY2tcIik7XHJcbiAgICB9O1xyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUuYXR0YWNoRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXNfMSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAkKHRoaXMuY2FtZXJhTGlzdEVsZW0pLm9mZignY2hhbmdlJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMub25DYW1lcmFDaGFuZ2VkKCQodGhpcykudmFsKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy5taWNMaXN0RWxlbSkub2ZmKCdjaGFuZ2UnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbk1pY0NoYW5nZWQoJCh0aGlzKS52YWwoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLnNwZWFrZXJMaXN0RWxlbSkub2ZmKCdjaGFuZ2UnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5vblNwZWFrZXJDaGFuZ2VkKCQodGhpcykudmFsKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy5va0J1dHRvbikub2ZmKCdjbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXNfMS5vbk9LKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUucmVmcmVzaERldmljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzXzEgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuSml0c2lNZWV0SlMubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoZnVuY3Rpb24gKGRldmljZXMpIHtcclxuICAgICAgICAgICAgX3RoaXNfMS5jYW1lcmFMaXN0ID0gZGV2aWNlcy5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQua2luZCA9PT0gJ3ZpZGVvaW5wdXQnOyB9KTtcclxuICAgICAgICAgICAgX3RoaXNfMS5taWNMaXN0ID0gZGV2aWNlcy5maWx0ZXIoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQua2luZCA9PT0gJ2F1ZGlvaW5wdXQnOyB9KTtcclxuICAgICAgICAgICAgX3RoaXNfMS5zcGVha2VyTGlzdCA9IGRldmljZXMuZmlsdGVyKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmtpbmQgPT09ICdhdWRpb291dHB1dCc7IH0pO1xyXG4gICAgICAgICAgICBfdGhpc18xLnJlbmRlckRldmljZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBTZXR0aW5nRGlhbG9nLnByb3RvdHlwZS5yZW5kZXJEZXZpY2VzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpc18xID0gdGhpcztcclxuICAgICAgICB0aGlzLmFjdGl2ZUNhbWVyYURldmljZUlkID0gdGhpcy5wcm9wcy5jdXJEZXZpY2VzLmNhbWVyYUlkO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlTWljRGV2aWNlSWQgPSB0aGlzLnByb3BzLmN1ckRldmljZXMubWljSWQ7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVTcGVha2VyRGV2aWNlSWQgPSB0aGlzLnByb3BzLmN1ckRldmljZXMuc3BlYWtlcklkO1xyXG4gICAgICAgIHRoaXMuY2xlYXJET01FbGVtZW50KHRoaXMuY2FtZXJhTGlzdEVsZW0pO1xyXG4gICAgICAgIHRoaXMuY2FtZXJhTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChjYW1lcmEpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gKF90aGlzXzEuYWN0aXZlQ2FtZXJhRGV2aWNlSWQgJiYgY2FtZXJhLmRldmljZUlkID09PSBfdGhpc18xLmFjdGl2ZUNhbWVyYURldmljZUlkKVxyXG4gICAgICAgICAgICAgICAgPyBcInNlbGVjdGVkXCIgOiBcIlwiO1xyXG4gICAgICAgICAgICAkKF90aGlzXzEuY2FtZXJhTGlzdEVsZW0pLmFwcGVuZChcIjxvcHRpb24gdmFsdWU9XFxcIlwiICsgY2FtZXJhLmRldmljZUlkICsgXCJcXFwiIFwiICsgc2VsZWN0ZWQgKyBcIj5cIiArIGNhbWVyYS5sYWJlbCArIFwiPC9vcHRpb24+XCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2xlYXJET01FbGVtZW50KHRoaXMubWljTGlzdEVsZW0pO1xyXG4gICAgICAgIHRoaXMubWljTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChtaWMpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gKF90aGlzXzEuYWN0aXZlTWljRGV2aWNlSWQgJiYgbWljLmRldmljZUlkID09PSBfdGhpc18xLmFjdGl2ZU1pY0RldmljZUlkKVxyXG4gICAgICAgICAgICAgICAgPyBcInNlbGVjdGVkXCIgOiBcIlwiO1xyXG4gICAgICAgICAgICAkKF90aGlzXzEubWljTGlzdEVsZW0pLmFwcGVuZChcIjxvcHRpb24gdmFsdWU9XFxcIlwiICsgbWljLmRldmljZUlkICsgXCJcXFwiIFwiICsgc2VsZWN0ZWQgKyBcIj5cIiArIG1pYy5sYWJlbCArIFwiPC9vcHRpb24+XCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2xlYXJET01FbGVtZW50KHRoaXMuc3BlYWtlckxpc3RFbGVtKTtcclxuICAgICAgICB0aGlzLnNwZWFrZXJMaXN0LmZvckVhY2goZnVuY3Rpb24gKHNwZWFrZXIpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gKF90aGlzXzEuYWN0aXZlU3BlYWtlckRldmljZUlkICYmIHNwZWFrZXIuZGV2aWNlSWQgPT09IF90aGlzXzEuYWN0aXZlU3BlYWtlckRldmljZUlkKVxyXG4gICAgICAgICAgICAgICAgPyBcInNlbGVjdGVkXCIgOiBcIlwiO1xyXG4gICAgICAgICAgICAkKF90aGlzXzEuc3BlYWtlckxpc3RFbGVtKS5hcHBlbmQoXCI8b3B0aW9uIHZhbHVlPVxcXCJcIiArIHNwZWFrZXIuZGV2aWNlSWQgKyBcIlxcXCIgXCIgKyBzZWxlY3RlZCArIFwiPlwiICsgc3BlYWtlci5sYWJlbCArIFwiPC9vcHRpb24+XCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQoXCIuZm9ybS1zZWxlY3RcIikuc2VsZWN0MigpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTG9jYWxUcmFja3ModGhpcy5hY3RpdmVDYW1lcmFEZXZpY2VJZCwgdGhpcy5hY3RpdmVNaWNEZXZpY2VJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykge1xyXG4gICAgICAgICAgICB0cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHQuZ2V0VHlwZSgpID09PSBNZWRpYVR5cGVfMS5NZWRpYVR5cGUuVklERU8pIHtcclxuICAgICAgICAgICAgICAgICAgICB0LmF0dGFjaChfdGhpc18xLnZpZGVvUHJldmlld0VsZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodC5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTykge1xyXG4gICAgICAgICAgICAgICAgICAgIHQuYXR0YWNoKF90aGlzXzEuYXVkaW9QcmV2aWV3RWxlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBfdGhpc18xLmxvY2FsVHJhY2tzID0gdHJhY2tzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFNldHRpbmdEaWFsb2cucHJvdG90eXBlLmluaXRDdXJyZW50RGV2aWNlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXNfMSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAkKFwib3B0aW9uXCIsIHRoaXMuY2FtZXJhTGlzdEVsZW0pLmVhY2goZnVuY3Rpb24gKF8pIHtcclxuICAgICAgICAgICAgaWYgKCQoX3RoaXNfMSkudmFsKCkgPT09IF90aGlzLnByb3BzLmN1ckRldmljZXMubWljSWQpXHJcbiAgICAgICAgICAgICAgICAkKF90aGlzXzEpLmF0dHIoXCJzZWxlY3RlZFwiLCBcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFNldHRpbmdEaWFsb2cucHJvdG90eXBlLmNsZWFyRE9NRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtKSB7XHJcbiAgICAgICAgd2hpbGUgKGVsZW0uZmlyc3RDaGlsZCkge1xyXG4gICAgICAgICAgICBlbGVtLnJlbW92ZUNoaWxkKGVsZW0uZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNldHRpbmdEaWFsb2cucHJvdG90eXBlLmNyZWF0ZUxvY2FsVHJhY2tzID0gZnVuY3Rpb24gKGNhbWVyYURldmljZUlkLCBtaWNEZXZpY2VJZCkge1xyXG4gICAgICAgIHZhciBfdGhpc18xID0gdGhpcztcclxuICAgICAgICB0aGlzLnZpZGVvVHJhY2tFcnJvciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdWRpb1RyYWNrRXJyb3IgPSBudWxsO1xyXG4gICAgICAgIGlmIChjYW1lcmFEZXZpY2VJZCAhPSBudWxsICYmIG1pY0RldmljZUlkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuSml0c2lNZWV0SlMuY3JlYXRlTG9jYWxUcmFja3Moe1xyXG4gICAgICAgICAgICAgICAgZGV2aWNlczogWydhdWRpbycsICd2aWRlbyddLFxyXG4gICAgICAgICAgICAgICAgY2FtZXJhRGV2aWNlSWQ6IGNhbWVyYURldmljZUlkLFxyXG4gICAgICAgICAgICAgICAgbWljRGV2aWNlSWQ6IG1pY0RldmljZUlkXHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgICAgIF90aGlzXzEuY3JlYXRlQXVkaW9UcmFjayhtaWNEZXZpY2VJZCkudGhlbihmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtID0gX2FbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgX3RoaXNfMS5jcmVhdGVWaWRlb1RyYWNrKGNhbWVyYURldmljZUlkKS50aGVuKGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHJlYW0gPSBfYVswXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgXSk7IH0pLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzXzEuYXVkaW9UcmFja0Vycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9kaXNwbGF5IGVycm9yXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXNfMS52aWRlb1RyYWNrRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2Rpc3BsYXkgZXJyb3JcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFja3MuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0eXBlb2YgdCAhPT0gJ3VuZGVmaW5lZCc7IH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY2FtZXJhRGV2aWNlSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVWaWRlb1RyYWNrKGNhbWVyYURldmljZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobWljRGV2aWNlSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVBdWRpb1RyYWNrKG1pY0RldmljZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XHJcbiAgICB9O1xyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUuY3JlYXRlVmlkZW9UcmFjayA9IGZ1bmN0aW9uIChjYW1lcmFEZXZpY2VJZCkge1xyXG4gICAgICAgIHZhciBfdGhpc18xID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5KaXRzaU1lZXRKUy5jcmVhdGVMb2NhbFRyYWNrcyh7XHJcbiAgICAgICAgICAgIGRldmljZXM6IFsndmlkZW8nXSxcclxuICAgICAgICAgICAgY2FtZXJhRGV2aWNlSWQ6IGNhbWVyYURldmljZUlkLFxyXG4gICAgICAgICAgICBtaWNEZXZpY2VJZDogbnVsbFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXNfMS52aWRlb1RyYWNrRXJyb3IgPSBlcnJvcjtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUuY3JlYXRlQXVkaW9UcmFjayA9IGZ1bmN0aW9uIChtaWNEZXZpY2VJZCkge1xyXG4gICAgICAgIHZhciBfdGhpc18xID0gdGhpcztcclxuICAgICAgICByZXR1cm4gKHRoaXMuSml0c2lNZWV0SlMuY3JlYXRlTG9jYWxUcmFja3Moe1xyXG4gICAgICAgICAgICBkZXZpY2VzOiBbJ2F1ZGlvJ10sXHJcbiAgICAgICAgICAgIGNhbWVyYURldmljZUlkOiBudWxsLFxyXG4gICAgICAgICAgICBtaWNEZXZpY2VJZDogbWljRGV2aWNlSWRcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF90aGlzXzEuYXVkaW9UcmFja0Vycm9yID0gZXJyb3I7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoW10pO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH07XHJcbiAgICBTZXR0aW5nRGlhbG9nLnByb3RvdHlwZS5vbkNhbWVyYUNoYW5nZWQgPSBmdW5jdGlvbiAoY2FtZXJhRGV2aWNlSWQpIHtcclxuICAgICAgICB2YXIgX3RoaXNfMSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVDYW1lcmFEZXZpY2VJZCA9IGNhbWVyYURldmljZUlkO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTG9jYWxUcmFja3ModGhpcy5hY3RpdmVDYW1lcmFEZXZpY2VJZCwgbnVsbClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykge1xyXG4gICAgICAgICAgICB2YXIgbmV3VHJhY2sgPSB0cmFja3MuZmluZChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTzsgfSk7XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGV4aXN0aW5nIHRyYWNrXHJcbiAgICAgICAgICAgIHZhciBvbGRUcmFjayA9IF90aGlzXzEubG9jYWxUcmFja3MuZmluZChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTzsgfSk7XHJcbiAgICAgICAgICAgIGlmIChvbGRUcmFjaykge1xyXG4gICAgICAgICAgICAgICAgb2xkVHJhY2suZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXNfMS5sb2NhbFRyYWNrcy5zcGxpY2UoX3RoaXNfMS5sb2NhbFRyYWNrcy5pbmRleE9mKG9sZFRyYWNrKSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5ld1RyYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpc18xLmxvY2FsVHJhY2tzLnB1c2gobmV3VHJhY2spO1xyXG4gICAgICAgICAgICAgICAgbmV3VHJhY2suYXR0YWNoKF90aGlzXzEudmlkZW9QcmV2aWV3RWxlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBTZXR0aW5nRGlhbG9nLnByb3RvdHlwZS5vbk1pY0NoYW5nZWQgPSBmdW5jdGlvbiAobWljRGV2aWNlSWQpIHtcclxuICAgICAgICB2YXIgX3RoaXNfMSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVNaWNEZXZpY2VJZCA9IG1pY0RldmljZUlkO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTG9jYWxUcmFja3MobnVsbCwgdGhpcy5hY3RpdmVNaWNEZXZpY2VJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykge1xyXG4gICAgICAgICAgICB2YXIgbmV3VHJhY2sgPSB0cmFja3MuZmluZChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTzsgfSk7XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGV4aXN0aW5nIHRyYWNrXHJcbiAgICAgICAgICAgIHZhciBvbGRUcmFjayA9IF90aGlzXzEubG9jYWxUcmFja3MuZmluZChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTzsgfSk7XHJcbiAgICAgICAgICAgIGlmIChvbGRUcmFjaykge1xyXG4gICAgICAgICAgICAgICAgb2xkVHJhY2suZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXNfMS5sb2NhbFRyYWNrcy5zcGxpY2UoX3RoaXNfMS5sb2NhbFRyYWNrcy5pbmRleE9mKG9sZFRyYWNrKSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5ld1RyYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpc18xLmxvY2FsVHJhY2tzLnB1c2gobmV3VHJhY2spO1xyXG4gICAgICAgICAgICAgICAgbmV3VHJhY2suYXR0YWNoKF90aGlzXzEuYXVkaW9QcmV2aWV3RWxlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBTZXR0aW5nRGlhbG9nLnByb3RvdHlwZS5vblNwZWFrZXJDaGFuZ2VkID0gZnVuY3Rpb24gKHNwZWFrZXJEZXZpY2VJZCkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU3BlYWtlckRldmljZUlkID0gc3BlYWtlckRldmljZUlkO1xyXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZVNwZWFrZXJEZXZpY2VJZCAmJiB0aGlzLkppdHNpTWVldEpTLm1lZGlhRGV2aWNlcy5pc0RldmljZUNoYW5nZUF2YWlsYWJsZSgnb3V0cHV0JykpIHtcclxuICAgICAgICAgICAgdGhpcy5KaXRzaU1lZXRKUy5tZWRpYURldmljZXMuc2V0QXVkaW9PdXRwdXREZXZpY2UodGhpcy5hY3RpdmVTcGVha2VyRGV2aWNlSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICA7XHJcbiAgICB9O1xyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUub25PSyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XHJcbiAgICAgICAgdmFyIG5ld0RldmljZXMgPSBuZXcgQWN0aXZlRGV2aWNlc18xLkFjdGl2ZURldmljZXMoKTtcclxuICAgICAgICBuZXdEZXZpY2VzLmNhbWVyYUlkID0gdGhpcy5hY3RpdmVDYW1lcmFEZXZpY2VJZDtcclxuICAgICAgICBuZXdEZXZpY2VzLm1pY0lkID0gdGhpcy5hY3RpdmVNaWNEZXZpY2VJZDtcclxuICAgICAgICBuZXdEZXZpY2VzLnNwZWFrZXJJZCA9IHRoaXMuYWN0aXZlU3BlYWtlckRldmljZUlkO1xyXG4gICAgICAgIHRoaXMucHJvcHMub25EZXZpY2VDaGFuZ2UobmV3RGV2aWNlcyk7XHJcbiAgICB9O1xyXG4gICAgU2V0dGluZ0RpYWxvZy5wcm90b3R5cGUuY2xvc2VEaWFsb2cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCh0aGlzLmNsb3NlQnV0dG9uKS50cmlnZ2VyKFwiY2xpY2tcIik7XHJcbiAgICAgICAgdGhpcy5sb2NhbFRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykge1xyXG4gICAgICAgICAgICB0cmFjay5kaXNwb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNldHRpbmdEaWFsb2c7XHJcbn0oKSk7XHJcbmV4cG9ydHMuU2V0dGluZ0RpYWxvZyA9IFNldHRpbmdEaWFsb2c7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVNldHRpbmdEaWFsb2cuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2NvbXBvbmVudHNcXFxcU2V0dGluZ0RpYWxvZy5qc1wiLFwiL2NvbXBvbmVudHNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlRvb2xCYXIgPSBleHBvcnRzLlRvb2xCYXJQcm9wcyA9IHZvaWQgMDtcclxudmFyIE1lZGlhVHlwZV8xID0gcmVxdWlyZShcIi4uL2VudW0vTWVkaWFUeXBlXCIpO1xyXG52YXIgdmVjdG9yX2ljb25fMSA9IHJlcXVpcmUoXCIuL3ZlY3Rvcl9pY29uXCIpO1xyXG52YXIgVG9vbEJhclByb3BzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVG9vbEJhclByb3BzKCkge1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFRvb2xCYXJQcm9wcztcclxufSgpKTtcclxuZXhwb3J0cy5Ub29sQmFyUHJvcHMgPSBUb29sQmFyUHJvcHM7XHJcbnZhciBUb29sQmFyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVG9vbEJhcihwcm9wcykge1xyXG4gICAgICAgIHRoaXMucm9vdCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wcm9wcyA9IHByb3BzO1xyXG4gICAgICAgIHRoaXMucm9vdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmV3LXRvb2xib3hcIik7XHJcbiAgICAgICAgdGhpcy50b29sYmFyVGlsZVZpZXdCdXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN0aWxldmlld1wiKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJNdXRlQWxsQnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbXV0ZWFsbFwiKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJNdXRlQWxsVmlkZW9CdXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtdXRlYWxsdmlkZW9cIik7XHJcbiAgICAgICAgdGhpcy50b29sYmFyQXVkaW9CdXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtaWMtZW5hYmxlXCIpO1xyXG4gICAgICAgIHRoaXMudG9vbGJhclZpZGVvQnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FtZXJhLWVuYWJsZVwiKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJEZXNrdG9wU2hhcmVCdXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzaGFyZVwiKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJEZXNrdG9wU2hhcmVNZW51QnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc2hhcmVzY3JlZW5cIik7XHJcbiAgICAgICAgdGhpcy50b29sYmFyUmVjb3JkQnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcmVjb3JkXCIpO1xyXG4gICAgICAgIHRoaXMudG9vbGJhckhhbmRSYWlzZUJ1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2hhbmRyYWlzZVwiKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJDaGF0QnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2hhdFwiKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJMZWF2ZUJ1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xlYXZlXCIpO1xyXG4gICAgICAgIHRoaXMudG9vbGJhclNldHRpbmdCdXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzZXR0aW5nXCIpO1xyXG4gICAgICAgIHRoaXMuY2hhdHRpbmdVbnJlYWRCYWRnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2hhdC1iYWRnZVwiKTtcclxuICAgICAgICB0aGlzLmF0dGFjaEhhbmRsZXJzKCk7XHJcbiAgICB9XHJcbiAgICBUb29sQmFyLnByb3RvdHlwZS5hdHRhY2hIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyVGlsZVZpZXdCdXR0b25FbGVtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLnRvZ2dsZVRpbGVWaWV3KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLnRvb2xiYXJNdXRlQWxsQnV0dG9uRWxlbWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy50b2dnbGVNdXRlQWxsKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLnRvb2xiYXJNdXRlQWxsVmlkZW9CdXR0b25FbGVtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLnRvZ2dsZU11dGVBbGxWaWRlbygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyVmlkZW9CdXR0b25FbGVtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLnRvZ2dsZVZpZGVvTXV0ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyQXVkaW9CdXR0b25FbGVtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLnRvZ2dsZUF1ZGlvTXV0ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyQ2hhdEJ1dHRvbkVsZW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChfKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLm9wZW5DaGF0dGluZyh0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKHRoaXMudG9vbGJhckRlc2t0b3BTaGFyZUJ1dHRvbkVsZW1lbnQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy50b2dnbGVTY3JlZW5TaGFyZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyRGVza3RvcFNoYXJlTWVudUJ1dHRvbkVsZW1lbnQpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy50b2dnbGVTY3JlZW5TaGFyZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyUmVjb3JkQnV0dG9uRWxlbWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy50b2dnbGVSZWNvcmRpbmcoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKHRoaXMudG9vbGJhckhhbmRSYWlzZUJ1dHRvbkVsZW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMucHJvcHMudG9nZ2xlSGFuZFJhaXNlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLnRvb2xiYXJTZXR0aW5nQnV0dG9uRWxlbWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy5vcGVuU2V0dGluZygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy50b29sYmFyTGVhdmVCdXR0b25FbGVtZW50KS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLmxlYXZlTWVldGluZygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFRvb2xCYXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICh1c2VySW5mbywgbG9jYWxUcmFja3MpIHtcclxuICAgICAgICB2YXIgYXVkaW9NdXRlZCA9IGZhbHNlLCB2aWRlb011dGVkID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGhhc0F1ZGlvVHJhY2sgPSBmYWxzZSwgaGFzVmlkZW9UcmFjayA9IGZhbHNlO1xyXG4gICAgICAgIGxvY2FsVHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTykge1xyXG4gICAgICAgICAgICAgICAgaGFzVmlkZW9UcmFjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgIHZpZGVvTXV0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPKSB7XHJcbiAgICAgICAgICAgICAgICBoYXNBdWRpb1RyYWNrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICh0cmFjay5pc011dGVkKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgYXVkaW9NdXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnRvb2xiYXJWaWRlb0J1dHRvbkVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IGhhc1ZpZGVvVHJhY2sgPyBcImlubGluZS1ibG9ja1wiIDogXCJcIjtcclxuICAgICAgICB0aGlzLnRvb2xiYXJEZXNrdG9wU2hhcmVCdXR0b25FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBoYXNWaWRlb1RyYWNrID8gXCJpbmxpbmUtYmxvY2tcIiA6IFwiXCI7XHJcbiAgICAgICAgdGhpcy50b29sYmFyQXVkaW9CdXR0b25FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBoYXNBdWRpb1RyYWNrID8gXCJpbmxpbmUtYmxvY2tcIiA6IFwiXCI7XHJcbiAgICAgICAgaWYgKGF1ZGlvTXV0ZWQpIHtcclxuICAgICAgICAgICAgJCh0aGlzLnRvb2xiYXJBdWRpb0J1dHRvbkVsZW1lbnQpLmZpbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHZlY3Rvcl9pY29uXzEuVmVjdG9ySWNvbi5BVURJT19NVVRFX0lDT04pO1xyXG4gICAgICAgICAgICAkKHRoaXMudG9vbGJhckF1ZGlvQnV0dG9uRWxlbWVudCkuYWRkQ2xhc3MoXCJtdXRlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICQodGhpcy50b29sYmFyQXVkaW9CdXR0b25FbGVtZW50KS5maW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uQVVESU9fVU5NVVRFX0lDT04pO1xyXG4gICAgICAgICAgICAkKHRoaXMudG9vbGJhckF1ZGlvQnV0dG9uRWxlbWVudCkucmVtb3ZlQ2xhc3MoXCJtdXRlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZpZGVvTXV0ZWQpIHtcclxuICAgICAgICAgICAgJCh0aGlzLnRvb2xiYXJWaWRlb0J1dHRvbkVsZW1lbnQpLmZpbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHZlY3Rvcl9pY29uXzEuVmVjdG9ySWNvbi5WSURFT19NVVRFX0lDT04pO1xyXG4gICAgICAgICAgICAkKHRoaXMudG9vbGJhclZpZGVvQnV0dG9uRWxlbWVudCkuYWRkQ2xhc3MoXCJtdXRlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICQodGhpcy50b29sYmFyVmlkZW9CdXR0b25FbGVtZW50KS5maW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uVklERU9fVU5NVVRFX0lDT04pO1xyXG4gICAgICAgICAgICAkKHRoaXMudG9vbGJhclZpZGVvQnV0dG9uRWxlbWVudCkucmVtb3ZlQ2xhc3MoXCJtdXRlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVG9vbEJhci5wcm90b3R5cGUuc2V0U2NyZWVuU2hhcmUgPSBmdW5jdGlvbiAob24pIHtcclxuICAgICAgICBpZiAob24pIHtcclxuICAgICAgICAgICAgJChcIi50b29sYm94LWljb25cIiwgdGhpcy50b29sYmFyRGVza3RvcFNoYXJlQnV0dG9uRWxlbWVudCkuYWRkQ2xhc3MoXCJ0b2dnbGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgJChcIi50b29sYm94LWljb25cIiwgdGhpcy50b29sYmFyRGVza3RvcFNoYXJlQnV0dG9uRWxlbWVudCkucmVtb3ZlQ2xhc3MoXCJ0b2dnbGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUb29sQmFyLnByb3RvdHlwZS5zZXRSZWNvcmRpbmcgPSBmdW5jdGlvbiAob24pIHtcclxuICAgICAgICBpZiAob24pIHtcclxuICAgICAgICAgICAgJCh0aGlzLnRvb2xiYXJSZWNvcmRCdXR0b25FbGVtZW50KS5hZGRDbGFzcyhcImxpdmVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAkKHRoaXMudG9vbGJhclJlY29yZEJ1dHRvbkVsZW1lbnQpLnJlbW92ZUNsYXNzKFwibGl2ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVG9vbEJhci5wcm90b3R5cGUuZmFkZUluID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcy5yb290KS5hZGRDbGFzcyhcInZpc2libGVcIik7XHJcbiAgICB9O1xyXG4gICAgVG9vbEJhci5wcm90b3R5cGUuZmFkZU91dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMucm9vdCkucmVtb3ZlQ2xhc3MoXCJ2aXNpYmxlXCIpO1xyXG4gICAgfTtcclxuICAgIFRvb2xCYXIucHJvdG90eXBlLnNob3dVbnJlYWRCYWRnZSA9IGZ1bmN0aW9uIChzaG93KSB7XHJcbiAgICAgICAgdGhpcy5jaGF0dGluZ1VucmVhZEJhZGdlLnN0eWxlLmRpc3BsYXkgPSAhIXNob3cgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xyXG4gICAgfTtcclxuICAgIFRvb2xCYXIucHJvdG90eXBlLnNldFVucmVhZENvdW50ID0gZnVuY3Rpb24gKGNvdW50KSB7XHJcbiAgICAgICAgdGhpcy5jaGF0dGluZ1VucmVhZEJhZGdlLmlubmVySFRNTCA9IFwiXCIgKyBjb3VudDtcclxuICAgIH07XHJcbiAgICBUb29sQmFyLnByb3RvdHlwZS51cGRhdGVCeVJvbGUgPSBmdW5jdGlvbiAoaXNIb3N0KSB7XHJcbiAgICAgICAgdGhpcy50b29sYmFySGFuZFJhaXNlQnV0dG9uRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gaXNIb3N0ID8gXCJub25lXCIgOiBcImlubGluZS1ibG9ja1wiO1xyXG4gICAgICAgIHRoaXMudG9vbGJhck11dGVBbGxCdXR0b25FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAhaXNIb3N0ID8gXCJub25lXCIgOiBcImJsb2NrXCI7XHJcbiAgICAgICAgdGhpcy50b29sYmFyTXV0ZUFsbFZpZGVvQnV0dG9uRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gIWlzSG9zdCA/IFwibm9uZVwiIDogXCJibG9ja1wiO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBUb29sQmFyO1xyXG59KCkpO1xyXG5leHBvcnRzLlRvb2xCYXIgPSBUb29sQmFyO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Ub29sQmFyLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi9jb21wb25lbnRzXFxcXFRvb2xCYXIuanNcIixcIi9jb21wb25lbnRzXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5WaWRlb1BhbmVsID0gZXhwb3J0cy5WaWRlb1BhbmVsUHJvcHMgPSB2b2lkIDA7XHJcbnZhciBNZWRpYVR5cGVfMSA9IHJlcXVpcmUoXCIuLi9lbnVtL01lZGlhVHlwZVwiKTtcclxudmFyIFVzZXJQcm9wZXJ0eV8xID0gcmVxdWlyZShcIi4uL2VudW0vVXNlclByb3BlcnR5XCIpO1xyXG52YXIgc25pcHBldF8xID0gcmVxdWlyZShcIi4uL3V0aWwvc25pcHBldFwiKTtcclxudmFyIHZlY3Rvcl9pY29uXzEgPSByZXF1aXJlKFwiLi92ZWN0b3JfaWNvblwiKTtcclxudmFyIFZpZGVvUGFuZWxQcm9wcyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZGVvUGFuZWxQcm9wcygpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBWaWRlb1BhbmVsUHJvcHM7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVmlkZW9QYW5lbFByb3BzID0gVmlkZW9QYW5lbFByb3BzO1xyXG52YXIgRElTQ09fUkVNT1RFX0NPTlRST0xfRkVBVFVSRSA9ICdodHRwOi8vaml0c2kub3JnL21lZXQvcmVtb3RlY29udHJvbCc7XHJcbnZhciBWaWRlb1BhbmVsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlkZW9QYW5lbChwcm9wcykge1xyXG4gICAgICAgIHRoaXMudmlkZW9FbGVtZW50Q2xhc3MgPSBcInZpZGVvLWVsZW1lbnRcIjtcclxuICAgICAgICB0aGlzLm1vZGVyYXRvckNsYXNzID0gXCJtb2RlcmF0b3ItaWNvblwiO1xyXG4gICAgICAgIHRoaXMuYXVkaW9NdXRlQ2xhc3MgPSBcImF1ZGlvTXV0ZWRcIjtcclxuICAgICAgICB0aGlzLnZpZGVvTXV0ZUNsYXNzID0gXCJ2aWRlb011dGVkXCI7XHJcbiAgICAgICAgdGhpcy51c2VyTmFtZUNsYXNzID0gXCJkaXNwbGF5bmFtZVwiO1xyXG4gICAgICAgIHRoaXMuc2hvcnROYW1lQ2xhc3MgPSBcImF2YXRhci1jb250YWluZXJcIjtcclxuICAgICAgICB0aGlzLmFjdGl2ZVNwZWFrZXJDbGFzcyA9IFwiYWN0aXZlLXNwZWFrZXJcIjtcclxuICAgICAgICB0aGlzLnByaXZhdGVDaGF0Q2xhc3MgPSBcInByaXZhdGUtY2hhdFwiO1xyXG4gICAgICAgIHRoaXMucG9wdXBNZW51QnV0dG9uQ2xhc3MgPSBcInJlbW90ZXZpZGVvbWVudVwiO1xyXG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcclxuICAgICAgICB0aGlzLnBhbmVsQ2xhc3MgPSB0aGlzLnByb3BzLnBhbmVsQ2xhc3M7XHJcbiAgICAgICAgdGhpcy5mdWxsc2NyZWVuQ2xhc3MgPSB0aGlzLnByb3BzLmZ1bGxzY3JlZW5DbGFzcztcclxuICAgICAgICB0aGlzLnBvcHVwTWVudUNsYXNzID0gdGhpcy5wcm9wcy5wb3B1cE1lbnVDbGFzcztcclxuICAgICAgICB0aGlzLklkID0gKytWaWRlb1BhbmVsLm5QYW5lbEluc3RhbmNlSWQ7XHJcbiAgICAgICAgdGhpcy5yb290ID0gdGhpcy5jcmVhdGUoKTtcclxuICAgICAgICB0aGlzLnZpZGVvRWxlbSA9ICQoXCJ2aWRlb1wiLCB0aGlzLnJvb3QpWzBdO1xyXG4gICAgICAgIHRoaXMuYXVkaW9FbGVtID0gJChcImF1ZGlvXCIsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgdGhpcy5uYW1lRWxlbSA9ICQoXCIuXCIgKyB0aGlzLnVzZXJOYW1lQ2xhc3MsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgdGhpcy5hdmF0YXJOYW1lRWxlbSA9ICQoXCIuXCIgKyB0aGlzLnNob3J0TmFtZUNsYXNzLCB0aGlzLnJvb3QpWzBdO1xyXG4gICAgICAgIC8vd2hpdGUgc21hbGwgaWNvbnMgYXQgdGhlIGJvdHRvbSBvZiBwYW5lbFxyXG4gICAgICAgIHRoaXMuYXVkaW9NdXRlSWNvbkVsZW0gPSAkKFwiLlwiICsgdGhpcy5hdWRpb011dGVDbGFzcywgdGhpcy5yb290KVswXTtcclxuICAgICAgICB0aGlzLnZpZGVvTXV0ZUljb25FbGVtID0gJChcIi5cIiArIHRoaXMudmlkZW9NdXRlQ2xhc3MsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgdGhpcy5tb2RlcmF0b3JJY29uRWxlbSA9ICQoXCIuXCIgKyB0aGlzLm1vZGVyYXRvckNsYXNzLCB0aGlzLnJvb3QpWzBdO1xyXG4gICAgICAgIC8vbWVudSBpdGVtcyBcclxuICAgICAgICB0aGlzLmdyYW50TW9kZXJhdG9yTWVudUl0ZW0gPSAkKFwibGkuZ3JhbnQtbW9kZXJhdG9yXCIsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgdGhpcy5hdWRpb011dGVNZW51SXRlbSA9ICQoXCJsaS5hdWRpby1tdXRlXCIsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgdGhpcy52aWRlb011dGVNZW51SXRlbSA9ICQoXCJsaS52aWRlby1tdXRlXCIsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgdGhpcy5mdWxsc2NyZWVuTXV0ZUl0ZW0gPSAkKFwibGkuZnVsbHNjcmVlblwiLCB0aGlzLnJvb3QpWzBdO1xyXG4gICAgICAgIHRoaXMua2lja1BhcnRpY2lwYW50TWVudUl0ZW0gPSAkKFwibGkua2ljay1wYXJ0aWNpcGFudFwiLCB0aGlzLnJvb3QpWzBdO1xyXG4gICAgICAgIHRoaXMucmVtb3RlQ29udHJvbE1lbnVJdGVtID0gJChcImxpLnJlbW90ZS1jb250cm9sXCIsIHRoaXMucm9vdClbMF07XHJcbiAgICAgICAgLy90aGlzLmF0dGFjaEhhbmRsZXJzKCk7XHJcbiAgICB9XHJcbiAgICBWaWRlb1BhbmVsLnByb3RvdHlwZS5hdHRhY2hIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMudGlsZUljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RpbGV2aWV3XCIpO1xyXG4gICAgICAgICQodGhpcy5yb290KVxyXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgXCIuXCIgKyBfdGhpcy5wb3B1cE1lbnVCdXR0b25DbGFzcywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgJChcIi5cIiArIF90aGlzLnBvcHVwTWVudUNsYXNzKS5yZW1vdmVDbGFzcyhcInZpc2libGVcIik7XHJcbiAgICAgICAgICAgICQodGhpcykuZmluZChcIi5cIiArIF90aGlzLnBvcHVwTWVudUNsYXNzKS5hZGRDbGFzcyhcInZpc2libGVcIikuZm9jdXMoKTtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAub24oJ2NsaWNrJywgJ2xpLm92ZXJmbG93LW1lbnUtaXRlbScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICQodGhpcykuY2xvc2VzdChcIi5cIiArIF90aGlzLnBvcHVwTWVudUNsYXNzKS5yZW1vdmVDbGFzcyhcInZpc2libGVcIik7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLm9uKCdjbGljaycsICcuZnVsbHNjcmVlbicsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICQoX3RoaXMucm9vdCkudG9nZ2xlQ2xhc3MoX3RoaXMuZnVsbHNjcmVlbkNsYXNzKTtcclxuICAgICAgICAgICAgX3RoaXMucHJvcHMucmVmcmVzaEdyaWQoKTtcclxuICAgICAgICAgICAgdmFyIGxhYmVsID0gJCh0aGlzKS5maW5kKFwiLmxhYmVsXCIpO1xyXG4gICAgICAgICAgICBpZiAoJChfdGhpcy5yb290KS5oYXNDbGFzcyhfdGhpcy5mdWxsc2NyZWVuQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbC5odG1sKFwiRXhpdCBmdWxsIHNjcmVlblwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxhYmVsLmh0bWwoXCJWaWV3IGZ1bGwgc2NyZWVuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJkaXNwbGF5LXZpZGVvXCIpO1xyXG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiZGlzcGxheS1uYW1lLW9uLXZpZGVvXCIpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoXCJkaXNwbGF5LW5hbWUtb24tdmlkZW9cIik7XHJcbiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJkaXNwbGF5LXZpZGVvXCIpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5vbignZGJsY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCIuZnVsbHNjcmVlblwiKS50cmlnZ2VyKFwiY2xpY2tcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh0aGlzLnRpbGVJY29uKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQoX3RoaXMucm9vdCkudG9nZ2xlQ2xhc3MoX3RoaXMuZnVsbHNjcmVlbkNsYXNzKTtcclxuICAgICAgICAgICAgX3RoaXMucHJvcHMucmVmcmVzaEdyaWQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBWaWRlb1BhbmVsLnByb3RvdHlwZS5zZXRTaG90bmFtZVZpc2libGUgPSBmdW5jdGlvbiAoc2hvdykge1xyXG4gICAgICAgIHRoaXMuYXZhdGFyTmFtZUVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgICAgICB0aGlzLnZpZGVvRWxlbS5zdHlsZS52aXNpYmlsaXR5ID0gc2hvdyA/IFwiaGlkZGVuXCIgOiBcInZpc2libGVcIjtcclxuICAgIH07XHJcbiAgICBWaWRlb1BhbmVsLnByb3RvdHlwZS5zZXRVc2VyTmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lRWxlbS5pbm5lckhUTUwgPSBuYW1lO1xyXG4gICAgICAgICQoXCJ0ZXh0XCIsIHRoaXMuYXZhdGFyTmFtZUVsZW0pLmh0bWwoc25pcHBldF8xLmF2YXRhck5hbWUobmFtZSkpO1xyXG4gICAgfTtcclxuICAgIFZpZGVvUGFuZWwucHJvdG90eXBlLnNob3dNb2RlcmF0b3JJY29uID0gZnVuY3Rpb24gKHNob3cpIHtcclxuICAgICAgICB0aGlzLm1vZGVyYXRvckljb25FbGVtLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgICB9O1xyXG4gICAgVmlkZW9QYW5lbC5wcm90b3R5cGUuc2V0SGlnaGxpZ2h0ID0gZnVuY3Rpb24gKGgpIHtcclxuICAgICAgICBpZiAoaClcclxuICAgICAgICAgICAgJCh0aGlzLnJvb3QpLmFkZENsYXNzKHRoaXMuYWN0aXZlU3BlYWtlckNsYXNzKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICQodGhpcy5yb290KS5yZW1vdmVDbGFzcyh0aGlzLmFjdGl2ZVNwZWFrZXJDbGFzcyk7XHJcbiAgICB9O1xyXG4gICAgVmlkZW9QYW5lbC5wcm90b3R5cGUudXBkYXRlUGFuZWxPbkppdHNpVXNlciA9IGZ1bmN0aW9uIChteUluZm8sIGppdHNpVXNlcikge1xyXG4gICAgICAgIHZhciBfdGhpc18xID0gdGhpcztcclxuICAgICAgICAvL3NldCBuYW1lXHJcbiAgICAgICAgdGhpcy5zZXRVc2VyTmFtZShqaXRzaVVzZXIuZ2V0RGlzcGxheU5hbWUoKSk7XHJcbiAgICAgICAgLy9oaWRlIHNob3RuYW1lIGlmIGV4aXN0IHZpc2libGUgdmlkZW8gdHJhY2tcclxuICAgICAgICB2YXIgaXNWaXNpYmxlVmlkZW8gPSBmYWxzZTtcclxuICAgICAgICBqaXRzaVVzZXIuZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPICYmICF0cmFjay5pc011dGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIGlzVmlzaWJsZVZpZGVvID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc2V0U2hvdG5hbWVWaXNpYmxlKCFpc1Zpc2libGVWaWRlbyk7XHJcbiAgICAgICAgLy9ib3R0b20gc21hbGwgaWNvbnNcclxuICAgICAgICB0aGlzLnZpZGVvTXV0ZUljb25FbGVtLnN0eWxlLmRpc3BsYXkgPSBqaXRzaVVzZXIuaXNWaWRlb011dGVkKCkgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgICAgICB0aGlzLmF1ZGlvTXV0ZUljb25FbGVtLnN0eWxlLmRpc3BsYXkgPSBqaXRzaVVzZXIuaXNBdWRpb011dGVkKCkgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgICAgICB0aGlzLm1vZGVyYXRvckljb25FbGVtLnN0eWxlLmRpc3BsYXkgPSBqaXRzaVVzZXIuZ2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LklzSG9zdCkgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgICAgICAvL3BvcHVwIG1lbnVcclxuICAgICAgICBpZiAobXlJbmZvLklzSG9zdCkge1xyXG4gICAgICAgICAgICB2YXIgdXNlckhhdmVDYW1lcmFfMSA9IGZhbHNlLCB1c2VySGF2ZU1pY3JvcGhvbmVfMSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBqaXRzaVVzZXIuZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTylcclxuICAgICAgICAgICAgICAgICAgICB1c2VySGF2ZUNhbWVyYV8xID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPKVxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJIYXZlTWljcm9waG9uZV8xID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9NdXRlTWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IHVzZXJIYXZlQ2FtZXJhXzEgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xyXG4gICAgICAgICAgICB0aGlzLmF1ZGlvTXV0ZU1lbnVJdGVtLnN0eWxlLmRpc3BsYXkgPSB1c2VySGF2ZU1pY3JvcGhvbmVfMSA/IFwiZmxleFwiIDogXCJub25lXCI7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JhbnRNb2RlcmF0b3JNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgIHRoaXMua2lja1BhcnRpY2lwYW50TWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW90ZUNvbnRyb2xNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIGppdHNpVXNlci5nZXRGZWF0dXJlcygpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZmVhdHVyZXMpIHtcclxuICAgICAgICAgICAgICAgIC8qKi9cclxuICAgICAgICAgICAgICAgIHZhciBiID0gZmVhdHVyZXMuaGFzKERJU0NPX1JFTU9URV9DT05UUk9MX0ZFQVRVUkUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGIpXHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXNfMS5yZW1vdGVDb250cm9sTWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCItLS0tLS0tLS0tLS0tdXNlcjpcIiArIGIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaml0c2lVc2VyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnZpZGVvTXV0ZU1lbnVJdGVtLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgdGhpcy5hdWRpb011dGVNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JhbnRNb2RlcmF0b3JNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIHRoaXMua2lja1BhcnRpY2lwYW50TWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICB0aGlzLnJlbW90ZUNvbnRyb2xNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChqaXRzaVVzZXIuZ2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LklzSG9zdCkpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmFudE1vZGVyYXRvck1lbnVJdGVtLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgdGhpcy5raWNrUGFydGljaXBhbnRNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3RlQ29udHJvbE1lbnVJdGVtLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9wb3B1cCBtZW51IGF1ZGlvIGljb24vbGFiZWwgY2hhbmdlXHJcbiAgICAgICAgaWYgKHRoaXMuYXVkaW9NdXRlTWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9PT0gJ2ZsZXgnKSB7XHJcbiAgICAgICAgICAgIGlmIChqaXRzaVVzZXIuaXNBdWRpb011dGVkKCkpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcy5hdWRpb011dGVNZW51SXRlbSkuZmluZChcIi5sYWJlbFwiKS5odG1sKFwiVW5tdXRlIEF1ZGlvXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzLmF1ZGlvTXV0ZU1lbnVJdGVtKS5maW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uQVVESU9fTVVURV9JQ09OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQodGhpcy5hdWRpb011dGVNZW51SXRlbSkuZmluZChcIi5sYWJlbFwiKS5odG1sKFwiTXV0ZSBBdWRpb1wiKTtcclxuICAgICAgICAgICAgICAgICQodGhpcy5hdWRpb011dGVNZW51SXRlbSkuZmluZChcInBhdGhcIikuYXR0cihcImRcIiwgdmVjdG9yX2ljb25fMS5WZWN0b3JJY29uLkFVRElPX1VOTVVURV9JQ09OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy52aWRlb011dGVNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID09PSAnZmxleCcpIHtcclxuICAgICAgICAgICAgaWYgKGppdHNpVXNlci5pc1ZpZGVvTXV0ZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzLnZpZGVvTXV0ZU1lbnVJdGVtKS5maW5kKFwiLmxhYmVsXCIpLmh0bWwoXCJVbm11dGUgVmlkZW9cIik7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMudmlkZW9NdXRlTWVudUl0ZW0pLmZpbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHZlY3Rvcl9pY29uXzEuVmVjdG9ySWNvbi5WSURFT19NVVRFX0lDT04pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzLnZpZGVvTXV0ZU1lbnVJdGVtKS5maW5kKFwiLmxhYmVsXCIpLmh0bWwoXCJNdXRlIFZpZGVvXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzLnZpZGVvTXV0ZU1lbnVJdGVtKS5maW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uVklERU9fVU5NVVRFX0lDT04pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vcG9wdXAgbWVudSBoYW5kbGVyc1xyXG4gICAgICAgIGlmIChteUluZm8uSXNIb3N0KSB7XHJcbiAgICAgICAgICAgICQodGhpcy5ncmFudE1vZGVyYXRvck1lbnVJdGVtKS51bmJpbmQoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXNfMS5wcm9wcy5ncmFudE1vZGVyYXRvclJvbGUoaml0c2lVc2VyLmdldElkKCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgJCh0aGlzLmF1ZGlvTXV0ZU1lbnVJdGVtKS51bmJpbmQoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXNfMS5wcm9wcy5tdXRlVXNlckF1ZGlvKGppdHNpVXNlci5nZXRJZCgpLCAhaml0c2lVc2VyLmlzQXVkaW9NdXRlZCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICQodGhpcy52aWRlb011dGVNZW51SXRlbSkudW5iaW5kKCdjbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzXzEucHJvcHMubXV0ZVVzZXJWaWRlbyhqaXRzaVVzZXIuZ2V0SWQoKSwgIWppdHNpVXNlci5pc1ZpZGVvTXV0ZWQoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkKHRoaXMua2lja1BhcnRpY2lwYW50TWVudUl0ZW0pLnVuYmluZCgnY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpc18xLnByb3BzLmtpY2tQYXJ0aWNpcGFudE91dChqaXRzaVVzZXIuZ2V0SWQoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkKHRoaXMucmVtb3RlQ29udHJvbE1lbnVJdGVtKS51bmJpbmQoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXNfMS5wcm9wcy5zZW5kUmVtb3RlQ29udHJvbFJlcGx5KCdwZXJtaXNzaW9ucycsIHt9LCBqaXRzaVVzZXIuZ2V0SWQoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3ByaXZhdGUgY2hhdCBoYW5kbGVyXHJcbiAgICAgICAgJCh0aGlzLnJvb3QpLmZpbmQoXCIuXCIgKyB0aGlzLnByaXZhdGVDaGF0Q2xhc3MpLnVuYmluZCgnY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzXzEucHJvcHMub3BlblByaXZhdGVDaGF0KGppdHNpVXNlci5nZXRJZCgpLCBqaXRzaVVzZXIuZ2V0RGlzcGxheU5hbWUoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9hY3RpdmUgc3BlYWtlcihibHVlIGJvcmRlcilcclxuICAgICAgICAkKHRoaXMucm9vdCkucmVtb3ZlQ2xhc3ModGhpcy5hY3RpdmVTcGVha2VyQ2xhc3MpO1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgJCh0aGlzLnJvb3QpLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAvL2UucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgaWYgKGUud2hpY2ggPT09IDMpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYWUgPSB7XHJcbiAgICAgICAgICAgICAgICBidXR0b246IGUuYnV0dG9uICsgMSxcclxuICAgICAgICAgICAgICAgIHg6IGUub2Zmc2V0WCxcclxuICAgICAgICAgICAgICAgIHk6IGUub2Zmc2V0WVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy5zZW5kUmVtb3RlQ29udHJvbFJlcGx5KCdtb3VzZWRvd24nLCBhZSwgaml0c2lVc2VyLmdldElkKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQodGhpcy5yb290KS5vbignbW91c2V1cCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIC8vZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBpZiAoZS53aGljaCA9PT0gMylcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdmFyIGFlID0ge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uOiBlLmJ1dHRvbiArIDEsXHJcbiAgICAgICAgICAgICAgICB4OiBlLm9mZnNldFgsXHJcbiAgICAgICAgICAgICAgICB5OiBlLm9mZnNldFlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgX3RoaXMucHJvcHMuc2VuZFJlbW90ZUNvbnRyb2xSZXBseSgnbW91c2V1cCcsIGFlLCBqaXRzaVVzZXIuZ2V0SWQoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIGVuYWJsZUhhbmRsZXIgPSB0cnVlO1xyXG4gICAgICAgICQodGhpcy5yb290KS5vbignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKGVuYWJsZUhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiBlLmJ1dHRvbiArIDEsXHJcbiAgICAgICAgICAgICAgICAgICAgeDogZS5vZmZzZXRYIC8gdGhpcy5vZmZzZXRXaWR0aCxcclxuICAgICAgICAgICAgICAgICAgICB5OiBlLm9mZnNldFkgLyB0aGlzLm9mZnNldEhlaWdodFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLnNlbmRSZW1vdGVDb250cm9sUmVwbHkoJ21vdXNlbW92ZScsIGFlLCBqaXRzaVVzZXIuZ2V0SWQoKSk7XHJcbiAgICAgICAgICAgICAgICBlbmFibGVIYW5kbGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgdGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBlbmFibGVIYW5kbGVyID0gdHJ1ZTtcclxuICAgICAgICB9LCAyMDApO1xyXG4gICAgICAgICQod2luZG93KS51bmJpbmQoKS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RpZmllcnMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVycy5wdXNoKCdzaGlmdCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlLmN0cmxLZXkpIHtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVycy5wdXNoKCdjb250cm9sJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGUuYWx0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllcnMucHVzaCgnYWx0Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGUubWV0YUtleSkge1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ2NvbW1hbmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYWUgPSB7XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllcnM6IG1vZGlmaWVycyxcclxuICAgICAgICAgICAgICAgIGtleTogZS5rZXlDb2RlLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBfdGhpcy5wcm9wcy5zZW5kUmVtb3RlQ29udHJvbFJlcGx5KCdrZXlkb3duJywgYWUsIGppdHNpVXNlci5nZXRJZCgpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKHdpbmRvdykub24oJ2tleXVwJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIG1vZGlmaWVycyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ3NoaWZ0Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGUuY3RybEtleSkge1xyXG4gICAgICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ2NvbnRyb2wnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZS5hbHRLZXkpIHtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVycy5wdXNoKCdhbHQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZS5tZXRhS2V5KSB7XHJcbiAgICAgICAgICAgICAgICBtb2RpZmllcnMucHVzaCgnY29tbWFuZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBhZSA9IHtcclxuICAgICAgICAgICAgICAgIG1vZGlmaWVyczogbW9kaWZpZXJzLFxyXG4gICAgICAgICAgICAgICAga2V5OiBlLmtleUNvZGUsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIF90aGlzLnByb3BzLnNlbmRSZW1vdGVDb250cm9sUmVwbHkoJ2tleXVwJywgYWUsIGppdHNpVXNlci5nZXRJZCgpKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBWaWRlb1BhbmVsLnByb3RvdHlwZS51cGRhdGVQYW5lbE9uTXlCR1VzZXIgPSBmdW5jdGlvbiAobXlJbmZvLCBsb2NhbFRyYWNrcykge1xyXG4gICAgICAgIHZhciBfdGhpc18xID0gdGhpcztcclxuICAgICAgICB2YXIgYXVkaW9NdXRlZCA9IHRydWUsIHZpZGVvTXV0ZWQgPSB0cnVlO1xyXG4gICAgICAgIGxvY2FsVHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTyAmJiAhdHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgdmlkZW9NdXRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTyAmJiAhdHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgYXVkaW9NdXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vbmFtZVxyXG4gICAgICAgIHRoaXMuc2V0VXNlck5hbWUobXlJbmZvLk5hbWUpO1xyXG4gICAgICAgIHZhciBpc1Zpc2libGVWaWRlbyA9IGZhbHNlO1xyXG4gICAgICAgIGxvY2FsVHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTyAmJiAhdHJhY2suaXNNdXRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICBpc1Zpc2libGVWaWRlbyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNldFNob3RuYW1lVmlzaWJsZSghaXNWaXNpYmxlVmlkZW8pO1xyXG4gICAgICAgIC8vYm90dG9tIHNtYWxsIGljb25zXHJcbiAgICAgICAgdGhpcy52aWRlb011dGVJY29uRWxlbS5zdHlsZS5kaXNwbGF5ID0gdmlkZW9NdXRlZCA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xyXG4gICAgICAgIHRoaXMuYXVkaW9NdXRlSWNvbkVsZW0uc3R5bGUuZGlzcGxheSA9IGF1ZGlvTXV0ZWQgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgICAgICB0aGlzLm1vZGVyYXRvckljb25FbGVtLnN0eWxlLmRpc3BsYXkgPSBteUluZm8uSXNIb3N0ID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgICAgICAgLy9wb3B1cCBtZW51XHJcbiAgICAgICAgaWYgKG15SW5mby5Jc0hvc3QpIHtcclxuICAgICAgICAgICAgdGhpcy52aWRlb011dGVNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gbXlJbmZvLm1lZGlhUG9saWN5LnVzZUNhbWVyYSA/IFwiZmxleFwiIDogXCJub25lXCI7XHJcbiAgICAgICAgICAgIHRoaXMuYXVkaW9NdXRlTWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IG15SW5mby5tZWRpYVBvbGljeS51c2VNaWMgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy52aWRlb011dGVNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIHRoaXMuYXVkaW9NdXRlTWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdyYW50TW9kZXJhdG9yTWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIHRoaXMua2lja1BhcnRpY2lwYW50TWVudUl0ZW0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIHRoaXMucmVtb3RlQ29udHJvbE1lbnVJdGVtLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAvL3BvcHVwIG1lbnUgYXVkaW8gaWNvbi9sYWJlbCBjaGFuZ2VcclxuICAgICAgICBpZiAodGhpcy5hdWRpb011dGVNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID09PSAnZmxleCcpIHtcclxuICAgICAgICAgICAgaWYgKGF1ZGlvTXV0ZWQpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcy5hdWRpb011dGVNZW51SXRlbSkuZmluZChcIi5sYWJlbFwiKS5odG1sKFwiVW5tdXRlIEF1ZGlvXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzLmF1ZGlvTXV0ZU1lbnVJdGVtKS5maW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uQVVESU9fTVVURV9JQ09OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQodGhpcy5hdWRpb011dGVNZW51SXRlbSkuZmluZChcIi5sYWJlbFwiKS5odG1sKFwiTXV0ZSBBdWRpb1wiKTtcclxuICAgICAgICAgICAgICAgICQodGhpcy5hdWRpb011dGVNZW51SXRlbSkuZmluZChcInBhdGhcIikuYXR0cihcImRcIiwgdmVjdG9yX2ljb25fMS5WZWN0b3JJY29uLkFVRElPX1VOTVVURV9JQ09OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy52aWRlb011dGVNZW51SXRlbS5zdHlsZS5kaXNwbGF5ID09PSAnZmxleCcpIHtcclxuICAgICAgICAgICAgaWYgKHZpZGVvTXV0ZWQpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcy52aWRlb011dGVNZW51SXRlbSkuZmluZChcIi5sYWJlbFwiKS5odG1sKFwiVW5tdXRlIFZpZGVvXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzLnZpZGVvTXV0ZU1lbnVJdGVtKS5maW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCB2ZWN0b3JfaWNvbl8xLlZlY3Rvckljb24uVklERU9fTVVURV9JQ09OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQodGhpcy52aWRlb011dGVNZW51SXRlbSkuZmluZChcIi5sYWJlbFwiKS5odG1sKFwiTXV0ZSBWaWRlb1wiKTtcclxuICAgICAgICAgICAgICAgICQodGhpcy52aWRlb011dGVNZW51SXRlbSkuZmluZChcInBhdGhcIikuYXR0cihcImRcIiwgdmVjdG9yX2ljb25fMS5WZWN0b3JJY29uLlZJREVPX1VOTVVURV9JQ09OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL3BvcHVwIG1lbnUgaGFuZGxlcnNcclxuICAgICAgICBpZiAobXlJbmZvLklzSG9zdCkge1xyXG4gICAgICAgICAgICAkKHRoaXMuYXVkaW9NdXRlTWVudUl0ZW0pLnVuYmluZCgnY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpc18xLnByb3BzLm11dGVNeUF1ZGlvKCFhdWRpb011dGVkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICQodGhpcy52aWRlb011dGVNZW51SXRlbSkudW5iaW5kKCdjbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzXzEucHJvcHMubXV0ZU15VmlkZW8oIXZpZGVvTXV0ZWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9oaWRlIHByaXZhdGUtY2hhdCBpdGVtXHJcbiAgICAgICAgJCh0aGlzLnJvb3QpLmZpbmQoXCIuXCIgKyB0aGlzLnByaXZhdGVDaGF0Q2xhc3MpLmhpZGUoKTtcclxuICAgICAgICAvL2FjdGl2ZSBzcGVha2VyKGJsdWUgYm9yZGVyKVxyXG4gICAgICAgICQodGhpcy5yb290KS5hZGRDbGFzcyh0aGlzLmFjdGl2ZVNwZWFrZXJDbGFzcyk7XHJcbiAgICB9O1xyXG4gICAgVmlkZW9QYW5lbC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB2aWRlb1RhZyA9IFwiPHZpZGVvIGF1dG9wbGF5IHBsYXlzaW5saW5lIHN0eWxlPSdvYmplY3QtZml0OmNvdmVyOyAnICBjbGFzcz0nXCIgKyB0aGlzLnZpZGVvRWxlbWVudENsYXNzICsgXCInIGlkPSdyZW1vdGVWaWRlb19cIiArIHRoaXMuSWQgKyBcIic+PC92aWRlbz5cIjtcclxuICAgICAgICB2YXIgYXVkaW9UYWcgPSBcIjxhdWRpbyBhdXRvcGxheT1cXFwiXFxcIiBpZD1cXFwicmVtb3RlQXVkaW9fXCIgKyB0aGlzLklkICsgXCJcXFwiPjwvYXVkaW8+XCI7XHJcbiAgICAgICAgdmFyIGF2YXRhclZpc2libGUgPSAndmlzaWJsZSc7XHJcbiAgICAgICAgdmFyIGNhbWVyYVN0YXR1cyA9ICc8ZGl2IGNsYXNzPVwiaW5kaWNhdG9yLWNvbnRhaW5lciB2aWRlb011dGVkXCI+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaW5kaWNhdG9yLWljb24tY29udGFpbmVyICB0b29sYmFyLWljb25cIiBpZD1cIlwiPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaml0c2ktaWNvbiBcIj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgaGVpZ2h0PVwiMTNcIiBpZD1cImNhbWVyYS1kaXNhYmxlZFwiIHdpZHRoPVwiMTNcIiB2aWV3Qm94PVwiMCAwIDMyIDMyXCI+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD1cIk00LjM3NSAyLjY4OEwyOCAyNi4zMTNsLTEuNjg4IDEuNjg4LTQuMjUtNC4yNWMtLjE4OC4xMjUtLjUuMjUtLjc1LjI1aC0xNmMtLjc1IDAtMS4zMTMtLjU2My0xLjMxMy0xLjMxM1Y5LjMxM2MwLS43NS41NjMtMS4zMTMgMS4zMTMtMS4zMTNoMUwyLjY4NyA0LjM3NXptMjMuNjI1IDZ2MTQuMjVMMTMuMDYyIDhoOC4yNWMuNzUgMCAxLjM3NS41NjMgMS4zNzUgMS4zMTN2NC42ODh6XCI+PC9wYXRoPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PiBcXFxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj4nO1xyXG4gICAgICAgIHZhciBtaWNTdGF0dXMgPSAnPGRpdiBjbGFzcz1cImluZGljYXRvci1jb250YWluZXIgYXVkaW9NdXRlZFwiPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaW5kaWNhdG9yLWljb24tY29udGFpbmVyICB0b29sYmFyLWljb25cIiBpZD1cIlwiPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImppdHNpLWljb24gXCI+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBoZWlnaHQ9XCIxM1wiIGlkPVwibWljLWRpc2FibGVkXCIgd2lkdGg9XCIxM1wiIHZpZXdCb3g9XCIwIDAgMzIgMzJcIj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD1cIk01LjY4OCA0bDIyLjMxMyAyMi4zMTMtMS42ODggMS42ODgtNS41NjMtNS41NjNjLTEgLjYyNS0yLjI1IDEtMy40MzggMS4xODh2NC4zNzVoLTIuNjI1di00LjM3NWMtNC4zNzUtLjYyNS04LTQuMzc1LTgtOC45MzhoMi4yNWMwIDQgMy4zNzUgNi43NSA3LjA2MyA2Ljc1IDEuMDYzIDAgMi4xMjUtLjI1IDMuMDYzLS42ODhsLTIuMTg4LTIuMTg4Yy0uMjUuMDYzLS41NjMuMTI1LS44NzUuMTI1LTIuMTg4IDAtNC0xLjgxMy00LTR2LTFsLTgtOHpNMjAgMTQuODc1bC04LTcuOTM4di0uMjVjMC0yLjE4OCAxLjgxMy00IDQtNHM0IDEuODEzIDQgNHY4LjE4OHptNS4zMTMtLjE4N2E4LjgyNCA4LjgyNCAwIDAxLTEuMTg4IDQuMzc1TDIyLjUgMTcuMzc1Yy4zNzUtLjgxMy41NjMtMS42ODguNTYzLTIuNjg4aDIuMjV6XCI+PC9wYXRoPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pic7XHJcbiAgICAgICAgdmFyIG1vZGVyYXRvclN0YXR1cyA9ICc8ZGl2IGNsYXNzPVwibW9kZXJhdG9yLWljb24gcmlnaHRcIj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImluZGljYXRvci1jb250YWluZXJcIj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpbmRpY2F0b3ItaWNvbi1jb250YWluZXIgZm9jdXNpbmRpY2F0b3IgdG9vbGJhci1pY29uXCIgaWQ9XCJcIj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImppdHNpLWljb24gXCI+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGhlaWdodD1cIjEzXCIgd2lkdGg9XCIxM1wiIHZpZXdCb3g9XCIwIDAgMzIgMzJcIj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPVwiTTE2IDIwLjU2M2w1IDMtMS4zMTMtNS42ODhMMjQuMTI1IDE0bC01Ljg3NS0uNUwxNiA4LjEyNSAxMy43NSAxMy41bC01Ljg3NS41IDQuNDM4IDMuODc1TDExIDIzLjU2M3ptMTMuMzEzLTguMjVsLTcuMjUgNi4zMTMgMi4xODggOS4zNzUtOC4yNS01LTguMjUgNSAyLjE4OC05LjM3NS03LjI1LTYuMzEzIDkuNTYzLS44MTMgMy43NS04LjgxMyAzLjc1IDguODEzelwiPjwvcGF0aD4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPiBcXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+IFxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JztcclxuICAgICAgICB2YXIgcGFuZWxIdG1sID0gXCJcXG4gICAgICAgIDxzcGFuIGNsYXNzPVxcXCJcIiArIHRoaXMucGFuZWxDbGFzcyArIFwiIGRpc3BsYXktdmlkZW9cXFwiIG9uQ29udGV4dE1lbnUgPSBcXFwicmV0dXJuIGZhbHNlO1xcXCI+XFxuXFxuICAgICAgICAgICAgPGxhYmVsPlZlcnNpb24gMS4xPC9sYWJlbD5cXG5cXG4gICAgICAgICAgICBcIiArIHZpZGVvVGFnICsgXCIgXFxuICAgICAgICAgICAgXCIgKyBhdWRpb1RhZyArIFwiXFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwidmlkZW9jb250YWluZXJfX3Rvb2xiYXJcXFwiPlxcbiAgICAgICAgICAgICAgICA8ZGl2PiBcIiArIGNhbWVyYVN0YXR1cyArIFwiIFwiICsgbWljU3RhdHVzICsgXCIgXCIgKyBtb2RlcmF0b3JTdGF0dXMgKyBcIjwvZGl2PlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcInZpZGVvY29udGFpbmVyX19ob3Zlck92ZXJsYXlcXFwiPjwvZGl2PlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImRpc3BsYXlOYW1lQ29udGFpbmVyXFxcIj48c3BhbiBjbGFzcz1cXFwiZGlzcGxheW5hbWVcXFwiIGlkPVxcXCJsb2NhbERpc3BsYXlOYW1lXFxcIj5OYW1lPC9zcGFuPlxcbiAgICAgICAgICAgIFxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImF2YXRhci1jb250YWluZXIgXCIgKyBhdmF0YXJWaXNpYmxlICsgXCJcXFwiIHN0eWxlPVxcXCJoZWlnaHQ6IDEwNS41cHg7IHdpZHRoOiAxMDUuNXB4O1xcXCI+XFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImF2YXRhciAgdXNlckF2YXRhclxcXCIgc3R5bGU9XFxcImJhY2tncm91bmQtY29sb3I6IHJnYmEoMjM0LCAyNTUsIDEyOCwgMC40KTsgZm9udC1zaXplOiAxODAlOyBoZWlnaHQ6IDEwMCU7IHdpZHRoOiAxMDAlO1xcXCI+XFxuICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPVxcXCJhdmF0YXItc3ZnXFxcIiB2aWV3Qm94PVxcXCIwIDAgMTAwIDEwMFxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIiB4bWxuczp4bGluaz1cXFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1xcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPHRleHQgZG9taW5hbnQtYmFzZWxpbmU9XFxcImNlbnRyYWxcXFwiIGZpbGw9XFxcInJnYmEoMjU1LDI1NSwyNTUsLjYpXFxcIiBmb250LXNpemU9XFxcIjQwcHRcXFwiIHRleHQtYW5jaG9yPVxcXCJtaWRkbGVcXFwiIHg9XFxcIjUwXFxcIiB5PVxcXCI1MFxcXCI+TmFtZTwvdGV4dD5cXG4gICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2RpdiA+XFxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIlwiICsgdGhpcy5wb3B1cE1lbnVCdXR0b25DbGFzcyArIFwiXFxcIj5cXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiXFxcIiBpZD1cXFwiXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJwb3BvdmVyLXRyaWdnZXIgcmVtb3RlLXZpZGVvLW1lbnUtdHJpZ2dlclxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaml0c2ktaWNvblxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgaGVpZ2h0PVxcXCIxZW1cXFwiIHdpZHRoPVxcXCIxZW1cXFwiIHZpZXdCb3g9XFxcIjAgMCAyNCAyNFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPVxcXCJNMTIgMTUuOTg0YzEuMDc4IDAgMi4wMTYuOTM4IDIuMDE2IDIuMDE2cy0uOTM4IDIuMDE2LTIuMDE2IDIuMDE2UzkuOTg0IDE5LjA3OCA5Ljk4NCAxOHMuOTM4LTIuMDE2IDIuMDE2LTIuMDE2em0wLTZjMS4wNzggMCAyLjAxNi45MzggMi4wMTYgMi4wMTZzLS45MzggMi4wMTYtMi4wMTYgMi4wMTZTOS45ODQgMTMuMDc4IDkuOTg0IDEyIDEwLjkyMiA5Ljk4NCAxMiA5Ljk4NHptMC0xLjk2OGMtMS4wNzggMC0yLjAxNi0uOTM4LTIuMDE2LTIuMDE2UzEwLjkyMiAzLjk4NCAxMiAzLjk4NHMyLjAxNi45MzggMi4wMTYgMi4wMTZTMTMuMDc4IDguMDE2IDEyIDguMDE2elxcXCI+PC9wYXRoPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XFxuICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJcIiArIHRoaXMucG9wdXBNZW51Q2xhc3MgKyBcIlxcXCIgdGFiSW5kZXg9LTEgc3R5bGU9XFxcInBvc2l0aW9uOiByZWxhdGl2ZTsgcmlnaHQ6IDE2OHB4OyAgdG9wOiAyNXB4OyB3aWR0aDogMTc1cHg7XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDx1bCBhcmlhLWxhYmVsPVxcXCJNb3JlIGFjdGlvbnMgbWVudVxcXCIgY2xhc3M9XFxcIm92ZXJmbG93LW1lbnVcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBhcmlhLWxhYmVsPVxcXCJHcmFudCBNb2RlcmF0b3JcXFwiIGNsYXNzPVxcXCJvdmVyZmxvdy1tZW51LWl0ZW0gZ3JhbnQtbW9kZXJhdG9yXFxcIiB0YWJpbmRleD1cXFwiMFxcXCIgcm9sZT1cXFwiYnV0dG9uXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm92ZXJmbG93LW1lbnUtaXRlbS1pY29uXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImppdHNpLWljb24gXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGhlaWdodD1cXFwiMjJcXFwiIHdpZHRoPVxcXCIyMlxcXCIgdmlld0JveD1cXFwiMCAwIDI0IDI0XFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZmlsbC1ydWxlPVxcXCJldmVub2RkXFxcIiBjbGlwLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIGQ9XFxcIk0xNCA0YTIgMiAwIDAxLTEuMjk4IDEuODczbDEuNTI3IDQuMDcuNzE2IDEuOTEyYy4wNjIuMDc0LjEyNi4wNzQuMTY1LjAzNWwxLjQ0NC0xLjQ0NCAyLjAzMi0yLjAzMmEyIDIgMCAxMTEuMjQ4LjU3OUwxOSAxOWEyIDIgMCAwMS0yIDJIN2EyIDIgMCAwMS0yLTJMNC4xNjYgOC45OTNhMiAyIDAgMTExLjI0OC0uNTc5bDIuMDMzIDIuMDMzTDguODkgMTEuODljLjA4Ny4wNDIuMTQ1LjAxNi4xNjUtLjAzNWwuNzE2LTEuOTEyIDEuNTI3LTQuMDdBMiAyIDAgMTExNCA0ek02Ljg0IDE3bC0uMzkzLTQuNzI1IDEuMDI5IDEuMDNhMi4xIDIuMSAwIDAwMy40NTEtLjc0OEwxMiA5LjY5NmwxLjA3MyAyLjg2YTIuMSAyLjEgMCAwMDMuNDUxLjc0OGwxLjAzLTEuMDNMMTcuMTYgMTdINi44NHpcXFwiPjwvcGF0aD4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibGFiZWxcXFwiPkdyYW50IE1vZGVyYXRvcjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBhcmlhLWxhYmVsPVxcXCJNdXRlXFxcIiBjbGFzcz1cXFwib3ZlcmZsb3ctbWVudS1pdGVtIGF1ZGlvLW11dGVcXFwiIHRhYmluZGV4PVxcXCIwXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwib3ZlcmZsb3ctbWVudS1pdGVtLWljb25cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaml0c2ktaWNvbiBcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgZmlsbD1cXFwibm9uZVxcXCIgaGVpZ2h0PVxcXCIyMlxcXCIgd2lkdGg9XFxcIjIyXFxcIiB2aWV3Qm94PVxcXCIwIDAgMjIgMjJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBmaWxsLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIGNsaXAtcnVsZT1cXFwiZXZlbm9kZFxcXCIgZD1cXFwiTTcuMzMzIDguNjVWMTFhMy42NjggMy42NjggMCAwMDIuNzU3IDMuNTUzLjkyOC45MjggMCAwMC0uMDA3LjExNHYxLjc1N0E1LjUwMSA1LjUwMSAwIDAxNS41IDExYS45MTcuOTE3IDAgMTAtMS44MzMgMGMwIDMuNzQgMi43OTkgNi44MjYgNi40MTYgNy4yNzd2Ljk3M2EuOTE3LjkxNyAwIDAwMS44MzQgMHYtLjk3M2E3LjI5NyA3LjI5NyAwIDAwMy41NjgtMS40NzVsMy4wOTEgMy4wOTJhLjkzMi45MzIgMCAxMDEuMzE4LTEuMzE4bC0zLjA5MS0zLjA5MS4wMS0uMDEzLTEuMzExLTEuMzExLS4wMS4wMTMtMS4zMjUtMS4zMjUuMDA4LS4wMTQtMS4zOTUtMS4zOTVhMS4yNCAxLjI0IDAgMDEtLjAwNC4wMThsLTMuNjEtMy42MDl2LS4wMjNMNy4zMzQgNS45OTN2LjAyM2wtMy45MDktMy45MWEuOTMyLjkzMiAwIDEwLTEuMzE4IDEuMzE4TDcuMzMzIDguNjV6bTEuODM0IDEuODM0VjExYTEuODMzIDEuODMzIDAgMDAyLjI5MSAxLjc3NmwtMi4yOTEtMi4yOTJ6bTMuNjgyIDMuNjgzYy0uMjkuMTctLjYwNi4zLS45NC4zODZhLjkyOC45MjggMCAwMS4wMDguMTE0djEuNzU3YTUuNDcgNS40NyAwIDAwMi4yNTctLjkzMmwtMS4zMjUtMS4zMjV6bTEuODE4LTMuNDc2bC0xLjgzNC0xLjgzNFY1LjVhMS44MzMgMS44MzMgMCAwMC0zLjY0NC0uMjg3bC0xLjQzLTEuNDNBMy42NjYgMy42NjYgMCAwMTE0LjY2NyA1LjV2NS4xOXptMS42NjUgMS42NjVsMS40NDcgMS40NDdjLjM1Ny0uODY0LjU1NC0xLjgxLjU1NC0yLjgwM2EuOTE3LjkxNyAwIDEwLTEuODMzIDBjMCAuNDY4LS4wNTguOTIyLS4xNjggMS4zNTZ6XFxcIj48L3BhdGg+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImxhYmVsXFxcIj5NdXRlPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGFyaWEtbGFiZWw9XFxcIkRpc2FibGUgY2FtZXJhXFxcIiBjbGFzcz1cXFwib3ZlcmZsb3ctbWVudS1pdGVtIHZpZGVvLW11dGVcXFwiIHRhYmluZGV4PVxcXCIwXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwib3ZlcmZsb3ctbWVudS1pdGVtLWljb25cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaml0c2ktaWNvblxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBmaWxsPVxcXCJub25lXFxcIiBoZWlnaHQ9XFxcIjIyXFxcIiB3aWR0aD1cXFwiMjJcXFwiIHZpZXdCb3g9XFxcIjAgMCAyMiAyMlxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGNsaXAtcnVsZT1cXFwiZXZlbm9kZFxcXCIgZD1cXFwiTTYuODQgNS41aC0uMDIyTDMuNDI0IDIuMTA2YS45MzIuOTMyIDAgMTAtMS4zMTggMS4zMThMNC4xODIgNS41aC0uNTE1Yy0xLjAxMyAwLTEuODM0LjgyLTEuODM0IDEuODMzdjcuMzM0YzAgMS4wMTIuODIxIDEuODMzIDEuODM0IDEuODMzSDEzLjc1Yy40MDQgMCAuNzc3LS4xMyAxLjA4LS4zNTJsMy43NDYgMy43NDZhLjkzMi45MzIgMCAxMDEuMzE4LTEuMzE4bC00LjMxLTQuMzF2LS4wMjRMMTMuNzUgMTIuNDF2LjAyM2wtNS4xLTUuMDk5aC4wMjRMNi44NDEgNS41em02LjkxIDQuMjc0VjcuMzMzaC0yLjQ0TDkuNDc1IDUuNWg0LjI3NGMxLjAxMiAwIDEuODMzLjgyIDEuODMzIDEuODMzdi43ODZsMy4yMTItMS44MzVhLjkxNy45MTcgMCAwMTEuMzcyLjc5NnY3Ljg0YzAgLjM0NC0uMTkuNjQ0LS40Ny44bC0zLjczNi0zLjczNSAyLjM3MiAxLjM1NlY4LjY1OWwtMi43NSAxLjU3MXYxLjM3N0wxMy43NSA5Ljc3NHpNMy42NjcgNy4zMzRoMi4zNDlsNy4zMzMgNy4zMzNIMy42NjdWNy4zMzN6XFxcIj48L3BhdGg+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImxhYmVsXFxcIj5EaXNhYmxlIGNhbWVyYTwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBhcmlhLWxhYmVsPVxcXCJUb2dnbGUgZnVsbCBzY3JlZW5cXFwiIGNsYXNzPVxcXCJvdmVyZmxvdy1tZW51LWl0ZW0gZnVsbHNjcmVlblxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJvdmVyZmxvdy1tZW51LWl0ZW0taWNvblxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJqaXRzaS1pY29uIFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBmaWxsPVxcXCJub25lXFxcIiBoZWlnaHQ9XFxcIjIyXFxcIiB3aWR0aD1cXFwiMjJcXFwiIHZpZXdCb3g9XFxcIjAgMCAyMiAyMlxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGNsaXAtcnVsZT1cXFwiZXZlbm9kZFxcXCIgZD1cXFwiTTguMjUgMi43NUgzLjY2N2EuOTE3LjkxNyAwIDAwLS45MTcuOTE3VjguMjVoMS44MzNWNC41ODNIOC4yNVYyLjc1em01LjUgMS44MzNWMi43NWg0LjU4M2MuNTA3IDAgLjkxNy40MS45MTcuOTE3VjguMjVoLTEuODMzVjQuNTgzSDEzLjc1em0wIDEyLjgzNGgzLjY2N1YxMy43NWgxLjgzM3Y0LjU4M2MwIC41MDctLjQxLjkxNy0uOTE3LjkxN0gxMy43NXYtMS44MzN6TTQuNTgzIDEzLjc1djMuNjY3SDguMjV2MS44MzNIMy42NjdhLjkxNy45MTcgMCAwMS0uOTE3LS45MTdWMTMuNzVoMS44MzN6XFxcIj48L3BhdGg+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImxhYmVsIG92ZXJmbG93LW1lbnUtaXRlbS10ZXh0XFxcIj5WaWV3IGZ1bGwgc2NyZWVuPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGFyaWEtbGFiZWw9XFxcIlxcXCIgY2xhc3M9XFxcIm92ZXJmbG93LW1lbnUtaXRlbSBcIiArIHRoaXMucHJpdmF0ZUNoYXRDbGFzcyArIFwiXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcIm92ZXJmbG93LW1lbnUtaXRlbS1pY29uXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImppdHNpLWljb24gXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGZpbGw9XFxcIm5vbmVcXFwiIGhlaWdodD1cXFwiMjJcXFwiIHdpZHRoPVxcXCIyMlxcXCIgdmlld0JveD1cXFwiMCAwIDIyIDIyXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggY2xpcC1ydWxlPVxcXCJldmVub2RkXFxcIiBkPVxcXCJNMTksOEgxOFY1YTMsMywwLDAsMC0zLTNINUEzLDMsMCwwLDAsMiw1VjE3YTEsMSwwLDAsMCwuNjIuOTJBLjg0Ljg0LDAsMCwwLDMsMThhMSwxLDAsMCwwLC43MS0uMjlsMi44MS0yLjgySDh2MS40NGEzLDMsMCwwLDAsMywzaDYuOTJsMi4zNywyLjM4QTEsMSwwLDAsMCwyMSwyMmEuODQuODQsMCwwLDAsLjM4LS4wOEExLDEsMCwwLDAsMjIsMjFWMTFBMywzLDAsMCwwLDE5LDhaTTgsMTF2MS44OUg2LjExYTEsMSwwLDAsMC0uNzEuMjlMNCwxNC41OVY1QTEsMSwwLDAsMSw1LDRIMTVhMSwxLDAsMCwxLDEsMVY4SDExQTMsMywwLDAsMCw4LDExWm0xMiw3LjU5LTEtMWExLDEsMCwwLDAtLjcxLS4zSDExYTEsMSwwLDAsMS0xLTFWMTFhMSwxLDAsMCwxLDEtMWg4YTEsMSwwLDAsMSwxLDFaXFxcIj48L3BhdGg+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImxhYmVsIG92ZXJmbG93LW1lbnUtaXRlbS10ZXh0XFxcIj5Qcml2YXRlIGNoYXQ8L3NwYW4+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9saT5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8bGkgYXJpYS1sYWJlbD1cXFwiXFxcIiBjbGFzcz1cXFwib3ZlcmZsb3ctbWVudS1pdGVtIGtpY2stcGFydGljaXBhbnRcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwib3ZlcmZsb3ctbWVudS1pdGVtLWljb25cXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiaml0c2ktaWNvbiBcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgaGVpZ2h0PVxcXCIyMFxcXCIgd2lkdGg9XFxcIjIwXFxcIiB2aWV3Qm94PVxcXCIwIDAgMjAgMjBcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBmaWxsLXJ1bGU9XFxcImV2ZW5vZGRcXFwiIGNsaXAtcnVsZT1cXFwiZXZlbm9kZFxcXCIgZD1cXFwiTTEwIDE2LjY2N2E2LjY2NyA2LjY2NyAwIDEwMC0xMy4zMzQgNi42NjcgNi42NjcgMCAwMDAgMTMuMzM0em0wIDEuNjY2YTguMzMzIDguMzMzIDAgMTEwLTE2LjY2NiA4LjMzMyA4LjMzMyAwIDAxMCAxNi42NjZ6bTAtOS41MTJsMi4zNTctMi4zNTdhLjgzMy44MzMgMCAxMTEuMTc5IDEuMTc5TDExLjE3OSAxMGwyLjM1NyAyLjM1N2EuODMzLjgzMyAwIDExLTEuMTc5IDEuMTc5TDEwIDExLjE3OGwtMi4zNTcgMi4zNTdhLjgzMy44MzMgMCAwMS0xLjE3OC0xLjE3OUw4LjgyMiAxMCA2LjQ2NSA3LjY0M2EuODMzLjgzMyAwIDExMS4xNzgtMS4xNzlMMTAgOC44MjF6XFxcIj48L3BhdGg+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibGFiZWwgb3ZlcmZsb3ctbWVudS1pdGVtLXRleHRcXFwiPktpY2sgb3V0PC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGFyaWEtbGFiZWw9XFxcIlxcXCIgY2xhc3M9XFxcIm92ZXJmbG93LW1lbnUtaXRlbSByZW1vdGUtY29udHJvbFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJvdmVyZmxvdy1tZW51LWl0ZW0taWNvblxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJqaXRzaS1pY29uIFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBoZWlnaHQ9XFxcIjIyXFxcIiB3aWR0aD1cXFwiMjJcXFwiIHZpZXdCb3g9XFxcIjAgMCAyMiAyOFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9XFxcIk0yMS42MjUgMTQuNDg0TC44NzUgMjYuMDE1Yy0uNDg0LjI2Ni0uODc1LjAzMS0uODc1LS41MTZ2LTIzYzAtLjU0Ny4zOTEtLjc4MS44NzUtLjUxNmwyMC43NSAxMS41MzFjLjQ4NC4yNjYuNDg0LjcwMyAwIC45Njl6XFxcIj48L3BhdGg+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cXFwibGFiZWwgb3ZlcmZsb3ctbWVudS1pdGVtLXRleHRcXFwiPlJlbW90ZSBDb250cm9sPC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgICAgICAgICAgICA8L3VsPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L3NwYW4+XFxuICAgICAgICA8L3NwYW4gPlwiO1xyXG4gICAgICAgIHJldHVybiAkKHBhbmVsSHRtbClbMF07XHJcbiAgICB9O1xyXG4gICAgVmlkZW9QYW5lbC5uUGFuZWxJbnN0YW5jZUlkID0gMDsgLy9pbmNyZWFzZWQgd2hlbiBhZGQgbmV3LCBidXQgbm90IGRlY3JlYXNlZCB3aGVuIHJlbW92ZSBwYW5lbFxyXG4gICAgcmV0dXJuIFZpZGVvUGFuZWw7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVmlkZW9QYW5lbCA9IFZpZGVvUGFuZWw7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVZpZGVvUGFuZWwuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2NvbXBvbmVudHNcXFxcVmlkZW9QYW5lbC5qc1wiLFwiL2NvbXBvbmVudHNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlZpZGVvUGFuZWxHcmlkID0gZXhwb3J0cy5WaWRlb1BhbmVsR3JpZFByb3BzID0gdm9pZCAwO1xyXG52YXIgVmlkZW9QYW5lbF8xID0gcmVxdWlyZShcIi4vVmlkZW9QYW5lbFwiKTtcclxudmFyIFZpZGVvUGFuZWxHcmlkUHJvcHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWRlb1BhbmVsR3JpZFByb3BzKCkge1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFZpZGVvUGFuZWxHcmlkUHJvcHM7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVmlkZW9QYW5lbEdyaWRQcm9wcyA9IFZpZGVvUGFuZWxHcmlkUHJvcHM7XHJcbnZhciBWaWRlb1BhbmVsR3JpZCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZGVvUGFuZWxHcmlkKHByb3BzKSB7XHJcbiAgICAgICAgdGhpcy5yb290ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZGVvUGFuZWxNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5wYW5lbENsYXNzID0gXCJ2aWRlb2NvbnRhaW5lclwiO1xyXG4gICAgICAgIHRoaXMuZnVsbHNjcmVlbkNsYXNzID0gXCJ2aWRlby1mdWxsc2NyZWVuXCI7XHJcbiAgICAgICAgdGhpcy5wb3B1cE1lbnVDbGFzcyA9IFwicG9wdXAtbWVudVwiO1xyXG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcclxuICAgICAgICB0aGlzLnJvb3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvLWdyaWRcIik7XHJcbiAgICAgICAgdGhpcy5hdHRhY2hIYW5kbGVycygpO1xyXG4gICAgfVxyXG4gICAgVmlkZW9QYW5lbEdyaWQucHJvdG90eXBlLmF0dGFjaEhhbmRsZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgaW5zaWRlID0gJChlLnRhcmdldCkuY2xvc2VzdChcIi5cIiArIF90aGlzLnBvcHVwTWVudUNsYXNzKS5sZW5ndGggPiAwO1xyXG4gICAgICAgICAgICBpZiAoIWluc2lkZSkge1xyXG4gICAgICAgICAgICAgICAgJChcIi5cIiArIF90aGlzLnBvcHVwTWVudUNsYXNzKS5yZW1vdmVDbGFzcyhcInZpc2libGVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnJlZHJhd0dyaWQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMucmVkcmF3R3JpZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFZpZGVvUGFuZWxHcmlkLnByb3RvdHlwZS5nZXROZXdWaWRlb1BhbmVsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwcm9wcyA9IG5ldyBWaWRlb1BhbmVsXzEuVmlkZW9QYW5lbFByb3BzKCk7XHJcbiAgICAgICAgcHJvcHMucmVmcmVzaEdyaWQgPSB0aGlzLnJlZHJhd0dyaWQuYmluZCh0aGlzKTtcclxuICAgICAgICBwcm9wcy5ncmFudE1vZGVyYXRvclJvbGUgPSB0aGlzLnByb3BzLmdyYW50TW9kZXJhdG9yUm9sZTtcclxuICAgICAgICBwcm9wcy5raWNrUGFydGljaXBhbnRPdXQgPSB0aGlzLnByb3BzLmtpY2tQYXJ0aWNpcGFudE91dDtcclxuICAgICAgICBwcm9wcy5zZW5kUmVtb3RlQ29udHJvbFJlcGx5ID0gdGhpcy5wcm9wcy5zZW5kUmVtb3RlQ29udHJvbFJlcGx5O1xyXG4gICAgICAgIHByb3BzLm11dGVVc2VyVmlkZW8gPSB0aGlzLnByb3BzLm11dGVVc2VyVmlkZW87XHJcbiAgICAgICAgcHJvcHMubXV0ZVVzZXJBdWRpbyA9IHRoaXMucHJvcHMubXV0ZVVzZXJBdWRpbztcclxuICAgICAgICBwcm9wcy5tdXRlTXlWaWRlbyA9IHRoaXMucHJvcHMubXV0ZU15VmlkZW87XHJcbiAgICAgICAgcHJvcHMubXV0ZU15QXVkaW8gPSB0aGlzLnByb3BzLm11dGVNeUF1ZGlvO1xyXG4gICAgICAgIHByb3BzLm9wZW5Qcml2YXRlQ2hhdCA9IHRoaXMucHJvcHMub3BlblByaXZhdGVDaGF0O1xyXG4gICAgICAgIHByb3BzLnBhbmVsQ2xhc3MgPSB0aGlzLnBhbmVsQ2xhc3M7XHJcbiAgICAgICAgcHJvcHMuZnVsbHNjcmVlbkNsYXNzID0gdGhpcy5mdWxsc2NyZWVuQ2xhc3M7XHJcbiAgICAgICAgcHJvcHMucG9wdXBNZW51Q2xhc3MgPSB0aGlzLnBvcHVwTWVudUNsYXNzO1xyXG4gICAgICAgIHZhciB2aWRlb1BhbmVsID0gbmV3IFZpZGVvUGFuZWxfMS5WaWRlb1BhbmVsKHByb3BzKTtcclxuICAgICAgICAkKHRoaXMucm9vdCkuYXBwZW5kKHZpZGVvUGFuZWwucm9vdCk7XHJcbiAgICAgICAgdmlkZW9QYW5lbC5hdHRhY2hIYW5kbGVycygpO1xyXG4gICAgICAgIC8vYWRkIHRvIG1hcFxyXG4gICAgICAgIHRoaXMudmlkZW9QYW5lbE1hcC5zZXQodmlkZW9QYW5lbC5JZCwgdmlkZW9QYW5lbCk7XHJcbiAgICAgICAgLy9yZWZyZXNoIGxheW91dFxyXG4gICAgICAgIHRoaXMucmVkcmF3R3JpZCgpO1xyXG4gICAgICAgIHJldHVybiB2aWRlb1BhbmVsO1xyXG4gICAgfTtcclxuICAgIFZpZGVvUGFuZWxHcmlkLnByb3RvdHlwZS5mcmVlVmlkZW9QYW5lbCA9IGZ1bmN0aW9uIChJZCkge1xyXG4gICAgICAgIHZhciB2aWRlb1BhbmVsID0gdGhpcy52aWRlb1BhbmVsTWFwLmdldChJZCk7XHJcbiAgICAgICAgaWYgKHZpZGVvUGFuZWwpIHtcclxuICAgICAgICAgICAgJCh2aWRlb1BhbmVsLnJvb3QpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnZpZGVvUGFuZWxNYXAuZGVsZXRlKElkKTtcclxuICAgICAgICAgICAgdGhpcy5yZWRyYXdHcmlkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZGVvUGFuZWxHcmlkLnByb3RvdHlwZS5yZWRyYXdHcmlkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vbWFyZ2luXHJcbiAgICAgICAgdmFyIGd1dHRlciA9IDQwO1xyXG4gICAgICAgIHZhciB3aWR0aCA9ICQoXCIjY29udGVudFwiKS53aWR0aCgpIC0gZ3V0dGVyO1xyXG4gICAgICAgIHZhciBoZWlnaHQgPSAkKFwiI2NvbnRlbnRcIikuaGVpZ2h0KCkgLSBndXR0ZXI7XHJcbiAgICAgICAgLy9udW1iZXIgb2YgdmlkZW8gcGFuZWxzXHJcbiAgICAgICAgdmFyIHBhbmVsQ291bnQgPSAkKFwiLlwiICsgdGhpcy5wYW5lbENsYXNzKS5sZW5ndGg7XHJcbiAgICAgICAgLy9jaGF0dGluZyBkaWFsb2dcclxuICAgICAgICB2YXIgY2hhdHRpbmdXaWR0aCA9IDMxNTtcclxuICAgICAgICBpZiAoJCh0aGlzLnJvb3QpLmhhc0NsYXNzKFwic2hpZnQtcmlnaHRcIikpIHtcclxuICAgICAgICAgICAgd2lkdGggLT0gY2hhdHRpbmdXaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy93aWR0aCwgaGVpZ2h0IG9mIGVhY2ggdmlkZW8gcGFuZWxcclxuICAgICAgICB2YXIgdywgaDtcclxuICAgICAgICAvL2lmIGZ1bGxzY3JlZW4gbW9kZSwgaGlkZSBvdGhlciB2aWRlbyBwYW5lbHNcclxuICAgICAgICBpZiAoJChcIi5cIiArIHRoaXMucGFuZWxDbGFzcykuaGFzQ2xhc3ModGhpcy5mdWxsc2NyZWVuQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICQoXCIuXCIgKyB0aGlzLnBhbmVsQ2xhc3MpLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpO1xyXG4gICAgICAgICAgICAkKFwiLlwiICsgdGhpcy5mdWxsc2NyZWVuQ2xhc3MpLmNzcyhcImRpc3BsYXlcIiwgXCJpbmxpbmUtYmxvY2tcIikuY3NzKFwiaGVpZ2h0XCIsIGhlaWdodCArIGd1dHRlciAtIDYpLmNzcyhcIndpZHRoXCIsIHdpZHRoICsgZ3V0dGVyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3Nob3cgYWxsIHZpZGVvIHBhbmVsc1xyXG4gICAgICAgICQoXCIuXCIgKyB0aGlzLnBhbmVsQ2xhc3MpLmNzcyhcImRpc3BsYXlcIiwgXCJpbmxpbmUtYmxvY2tcIik7XHJcbiAgICAgICAgdmFyIGNvbHVtbkNvdW50ID0gMTtcclxuICAgICAgICB2YXIgcm93Q291bnQgPSAxO1xyXG4gICAgICAgIHZhciBTTSA9IDU3NjtcclxuICAgICAgICB2YXIgTUQgPSA3Njg7XHJcbiAgICAgICAgdmFyIExHID0gOTkyO1xyXG4gICAgICAgIHZhciBYTCA9IDEyMDA7XHJcbiAgICAgICAgdmFyIFhYTCA9IDE0MDA7XHJcbiAgICAgICAgaWYgKHdpZHRoIDwgU00pIHtcclxuICAgICAgICAgICAgY29sdW1uQ291bnQgPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh3aWR0aCA8IExHKSB7XHJcbiAgICAgICAgICAgIGlmIChwYW5lbENvdW50IDw9IDEpXHJcbiAgICAgICAgICAgICAgICBjb2x1bW5Db3VudCA9IDE7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGNvbHVtbkNvdW50ID0gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChwYW5lbENvdW50ID09IDEpIHtcclxuICAgICAgICAgICAgICAgIGlmICh3aWR0aCA8IFhYTClcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5Db3VudCA9IDE7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uQ291bnQgPSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHBhbmVsQ291bnQgPD0gNClcclxuICAgICAgICAgICAgICAgIGNvbHVtbkNvdW50ID0gMjtcclxuICAgICAgICAgICAgZWxzZSBpZiAocGFuZWxDb3VudCA8PSA5KVxyXG4gICAgICAgICAgICAgICAgY29sdW1uQ291bnQgPSAzO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChwYW5lbENvdW50IDw9IDE2KVxyXG4gICAgICAgICAgICAgICAgY29sdW1uQ291bnQgPSA0O1xyXG4gICAgICAgICAgICBlbHNlIGlmIChwYW5lbENvdW50IDw9IDIwKVxyXG4gICAgICAgICAgICAgICAgY29sdW1uQ291bnQgPSA1O1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBjb2x1bW5Db3VudCA9IDY7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJvd0NvdW50ID0gTWF0aC5mbG9vcigocGFuZWxDb3VudCAtIDEpIC8gY29sdW1uQ291bnQpICsgMTtcclxuICAgICAgICBpZiAod2lkdGggPCA1NzYpIHtcclxuICAgICAgICAgICAgdyA9IHdpZHRoO1xyXG4gICAgICAgICAgICBoID0gdyAqIDkgLyAxNjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFxyXG4gICAgICAgICAgICBpZiAod2lkdGggKiByb3dDb3VudCAqIDkgPiBoZWlnaHQgKiBjb2x1bW5Db3VudCAqIDE2KSB7XHJcbiAgICAgICAgICAgICAgICBoID0gaGVpZ2h0IC8gcm93Q291bnQ7XHJcbiAgICAgICAgICAgICAgICB3ID0gaCAqIDE2IC8gOTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHcgPSB3aWR0aCAvIGNvbHVtbkNvdW50O1xyXG4gICAgICAgICAgICAgICAgaCA9IHcgKiA5IC8gMTY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgJChcIi5cIiArIHRoaXMucGFuZWxDbGFzcylcclxuICAgICAgICAgICAgLmNzcyhcIndpZHRoXCIsIHcpXHJcbiAgICAgICAgICAgIC5jc3MoXCJoZWlnaHRcIiwgaClcclxuICAgICAgICAgICAgLmZpbmQoXCIuYXZhdGFyLWNvbnRhaW5lclwiKVxyXG4gICAgICAgICAgICAuY3NzKFwid2lkdGhcIiwgaCAvIDIpXHJcbiAgICAgICAgICAgIC5jc3MoXCJoZWlnaHRcIiwgaCAvIDIpO1xyXG4gICAgfTtcclxuICAgIFZpZGVvUGFuZWxHcmlkLnByb3RvdHlwZS5oaWdodGxpZ2h0UGFuZWwgPSBmdW5jdGlvbiAodGFyZ2V0SWQpIHtcclxuICAgICAgICB0aGlzLnZpZGVvUGFuZWxNYXAuZm9yRWFjaChmdW5jdGlvbiAocGFuZWwsIElkKSB7XHJcbiAgICAgICAgICAgIHBhbmVsLnNldEhpZ2hsaWdodCh0YXJnZXRJZCA9PT0gSWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWRlb1BhbmVsR3JpZDtcclxufSgpKTtcclxuZXhwb3J0cy5WaWRlb1BhbmVsR3JpZCA9IFZpZGVvUGFuZWxHcmlkO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1WaWRlb1BhbmVsR3JpZC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvY29tcG9uZW50c1xcXFxWaWRlb1BhbmVsR3JpZC5qc1wiLFwiL2NvbXBvbmVudHNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlZlY3Rvckljb24gPSB2b2lkIDA7XHJcbnZhciBWZWN0b3JJY29uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmVjdG9ySWNvbigpIHtcclxuICAgIH1cclxuICAgIFZlY3Rvckljb24uQVVESU9fTVVURV9JQ09OID0gXCJNNy4zMzMgOC42NVYxMWEzLjY2OCAzLjY2OCAwIDAwMi43NTcgMy41NTMuOTI4LjkyOCAwIDAwLS4wMDcuMTE0djEuNzU3QTUuNTAxIDUuNTAxIDAgMDE1LjUgMTFhLjkxNy45MTcgMCAxMC0xLjgzMyAwYzAgMy43NCAyLjc5OSA2LjgyNiA2LjQxNiA3LjI3N3YuOTczYS45MTcuOTE3IDAgMDAxLjgzNCAwdi0uOTczYTcuMjk3IDcuMjk3IDAgMDAzLjU2OC0xLjQ3NWwzLjA5MSAzLjA5MmEuOTMyLjkzMiAwIDEwMS4zMTgtMS4zMThsLTMuMDkxLTMuMDkxLjAxLS4wMTMtMS4zMTEtMS4zMTEtLjAxLjAxMy0xLjMyNS0xLjMyNS4wMDgtLjAxNC0xLjM5NS0xLjM5NWExLjI0IDEuMjQgMCAwMS0uMDA0LjAxOGwtMy42MS0zLjYwOXYtLjAyM0w3LjMzNCA1Ljk5M3YuMDIzbC0zLjkwOS0zLjkxYS45MzIuOTMyIDAgMTAtMS4zMTggMS4zMThMNy4zMzMgOC42NXptMS44MzQgMS44MzRWMTFhMS44MzMgMS44MzMgMCAwMDIuMjkxIDEuNzc2bC0yLjI5MS0yLjI5MnptMy42ODIgMy42ODNjLS4yOS4xNy0uNjA2LjMtLjk0LjM4NmEuOTI4LjkyOCAwIDAxLjAwOC4xMTR2MS43NTdhNS40NyA1LjQ3IDAgMDAyLjI1Ny0uOTMybC0xLjMyNS0xLjMyNXptMS44MTgtMy40NzZsLTEuODM0LTEuODM0VjUuNWExLjgzMyAxLjgzMyAwIDAwLTMuNjQ0LS4yODdsLTEuNDMtMS40M0EzLjY2NiAzLjY2NiAwIDAxMTQuNjY3IDUuNXY1LjE5em0xLjY2NSAxLjY2NWwxLjQ0NyAxLjQ0N2MuMzU3LS44NjQuNTU0LTEuODEuNTU0LTIuODAzYS45MTcuOTE3IDAgMTAtMS44MzMgMGMwIC40NjgtLjA1OC45MjItLjE2OCAxLjM1NnpcIjtcclxuICAgIFZlY3Rvckljb24uQVVESU9fVU5NVVRFX0lDT04gPSBcIk0xNiA2YTQgNCAwIDAwLTggMHY2YTQuMDAyIDQuMDAyIDAgMDAzLjAwOCAzLjg3NmMtLjAwNS4wNC0uMDA4LjA4Mi0uMDA4LjEyNHYxLjkxN0E2LjAwMiA2LjAwMiAwIDAxNiAxMmExIDEgMCAxMC0yIDAgOC4wMDEgOC4wMDEgMCAwMDcgNy45MzhWMjFhMSAxIDAgMTAyIDB2LTEuMDYyQTguMDAxIDguMDAxIDAgMDAyMCAxMmExIDEgMCAxMC0yIDAgNi4wMDIgNi4wMDIgMCAwMS01IDUuOTE3VjE2YzAtLjA0Mi0uMDAzLS4wODMtLjAwOC0uMTI0QTQuMDAyIDQuMDAyIDAgMDAxNiAxMlY2em0tNC0yYTIgMiAwIDAwLTIgMnY2YTIgMiAwIDEwNCAwVjZhMiAyIDAgMDAtMi0yelwiO1xyXG4gICAgVmVjdG9ySWNvbi5WSURFT19NVVRFX0lDT04gPSBcIk0gNi44NCA1LjUgaCAtMC4wMjIgTCAzLjQyNCAyLjEwNiBhIDAuOTMyIDAuOTMyIDAgMSAwIC0xLjMxOCAxLjMxOCBMIDQuMTgyIDUuNSBoIC0wLjUxNSBjIC0xLjAxMyAwIC0xLjgzNCAwLjgyIC0xLjgzNCAxLjgzMyB2IDcuMzM0IGMgMCAxLjAxMiAwLjgyMSAxLjgzMyAxLjgzNCAxLjgzMyBIIDEzLjc1IGMgMC40MDQgMCAwLjc3NyAtMC4xMyAxLjA4IC0wLjM1MiBsIDMuNzQ2IDMuNzQ2IGEgMC45MzIgMC45MzIgMCAxIDAgMS4zMTggLTEuMzE4IGwgLTQuMzEgLTQuMzEgdiAtMC4wMjQgTCAxMy43NSAxMi40MSB2IDAuMDIzIGwgLTUuMSAtNS4wOTkgaCAwLjAyNCBMIDYuODQxIDUuNSBaIG0gNi45MSA0LjI3NCBWIDcuMzMzIGggLTIuNDQgTCA5LjQ3NSA1LjUgaCA0LjI3NCBjIDEuMDEyIDAgMS44MzMgMC44MiAxLjgzMyAxLjgzMyB2IDAuNzg2IGwgMy4yMTIgLTEuODM1IGEgMC45MTcgMC45MTcgMCAwIDEgMS4zNzIgMC43OTYgdiA3Ljg0IGMgMCAwLjM0NCAtMC4xOSAwLjY0NCAtMC40NyAwLjggbCAtMy43MzYgLTMuNzM1IGwgMi4zNzIgMS4zNTYgViA4LjY1OSBsIC0yLjc1IDEuNTcxIHYgMS4zNzcgTCAxMy43NSA5Ljc3NCBaIE0gMy42NjcgNy4zMzQgaCAyLjM0OSBsIDcuMzMzIDcuMzMzIEggMy42NjcgViA3LjMzMyBaXCI7XHJcbiAgICBWZWN0b3JJY29uLlZJREVPX1VOTVVURV9JQ09OID0gXCJNMTMuNzUgNS41SDMuNjY3Yy0xLjAxMyAwLTEuODM0LjgyLTEuODM0IDEuODMzdjcuMzM0YzAgMS4wMTIuODIxIDEuODMzIDEuODM0IDEuODMzSDEzLjc1YzEuMDEyIDAgMS44MzMtLjgyIDEuODMzLTEuODMzdi0uNzg2bDMuMjEyIDEuODM1YS45MTYuOTE2IDAgMDAxLjM3Mi0uNzk2VjcuMDhhLjkxNy45MTcgMCAwMC0xLjM3Mi0uNzk2bC0zLjIxMiAxLjgzNXYtLjc4NmMwLTEuMDEyLS44Mi0xLjgzMy0xLjgzMy0xLjgzM3ptMCAzLjY2N3Y1LjVIMy42NjdWNy4zMzNIMTMuNzV2MS44MzR6bTQuNTgzIDQuMTc0bC0yLjc1LTEuNTcydi0xLjUzOGwyLjc1LTEuNTcydjQuNjgyelwiO1xyXG4gICAgVmVjdG9ySWNvbi5HUkFOVF9NT0RFUkFUT1JfSUNPTiA9IFwiTTE0IDRhMiAyIDAgMDEtMS4yOTggMS44NzNsMS41MjcgNC4wNy43MTYgMS45MTJjLjA2Mi4wNzQuMTI2LjA3NC4xNjUuMDM1bDEuNDQ0LTEuNDQ0IDIuMDMyLTIuMDMyYTIgMiAwIDExMS4yNDguNTc5TDE5IDE5YTIgMiAwIDAxLTIgMkg3YTIgMiAwIDAxLTItMkw0LjE2NiA4Ljk5M2EyIDIgMCAxMTEuMjQ4LS41NzlsMi4wMzMgMi4wMzNMOC44OSAxMS44OWMuMDg3LjA0Mi4xNDUuMDE2LjE2NS0uMDM1bC43MTYtMS45MTIgMS41MjctNC4wN0EyIDIgMCAxMTE0IDR6TTYuODQgMTdsLS4zOTMtNC43MjUgMS4wMjkgMS4wM2EyLjEgMi4xIDAgMDAzLjQ1MS0uNzQ4TDEyIDkuNjk2bDEuMDczIDIuODZhMi4xIDIuMSAwIDAwMy40NTEuNzQ4bDEuMDMtMS4wM0wxNy4xNiAxN0g2Ljg0elwiO1xyXG4gICAgVmVjdG9ySWNvbi5BVURJT19NVVRFX1NNQUxMX0lDT04gPSBcIk01LjY4OCA0bDIyLjMxMyAyMi4zMTMtMS42ODggMS42ODgtNS41NjMtNS41NjNjLTEgLjYyNS0yLjI1IDEtMy40MzggMS4xODh2NC4zNzVoLTIuNjI1di00LjM3NWMtNC4zNzUtLjYyNS04LTQuMzc1LTgtOC45MzhoMi4yNWMwIDQgMy4zNzUgNi43NSA3LjA2MyA2Ljc1IDEuMDYzIDAgMi4xMjUtLjI1IDMuMDYzLS42ODhsLTIuMTg4LTIuMTg4Yy0uMjUuMDYzLS41NjMuMTI1LS44NzUuMTI1LTIuMTg4IDAtNC0xLjgxMy00LTR2LTFsLTgtOHpNMjAgMTQuODc1bC04LTcuOTM4di0uMjVjMC0yLjE4OCAxLjgxMy00IDQtNHM0IDEuODEzIDQgNHY4LjE4OHptNS4zMTMtLjE4N2E4LjgyNCA4LjgyNCAwIDAxLTEuMTg4IDQuMzc1TDIyLjUgMTcuMzc1Yy4zNzUtLjgxMy41NjMtMS42ODguNTYzLTIuNjg4aDIuMjV6XCI7XHJcbiAgICBWZWN0b3JJY29uLlZJREVPX01VVEVfU01BTExfSUNPTiA9IFwiTTQuMzc1IDIuNjg4TDI4IDI2LjMxM2wtMS42ODggMS42ODgtNC4yNS00LjI1Yy0uMTg4LjEyNS0uNS4yNS0uNzUuMjVoLTE2Yy0uNzUgMC0xLjMxMy0uNTYzLTEuMzEzLTEuMzEzVjkuMzEzYzAtLjc1LjU2My0xLjMxMyAxLjMxMy0xLjMxM2gxTDIuNjg3IDQuMzc1em0yMy42MjUgNnYxNC4yNUwxMy4wNjIgOGg4LjI1Yy43NSAwIDEuMzc1LjU2MyAxLjM3NSAxLjMxM3Y0LjY4OHpcIjtcclxuICAgIFZlY3Rvckljb24uTU9ERVJBVE9SX1NNQUxMX0lDT04gPSBcIk0xNiAyMC41NjNsNSAzLTEuMzEzLTUuNjg4TDI0LjEyNSAxNGwtNS44NzUtLjVMMTYgOC4xMjUgMTMuNzUgMTMuNWwtNS44NzUuNSA0LjQzOCAzLjg3NUwxMSAyMy41NjN6bTEzLjMxMy04LjI1bC03LjI1IDYuMzEzIDIuMTg4IDkuMzc1LTguMjUtNS04LjI1IDUgMi4xODgtOS4zNzUtNy4yNS02LjMxMyA5LjU2My0uODEzIDMuNzUtOC44MTMgMy43NSA4LjgxM3pcIjtcclxuICAgIFZlY3Rvckljb24uU0VUVElOR19JQ09OID0gXCJNOS4wMDUgMi4xN2wtLjU3NiAxLjcyNy0uNjM0LjI2Mi0xLjYyOC0uODEzYTEuODMzIDEuODMzIDAgMDAtMi4xMTYuMzQzbC0uMzYyLjM2MmExLjgzMyAxLjgzMyAwIDAwLS4zNDMgMi4xMTZsLjgxNiAxLjYyNC0uMjY1LjYzOC0xLjcyNy41NzZjLS43NDguMjUtMS4yNTMuOTUtMS4yNTMgMS43Mzl2LjUxMmMwIC43OS41MDUgMS40OSAxLjI1MyAxLjc0bDEuNzI3LjU3NS4yNjIuNjM0LS44MTMgMS42MjhhMS44MzMgMS44MzMgMCAwMC4zNDMgMi4xMTZsLjM2Mi4zNjJjLjU1OC41NTggMS40MS42OTYgMi4xMTYuMzQzbDEuNjI0LS44MTYuNjM4LjI2NS41NzYgMS43MjdjLjI1Ljc0OC45NSAxLjI1MyAxLjczOSAxLjI1M2guNTEyYy43OSAwIDEuNDktLjUwNSAxLjc0LTEuMjUzbC41NzUtMS43MjYuNjM0LS4yNjMgMS42MjguODEzYTEuODMzIDEuODMzIDAgMDAyLjExNi0uMzQzbC4zNjItLjM2MmMuNTU4LS41NTguNjk2LTEuNDEuMzQzLTIuMTE2bC0uODE2LTEuNjI0LjI2NS0uNjM4IDEuNzI3LS41NzZhMS44MzMgMS44MzMgMCAwMDEuMjUzLTEuNzM5di0uNTEyYzAtLjc5LS41MDUtMS40OS0xLjI1My0xLjc0bC0xLjcyNi0uNTcyLS4yNjQtLjYzNy44MTQtMS42MjhhMS44MzMgMS44MzMgMCAwMC0uMzQzLTIuMTE2bC0uMzYyLS4zNjJhMS44MzMgMS44MzMgMCAwMC0yLjExNi0uMzQzbC0xLjYyNC44MTYtLjYzOC0uMjY1LS41NzYtMS43MjdhMS44MzMgMS44MzMgMCAwMC0xLjc0LTEuMjUzaC0uNTExYy0uNzkgMC0xLjQ5LjUwNS0xLjc0IDEuMjUzek03LjcyMyA2LjE3M2wyLjE4MS0uOTAzLjg0LTIuNTJoLjUxMmwuODQgMi41MiAyLjE4NS45MDggMi4zNzItMS4xOTMuMzYyLjM2Mi0xLjE4OCAyLjM3Ni45MDMgMi4xODUgMi41Mi44MzZ2LjUxMmwtMi41Mi44NC0uOTA4IDIuMTg1IDEuMTkzIDIuMzcyLS4zNjIuMzYyLTIuMzc2LTEuMTg4LTIuMTgxLjkwMy0uODQgMi41MmgtLjUxMmwtLjg0LTIuNTItMi4xODUtLjkwOC0yLjM3MiAxLjE5My0uMzYyLS4zNjIgMS4xODgtMi4zNzYtLjkwMy0yLjE4MS0yLjUyLS44NHYtLjUxMmwyLjUyLS44NC45MDgtMi4xODUtMS4xOTMtMi4zNzIuMzYyLS4zNjIgMi4zNzYgMS4xODh6TTExIDE1LjU4M2E0LjU4MyA0LjU4MyAwIDExMC05LjE2NiA0LjU4MyA0LjU4MyAwIDAxMCA5LjE2NnpNMTMuNzUgMTFhMi43NSAyLjc1IDAgMTEtNS41IDAgMi43NSAyLjc1IDAgMDE1LjUgMHpcIjtcclxuICAgIFZlY3Rvckljb24uVVNFUl9HUk9VUF9JQ09OID0gXCJNNS4zMzMzMSAyQzYuMjgxMDEgMiA3LjA5Njc1IDIuNTY0OTkgNy40NjIwNyAzLjM3NjUxQzcuMDA3NjYgMy40NTAyMyA2LjU4NDA2IDMuNjE1ODMgNi4yMTA5NSAzLjg1MzYxQzYuMDQxMTEgMy41NDM1NiA1LjcxMTc2IDMuMzMzMzMgNS4zMzMzMSAzLjMzMzMzQzQuNzgxMDMgMy4zMzMzMyA0LjMzMzMxIDMuNzgxMDUgNC4zMzMzMSA0LjMzMzMzQzQuMzMzMzEgNC43NTg5NSA0LjU5OTIxIDUuMTIyNDYgNC45NzM5NSA1LjI2NjgyQzQuNzc2NzIgNS42OTI0NSA0LjY2NjY1IDYuMTY2NzEgNC42NjY2NSA2LjY2NjY3TDQuNjY2NzggNi42OTY3QzMuMTIyNDkgNi44NTMzMiAyLjY2NjY1IDcuNjU0MTUgMi42NjY2NSA5LjgzMzMzQzIuNjY2NjUgOS44OTY2NiAyLjY2ODM1IDkuOTUyMjIgMi42NzA4OCAxMEgzLjEzNDQxQzIuOTc3IDEwLjM5ODIgMi44NjExNCAxMC44NDIzIDIuNzg0MSAxMS4zMzMzSDIuMzMzMzFDMS42NjY2NSAxMS4zMzMzIDEuMzMzMzEgMTAuODMzMyAxLjMzMzMxIDkuODMzMzNDMS4zMzMzMSA3LjYwNTU5IDEuODgwOTcgNi4yMDQ5OCAzLjM5NDE3IDUuNjMxNTJDMy4xNDUyMSA1LjI2MDM4IDIuOTk5OTggNC44MTM4MiAyLjk5OTk4IDQuMzMzMzNDMi45OTk5OCAzLjA0NDY3IDQuMDQ0NjUgMiA1LjMzMzMxIDJaTTkuNzg5MDEgMy44NTM2MUM5LjQxNTkgMy42MTU4MyA4Ljk5MjMgMy40NTAyMyA4LjUzNzg4IDMuMzc2NTFDOC45MDMyMSAyLjU2NDk5IDkuNzE4OTUgMiAxMC42NjY2IDJDMTEuOTU1MyAyIDEzIDMuMDQ0NjcgMTMgNC4zMzMzM0MxMyA0LjgxMzgyIDEyLjg1NDcgNS4yNjAzOCAxMi42MDU4IDUuNjMxNTJDMTQuMTE5IDYuMjA0OTggMTQuNjY2NiA3LjYwNTU5IDE0LjY2NjYgOS44MzMzM0MxNC42NjY2IDEwLjgzMzMgMTQuMzMzMyAxMS4zMzMzIDEzLjY2NjYgMTEuMzMzM0gxMy4yMTU5QzEzLjEzODggMTAuODQyMyAxMy4wMjMgMTAuMzk4MiAxMi44NjU2IDEwSDEzLjMyOTFDMTMuMzMxNiA5Ljk1MjIyIDEzLjMzMzMgOS44OTY2NiAxMy4zMzMzIDkuODMzMzNDMTMuMzMzMyA3LjY1NDE1IDEyLjg3NzUgNi44NTMzMiAxMS4zMzMyIDYuNjk2N0wxMS4zMzMzIDYuNjY2NjdDMTEuMzMzMyA2LjE2NjcgMTEuMjIzMiA1LjY5MjQ1IDExLjAyNiA1LjI2NjgyQzExLjQwMDggNS4xMjI0NiAxMS42NjY2IDQuNzU4OTUgMTEuNjY2NiA0LjMzMzMzQzExLjY2NjYgMy43ODEwNSAxMS4yMTg5IDMuMzMzMzMgMTAuNjY2NiAzLjMzMzMzQzEwLjI4ODIgMy4zMzMzMyA5Ljk1ODg1IDMuNTQzNTYgOS43ODkwMSAzLjg1MzYxWk00LjQ5OTk4IDE0LjY2NjdDMy43MjIyIDE0LjY2NjcgMy4zMzMzMSAxNC4xMTExIDMuMzMzMzEgMTNDMy4zMzMzMSAxMC40NTk4IDQuMDA2MiA4Ljg4NzUgNS44Nzg4OCA4LjI4MzA4QzUuNTM2NiA3LjgzNDYyIDUuMzMzMzEgNy4yNzQzOCA1LjMzMzMxIDYuNjY2NjdDNS4zMzMzMSA1LjE5MzkxIDYuNTI3MjIgNCA3Ljk5OTk4IDRDOS40NzI3NCA0IDEwLjY2NjYgNS4xOTM5MSAxMC42NjY2IDYuNjY2NjdDMTAuNjY2NiA3LjI3NDM4IDEwLjQ2MzQgNy44MzQ2MiAxMC4xMjExIDguMjgzMDhDMTEuOTkzOCA4Ljg4NzUgMTIuNjY2NiAxMC40NTk4IDEyLjY2NjYgMTNDMTIuNjY2NiAxNC4xMTExIDEyLjI3NzggMTQuNjY2NyAxMS41IDE0LjY2NjdINC40OTk5OFpNOS4zMzMzMSA2LjY2NjY3QzkuMzMzMzEgNy40MDMwNSA4LjczNjM2IDggNy45OTk5OCA4QzcuMjYzNiA4IDYuNjY2NjUgNy40MDMwNSA2LjY2NjY1IDYuNjY2NjdDNi42NjY2NSA1LjkzMDI5IDcuMjYzNiA1LjMzMzMzIDcuOTk5OTggNS4zMzMzM0M4LjczNjM2IDUuMzMzMzMgOS4zMzMzMSA1LjkzMDI5IDkuMzMzMzEgNi42NjY2N1pNMTEuMzMzMyAxM0MxMS4zMzMzIDEzLjE0MjYgMTEuMzI1MiAxMy4yNTM2IDExLjMxNTIgMTMuMzMzM0g0LjY4NDc3QzQuNjc0NzYgMTMuMjUzNiA0LjY2NjY1IDEzLjE0MjYgNC42NjY2NSAxM0M0LjY2NjY1IDEwLjE5NTcgNS40MjAyMSA5LjMzMzMzIDcuOTk5OTggOS4zMzMzM0MxMC41Nzk3IDkuMzMzMzMgMTEuMzMzMyAxMC4xOTU3IDExLjMzMzMgMTNaXCI7XHJcbiAgICBWZWN0b3JJY29uLlNFTkRfRklMRSA9IFwiTTEzLjUsMTIuNWExLDEsMCwwLDAtMS0xaC01YTEsMSwwLDAsMCwwLDJoNUExLDEsMCwwLDAsMTMuNSwxMi41Wm01LDVhMiwyLDAsMCwwLTEuMTguMzlsLTEuNzUtLjgsMS45MS0uODhhMiwyLDAsMCwwLDEsLjI5LDIsMiwwLDEsMC0yLTJsLTEuODkuODdBMiwyLDAsMSwwLDEzLjUsMTlhMS44OCwxLjg4LDAsMCwwLC45Mi0uMjRsMi4xLDFhMiwyLDAsMSwwLDItMi4yM1ptLTgsMmgtNWExLDEsMCwwLDEtMS0xVjQuNWExLDEsMCwwLDEsMS0xaDV2M2EzLDMsMCwwLDAsMywzaDNhMSwxLDAsMCwwLDIsMHYtMXMwLDAsMC0uMDZhMS4zMSwxLjMxLDAsMCwwLS4wNi0uMjdsMC0uMDlhMS4wNywxLjA3LDAsMCwwLS4xOS0uMjhoMGwtNi02aDBhMS4wNywxLjA3LDAsMCwwLS4yOC0uMTkuMjkuMjksMCwwLDAtLjEsMCwxLjEsMS4xLDAsMCwwLS4yNi0uMDZINS41YTMsMywwLDAsMC0zLDN2MTRhMywzLDAsMCwwLDMsM2g1YTEsMSwwLDAsMCwwLTJabTItMTQuNTlMMTUuMDksNy41SDEzLjVhMSwxLDAsMCwxLTEtMVpNNy41LDE1LjVhMSwxLDAsMCwwLDAsMmgxYTEsMSwwLDAsMCwwLTJabTAtNmgxYTEsMSwwLDAsMCwwLTJoLTFhMSwxLDAsMCwwLDAsMlpcIjtcclxuICAgIHJldHVybiBWZWN0b3JJY29uO1xyXG59KCkpO1xyXG5leHBvcnRzLlZlY3Rvckljb24gPSBWZWN0b3JJY29uO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD12ZWN0b3JfaWNvbi5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvY29tcG9uZW50c1xcXFx2ZWN0b3JfaWNvbi5qc1wiLFwiL2NvbXBvbmVudHNcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkNoYW5uZWxUeXBlID0gdm9pZCAwO1xyXG52YXIgQ2hhbm5lbFR5cGU7XHJcbihmdW5jdGlvbiAoQ2hhbm5lbFR5cGUpIHtcclxuICAgIENoYW5uZWxUeXBlW1wiQm90aFwiXSA9IFwiQm90aFwiO1xyXG4gICAgQ2hhbm5lbFR5cGVbXCJBdWRpb09ubHlcIl0gPSBcIkF1ZGlvT25seVwiO1xyXG4gICAgQ2hhbm5lbFR5cGVbXCJWaWRlb09ubHlcIl0gPSBcIlZpZGVvT25seVwiO1xyXG59KShDaGFubmVsVHlwZSA9IGV4cG9ydHMuQ2hhbm5lbFR5cGUgfHwgKGV4cG9ydHMuQ2hhbm5lbFR5cGUgPSB7fSkpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1DaGFubmVsVHlwZS5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvZW51bVxcXFxDaGFubmVsVHlwZS5qc1wiLFwiL2VudW1cIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLk1lZGlhVHlwZSA9IHZvaWQgMDtcclxudmFyIE1lZGlhVHlwZTtcclxuKGZ1bmN0aW9uIChNZWRpYVR5cGUpIHtcclxuICAgIE1lZGlhVHlwZVtcIlZJREVPXCJdID0gXCJ2aWRlb1wiO1xyXG4gICAgTWVkaWFUeXBlW1wiQVVESU9cIl0gPSBcImF1ZGlvXCI7XHJcbiAgICBNZWRpYVR5cGVbXCJQUkVTRU5URVJcIl0gPSBcInByZXNlbnRlclwiO1xyXG59KShNZWRpYVR5cGUgPSBleHBvcnRzLk1lZGlhVHlwZSB8fCAoZXhwb3J0cy5NZWRpYVR5cGUgPSB7fSkpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1NZWRpYVR5cGUuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2VudW1cXFxcTWVkaWFUeXBlLmpzXCIsXCIvZW51bVwiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuTm90aWZpY2F0aW9uRHVyYXRpb24gPSBleHBvcnRzLk5vdGlmaWNhdGlvblR5cGUgPSB2b2lkIDA7XHJcbnZhciBOb3RpZmljYXRpb25UeXBlO1xyXG4oZnVuY3Rpb24gKE5vdGlmaWNhdGlvblR5cGUpIHtcclxuICAgIE5vdGlmaWNhdGlvblR5cGVbXCJVc2VyXCJdID0gXCJ1c2VyXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiR3JhbnRIb3N0XCJdID0gXCJob3N0XCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiVmlkZW9cIl0gPSBcInZpZGVvXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiVmlkZW9NdXRlXCJdID0gXCJ2aWRlby1tdXRlXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiQXVkaW9cIl0gPSBcImF1ZGlvXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiQXVkaW9NdXRlXCJdID0gXCJhdWRpby1tdXRlXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiUmVjb3JkaW5nXCJdID0gXCJyZWNvcmRpbmdcIjtcclxuICAgIE5vdGlmaWNhdGlvblR5cGVbXCJTY3JlZW5zaGFyaW5nXCJdID0gXCJzY3JlZW5zaGFyaW5nXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiSGFuZFJhaXNlXCJdID0gXCJoYW5kcmFpc2VcIjtcclxuICAgIE5vdGlmaWNhdGlvblR5cGVbXCJDaGF0XCJdID0gXCJjaGF0XCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiRmlsZVRyYW5zZmVyXCJdID0gXCJmaWxlLXRyYW5mZXJcIjtcclxuICAgIE5vdGlmaWNhdGlvblR5cGVbXCJGaWxlUmVjZWl2ZVwiXSA9IFwiZmlsZS1yZWNlaXZlXCI7XHJcbiAgICBOb3RpZmljYXRpb25UeXBlW1wiSW5mb1wiXSA9IFwiaW5mb1wiO1xyXG4gICAgTm90aWZpY2F0aW9uVHlwZVtcIldhcm5pbmdcIl0gPSBcIndhcm5pbmdcIjtcclxufSkoTm90aWZpY2F0aW9uVHlwZSA9IGV4cG9ydHMuTm90aWZpY2F0aW9uVHlwZSB8fCAoZXhwb3J0cy5Ob3RpZmljYXRpb25UeXBlID0ge30pKTtcclxuO1xyXG52YXIgTm90aWZpY2F0aW9uRHVyYXRpb247XHJcbihmdW5jdGlvbiAoTm90aWZpY2F0aW9uRHVyYXRpb24pIHtcclxuICAgIE5vdGlmaWNhdGlvbkR1cmF0aW9uW1wiUGVybWFuZW50XCJdID0gXCJwZXJtYW5lbnRcIjtcclxuICAgIE5vdGlmaWNhdGlvbkR1cmF0aW9uW1wiSGlkZUF1dG9cIl0gPSBcImhpZGUtYXV0b1wiO1xyXG59KShOb3RpZmljYXRpb25EdXJhdGlvbiA9IGV4cG9ydHMuTm90aWZpY2F0aW9uRHVyYXRpb24gfHwgKGV4cG9ydHMuTm90aWZpY2F0aW9uRHVyYXRpb24gPSB7fSkpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Ob3RpZmljYXRpb25UeXBlLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi9lbnVtXFxcXE5vdGlmaWNhdGlvblR5cGUuanNcIixcIi9lbnVtXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5Vc2VyUHJvcGVydHkgPSB2b2lkIDA7XHJcbnZhciBVc2VyUHJvcGVydHk7XHJcbihmdW5jdGlvbiAoVXNlclByb3BlcnR5KSB7XHJcbiAgICBVc2VyUHJvcGVydHlbXCJ2aWRlb1BhbmVsXCJdID0gXCJ2aWRlb1BhbmVsXCI7XHJcbiAgICBVc2VyUHJvcGVydHlbXCJJc0hvc3RcIl0gPSBcIklzSG9zdFwiO1xyXG4gICAgVXNlclByb3BlcnR5W1widXNlQ2FtZXJhXCJdID0gXCJ1c2VDYW1lcmFcIjtcclxuICAgIFVzZXJQcm9wZXJ0eVtcInVzZU1pY1wiXSA9IFwidXNlTWljXCI7XHJcbn0pKFVzZXJQcm9wZXJ0eSA9IGV4cG9ydHMuVXNlclByb3BlcnR5IHx8IChleHBvcnRzLlVzZXJQcm9wZXJ0eSA9IHt9KSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVVzZXJQcm9wZXJ0eS5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvZW51bVxcXFxVc2VyUHJvcGVydHkuanNcIixcIi9lbnVtXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcclxuICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn07XHJcbnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20pIHtcclxuICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGZyb20ubGVuZ3RoLCBqID0gdG8ubGVuZ3RoOyBpIDwgaWw7IGkrKywgaisrKVxyXG4gICAgICAgIHRvW2pdID0gZnJvbVtpXTtcclxuICAgIHJldHVybiB0bztcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkJpekdhemVNZWV0aW5nID0gdm9pZCAwO1xyXG52YXIgc2lnbmFsUiA9IHJlcXVpcmUoXCJAbWljcm9zb2Z0L3NpZ25hbHJcIik7XHJcbnZhciBiZ18xID0gcmVxdWlyZShcIi4vcHJvdG9jb2wvYmdcIik7XHJcbnZhciBtZWV0aW5nX3VpXzEgPSByZXF1aXJlKFwiLi9tZWV0aW5nX3VpXCIpO1xyXG52YXIgQkdVc2VyXzEgPSByZXF1aXJlKFwiLi9tb2RlbC9CR1VzZXJcIik7XHJcbnZhciBCR01lZXRpbmdfMSA9IHJlcXVpcmUoXCIuL21vZGVsL0JHTWVldGluZ1wiKTtcclxudmFyIE1lZGlhVHlwZV8xID0gcmVxdWlyZShcIi4vZW51bS9NZWRpYVR5cGVcIik7XHJcbnZhciBKaXRzaUNvbW1hbmRQYXJhbV8xID0gcmVxdWlyZShcIi4vaml0c2kvSml0c2lDb21tYW5kUGFyYW1cIik7XHJcbnZhciBVc2VyUHJvcGVydHlfMSA9IHJlcXVpcmUoXCIuL2VudW0vVXNlclByb3BlcnR5XCIpO1xyXG52YXIgVGltZVV0aWxfMSA9IHJlcXVpcmUoXCIuL3V0aWwvVGltZVV0aWxcIik7XHJcbnZhciBBY3RpdmVEZXZpY2VzXzEgPSByZXF1aXJlKFwiLi9tb2RlbC9BY3RpdmVEZXZpY2VzXCIpO1xyXG52YXIgSW5wdXREZXZpY2VQb2xpY3lfMSA9IHJlcXVpcmUoXCIuL21vZGVsL0lucHV0RGV2aWNlUG9saWN5XCIpO1xyXG52YXIgQ2hhbm5lbFR5cGVfMSA9IHJlcXVpcmUoXCIuL2VudW0vQ2hhbm5lbFR5cGVcIik7XHJcbnZhciBqaXRzaV8xID0gcmVxdWlyZShcIi4vcHJvdG9jb2wvaml0c2lcIik7XHJcbnZhciBOb3RpZmljYXRpb25UeXBlXzEgPSByZXF1aXJlKFwiLi9lbnVtL05vdGlmaWNhdGlvblR5cGVcIik7XHJcbnZhciBKaXRzaUNvbW1hbmRRdWV1ZV8xID0gcmVxdWlyZShcIi4vaml0c2kvSml0c2lDb21tYW5kUXVldWVcIik7XHJcbnZhciBLRVlTID0ge1xyXG4gICAgQkFDS1NQQUNFOiAnYmFja3NwYWNlJyxcclxuICAgIERFTEVURTogJ2RlbGV0ZScsXHJcbiAgICBSRVRVUk46ICdlbnRlcicsXHJcbiAgICBUQUI6ICd0YWInLFxyXG4gICAgRVNDQVBFOiAnZXNjYXBlJyxcclxuICAgIFVQOiAndXAnLFxyXG4gICAgRE9XTjogJ2Rvd24nLFxyXG4gICAgUklHSFQ6ICdyaWdodCcsXHJcbiAgICBMRUZUOiAnbGVmdCcsXHJcbiAgICBIT01FOiAnaG9tZScsXHJcbiAgICBFTkQ6ICdlbmQnLFxyXG4gICAgUEFHRVVQOiAncGFnZXVwJyxcclxuICAgIFBBR0VET1dOOiAncGFnZWRvd24nLFxyXG4gICAgRjE6ICdmMScsXHJcbiAgICBGMjogJ2YyJyxcclxuICAgIEYzOiAnZjMnLFxyXG4gICAgRjQ6ICdmNCcsXHJcbiAgICBGNTogJ2Y1JyxcclxuICAgIEY2OiAnZjYnLFxyXG4gICAgRjc6ICdmNycsXHJcbiAgICBGODogJ2Y4JyxcclxuICAgIEY5OiAnZjknLFxyXG4gICAgRjEwOiAnZjEwJyxcclxuICAgIEYxMTogJ2YxMScsXHJcbiAgICBGMTI6ICdmMTInLFxyXG4gICAgTUVUQTogJ2NvbW1hbmQnLFxyXG4gICAgQ01EX0w6ICdjb21tYW5kJyxcclxuICAgIENNRF9SOiAnY29tbWFuZCcsXHJcbiAgICBBTFQ6ICdhbHQnLFxyXG4gICAgQ09OVFJPTDogJ2NvbnRyb2wnLFxyXG4gICAgU0hJRlQ6ICdzaGlmdCcsXHJcbiAgICBDQVBTX0xPQ0s6ICdjYXBzX2xvY2snLFxyXG4gICAgU1BBQ0U6ICdzcGFjZScsXHJcbiAgICBQUklOVFNDUkVFTjogJ3ByaW50c2NyZWVuJyxcclxuICAgIElOU0VSVDogJ2luc2VydCcsXHJcbiAgICBOVU1QQURfMDogJ251bXBhZF8wJyxcclxuICAgIE5VTVBBRF8xOiAnbnVtcGFkXzEnLFxyXG4gICAgTlVNUEFEXzI6ICdudW1wYWRfMicsXHJcbiAgICBOVU1QQURfMzogJ251bXBhZF8zJyxcclxuICAgIE5VTVBBRF80OiAnbnVtcGFkXzQnLFxyXG4gICAgTlVNUEFEXzU6ICdudW1wYWRfNScsXHJcbiAgICBOVU1QQURfNjogJ251bXBhZF82JyxcclxuICAgIE5VTVBBRF83OiAnbnVtcGFkXzcnLFxyXG4gICAgTlVNUEFEXzg6ICdudW1wYWRfOCcsXHJcbiAgICBOVU1QQURfOTogJ251bXBhZF85JyxcclxuICAgIENPTU1BOiAnLCcsXHJcbiAgICBQRVJJT0Q6ICcuJyxcclxuICAgIFNFTUlDT0xPTjogJzsnLFxyXG4gICAgUVVPVEU6ICdcXCcnLFxyXG4gICAgQlJBQ0tFVF9MRUZUOiAnWycsXHJcbiAgICBCUkFDS0VUX1JJR0hUOiAnXScsXHJcbiAgICBCQUNLUVVPVEU6ICdgJyxcclxuICAgIEJBQ0tTTEFTSDogJ1xcXFwnLFxyXG4gICAgTUlOVVM6ICctJyxcclxuICAgIEVRVUFMOiAnPScsXHJcbiAgICBTTEFTSDogJy8nXHJcbn07XHJcbnZhciBrZXlDb2RlVG9LZXkgPSBbXTtcclxua2V5Q29kZVRvS2V5WzhdID0gS0VZUy5CQUNLU1BBQ0U7XHJcbmtleUNvZGVUb0tleVs5XSA9IEtFWVMuVEFCO1xyXG5rZXlDb2RlVG9LZXlbMTNdID0gS0VZUy5SRVRVUk47XHJcbmtleUNvZGVUb0tleVsxNl0gPSBLRVlTLlNISUZUO1xyXG5rZXlDb2RlVG9LZXlbMTddID0gS0VZUy5DT05UUk9MO1xyXG5rZXlDb2RlVG9LZXlbMThdID0gS0VZUy5BTFQ7XHJcbmtleUNvZGVUb0tleVsyMF0gPSBLRVlTLkNBUFNfTE9DSztcclxua2V5Q29kZVRvS2V5WzI3XSA9IEtFWVMuRVNDQVBFO1xyXG5rZXlDb2RlVG9LZXlbMzJdID0gS0VZUy5TUEFDRTtcclxua2V5Q29kZVRvS2V5WzMzXSA9IEtFWVMuUEFHRVVQO1xyXG5rZXlDb2RlVG9LZXlbMzRdID0gS0VZUy5QQUdFRE9XTjtcclxua2V5Q29kZVRvS2V5WzM1XSA9IEtFWVMuRU5EO1xyXG5rZXlDb2RlVG9LZXlbMzZdID0gS0VZUy5IT01FO1xyXG5rZXlDb2RlVG9LZXlbMzddID0gS0VZUy5MRUZUO1xyXG5rZXlDb2RlVG9LZXlbMzhdID0gS0VZUy5VUDtcclxua2V5Q29kZVRvS2V5WzM5XSA9IEtFWVMuUklHSFQ7XHJcbmtleUNvZGVUb0tleVs0MF0gPSBLRVlTLkRPV047XHJcbmtleUNvZGVUb0tleVs0Ml0gPSBLRVlTLlBSSU5UU0NSRUVOO1xyXG5rZXlDb2RlVG9LZXlbNDRdID0gS0VZUy5QUklOVFNDUkVFTjtcclxua2V5Q29kZVRvS2V5WzQ1XSA9IEtFWVMuSU5TRVJUO1xyXG5rZXlDb2RlVG9LZXlbNDZdID0gS0VZUy5ERUxFVEU7XHJcbmtleUNvZGVUb0tleVs1OV0gPSBLRVlTLlNFTUlDT0xPTjtcclxua2V5Q29kZVRvS2V5WzYxXSA9IEtFWVMuRVFVQUw7XHJcbmtleUNvZGVUb0tleVs5MV0gPSBLRVlTLkNNRF9MO1xyXG5rZXlDb2RlVG9LZXlbOTJdID0gS0VZUy5DTURfUjtcclxua2V5Q29kZVRvS2V5WzkzXSA9IEtFWVMuQ01EX1I7XHJcbmtleUNvZGVUb0tleVs5Nl0gPSBLRVlTLk5VTVBBRF8wO1xyXG5rZXlDb2RlVG9LZXlbOTddID0gS0VZUy5OVU1QQURfMTtcclxua2V5Q29kZVRvS2V5Wzk4XSA9IEtFWVMuTlVNUEFEXzI7XHJcbmtleUNvZGVUb0tleVs5OV0gPSBLRVlTLk5VTVBBRF8zO1xyXG5rZXlDb2RlVG9LZXlbMTAwXSA9IEtFWVMuTlVNUEFEXzQ7XHJcbmtleUNvZGVUb0tleVsxMDFdID0gS0VZUy5OVU1QQURfNTtcclxua2V5Q29kZVRvS2V5WzEwMl0gPSBLRVlTLk5VTVBBRF82O1xyXG5rZXlDb2RlVG9LZXlbMTAzXSA9IEtFWVMuTlVNUEFEXzc7XHJcbmtleUNvZGVUb0tleVsxMDRdID0gS0VZUy5OVU1QQURfODtcclxua2V5Q29kZVRvS2V5WzEwNV0gPSBLRVlTLk5VTVBBRF85O1xyXG5rZXlDb2RlVG9LZXlbMTEyXSA9IEtFWVMuRjE7XHJcbmtleUNvZGVUb0tleVsxMTNdID0gS0VZUy5GMjtcclxua2V5Q29kZVRvS2V5WzExNF0gPSBLRVlTLkYzO1xyXG5rZXlDb2RlVG9LZXlbMTE1XSA9IEtFWVMuRjQ7XHJcbmtleUNvZGVUb0tleVsxMTZdID0gS0VZUy5GNTtcclxua2V5Q29kZVRvS2V5WzExN10gPSBLRVlTLkY2O1xyXG5rZXlDb2RlVG9LZXlbMTE4XSA9IEtFWVMuRjc7XHJcbmtleUNvZGVUb0tleVsxMTldID0gS0VZUy5GODtcclxua2V5Q29kZVRvS2V5WzEyMF0gPSBLRVlTLkY5O1xyXG5rZXlDb2RlVG9LZXlbMTIxXSA9IEtFWVMuRjEwO1xyXG5rZXlDb2RlVG9LZXlbMTIyXSA9IEtFWVMuRjExO1xyXG5rZXlDb2RlVG9LZXlbMTIzXSA9IEtFWVMuRjEyO1xyXG5rZXlDb2RlVG9LZXlbMTI0XSA9IEtFWVMuUFJJTlRTQ1JFRU47XHJcbmtleUNvZGVUb0tleVsxNzNdID0gS0VZUy5NSU5VUztcclxua2V5Q29kZVRvS2V5WzE4Nl0gPSBLRVlTLlNFTUlDT0xPTjtcclxua2V5Q29kZVRvS2V5WzE4N10gPSBLRVlTLkVRVUFMO1xyXG5rZXlDb2RlVG9LZXlbMTg4XSA9IEtFWVMuQ09NTUE7XHJcbmtleUNvZGVUb0tleVsxODldID0gS0VZUy5NSU5VUztcclxua2V5Q29kZVRvS2V5WzE5MF0gPSBLRVlTLlBFUklPRDtcclxua2V5Q29kZVRvS2V5WzE5MV0gPSBLRVlTLlNMQVNIO1xyXG5rZXlDb2RlVG9LZXlbMTkyXSA9IEtFWVMuQkFDS1FVT1RFO1xyXG5rZXlDb2RlVG9LZXlbMjE5XSA9IEtFWVMuQlJBQ0tFVF9MRUZUO1xyXG5rZXlDb2RlVG9LZXlbMjIwXSA9IEtFWVMuQkFDS1NMQVNIO1xyXG5rZXlDb2RlVG9LZXlbMjIxXSA9IEtFWVMuQlJBQ0tFVF9SSUdIVDtcclxua2V5Q29kZVRvS2V5WzIyMl0gPSBLRVlTLlFVT1RFO1xyXG5rZXlDb2RlVG9LZXlbMjI0XSA9IEtFWVMuTUVUQTtcclxua2V5Q29kZVRvS2V5WzIyOV0gPSBLRVlTLlNFTUlDT0xPTjtcclxuZm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XHJcbiAgICBrZXlDb2RlVG9LZXlbaSArIDQ4XSA9IFwiXCIgKyBpO1xyXG59XHJcbmZvciAodmFyIGkgPSAwOyBpIDwgMjY7IGkrKykge1xyXG4gICAgdmFyIGtleUNvZGUgPSBpICsgNjU7XHJcbiAgICBrZXlDb2RlVG9LZXlba2V5Q29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGtleUNvZGUpLnRvTG93ZXJDYXNlKCk7XHJcbn1cclxuZnVuY3Rpb24ga2V5Ym9hcmRFdmVudFRvS2V5KGFrZXkpIHtcclxuICAgIHJldHVybiBrZXlDb2RlVG9LZXlbYWtleV07XHJcbn1cclxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgIExpZmVjeWNsZSBvZiBCaXpnYXplIE1lZXRpbmdcclxuXHJcbiAgICBjb25uZWN0VG9CRyAtPiBqb2luQkdDb25mZXJlbmNlIC0+IGNvbm5lY3RUb0ppdHNpIC0+IGpvaW5KaXRzaUNvbmZlcmVuY2UgLT4gLi4uXHJcbiAgICAuLi4gLT4gbGVhdmVGcm9tSml0c2kgLT4gbGVhdmVGcm9tQkdcclxuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxudmFyIE1lZXRpbmdDb25maWcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBNZWV0aW5nQ29uZmlnKCkge1xyXG4gICAgICAgIHRoaXMucmVzZXRNdXRlT25EZXZpY2VDaGFuZ2UgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaGlkZVRvb2xiYXJPbk1vdXNlT3V0ID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBNZWV0aW5nQ29uZmlnO1xyXG59KCkpO1xyXG52YXIgQml6R2F6ZU1lZXRpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCaXpHYXplTWVldGluZygpIHtcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBuZXcgc2lnbmFsUi5IdWJDb25uZWN0aW9uQnVpbGRlcigpLndpdGhVcmwoXCIvQml6R2F6ZU1lZXRpbmdTZXJ2ZXJcIikuYnVpbGQoKTtcclxuICAgICAgICB0aGlzLmpvaW5lZEJHQ29uZmVyZW5jZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNUb2dnbGVNdXRlTXlBdWRpbyA9IGZhbHNlOyAvL2lzQ29udHJvbEFsbG93ZWRcclxuICAgICAgICB0aGlzLmlzVG9nZ2xlTXV0ZU15VmlkZW8gPSBmYWxzZTsgLy9pc0NvbnRyb2xBbGxvd2VkXHJcbiAgICAgICAgdGhpcy5pc011bHRpcGxlU2hhcmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNBbGxvd0N0bE1pYyA9IHRydWU7IC8vaXMgYWxsb3dlZCBjb250cm9sIG1pYyBpbiBwYXJ0aWNpcGFudCdzIGxpc3RcclxuICAgICAgICB0aGlzLmlzQWxsb3dDdGxWaWRlbyA9IHRydWU7IC8vaXMgYWxsb3dlZCBjb250cm9sIHZpZGVvIGluIHBhcnRpY2lwYW50J3MgbGlzdFxyXG4gICAgICAgIHRoaXMudWkgPSBuZXcgbWVldGluZ191aV8xLk1lZXRpbmdVSSh0aGlzKTtcclxuICAgICAgICB0aGlzLnJvb21JbmZvID0gbmV3IEJHTWVldGluZ18xLkJHTWVldGluZ0luZm8oKTtcclxuICAgICAgICB0aGlzLm1fQkdVc2VyTGlzdCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmxvY2FsVmlkZW9QYW5lbCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5teUluZm8gPSBuZXcgQkdVc2VyXzEuVXNlckluZm8oKTtcclxuICAgICAgICB0aGlzLkppdHNpTWVldEpTID0gd2luZG93LkppdHNpTWVldEpTO1xyXG4gICAgICAgIC8vSml0c2lTZXJ2ZXJEb21haW4gPSBcImlkbGVzdHMuY29tXCI7XHJcbiAgICAgICAgLy9KaXRzaVNlcnZlckRvbWFpbiA9IFwidW5pbWFpbC5pblwiO1xyXG4gICAgICAgIHRoaXMuSml0c2lTZXJ2ZXJEb21haW4gPSBcIm1lZXRzZXJ2ZXIuY29tXCI7XHJcbiAgICAgICAgdGhpcy5sb2NhbFRyYWNrcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc2NyZWVuU2hhcmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmVjb3JkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5kb3dubG9hZFJlY29yZEZpbGUgPSBmYWxzZTtcclxuICAgICAgICAvL2RlZmF1bHQgZGV2aWNlc1xyXG4gICAgICAgIHRoaXMuYWN0aXZlQ2FtZXJhSWQgPSB3aW5kb3cuX2NhbUlkO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlTWljSWQgPSB3aW5kb3cuX21pY0lkO1xyXG4gICAgICAgIHRoaXMuYWN0aXZlU3BlYWtlcklkID0gd2luZG93Ll9zcGVha2VySWQ7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBuZXcgTWVldGluZ0NvbmZpZygpO1xyXG4gICAgICAgIHRoaXMuY29tbWFuZFF1ZXVlID0gbmV3IEppdHNpQ29tbWFuZFF1ZXVlXzEuSml0c2lDb21tYW5kUXVldWUoKTtcclxuICAgICAgICB0aGlzLnByaXZhdGVDb21tYW5kUXVldWUgPSBuZXcgSml0c2lDb21tYW5kUXVldWVfMS5KaXRzaVByaXZhdGVDb21tYW5kUXVldWUoKTtcclxuICAgICAgICB0aGlzLnJlY29yZGluZ0RhdGEgPSBbXTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqICAgICAgICAgICAgICBTVEFSVCB+IEVORFxyXG4gICAgICpcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKi9cclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICghd2luZG93Ll9yb29tSWQpIHtcclxuICAgICAgICAgICAgdGhpcy5sZWF2ZUJHQ29uZmVyZW5jZSgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vaml0c2kgaW5pdFxyXG4gICAgICAgIHZhciBpbml0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGlzYWJsZUF1ZGlvTGV2ZWxzOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLkppdHNpTWVldEpTLnNldExvZ0xldmVsKHRoaXMuSml0c2lNZWV0SlMubG9nTGV2ZWxzLkVSUk9SKTtcclxuICAgICAgICB0aGlzLkppdHNpTWVldEpTLmluaXQoaW5pdE9wdGlvbnMpO1xyXG4gICAgICAgIC8vZGV2aWNlIGxvZ1xyXG4gICAgICAgIHRoaXMuSml0c2lNZWV0SlMubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoZnVuY3Rpb24gKGRldmljZXMpIHtcclxuICAgICAgICAgICAgZGV2aWNlcy5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYWN0aXZlQ2FtZXJhSWQubGVuZ3RoID4gMCAmJiBkLmRldmljZUlkID09PSBfdGhpcy5hY3RpdmVDYW1lcmFJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLkxvZyhcIkNhbWVyYTogXCIgKyBkLmxhYmVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hY3RpdmVNaWNJZC5sZW5ndGggPiAwICYmIGQuZGV2aWNlSWQgPT09IF90aGlzLmFjdGl2ZU1pY0lkICYmIGQua2luZCA9PT0gJ2F1ZGlvaW5wdXQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuTG9nKFwiTWljcm9waG9uZTogXCIgKyBkLmxhYmVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9jb25uZWN0IHRvIGJnIHNlcnZlclxyXG4gICAgICAgIHRoaXMuY29ubmVjdFRvQkdTZXJ2ZXIoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5Mb2coXCJDb25uZWN0ZWQgdG8gQml6R2F6ZSBTaWduYWxSIFNlcnZlclwiKTtcclxuICAgICAgICAgICAgX3RoaXMuam9pbkJHQ29uZmVyZW5jZSgpOyAvLyA9PiBvbkJHQ29uZmVyZW5jZUpvaW5lZFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vdG9kbyBcclxuICAgICAgICAvL2lmIGl0IHdhcyByZWNvcmRpbmcsIHNhdmUgaXQgYmVmb3JlIHN0b3BcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmppdHNpUm9vbUpvaW5lZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcEFsbE1lZGlhU3RyZWFtcygpO1xyXG4gICAgICAgICAgICB0aGlzLmppdHNpUm9vbS5sZWF2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMubGVhdmVCR0NvbmZlcmVuY2UoKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5sZWF2ZUJHQ29uZmVyZW5jZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubGVhdmVCR0NvbmZlcmVuY2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmZvcmNlU3RvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKiAgICAgICAgICAgICAgQml6R2F6ZSBTaWduYWxSIFNlcnZlciBpbnRlcmFjdGlvblxyXG4gICAgICpcclxuICAgICAqICAgICAgICAgIENvbm5lY3RcclxuICAgICAqICAgICAgICAgIEpvaW4vTGVhdmVcclxuICAgICAqICAgICAgICAgIENvbnRyb2wgTWVzc2FnZVxyXG4gICAgICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqL1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmNvbm5lY3RUb0JHU2VydmVyID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAvLyBDb25uZWN0IHRvIHRoZSBzaWduYWxpbmcgc2VydmVyXHJcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uLnN0YXJ0KCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnJlZ2lzdGVyQkdTZXJ2ZXJDYWxsYmFja3MoKTtcclxuICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKGVyci50b1N0cmluZygpKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuam9pbkJHQ29uZmVyZW5jZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24uaW52b2tlKFwiSm9pblwiLCBcIlwiICsgd2luZG93Ll9yb29tSWQsIFwiXCIgKyB3aW5kb3cuX3VzZXJJZCwgXCJcIiArIHdpbmRvdy5fYW5vbnltb3VzVXNlck5hbWUpLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXCJKb2luIE1lZXRpbmcgRmFpbGVkLlwiLCBlcnIudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLy90aGlzIGlzIHRoZSBlbnRyeSBwb2ludCB3aGVyZSB3ZSBjYW4gZGVjaWRlIHdlYmluYXIvZ3JvdXAgY2hhdHRpbmdcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUgd2UgY2FuIGRlY2lkZSBpIGFtIGhvc3Qgb3Igbm90XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25CR0NvbmZlcmVuY2VKb2luZWQgPSBmdW5jdGlvbiAocm9vbUluZm8sIHVzZXJJbmZvKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmpvaW5lZEJHQ29uZmVyZW5jZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sb2NhbFN0YXJ0VGltZXN0YW1wID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB0aGlzLnJvb21JbmZvID0gcm9vbUluZm87XHJcbiAgICAgICAgdGhpcy5Mb2coXCJNZWV0aW5nIFR5cGU6IFwiICsgKHJvb21JbmZvLklzV2ViaW5hciA/IFwiV2ViaW5hclwiIDogXCJHcm91cCBDaGF0dGluZ1wiKSk7XHJcbiAgICAgICAgdGhpcy5teUluZm8uSWQgPSB1c2VySW5mby5JZDtcclxuICAgICAgICB0aGlzLm15SW5mby5OYW1lID0gdXNlckluZm8uTmFtZTtcclxuICAgICAgICB0aGlzLm15SW5mby5Jc0hvc3QgPSB1c2VySW5mby5Jc0hvc3Q7XHJcbiAgICAgICAgdmFyIGRldmljZVVzZVBvbGljeSA9IHRoaXMuZ2V0SW5pdE1lZGlhUG9saWN5KCk7XHJcbiAgICAgICAgdGhpcy5teUluZm8ubWVkaWFQb2xpY3kudXNlQ2FtZXJhID0gZGV2aWNlVXNlUG9saWN5LnVzZUNhbWVyYTtcclxuICAgICAgICB0aGlzLm15SW5mby5tZWRpYVBvbGljeS51c2VNaWMgPSBkZXZpY2VVc2VQb2xpY3kudXNlTWljO1xyXG4gICAgICAgIHRoaXMudWkudXBkYXRlQnlSb2xlKHRoaXMubXlJbmZvLklzSG9zdCk7XHJcbiAgICAgICAgdGhpcy51aS50b29sYmFyLnVwZGF0ZUJ5Um9sZSh0aGlzLm15SW5mby5Jc0hvc3QpO1xyXG4gICAgICAgIHRoaXMudWkudXBkYXRlSm9pbmluZ0luZm8oKTtcclxuICAgICAgICB0aGlzLmluaXRNZWRpYURldmljZXMoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAvL2Nvbm5lY3QgdG8gaml0c2kgc2VydmVyIGFuZCBlbnRlciByb29tXHJcbiAgICAgICAgICAgIF90aGlzLmNvbm5lY3RUb0ppdHNpU2VydmVyKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmxlYXZlQkdDb25mZXJlbmNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuTG9nKFwibGVhdmluZyBNZWV0aW5nIFwiICsgdGhpcy5qb2luZWRCR0NvbmZlcmVuY2UpO1xyXG4gICAgICAgIC8qaWYgKHRoaXMuam9pbmVkQkdDb25mZXJlbmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5pbnZva2UoXCJMZWF2ZVJvb21cIikuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihcIkxlYXZlIE1lZXRpbmcgRmFpbGVkLlwiLCBlcnIudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSovIHtcclxuICAgICAgICAgICAgdGhpcy5zdG9wQWxsTWVkaWFTdHJlYW1zKCk7XHJcbiAgICAgICAgICAgICQoXCJmb3JtI3JldHVyblwiKS5zdWJtaXQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uQkdDb25mZXJlbmNlTGVmdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmpvaW5lZEJHQ29uZmVyZW5jZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc3RvcEFsbE1lZGlhU3RyZWFtcygpO1xyXG4gICAgICAgIHRoaXMubV9CR1VzZXJMaXN0LmNsZWFyKCk7XHJcbiAgICAgICAgJChcImZvcm0jcmV0dXJuXCIpLnN1Ym1pdCgpO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkJHVXNlckpvaW5lZCA9IGZ1bmN0aW9uICh1c2VySW5mbykge1xyXG4gICAgICAgIHRoaXMubV9CR1VzZXJMaXN0LnNldCh1c2VySW5mby5JZCwgdXNlckluZm8pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkJHVXNlckxlZnQgPSBmdW5jdGlvbiAodXNlcklkKSB7XHJcbiAgICAgICAgLy9zZWxmIGxlYXZlXHJcbiAgICAgICAgaWYgKHVzZXJJZCA9PSB0aGlzLm15SW5mby5JZCkge1xyXG4gICAgICAgICAgICB0aGlzLm9uQkdDb25mZXJlbmNlTGVmdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBwYXJ0aWNpcGFudCBsZWZ0XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1fQkdVc2VyTGlzdC5oYXModXNlcklkKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJpelVzZXIgPSB0aGlzLm1fQkdVc2VyTGlzdC5nZXQodXNlcklkKTtcclxuICAgICAgICAgICAgICAgIGlmIChiaXpVc2VyLkppdHNpX0lkICYmIHRoaXMuaml0c2lSb29tSm9pbmVkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaml0c2lVc2VyID0gdGhpcy5qaXRzaVJvb20uZ2V0UGFydGljaXBhbnRCeUlkKGJpelVzZXIuSml0c2lfSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqaXRzaVVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25KaXRzaVVzZXJMZWZ0KGJpelVzZXIuSml0c2lfSWQsIGppdHNpVXNlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLkxvZyh0aGlzLm1fQkdVc2VyTGlzdC5nZXQodXNlcklkKS5OYW1lICsgXCIgaGFzIGxlZnRcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1fQkdVc2VyTGlzdC5kZWxldGUodXNlcklkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUucmVnaXN0ZXJCR1NlcnZlckNhbGxiYWNrcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbihiZ18xLkJHdG9Vc2VyLlJPT01fSk9JTkVELCBmdW5jdGlvbiAoc3RyUm9vbUluZm8sIHN0ck15SW5mbykge1xyXG4gICAgICAgICAgICB2YXIgcm9vbUluZm8gPSBKU09OLnBhcnNlKHN0clJvb21JbmZvKTtcclxuICAgICAgICAgICAgdmFyIG15SW5mbyA9IEpTT04ucGFyc2Uoc3RyTXlJbmZvKTtcclxuICAgICAgICAgICAgX3RoaXMub25CR0NvbmZlcmVuY2VKb2luZWQocm9vbUluZm8sIG15SW5mbyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9uKGJnXzEuQkd0b1VzZXIuUk9PTV9VU0VSX0pPSU5FRCwgZnVuY3Rpb24gKHN0clVzZXJJbmZvKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmZvID0gSlNPTi5wYXJzZShzdHJVc2VySW5mbyk7XHJcbiAgICAgICAgICAgIF90aGlzLm9uQkdVc2VySm9pbmVkKGluZm8pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbihiZ18xLkJHdG9Vc2VyLkVSUk9SLCBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICBfdGhpcy5mb3JjZVN0b3AoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24ub24oYmdfMS5CR3RvVXNlci5ST09NX0xFRlQsIGZ1bmN0aW9uIChjbGllbnRJZCkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbkJHVXNlckxlZnQoY2xpZW50SWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbihiZ18xLkJHdG9Vc2VyLlNJR05BTElORywgZnVuY3Rpb24gKHNvdXJjZUlkLCBzdHJNc2cpIHtcclxuICAgICAgICAgICAgLypjb25zb2xlLmxvZygnIHJlY2VpdmVkIHNpZ25hbGluZyBtZXNzYWdlOicsIHN0ck1zZyk7XHJcbiAgICAgICAgICAgIGxldCBtc2cgPSBKU09OLnBhcnNlKHN0ck1zZyk7XHJcbiAgICAgICAgICAgIGlmIChzb3VyY2VJZCAhPSB0aGlzLm15SW5mby5JZCAmJiB0aGlzLmNvbm5NYXAuaGFzKHNvdXJjZUlkKSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBlZXJDb25uOiBCaXpHYXplQ29ubmVjdGlvbiA9IHRoaXMuY29ubk1hcC5nZXQoc291cmNlSWQpO1xyXG4gICAgICAgICAgICAgICAgcGVlckNvbm4ub25TaWduYWxpbmdNZXNzYWdlKG1zZyk7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5zZW5kQkdTaWduYWxpbmdNZXNzYWdlID0gZnVuY3Rpb24gKGRlc3RJZCwgbXNnKSB7XHJcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uLmludm9rZShiZ18xLkJHdG9Vc2VyLlNJR05BTElORywgdGhpcy5teUluZm8uSWQsIGRlc3RJZCwgSlNPTi5zdHJpbmdpZnkobXNnKSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihlcnIudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICogICAgICAgICAgICAgIExvY2FsIENhbWVyYS9NaWNyb3Bob25lIGluaXRcclxuICAgICAqXHJcbiAgICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICovXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuaW5pdE1lZGlhRGV2aWNlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuTG9nKCdHZXR0aW5nIHVzZXIgbWVkaWEgZGV2aWNlcyAuLi4nKTtcclxuICAgICAgICAvL3NldCBzcGVha2VyXHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3BlYWtlcklkICYmIHRoaXMuSml0c2lNZWV0SlMubWVkaWFEZXZpY2VzLmlzRGV2aWNlQ2hhbmdlQXZhaWxhYmxlKCdvdXRwdXQnKSkge1xyXG4gICAgICAgICAgICB0aGlzLkppdHNpTWVldEpTLm1lZGlhRGV2aWNlcy5zZXRBdWRpb091dHB1dERldmljZSh0aGlzLmFjdGl2ZVNwZWFrZXJJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIDtcclxuICAgICAgICAvL3NldCBpbnB1dCBkZXZpY2VzXHJcbiAgICAgICAgdmFyIGNhbWVyYUlkID0gdGhpcy5hY3RpdmVDYW1lcmFJZDtcclxuICAgICAgICB2YXIgbWljSWQgPSB0aGlzLmFjdGl2ZU1pY0lkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUxvY2FsVHJhY2tzKGNhbWVyYUlkLCBtaWNJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykge1xyXG4gICAgICAgICAgICBpZiAodHJhY2tzLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJubyB0cmFja3NcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5teUluZm8ubWVkaWFQb2xpY3kudXNlQ2FtZXJhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFjay5tdXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFjay51bm11dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5teUluZm8ubWVkaWFQb2xpY3kudXNlTWljKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFjay5tdXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFjay51bm11dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIF90aGlzLm9uTG9jYWxUcmFja0FkZGVkKHRyYWNrcyk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3RoaXMudWkudG9vbGJhci51cGRhdGUoX3RoaXMubXlJbmZvLCBfdGhpcy5nZXRMb2NhbFRyYWNrcygpKTtcclxuICAgICAgICAgICAgLy9pZiAoIXRoaXMucm9vbUluZm8uSXNXZWJpbmFyIHx8IHRoaXMubXlJbmZvLklzSG9zdCkgLy9tYXR2ZXlcclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkIHx8IF90aGlzLm15SW5mby5Jc0hvc3QpXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fdXBkYXRlTXlQYW5lbCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmNyZWF0ZVZpZGVvVHJhY2sgPSBmdW5jdGlvbiAoY2FtZXJhRGV2aWNlSWQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLkppdHNpTWVldEpTLmNyZWF0ZUxvY2FsVHJhY2tzKHtcclxuICAgICAgICAgICAgZGV2aWNlczogWyd2aWRlbyddLFxyXG4gICAgICAgICAgICBjYW1lcmFEZXZpY2VJZDogY2FtZXJhRGV2aWNlSWQsXHJcbiAgICAgICAgICAgIG1pY0RldmljZUlkOiBudWxsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5Mb2coZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuY3JlYXRlQXVkaW9UcmFjayA9IGZ1bmN0aW9uIChtaWNEZXZpY2VJZCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLkppdHNpTWVldEpTLmNyZWF0ZUxvY2FsVHJhY2tzKHtcclxuICAgICAgICAgICAgZGV2aWNlczogWydhdWRpbyddLFxyXG4gICAgICAgICAgICBjYW1lcmFEZXZpY2VJZDogbnVsbCxcclxuICAgICAgICAgICAgbWljRGV2aWNlSWQ6IG1pY0RldmljZUlkXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBfdGhpcy5Mb2coZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmNyZWF0ZUxvY2FsVHJhY2tzID0gZnVuY3Rpb24gKGNhbWVyYURldmljZUlkLCBtaWNEZXZpY2VJZCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKGNhbWVyYURldmljZUlkICE9IG51bGwgJiYgbWljRGV2aWNlSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5KaXRzaU1lZXRKUy5jcmVhdGVMb2NhbFRyYWNrcyh7XHJcbiAgICAgICAgICAgICAgICBkZXZpY2VzOiBbJ2F1ZGlvJywgJ3ZpZGVvJ10sXHJcbiAgICAgICAgICAgICAgICBjYW1lcmFEZXZpY2VJZDogY2FtZXJhRGV2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICBtaWNEZXZpY2VJZDogbWljRGV2aWNlSWRcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgeyByZXR1cm4gUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuY3JlYXRlQXVkaW9UcmFjayhtaWNEZXZpY2VJZCkudGhlbihmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtID0gX2FbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbTtcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgX3RoaXMuY3JlYXRlVmlkZW9UcmFjayhjYW1lcmFEZXZpY2VJZCkudGhlbihmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RyZWFtID0gX2FbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF0pOyB9KS50aGVuKGZ1bmN0aW9uICh0cmFja3MpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFja3MuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0eXBlb2YgdCAhPT0gJ3VuZGVmaW5lZCc7IH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY2FtZXJhRGV2aWNlSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVWaWRlb1RyYWNrKGNhbWVyYURldmljZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobWljRGV2aWNlSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVBdWRpb1RyYWNrKG1pY0RldmljZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uTG9jYWxUcmFja0FkZGVkID0gZnVuY3Rpb24gKHRyYWNrcykge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGksIGxvY2FsVmlkZW9UcmFjaztcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyYWNrcy5sZW5ndGggPD0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGkgPCB0cmFja3MubGVuZ3RoKSkgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrc1tpXS5hZGRFdmVudExpc3RlbmVyKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLnRyYWNrLlRSQUNLX0FVRElPX0xFVkVMX0NIQU5HRUQsIGZ1bmN0aW9uIChhdWRpb0xldmVsKSB7IHJldHVybiBjb25zb2xlLmxvZyhcIkF1ZGlvIExldmVsIGxvY2FsOiBcIiArIGF1ZGlvTGV2ZWwpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tzW2ldLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5KaXRzaU1lZXRKUy5ldmVudHMudHJhY2suVFJBQ0tfTVVURV9DSEFOR0VELCBmdW5jdGlvbiAodHJhY2spIHsgX3RoaXMudXBkYXRlVWlPbkxvY2FsVHJhY2tDaGFuZ2UoKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrc1tpXS5hZGRFdmVudExpc3RlbmVyKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLnRyYWNrLkxPQ0FMX1RSQUNLX1NUT1BQRUQsIGZ1bmN0aW9uICh0cmFjaykgeyBfdGhpcy51cGRhdGVVaU9uTG9jYWxUcmFja0NoYW5nZSgpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tzW2ldLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5KaXRzaU1lZXRKUy5ldmVudHMudHJhY2suVFJBQ0tfQVVESU9fT1VUUFVUX0NIQU5HRUQsIGZ1bmN0aW9uIChkZXZpY2VJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwidHJhY2sgYXVkaW8gb3V0cHV0IGRldmljZSB3YXMgY2hhbmdlZCB0byBcIiArIGRldmljZUlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdHNpUm9vbUpvaW5lZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5Mb2coXCJbIE9VVCBdIG15IHRyYWNrIC0gXCIgKyB0cmFja3NbaV0uZ2V0VHlwZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5yZXBsYWNlTG9jYWxUcmFjayh0cmFja3NbaV0sIHRyYWNrc1tpXS5nZXRUeXBlKCkpXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCAxXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdG9vbGJhclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIudXBkYXRlKHRoaXMubXlJbmZvLCB0aGlzLmdldExvY2FsVHJhY2tzKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL215IHZpZGVvIHBhbmVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZU15UGFuZWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxWaWRlb1RyYWNrID0gdGhpcy5nZXRMb2NhbFRyYWNrQnlUeXBlKE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFZpZGVvVHJhY2sgJiYgdGhpcy5sb2NhbFZpZGVvUGFuZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsVmlkZW9UcmFjay5hdHRhY2godGhpcy5sb2NhbFZpZGVvUGFuZWwudmlkZW9FbGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYWxWaWRlb1BhbmVsLnZpZGVvRWxlbS5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2FsVmlkZW9QYW5lbC5zZXRTaG90bmFtZVZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnN0b3BBbGxNZWRpYVN0cmVhbXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgbG9jYWxUcmFja3MgPSBfX3NwcmVhZEFycmF5KFtdLCB0aGlzLmdldExvY2FsVHJhY2tzKCkpO1xyXG4gICAgICAgIGxvY2FsVHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnJlbW92ZUxvY2FsVHJhY2sodHJhY2spLnRoZW4oZnVuY3Rpb24gKF8pIHtcclxuICAgICAgICAgICAgICAgIHRyYWNrLmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uRGV2aWNlQ2hhbmdlID0gZnVuY3Rpb24gKG5ld0RldmljZXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciB2aWRlb0RldmljZUNoYW5nZWQgPSB0aGlzLmFjdGl2ZUNhbWVyYUlkICE9PSBuZXdEZXZpY2VzLmNhbWVyYUlkO1xyXG4gICAgICAgIHZhciBhdWRpb0RldmljZUNoYW5nZWQgPSB0aGlzLmFjdGl2ZU1pY0lkICE9PSBuZXdEZXZpY2VzLm1pY0lkO1xyXG4gICAgICAgIC8vY3JlYXRlIG5ldyB0cmFja3Mgd2l0aCBuZXcgZGV2aWNlc1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTG9jYWxUcmFja3ModmlkZW9EZXZpY2VDaGFuZ2VkID8gbmV3RGV2aWNlcy5jYW1lcmFJZCA6IG51bGwsIGF1ZGlvRGV2aWNlQ2hhbmdlZCA/IG5ld0RldmljZXMubWljSWQgOiBudWxsKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodHJhY2tzKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uTG9jYWxUcmFja0FkZGVkKHRyYWNrcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVDYW1lcmFJZCA9IG5ld0RldmljZXMuY2FtZXJhSWQ7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVNaWNJZCA9IG5ld0RldmljZXMubWljSWQ7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVTcGVha2VySWQgPSBuZXdEZXZpY2VzLnNwZWFrZXJJZDtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuZ2V0QWN0aXZlRGV2aWNlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgYWN0aXZlRGV2aWNlcyA9IG5ldyBBY3RpdmVEZXZpY2VzXzEuQWN0aXZlRGV2aWNlcygpO1xyXG4gICAgICAgIGFjdGl2ZURldmljZXMuY2FtZXJhSWQgPSB0aGlzLmFjdGl2ZUNhbWVyYUlkO1xyXG4gICAgICAgIGFjdGl2ZURldmljZXMubWljSWQgPSB0aGlzLmFjdGl2ZU1pY0lkO1xyXG4gICAgICAgIGFjdGl2ZURldmljZXMuc3BlYWtlcklkID0gdGhpcy5hY3RpdmVTcGVha2VySWQ7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2ZURldmljZXM7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmdldEluaXRNZWRpYVBvbGljeSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdXNlQ2FtZXJhID0gdHJ1ZTtcclxuICAgICAgICB2YXIgdXNlTWljID0gdHJ1ZTtcclxuICAgICAgICAvL2lmICh0aGlzLnJvb21JbmZvLklzV2ViaW5hcikgLy9tYXR2ZXlcclxuICAgICAgICBpZiAodGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5teUluZm8uSXNIb3N0KSB7XHJcbiAgICAgICAgICAgICAgICB1c2VDYW1lcmEgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHVzZU1pYyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnJvb21JbmZvLmNoYW5uZWxUeXBlID09PSBDaGFubmVsVHlwZV8xLkNoYW5uZWxUeXBlLkF1ZGlvT25seSlcclxuICAgICAgICAgICAgdXNlQ2FtZXJhID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMucm9vbUluZm8uY2hhbm5lbFR5cGUgPT09IENoYW5uZWxUeXBlXzEuQ2hhbm5lbFR5cGUuVmlkZW9Pbmx5KVxyXG4gICAgICAgICAgICB1c2VNaWMgPSBmYWxzZTtcclxuICAgICAgICBpZiAod2luZG93Ll92aWRlb011dGUgIT09IFwidHJ1ZVwiKVxyXG4gICAgICAgICAgICB1c2VDYW1lcmEgPSBmYWxzZTtcclxuICAgICAgICBpZiAod2luZG93Ll9hdWRpb011dGUgIT09IFwidHJ1ZVwiKVxyXG4gICAgICAgICAgICB1c2VNaWMgPSBmYWxzZTtcclxuICAgICAgICB2YXIgcG9saWN5ID0gbmV3IElucHV0RGV2aWNlUG9saWN5XzEuSW5wdXRNZWRpYVBvbGljeSgpO1xyXG4gICAgICAgIHBvbGljeS51c2VDYW1lcmEgPSB1c2VDYW1lcmE7XHJcbiAgICAgICAgcG9saWN5LnVzZU1pYyA9IHVzZU1pYztcclxuICAgICAgICB0aGlzLkxvZyhcInVzZUNhbWVyYSBcIiArIHVzZUNhbWVyYSk7XHJcbiAgICAgICAgdGhpcy5Mb2coXCJ1c2VNaWMgXCIgKyB1c2VNaWMpO1xyXG4gICAgICAgIHJldHVybiBwb2xpY3k7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICogICAgICAgICAgICAgIExvY2FsIFRyYWNrIEFjY2Vzc1xyXG4gICAgICpcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKi9cclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5qaXRzaVJvb21Kb2luZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaml0c2lSb29tICYmIHRoaXMuaml0c2lSb29tLmlzSm9pbmVkKCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmdldExvY2FsVHJhY2tzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmppdHNpUm9vbUpvaW5lZCgpKVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5qaXRzaVJvb20uZ2V0TG9jYWxUcmFja3MoKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsVHJhY2tzO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5nZXRMb2NhbFRyYWNrQnlUeXBlID0gZnVuY3Rpb24gKHR5cGUpIHtcclxuICAgICAgICBpZiAodGhpcy5qaXRzaVJvb21Kb2luZWQoKSkge1xyXG4gICAgICAgICAgICB2YXIgdHJhY2tzID0gdGhpcy5qaXRzaVJvb20uZ2V0TG9jYWxUcmFja3ModHlwZSk7XHJcbiAgICAgICAgICAgIGlmICh0cmFja3MubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFja3NbMF07XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHRyYWNrID0gdGhpcy5sb2NhbFRyYWNrcy5maW5kKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmdldFR5cGUoKSA9PT0gdHlwZTsgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cmFjaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnJlbW92ZUxvY2FsVHJhY2sgPSBmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICBpZiAodGhpcy5qaXRzaVJvb21Kb2luZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5qaXRzaVJvb20ucmVtb3ZlVHJhY2sodHJhY2spO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5sb2NhbFRyYWNrcy5pbmRleE9mKHRyYWNrKTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID49IDApXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2FsVHJhY2tzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy90eXBlIGlzIG5lY2Nlc3NyYXkgd2hlbiBuZXdUcmFjayBpcyBudWxsXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUucmVwbGFjZUxvY2FsVHJhY2sgPSBmdW5jdGlvbiAobmV3VHJhY2ssIHR5cGUpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBvbGRUcmFjaztcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgb2xkVHJhY2sgPSB0aGlzLmdldExvY2FsVHJhY2tCeVR5cGUodHlwZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAob2xkVHJhY2sgPT09IG5ld1RyYWNrKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdCgpXTtcclxuICAgICAgICAgICAgICAgIGlmICghb2xkVHJhY2sgJiYgIW5ld1RyYWNrKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBQcm9taXNlLnJlamVjdCgpXTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdHNpUm9vbUpvaW5lZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuaml0c2lSb29tLnJlcGxhY2VUcmFjayhvbGRUcmFjaywgbmV3VHJhY2spLnRoZW4oZnVuY3Rpb24gKF8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRUcmFjaylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRUcmFjay5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVVaU9uTG9jYWxUcmFja0NoYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZW1vdmVMb2NhbFRyYWNrKG9sZFRyYWNrKS50aGVuKGZ1bmN0aW9uIChfKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkVHJhY2spXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkVHJhY2suZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1RyYWNrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmxvY2FsVHJhY2tzLnB1c2gobmV3VHJhY2spO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlVWlPbkxvY2FsVHJhY2tDaGFuZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUudXBkYXRlVWlPbkxvY2FsVHJhY2tDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9jYWxWaWRlb1BhbmVsKVxyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVNeVBhbmVsKCk7XHJcbiAgICAgICAgdGhpcy51aS50b29sYmFyLnVwZGF0ZSh0aGlzLm15SW5mbywgdGhpcy5nZXRMb2NhbFRyYWNrcygpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKiAgICAgICAgICAgICAgSml0c2kgU2VydmVyIGludGVyYWN0aW9uXHJcbiAgICAgKiAgICAgICAgIENvbm5lY3RcclxuICAgICAqICAgICAgICAgRW50ZXIvTGVhdmUgUm9vbVxyXG4gICAgICogICAgICAgICBTZW5kL1JlY2VpdmUgVHJhY2tcclxuICAgICAqICAgICAgICAgVXNlckluZm9cclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKi9cclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5jb25uZWN0VG9KaXRzaVNlcnZlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBzZXJ2ZXJkb21haW4gPSB0aGlzLkppdHNpU2VydmVyRG9tYWluO1xyXG4gICAgICAgIHZhciBjb25uQ29uZiA9IHtcclxuICAgICAgICAgICAgaG9zdHM6IHtcclxuICAgICAgICAgICAgICAgIGRvbWFpbjogc2VydmVyZG9tYWluLFxyXG4gICAgICAgICAgICAgICAgbXVjOiBcImNvbmZlcmVuY2UuXCIgKyBzZXJ2ZXJkb21haW4sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJvc2g6IFwiLy9cIiArIHNlcnZlcmRvbWFpbiArIFwiL2h0dHAtYmluZFwiLFxyXG4gICAgICAgICAgICAvLyBUaGUgbmFtZSBvZiBjbGllbnQgbm9kZSBhZHZlcnRpc2VkIGluIFhFUC0wMTE1ICdjJyBzdGFuemFcclxuICAgICAgICAgICAgY2xpZW50Tm9kZTogXCIvL1wiICsgc2VydmVyZG9tYWluICsgXCIvaml0c2ltZWV0XCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuaml0c2lDb25uZWN0aW9uID0gbmV3IHRoaXMuSml0c2lNZWV0SlMuSml0c2lDb25uZWN0aW9uKG51bGwsIG51bGwsIGNvbm5Db25mKTtcclxuICAgICAgICB0aGlzLmppdHNpQ29ubmVjdGlvbi5hZGRFdmVudExpc3RlbmVyKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLmNvbm5lY3Rpb24uQ09OTkVDVElPTl9FU1RBQkxJU0hFRCwgZnVuY3Rpb24gKCkgeyBfdGhpcy5vbkppdHNpQ29ubmVjdGlvblN1Y2Nlc3MoKTsgfSk7XHJcbiAgICAgICAgdGhpcy5qaXRzaUNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcih0aGlzLkppdHNpTWVldEpTLmV2ZW50cy5jb25uZWN0aW9uLkNPTk5FQ1RJT05fRkFJTEVELCBmdW5jdGlvbiAoKSB7IF90aGlzLm9uSml0c2lDb25uZWN0aW9uRmFpbGVkKCk7IH0pO1xyXG4gICAgICAgIHRoaXMuaml0c2lDb25uZWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5KaXRzaU1lZXRKUy5ldmVudHMuY29ubmVjdGlvbi5DT05ORUNUSU9OX0RJU0NPTk5FQ1RFRCwgZnVuY3Rpb24gKCkgeyBfdGhpcy5kaXNjb25uZWN0RnJvbUppdHNpU2VydmVyKCk7IH0pO1xyXG4gICAgICAgIHRoaXMuaml0c2lDb25uZWN0aW9uLmNvbm5lY3QoKTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25KaXRzaUNvbm5lY3Rpb25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuTG9nKFwiQ29ubmVjdGVkIHRvIEppdHNpIFNlcnZlciAtIFwiICsgdGhpcy5KaXRzaVNlcnZlckRvbWFpbik7XHJcbiAgICAgICAgdGhpcy5qb2luSml0c2lDb25mZXJlbmNlKCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uSml0c2lDb25uZWN0aW9uRmFpbGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuTG9nKFwiRmFpbGVkIHRvIGNvbm5lY3QgSml0c2kgU2VydmVyIC0gXCIgKyB0aGlzLkppdHNpU2VydmVyRG9tYWluKTtcclxuICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuZGlzY29ubmVjdEZyb21KaXRzaVNlcnZlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLkxvZyhcIkRpc2Nvbm5lY3RlZCBmcm9tIEppdHNpIFNlcnZlciAtIFwiICsgdGhpcy5KaXRzaVNlcnZlckRvbWFpbik7XHJcbiAgICAgICAgdGhpcy5zdG9wKCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmpvaW5KaXRzaUNvbmZlcmVuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgY29uZk9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG9wZW5CcmlkZ2VDaGFubmVsOiB0cnVlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbSA9IHRoaXMuaml0c2lDb25uZWN0aW9uLmluaXRKaXRzaUNvbmZlcmVuY2UoXCJcIiArIHRoaXMucm9vbUluZm8uSWQsIGNvbmZPcHRpb25zKTtcclxuICAgICAgICAvL3JlbW90ZSB0cmFja1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLm9uKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLmNvbmZlcmVuY2UuVFJBQ0tfQURERUQsIGZ1bmN0aW9uICh0cmFjaykge1xyXG4gICAgICAgICAgICBfdGhpcy5vblJlbW90ZVRyYWNrQWRkZWQodHJhY2spO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLm9uKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLmNvbmZlcmVuY2UuVFJBQ0tfUkVNT1ZFRCwgZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uUmVtb3ZlZFJlbW90ZVRyYWNrKHRyYWNrKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvL215IGpvaW5cclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5vbih0aGlzLkppdHNpTWVldEpTLmV2ZW50cy5jb25mZXJlbmNlLkNPTkZFUkVOQ0VfSk9JTkVELCBmdW5jdGlvbiAoKSB7IF90aGlzLm9uSml0c2lDb25mZXJlbmNlSm9pbmVkKCk7IH0pO1xyXG4gICAgICAgIC8vbXkgbGVmdFxyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLm9uKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLmNvbmZlcmVuY2UuQ09ORkVSRU5DRV9MRUZULCBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2F3YWl0ZXIoX3RoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgdGhpcy5vbkppdHNpQ29uZmVyZW5jZUxlZnQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgIH0pOyB9KTsgfSk7XHJcbiAgICAgICAgLy9yZW1vdGUgam9pblxyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLm9uKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLmNvbmZlcmVuY2UuVVNFUl9KT0lORUQsIGZ1bmN0aW9uIChpZCwgdXNlcikge1xyXG4gICAgICAgICAgICBfdGhpcy5vbkppdHNpVXNlckpvaW5lZChpZCwgdXNlcik7XHJcbiAgICAgICAgICAgIC8vcmVtb3RlVHJhY2tzW2lkXSA9IFtdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vcmVtb3RlIGxlZnRcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5vbih0aGlzLkppdHNpTWVldEpTLmV2ZW50cy5jb25mZXJlbmNlLlVTRVJfTEVGVCwgZnVuY3Rpb24gKGlkLCB1c2VyKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uSml0c2lVc2VyTGVmdChpZCwgdXNlcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy90cmFjayBtdXRlXHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20ub24odGhpcy5KaXRzaU1lZXRKUy5ldmVudHMuY29uZmVyZW5jZS5UUkFDS19NVVRFX0NIQU5HRUQsIGZ1bmN0aW9uICh0cmFjaykge1xyXG4gICAgICAgICAgICBpZiAodHJhY2suaXNMb2NhbCgpKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5vbkxvY2FsVHJhY2tNdXRlQ2hhbmdlZCh0cmFjayk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5vblJlbW90ZVRyYWNrTXV0ZUNoYW5nZWQodHJhY2spO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9hdWRpbyBsZXZlbCBjaGFuZ2VcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5vbih0aGlzLkppdHNpTWVldEpTLmV2ZW50cy5jb25mZXJlbmNlLlRSQUNLX0FVRElPX0xFVkVMX0NIQU5HRUQsIGZ1bmN0aW9uICh1c2VySUQsIGF1ZGlvTGV2ZWwpIHtcclxuICAgICAgICAgICAgX3RoaXMuTG9nKHVzZXJJRCArIFwiIC0gXCIgKyBhdWRpb0xldmVsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvL2NoYXRcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5vbih0aGlzLkppdHNpTWVldEpTLmV2ZW50cy5jb25mZXJlbmNlLk1FU1NBR0VfUkVDRUlWRUQsIGZ1bmN0aW9uIChpZCwgbWVzc2FnZSwgdGltZXN0YW1wKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uUmVjZWl2ZUNoYXRNZXNzYWdlKGlkLCBtZXNzYWdlLCB0aW1lc3RhbXApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vcHJpdmF0ZSBtZXNzYWdlIG9iamVjdFxyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLm9uKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLmNvbmZlcmVuY2UuRU5EUE9JTlRfTUVTU0FHRV9SRUNFSVZFRCwgZnVuY3Rpb24gKHBlZXIsIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZS50eXBlID09PSBcImJpel9wcml2YXRlXCIpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLm9uUHJpdmF0ZUNvbW1hbmQobWVzc2FnZS5zZW5kZXJJZCwgbWVzc2FnZS5zdWJ0eXBlLCBtZXNzYWdlLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9kb21pbmFudCBzcGVha2VyXHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20ub24odGhpcy5KaXRzaU1lZXRKUy5ldmVudHMuY29uZmVyZW5jZS5ET01JTkFOVF9TUEVBS0VSX0NIQU5HRUQsIGZ1bmN0aW9uIChpZCwgcHJldmlvdXNTcGVha2Vycykge1xyXG4gICAgICAgICAgICBfdGhpcy5vbkRvbWluYW50U3BlYWtlckNoYW5nZWQoaWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vbmFtZSBjaGFuZ2VcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5vbih0aGlzLkppdHNpTWVldEpTLmV2ZW50cy5jb25mZXJlbmNlLkRJU1BMQVlfTkFNRV9DSEFOR0VELCBmdW5jdGlvbiAodXNlcklELCBkaXNwbGF5TmFtZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh1c2VySUQgKyBcIiAtIFwiICsgZGlzcGxheU5hbWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vY29tbWFuZFxyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLmFkZENvbW1hbmRMaXN0ZW5lcihqaXRzaV8xLkppdHNpQ29tbWFuZC5LSUNLX09VVCwgZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uS2lja2VkT3V0KHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoaml0c2lfMS5KaXRzaUNvbW1hbmQuTVVURV9BbGxfQVVESU8sIGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbk11dGVBbGxBdWRpbyhwYXJhbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20uYWRkQ29tbWFuZExpc3RlbmVyKGppdHNpXzEuSml0c2lDb21tYW5kLk1VVEVfQWxsX1ZJREVPLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25NdXRlQWxsVmlkZW8ocGFyYW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLmFkZENvbW1hbmRMaXN0ZW5lcihqaXRzaV8xLkppdHNpQ29tbWFuZC5HUkFOVF9IT1NUX1JPTEUsIGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbkNoYW5nZWRNb2RlcmF0b3IocGFyYW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLmFkZENvbW1hbmRMaXN0ZW5lcihqaXRzaV8xLkppdHNpQ29tbWFuZC5NVVRFX0FVRElPLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25NdXRlZEF1ZGlvKHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoaml0c2lfMS5KaXRzaUNvbW1hbmQuQUxMT1dfTUlDLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25BbGxvd01pYyhwYXJhbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20uYWRkQ29tbWFuZExpc3RlbmVyKGppdHNpXzEuSml0c2lDb21tYW5kLk1VVEVfVklERU8sIGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbk11dGVkVmlkZW8ocGFyYW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8qdGhpcy5qaXRzaVJvb20uYWRkQ29tbWFuZExpc3RlbmVyKEppdHNpQ29tbWFuZC5BTExPV19DQU1FUkEsIChwYXJhbTogSml0c2lDb21tYW5kUGFyYW0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vbkFsbG93Q2FtZXJhQ29tbWFuZChwYXJhbSlcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoSml0c2lDb21tYW5kLkFMTE9XX01JQywgKHBhcmFtOiBKaXRzaUNvbW1hbmRQYXJhbSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9uQWxsb3dNaWNDb21tYW5kKHBhcmFtKVxyXG4gICAgICAgIH0pOyovXHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20uYWRkQ29tbWFuZExpc3RlbmVyKGppdHNpXzEuSml0c2lDb21tYW5kLklOSVRfTUVESUFfUE9MSUNZLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25Jbml0TWVkaWFQb2xpY3kocGFyYW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLmFkZENvbW1hbmRMaXN0ZW5lcihqaXRzaV8xLkppdHNpQ29tbWFuZC5CSVpfSUQsIGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbkJpeklkKHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoaml0c2lfMS5KaXRzaUNvbW1hbmQuQVNLX1JFQ09SRElORywgZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uQXNrUmVjb3JkaW5nKHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoaml0c2lfMS5KaXRzaUNvbW1hbmQuQVNLX1NDUkVFTlNIQVJFLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25Bc2tTY3JlZW5TaGFyZShwYXJhbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20uYWRkQ29tbWFuZExpc3RlbmVyKGppdHNpXzEuSml0c2lDb21tYW5kLkFTS19NVUxUSVNIQVJFLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25Bc2tNdWx0aVNoYXJlKHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoaml0c2lfMS5KaXRzaUNvbW1hbmQuQVNLX0hBTkRSQUlTRSwgZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm9uQXNrSGFuZFJhaXNlKHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRDb21tYW5kTGlzdGVuZXIoaml0c2lfMS5KaXRzaUNvbW1hbmQuRklMRV9NRVRBLCBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICAgICAgX3RoaXMub25GaWxlTWV0YShwYXJhbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20uYWRkQ29tbWFuZExpc3RlbmVyKGppdHNpXzEuSml0c2lDb21tYW5kLkZJTEVfU0xJQ0UsIGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgICAgICBfdGhpcy5vbkZpbGVEYXRhKHBhcmFtKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvL3NldCBuYW1lXHJcbiAgICAgICAgdGhpcy5qaXRzaVJvb20uc2V0RGlzcGxheU5hbWUodGhpcy5teUluZm8uTmFtZSk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxvY2FsVHJhY2tzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuTG9nKFwiWyBPVVQgXSBteSB0cmFjayAtIFwiICsgdGhpcy5sb2NhbFRyYWNrc1tpXS5nZXRUeXBlKCkpO1xyXG4gICAgICAgICAgICB0aGlzLmppdHNpUm9vbS5hZGRUcmFjayh0aGlzLmxvY2FsVHJhY2tzW2ldKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLkxvZyhlcnJvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2pvaW5KaXRzaUNvbmZlcmVuY2VcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5qb2luKCk7IC8vY2FsbGJhY2sgLSAgb25KaXRzaVVzZXJKb2luZWRcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUubGVhdmVKaXRzaUNvbmZlcmVuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB9O1xyXG4gICAgLy9teSBlbnRlciByb29tXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25KaXRzaUNvbmZlcmVuY2VKb2luZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLm15SW5mby5KaXRzaV9JZCA9IHRoaXMuaml0c2lSb29tLm15VXNlcklkKCk7XHJcbiAgICAgICAgdGhpcy5Mb2coXCJKaXRzaV9JZCA6IFwiICsgdGhpcy5teUluZm8uSml0c2lfSWQpO1xyXG4gICAgICAgIC8vc2V0IHN1YmplY3RcclxuICAgICAgICB0aGlzLnVpLm1lZXRpbmdEZXNjV2lkZ2V0LnNldFN1YmplY3QodGhpcy5yb29tSW5mby5jb25mZXJlbmNlTmFtZSwgdGhpcy5yb29tSW5mby5ob3N0TmFtZSk7XHJcbiAgICAgICAgdmFyIGF1ZGlvTXV0ZSA9IHRydWU7XHJcbiAgICAgICAgdmFyIHZpZGVvTXV0ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5nZXRMb2NhbFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTyAmJiAhdHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgdmlkZW9NdXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTyAmJiAhdHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgYXVkaW9NdXRlID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9hZGQgbGlzdFxyXG4gICAgICAgIC8vaWYgKHRoaXMubXlJbmZvLklzSG9zdCkgXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnVpLmFkZFBhcnRpY2lwYW50KHRoaXMuaml0c2lSb29tLm15VXNlcklkKCksIHRoaXMubXlJbmZvLk5hbWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgdmlkZW9NdXRlLCBhdWRpb011dGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3NldCB0aW1lXHJcbiAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVsdGEgPSBEYXRlLm5vdygpIC0gX3RoaXMubG9jYWxTdGFydFRpbWVzdGFtcDtcclxuICAgICAgICAgICAgdmFyIGVsYXBzZWQgPSBfdGhpcy5yb29tSW5mby5lbGFwc2VkICsgZGVsdGE7XHJcbiAgICAgICAgICAgIF90aGlzLnVpLm1lZXRpbmdEZXNjV2lkZ2V0LnVwZGF0ZVRpbWUoVGltZVV0aWxfMS5Uc1RvRGF0ZUZvcm1hdChlbGFwc2VkKSk7XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgLy9zZW5kIG1lZGlhIHBvbGljeVxyXG4gICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5JTklUX01FRElBX1BPTElDWSwgdGhpcy5teUluZm8uSml0c2lfSWQsIHRoaXMubXlJbmZvLm1lZGlhUG9saWN5KTtcclxuICAgICAgICAvL3NlbmQgYml6Z2F6ZSBpZFxyXG4gICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5CSVpfSUQsIHRoaXMubXlJbmZvLklkKTtcclxuICAgIH07XHJcbiAgICAvL215IGxlYXZlIHJvb21cclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkppdHNpQ29uZmVyZW5jZUxlZnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5teUluZm8uSml0c2lfSWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubGVhdmVCR0NvbmZlcmVuY2UoKTtcclxuICAgIH07XHJcbiAgICAvL3JlbW90ZS11c2VyIGVudGVyIHJvb21cclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkppdHNpVXNlckpvaW5lZCA9IGZ1bmN0aW9uIChqaXRzaUlkLCB1c2VyKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLkxvZyhcImpvaW5lZCB1c2VyOiBcIiArIHVzZXIuZ2V0RGlzcGxheU5hbWUoKSk7XHJcbiAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb24odXNlci5nZXREaXNwbGF5TmFtZSgpLCBcIk5ldyBQYXJ0aWNpcGFudCBqb2luZWRcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuVXNlcik7XHJcbiAgICAgICAgLy9pZiB0cmFjayBkb2Vzbid0IGFycml2ZSBmb3IgY2VydGFpbiB0aW1lXHJcbiAgICAgICAgLy9nZW5lcmF0ZSBuZXcgcGFuZWwgZm9yIHRoYXQgdXNlclxyXG4gICAgICAgIC8vaWYgKCF0aGlzLnJvb21JbmZvLklzV2ViaW5hcikgeyAvL21hdHZleVxyXG4gICAgICAgIGlmICghdGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VyLmdldFByb3BlcnR5KFVzZXJQcm9wZXJ0eV8xLlVzZXJQcm9wZXJ0eS52aWRlb1BhbmVsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2aWRlb1BhbmVsID0gX3RoaXMudWkudmlkZW9QYW5lbEdyaWQuZ2V0TmV3VmlkZW9QYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXIuc2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LnZpZGVvUGFuZWwsIHZpZGVvUGFuZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl91cGRhdGVVc2VyUGFuZWwodXNlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgYXVkaW9NdXRlID0gdHJ1ZTtcclxuICAgICAgICB2YXIgdmlkZW9NdXRlID0gdHJ1ZTtcclxuICAgICAgICB1c2VyLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTyAmJiAhdHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgdmlkZW9NdXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTyAmJiAhdHJhY2suaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgdmlkZW9NdXRlID0gZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9hZGQgbGlzdFxyXG4gICAgICAgIGlmICh0aGlzLm15SW5mby5Jc0hvc3QpIHtcclxuICAgICAgICAgICAgdGhpcy51aS5hZGRQYXJ0aWNpcGFudChqaXRzaUlkLCB1c2VyLmdldERpc3BsYXlOYW1lKCksIGZhbHNlLCAvL21lP1xyXG4gICAgICAgICAgICBmYWxzZSwgZmFsc2UsIHZpZGVvTXV0ZSwgLy91c2UgY2FtZXJhP1xyXG4gICAgICAgICAgICBhdWRpb011dGUgLy91c2UgbWljP1xyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy51aS5hZGRQYXJ0aWNpcGFudChqaXRzaUlkLCB1c2VyLmdldERpc3BsYXlOYW1lKCksIGZhbHNlLCAvL21lP1xyXG4gICAgICAgICAgICB0cnVlLCB0cnVlLCB2aWRlb011dGUsIC8vdXNlIGNhbWVyYT9cclxuICAgICAgICAgICAgYXVkaW9NdXRlIC8vdXNlIG1pYz9cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9ub3RpZnkgaGltIHRoYXQgaSBhbSBtb2RlcmF0b3JcclxuICAgICAgICBpZiAodGhpcy5teUluZm8uSXNIb3N0KVxyXG4gICAgICAgICAgICB0aGlzLmdyYW50TW9kZXJhdG9yUm9sZSh0aGlzLmppdHNpUm9vbS5teVVzZXJJZCgpKTtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaVByaXZhdGVDb21tYW5kKGppdHNpSWQsIGppdHNpXzEuSml0c2lQcml2YXRlQ29tbWFuZC5NRURJQV9QT0xJQ1ksIHRoaXMubXlJbmZvLm1lZGlhUG9saWN5KTtcclxuICAgICAgICB0aGlzLmNvbW1hbmRRdWV1ZS5leGVjdXRlUXVldWVkQ29tbWFuZHMoaml0c2lJZCk7XHJcbiAgICAgICAgdGhpcy5wcml2YXRlQ29tbWFuZFF1ZXVlLmV4ZWN1dGVRdWV1ZWRDb21tYW5kcyhqaXRzaUlkKTtcclxuICAgIH07XHJcbiAgICAvL3JlbW90ZSBsZWF2ZSByb29tXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25KaXRzaVVzZXJMZWZ0ID0gZnVuY3Rpb24gKGppdHNpSWQsIHVzZXIpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcodXNlci5nZXREaXNwbGF5TmFtZSgpLCBcIlBhcnRpY2lwYW50IGxlZnRcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuVXNlcik7XHJcbiAgICAgICAgdGhpcy5Mb2coXCJsZWZ0IHVzZXI6IFwiICsgdXNlci5nZXREaXNwbGF5TmFtZSgpKTtcclxuICAgICAgICB2YXIgdmlkZW9QYW5lbCA9IHVzZXIuZ2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LnZpZGVvUGFuZWwpO1xyXG4gICAgICAgIGlmICh2aWRlb1BhbmVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudWkudmlkZW9QYW5lbEdyaWQuZnJlZVZpZGVvUGFuZWwodmlkZW9QYW5lbC5JZCk7XHJcbiAgICAgICAgICAgIHVzZXIuc2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LnZpZGVvUGFuZWwsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3JlbW92ZSBsaXN0XHJcbiAgICAgICAgdGhpcy51aS5yZW1vdmVQYXJ0aWNpcGFudChqaXRzaUlkKTtcclxuICAgICAgICAvL3JlbW92ZSBmcm9tIGxpc3RcclxuICAgICAgICB0aGlzLm1fQkdVc2VyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChielVzZXIsIGJpeklkKSB7XHJcbiAgICAgICAgICAgIGlmIChielVzZXIuSml0c2lfSWQgPT0gaml0c2lJZCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMubV9CR1VzZXJMaXN0LmRlbGV0ZShiaXpJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25CaXpJZCA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIHZhciBzZW5kZXJKaXRzaUlkID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJJZDtcclxuICAgICAgICBpZiAoc2VuZGVySml0c2lJZCA9PT0gdGhpcy5teUluZm8uSml0c2lfSWQpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB2YXIgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChzZW5kZXJKaXRzaUlkKTtcclxuICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICB2YXIgYml6SWQgPSBwYXJhbS52YWx1ZTtcclxuICAgICAgICAgICAgdmFyIGJpelVzZXIgPSB0aGlzLm1fQkdVc2VyTGlzdC5nZXQoYml6SWQpO1xyXG4gICAgICAgICAgICBpZiAoYml6VXNlcilcclxuICAgICAgICAgICAgICAgIGJpelVzZXIuSml0c2lfSWQgPSBzZW5kZXJKaXRzaUlkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb21tYW5kUXVldWUucXVldWVDb21tYW5kKHNlbmRlckppdHNpSWQsIGppdHNpXzEuSml0c2lDb21tYW5kLkJJWl9JRCwgcGFyYW0sIHRoaXMub25CaXpJZC5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy9bIElOIF0gcmVtb3RlIHRyYWNrXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25SZW1vdGVUcmFja0FkZGVkID0gZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgaWYgKHRyYWNrLmlzTG9jYWwoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuTG9nKFwiWyBJTiBdIHJlbW90ZSB0cmFjayAtIFwiICsgdHJhY2suZ2V0VHlwZSgpKTtcclxuICAgICAgICAvL2lmICh0aGlzLnJvb21JbmZvLklzV2ViaW5hciAmJiB0cmFjay5pc011dGVkKCkpIC8vbWF0dmV5XHJcbiAgICAgICAgaWYgKHRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCAmJiB0cmFjay5pc011dGVkKCkpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAvL2FkZCB0byB1aVxyXG4gICAgICAgIHZhciBpZCA9IHRyYWNrLmdldFBhcnRpY2lwYW50SWQoKTtcclxuICAgICAgICB2YXIgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChpZCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuTG9nKHVzZXIuZ2V0RGlzcGxheU5hbWUoKSArIFwiIG5vdCB5ZXQgYWRkZWRcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHZpZGVvUGFuZWwgPSB1c2VyLmdldFByb3BlcnR5KFVzZXJQcm9wZXJ0eV8xLlVzZXJQcm9wZXJ0eS52aWRlb1BhbmVsKTtcclxuICAgICAgICBpZiAoIXZpZGVvUGFuZWwpIHtcclxuICAgICAgICAgICAgdmlkZW9QYW5lbCA9IHRoaXMudWkudmlkZW9QYW5lbEdyaWQuZ2V0TmV3VmlkZW9QYW5lbCgpO1xyXG4gICAgICAgICAgICB1c2VyLnNldFByb3BlcnR5KFVzZXJQcm9wZXJ0eV8xLlVzZXJQcm9wZXJ0eS52aWRlb1BhbmVsLCB2aWRlb1BhbmVsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPKSB7XHJcbiAgICAgICAgICAgIHZhciB2aWRlb0VsZW0gPSB2aWRlb1BhbmVsLnZpZGVvRWxlbTtcclxuICAgICAgICAgICAgdHJhY2suYXR0YWNoKHZpZGVvRWxlbSk7XHJcbiAgICAgICAgICAgIHZpZGVvRWxlbS5wbGF5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPKSB7XHJcbiAgICAgICAgICAgIHZhciBhdWRpb0VsZW0gPSB2aWRlb1BhbmVsLmF1ZGlvRWxlbTtcclxuICAgICAgICAgICAgdHJhY2suYXR0YWNoKGF1ZGlvRWxlbSk7XHJcbiAgICAgICAgICAgIGF1ZGlvRWxlbS5wbGF5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVVzZXJQYW5lbCh1c2VyKTtcclxuICAgIH07XHJcbiAgICAvLyBbREVMXSByZW1vdGUgdHJhY2tcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vblJlbW92ZWRSZW1vdGVUcmFjayA9IGZ1bmN0aW9uICh0cmFjaykge1xyXG4gICAgICAgIGlmICh0cmFjay5pc0xvY2FsKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5Mb2coXCJbIERFTCBdIGxvY2FsdHJhY2sgLSBcIiArIHRyYWNrLmdldFR5cGUoKSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiWyBERUwgXSBsb2NhbHRyYWNrIC0gXCIgKyB0cmFjay5nZXRUeXBlKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5Mb2coXCJbIERFTCBdIHJlbW90ZXRyYWNrIC0gXCIgKyB0cmFjay5nZXRUeXBlKCkpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlsgREVMIF0gcmVtb3RldHJhY2sgLS0tIFwiICsgdHJhY2suZ2V0VHlwZSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJhY2sucmVtb3ZlQWxsTGlzdGVuZXJzKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLnRyYWNrLlRSQUNLX0FVRElPX0xFVkVMX0NIQU5HRUQpO1xyXG4gICAgICAgIHRyYWNrLnJlbW92ZUFsbExpc3RlbmVycyh0aGlzLkppdHNpTWVldEpTLmV2ZW50cy50cmFjay5UUkFDS19NVVRFX0NIQU5HRUQpO1xyXG4gICAgICAgIHRyYWNrLnJlbW92ZUFsbExpc3RlbmVycyh0aGlzLkppdHNpTWVldEpTLmV2ZW50cy50cmFjay5MT0NBTF9UUkFDS19TVE9QUEVEKTtcclxuICAgICAgICB0cmFjay5yZW1vdmVBbGxMaXN0ZW5lcnModGhpcy5KaXRzaU1lZXRKUy5ldmVudHMudHJhY2suVFJBQ0tfVklERU9UWVBFX0NIQU5HRUQpO1xyXG4gICAgICAgIHRyYWNrLnJlbW92ZUFsbExpc3RlbmVycyh0aGlzLkppdHNpTWVldEpTLmV2ZW50cy50cmFjay5UUkFDS19BVURJT19PVVRQVVRfQ0hBTkdFRCk7XHJcbiAgICAgICAgdHJhY2sucmVtb3ZlQWxsTGlzdGVuZXJzKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLnRyYWNrLk5PX0RBVEFfRlJPTV9TT1VSQ0UpO1xyXG4gICAgICAgIGlmICghdHJhY2suaXNMb2NhbCgpKSB7XHJcbiAgICAgICAgICAgIHZhciBqaXRzaUlkID0gdHJhY2suZ2V0UGFydGljaXBhbnRJZCgpO1xyXG4gICAgICAgICAgICB2YXIgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChqaXRzaUlkKTtcclxuICAgICAgICAgICAgLy9pZiAodGhpcy5yb29tSW5mby5Jc1dlYmluYXIpIHsgLy9tYXR2ZXlcclxuICAgICAgICAgICAgaWYgKHRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIElzSG9zdCA9IHVzZXIuZ2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LklzSG9zdCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXNlclZpZGVvUGFuZWwgPSB1c2VyLmdldFByb3BlcnR5KFVzZXJQcm9wZXJ0eV8xLlVzZXJQcm9wZXJ0eS52aWRlb1BhbmVsKTtcclxuICAgICAgICAgICAgICAgIGlmICghSXNIb3N0ICYmIHVzZXIuZ2V0VHJhY2tzKCkubGVuZ3RoIDw9IDAgJiYgdXNlclZpZGVvUGFuZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnZpZGVvUGFuZWxHcmlkLmZyZWVWaWRlb1BhbmVsKHVzZXJWaWRlb1BhbmVsLklkKTtcclxuICAgICAgICAgICAgICAgICAgICB1c2VyLnNldFByb3BlcnR5KFVzZXJQcm9wZXJ0eV8xLlVzZXJQcm9wZXJ0eS52aWRlb1BhbmVsLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVVc2VyUGFuZWwodXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVVpT25Mb2NhbFRyYWNrQ2hhbmdlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5fdXBkYXRlVXNlclBhbmVsID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICBpZiAodXNlciAmJiB1c2VyLmdldFByb3BlcnR5KFVzZXJQcm9wZXJ0eV8xLlVzZXJQcm9wZXJ0eS52aWRlb1BhbmVsKSkge1xyXG4gICAgICAgICAgICB2YXIgdmlkZW9QYW5lbCA9IHVzZXIuZ2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LnZpZGVvUGFuZWwpO1xyXG4gICAgICAgICAgICB2aWRlb1BhbmVsLnVwZGF0ZVBhbmVsT25KaXRzaVVzZXIodGhpcy5teUluZm8sIHVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuX3VwZGF0ZU15UGFuZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9jYWxWaWRlb1BhbmVsID09IG51bGwpIHtcclxuICAgICAgICAgICAgLy9pZiAodGhpcy5yb29tSW5mby5Jc1dlYmluYXIgJiYgIXRoaXMubXlJbmZvLklzSG9zdCkgeyAvL21hdHZleVxyXG4gICAgICAgICAgICBpZiAodGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkICYmICF0aGlzLm15SW5mby5Jc0hvc3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpc0FsbE11dGVkXzEgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRMb2NhbFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmFjay5pc011dGVkKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQWxsTXV0ZWRfMSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlzQWxsTXV0ZWRfMSlcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2FsVmlkZW9QYW5lbCA9IHRoaXMudWkudmlkZW9QYW5lbEdyaWQuZ2V0TmV3VmlkZW9QYW5lbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhbFZpZGVvUGFuZWwgPSB0aGlzLnVpLnZpZGVvUGFuZWxHcmlkLmdldE5ld1ZpZGVvUGFuZWwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sb2NhbFZpZGVvUGFuZWwpXHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxWaWRlb1BhbmVsLnVwZGF0ZVBhbmVsT25NeUJHVXNlcih0aGlzLm15SW5mbywgdGhpcy5nZXRMb2NhbFRyYWNrcygpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKiAgICAgICAgICAgICAgICBNZXNzYWdpbmcgYmV0d2VlbiBKaXRzaSBwYXJ0aWNpcGFudHNcclxuICAgICAqICAgICAgICBCcm9hZGNhc3RcclxuICAgICAqICAgICAgICBQcml2YXRlXHJcbiAgICAgKlxyXG4gICAgICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqL1xyXG4gICAgLy9BVFRFTlRJT04hIGF0dHJpYnV0ZXMgPSB7a2V5MTogbm90IG9iamVjdCwga2V5Mjogbm90IG9iamVjdCwgLi4ufVxyXG4gICAgLy9zZW5kIGFzIHByaW1pdGl2ZSB0eXBlIGxpa2UgYm9vbGVhbiwgc3RyaW5nLCBudW1iZXIuLi5cclxuICAgIC8vYW5kIGRlY29kZSB3aGVuIHVzZSB2YWx1ZTEsIHZhdWxlMlxyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnNlbmRKaXRzaUJyb2FkY2FzdENvbW1hbmQgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUsIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICBpZiAoYXR0cmlidXRlcyA9PT0gdm9pZCAwKSB7IGF0dHJpYnV0ZXMgPSBudWxsOyB9XHJcbiAgICAgICAgdmFyIHBhcmFtID0gbmV3IEppdHNpQ29tbWFuZFBhcmFtXzEuSml0c2lDb21tYW5kUGFyYW0oKTtcclxuICAgICAgICBwYXJhbS52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIGlmICghIWF0dHJpYnV0ZXMgJiYgdHlwZW9mIGF0dHJpYnV0ZXMgPT09IFwib2JqZWN0XCIgJiYgYXR0cmlidXRlcy5jb25zdHJ1Y3Rvci5uYW1lID09PSBcIk9iamVjdFwiKVxyXG4gICAgICAgICAgICBwYXJhbS5hdHRyaWJ1dGVzID0gX19hc3NpZ24oe30sIGF0dHJpYnV0ZXMpO1xyXG4gICAgICAgIHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQgPSB0aGlzLm15SW5mby5KaXRzaV9JZDtcclxuICAgICAgICBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWUgPSB0aGlzLm15SW5mby5OYW1lO1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLnNlbmRDb21tYW5kT25jZSh0eXBlLCBwYXJhbSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnNlbmRKaXRzaVByaXZhdGVDb21tYW5kID0gZnVuY3Rpb24gKHRhcmdldElkLCB0eXBlLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgdmFyIHBheWxvYWQgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwiYml6X3ByaXZhdGVcIixcclxuICAgICAgICAgICAgc3VidHlwZTogdHlwZSxcclxuICAgICAgICAgICAgc2VuZGVySWQ6IHRoaXMubXlJbmZvLkppdHNpX0lkLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmppdHNpUm9vbS5zZW5kTWVzc2FnZShwYXlsb2FkLCB0YXJnZXRJZCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uUHJpdmF0ZUNvbW1hbmQgPSBmdW5jdGlvbiAoc2VuZGVySWQsIHR5cGUsIG1lc3NhZ2UpIHtcclxuICAgICAgICB2YXIgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChzZW5kZXJJZCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJpdmF0ZUNvbW1hbmRRdWV1ZS5xdWV1ZUNvbW1hbmQoc2VuZGVySWQsIHR5cGUsIG1lc3NhZ2UsIHRoaXMub25Qcml2YXRlQ29tbWFuZC5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZSA9PT0gaml0c2lfMS5KaXRzaVByaXZhdGVDb21tYW5kLk1FRElBX1BPTElDWSkge1xyXG4gICAgICAgICAgICB2YXIgcG9saWN5ID0gbWVzc2FnZTtcclxuICAgICAgICAgICAgdGhpcy5vblVzZXJNZWRpYVBvbGljeShzZW5kZXJJZCwgcG9saWN5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gaml0c2lfMS5KaXRzaVByaXZhdGVDb21tYW5kLkFMTE9XX1JFQ09SRElORykge1xyXG4gICAgICAgICAgICB2YXIgYWxsb3cgPSBtZXNzYWdlLmFsbG93O1xyXG4gICAgICAgICAgICB0aGlzLm9uQWxsb3dSZWNvcmRpbmcoc2VuZGVySWQsIGFsbG93KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gaml0c2lfMS5KaXRzaVByaXZhdGVDb21tYW5kLkFMTE9XX1NDUkVFTlNIQVJFKSB7XHJcbiAgICAgICAgICAgIHZhciBhbGxvdyA9IG1lc3NhZ2UuYWxsb3c7XHJcbiAgICAgICAgICAgIHRoaXMub25BbGxvd1NjcmVlbnNoYXJlKHNlbmRlcklkLCBhbGxvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IGppdHNpXzEuSml0c2lQcml2YXRlQ29tbWFuZC5BTExPV19IQU5EUkFJU0UpIHtcclxuICAgICAgICAgICAgdmFyIGFsbG93ID0gbWVzc2FnZS5hbGxvdztcclxuICAgICAgICAgICAgdGhpcy5vbkFsbG93SGFuZFJhaXNlKHNlbmRlcklkLCBhbGxvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IGppdHNpXzEuSml0c2lQcml2YXRlQ29tbWFuZC5QUklWQVRFX0NBSFQpIHtcclxuICAgICAgICAgICAgdGhpcy5vblJlY2VpdmVQcml2YXRlQ2hhdE1lc3NhZ2Uoc2VuZGVySWQsIG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKiAgICAgICAgICAgICAgICBNZWV0aW5nIExvZ2ljXHJcbiAgICAgKiAgICAgICAgTW9kZXJhdG9yXHJcbiAgICAgKiAgICAgICAgTXV0ZS9Vbm11dGUgQXVkaW8vVmlkZW9cclxuICAgICAqICAgICAgICBTY3JlZW5TaGFyZVxyXG4gICAgICogICAgICAgIFJlY29yZGluZ1xyXG4gICAgICogICAgICAgIENoYXR0aW5nXHJcbiAgICAgKiAgICAgICAgRmlsZSBTaGFyaW5nXHJcbiAgICAgKlxyXG4gICAgICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqL1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnNlbmRSZW1vdGVDb250cm9sUmVwbHkgPSBmdW5jdGlvbiAodHlwZSwgZSwgdGFyZ2V0SWQpIHtcclxuICAgICAgICAvL3RoaXMuTG9nKFwiU2VuZGluZyByZW1vdGVDb250cm9sXCIpO1xyXG4gICAgICAgIHZhciBwYXJhbSA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ3JlbW90ZS1jb250cm9sJyxcclxuICAgICAgICAgICAgdHlwZTogJycsXHJcbiAgICAgICAgICAgIGFjdGlvbjogJycsXHJcbiAgICAgICAgICAgIGJ1dHRvbjogMCxcclxuICAgICAgICAgICAgeDogMCxcclxuICAgICAgICAgICAgeTogMCxcclxuICAgICAgICAgICAgbW9kaWZpZXJzOiB7fSxcclxuICAgICAgICAgICAga2V5OiAnJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3Blcm1pc3Npb25zJzpcclxuICAgICAgICAgICAgICAgIHBhcmFtLnR5cGUgPSAncGVybWlzc2lvbnMnO1xyXG4gICAgICAgICAgICAgICAgcGFyYW0uYWN0aW9uID0gJ3JlcXVlc3QnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ21vdXNlbW92ZSc6XHJcbiAgICAgICAgICAgICAgICBwYXJhbS50eXBlID0gJ21vdXNlbW92ZSc7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS54ID0gZS54O1xyXG4gICAgICAgICAgICAgICAgcGFyYW0ueSA9IGUueTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdtb3VzZWRvd24nOlxyXG4gICAgICAgICAgICAgICAgcGFyYW0udHlwZSA9ICdtb3VzZWRvd24nO1xyXG4gICAgICAgICAgICAgICAgcGFyYW0uYnV0dG9uID0gZS5idXR0b247XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbW91c2V1cCc6XHJcbiAgICAgICAgICAgICAgICBwYXJhbS50eXBlID0gJ21vdXNldXAnO1xyXG4gICAgICAgICAgICAgICAgcGFyYW0uYnV0dG9uID0gZS5idXR0b247XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAna2V5ZG93bic6XHJcbiAgICAgICAgICAgICAgICBwYXJhbS50eXBlID0gJ2tleWRvd24nO1xyXG4gICAgICAgICAgICAgICAgcGFyYW0ubW9kaWZpZXJzID0gZS5tb2RpZmllcnM7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS5rZXkgPSBrZXlib2FyZEV2ZW50VG9LZXkoZS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLXBhcmFtJywgcGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2tleXVwJzpcclxuICAgICAgICAgICAgICAgIHBhcmFtLnR5cGUgPSAna2V5dXAnO1xyXG4gICAgICAgICAgICAgICAgcGFyYW0ubW9kaWZpZXJzID0gZS5tb2RpZmllcnM7XHJcbiAgICAgICAgICAgICAgICBwYXJhbS5rZXkgPSBrZXlib2FyZEV2ZW50VG9LZXkoZS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCctLS0tLS0tLS0tLS0tLS0tLS0tLXBhcmFtJywgcGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qbGV0IHBhcmFtID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAncmVtb3RlLWNvbnRyb2wnLFxyXG4gICAgICAgICAgICB0eXBlOiAnbW91c2Vkb3duJyxcclxuICAgICAgICAgICAgYnV0dG9uOiAxXHJcbiAgICAgICAgfTsqL1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLnNlbmRFbmRwb2ludE1lc3NhZ2UodGFyZ2V0SWQsIHBhcmFtKTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUua2lja1BhcnRpY2lwYW50T3V0ID0gZnVuY3Rpb24gKHRhcmdldElkKSB7XHJcbiAgICAgICAgdGhpcy5Mb2coXCJTZW5kaW5nIGtpY2sgb3V0XCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRhcmdldElkKTtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaUJyb2FkY2FzdENvbW1hbmQoaml0c2lfMS5KaXRzaUNvbW1hbmQuS0lDS19PVVQsIHRhcmdldElkKTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25LaWNrZWRPdXQgPSBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICB0aGlzLkxvZyhcInJlY2VpdmVkIGtpY2sgb3V0XCIpO1xyXG4gICAgICAgIHZhciB0YXJnZXRJZCA9IHBhcmFtLnZhbHVlO1xyXG4gICAgICAgIGlmICh0YXJnZXRJZCA9PT0gdGhpcy5teUluZm8uSml0c2lfSWQpIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JjZVN0b3AoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy9tb2RlcmF0b3JcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5ncmFudE1vZGVyYXRvclJvbGUgPSBmdW5jdGlvbiAodGFyZ2V0SWQpIHtcclxuICAgICAgICB0aGlzLkxvZyhcIlNlbmRpbmcgZ3JhbnQgaG9zdFwiKTtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaUJyb2FkY2FzdENvbW1hbmQoaml0c2lfMS5KaXRzaUNvbW1hbmQuR1JBTlRfSE9TVF9ST0xFLCB0YXJnZXRJZCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uQ2hhbmdlZE1vZGVyYXRvciA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5Mb2coXCJyZWNlaXZlZCBncmFudCBob3N0XCIpO1xyXG4gICAgICAgIHZhciB0YXJnZXRJZCA9IHBhcmFtLnZhbHVlO1xyXG4gICAgICAgIHZhciBzZW5kZXJOYW1lID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lO1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQ7XHJcbiAgICAgICAgaWYgKHRhcmdldElkID09PSB0aGlzLm15SW5mby5KaXRzaV9JZCkge1xyXG4gICAgICAgICAgICBpZiAoc2VuZGVySWQgIT09IHRhcmdldElkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKHNlbmRlck5hbWUsIFwiWW91J3JlIGdyYW50ZWQgY28taG9zdCBwZXJtaXNzaW9uXCIsIE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLkdyYW50SG9zdCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm15SW5mby5Jc0hvc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlTXlQYW5lbCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5qaXRzaVJvb20uZ2V0UGFydGljaXBhbnRzKCkuZm9yRWFjaChmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl91cGRhdGVVc2VyUGFuZWwodXNlcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMudWkudXBkYXRlQnlSb2xlKHRoaXMubXlJbmZvLklzSG9zdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyID0gdGhpcy5qaXRzaVJvb20uZ2V0UGFydGljaXBhbnRCeUlkKHRhcmdldElkKTtcclxuICAgICAgICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgIHVzZXIuc2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LklzSG9zdCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVVc2VyUGFuZWwodXNlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbW1hbmRRdWV1ZS5xdWV1ZUNvbW1hbmQodGFyZ2V0SWQsIGppdHNpXzEuSml0c2lDb21tYW5kLkdSQU5UX0hPU1RfUk9MRSwgcGFyYW0sIHRoaXMub25DaGFuZ2VkTW9kZXJhdG9yLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkluaXRNZWRpYVBvbGljeSA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIHZhciBzb3VyY2VJZCA9IHBhcmFtLnZhbHVlO1xyXG4gICAgICAgIGlmIChzb3VyY2VJZCA9PT0gdGhpcy5teUluZm8uSml0c2lfSWQpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB0aGlzLkxvZyhcInJlY2VpdmVkIGluaXRNZWRpYVBvbGljeSBmcm9tIFwiICsgc291cmNlSWQpO1xyXG4gICAgICAgIHZhciB1c2VyID0gdGhpcy5qaXRzaVJvb20uZ2V0UGFydGljaXBhbnRCeUlkKHNvdXJjZUlkKTtcclxuICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICB2YXIgdXNlQ2FtZXJhID0gcGFyYW0uYXR0cmlidXRlcy51c2VDYW1lcmEgPT09IFwidHJ1ZVwiO1xyXG4gICAgICAgICAgICB2YXIgdXNlTWljID0gcGFyYW0uYXR0cmlidXRlcy51c2VNaWMgPT09IFwidHJ1ZVwiO1xyXG4gICAgICAgICAgICB0aGlzLnVpLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQuc2V0TXV0ZUNhbWVyYShzb3VyY2VJZCwgIXVzZUNhbWVyYSk7XHJcbiAgICAgICAgICAgIHRoaXMudWkucGFydGljaXBhbnRzTGlzdFdpZGdldC5zZXRNdXRlTWljKHNvdXJjZUlkLCAhdXNlTWljKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuTG9nKFwiZGVsYXlpbmcgaW5pdE1lZGlhUG9saWN5IGNhbGxiYWNrXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1hbmRRdWV1ZS5xdWV1ZUNvbW1hbmQoc291cmNlSWQsIGppdHNpXzEuSml0c2lDb21tYW5kLklOSVRfTUVESUFfUE9MSUNZLCBwYXJhbSwgdGhpcy5vbkluaXRNZWRpYVBvbGljeS5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uVXNlck1lZGlhUG9saWN5ID0gZnVuY3Rpb24gKHNlbmRlcklkLCBwb2xpY3kpIHtcclxuICAgICAgICB0aGlzLnVpLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQuc2V0TXV0ZUNhbWVyYShzZW5kZXJJZCwgIXBvbGljeS51c2VDYW1lcmEpO1xyXG4gICAgICAgIHRoaXMudWkucGFydGljaXBhbnRzTGlzdFdpZGdldC5zZXRNdXRlTWljKHNlbmRlcklkLCAhcG9saWN5LnVzZU1pYyk7XHJcbiAgICB9O1xyXG4gICAgLy9tdXRlIG15c2VsZlxyXG4gICAgLy9jYWxsZWQgd2hlbiB1c2VyIGNsaWNrIHRvb2xiYXIgYnV0dG9uc1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLk9uVG9nZ2xlTXV0ZU15QXVkaW8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCAmJiAhdGhpcy5teUluZm8uSXNIb3N0KVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy9hbGVydChcIklzSG9zdFwiICsgdGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkICsgXCItXCIgKyBcIklzQ29udHJvbEFsbG93ZWRcIiArIHRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCk7XHJcbiAgICAgICAgdmFyIGF1ZGlvTXV0ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmdldExvY2FsVHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPICYmIHRyYWNrLmlzTXV0ZWQoKSlcclxuICAgICAgICAgICAgICAgIGF1ZGlvTXV0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaXNUb2dnbGVNdXRlTXlBdWRpbyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5tdXRlTXlBdWRpbyghYXVkaW9NdXRlZCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLk9uVG9nZ2xlTXV0ZU15VmlkZW8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCAmJiAhdGhpcy5teUluZm8uSXNIb3N0KVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdmFyIHZpZGVvTXV0ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmdldExvY2FsVHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPICYmIHRyYWNrLmlzTXV0ZWQoKSlcclxuICAgICAgICAgICAgICAgIHZpZGVvTXV0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaXNUb2dnbGVNdXRlTXlWaWRlbyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5tdXRlTXlWaWRlbyghdmlkZW9NdXRlZCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmRlbmllZHVubXV0ZU15QXVkaW8gPSBmdW5jdGlvbiAodGFyZ2V0SWQsIG11dGUpIHtcclxuICAgICAgICBpZiAodGFyZ2V0SWQgIT09IHRoaXMubXlJbmZvLkppdHNpX0lkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5BTExPV19NSUMsIHRhcmdldElkLCB7IG11dGU6IG11dGUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5tdXRlTXlBdWRpbyA9IGZ1bmN0aW9uIChtdXRlKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJtdXRlTXlBdWRpb1wiKTtcclxuICAgICAgICB0aGlzLmdldExvY2FsVHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobXV0ZSlcclxuICAgICAgICAgICAgICAgICAgICB0cmFjay5tdXRlKCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdHJhY2sudW5tdXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkICYmIG11dGUpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLm15SW5mby5Jc0hvc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNBbGxvd0N0bE1pYyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudWkudXBkYXRlQnlSb2xlKHRoaXMuaXNBbGxvd0N0bE1pYyk7XHJcbiAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJcIiwgXCJZb3VyIE1pYyBpcyBNdXRlZFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5BdWRpb011dGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLnJvb21JbmZvLklzQ29udHJvbEFsbG93ZWQgJiYgKCFtdXRlKSkge1xyXG4gICAgICAgICAgICB0aGlzLmlzQWxsb3dDdGxNaWMgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnVpLnVwZGF0ZUJ5Um9sZSh0aGlzLmlzQWxsb3dDdGxNaWMpO1xyXG4gICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKFwiXCIsIFwiWW91ciBNaWMgaXMgVW5tdXRlZFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5BdWRpbyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLnJvb21JbmZvLklzQ29udHJvbEFsbG93ZWQgJiYgKG11dGUpICYmICghdGhpcy5pc1RvZ2dsZU11dGVNeUF1ZGlvKSlcclxuICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcIlwiLCBcIkhvc3QgbXV0ZWQgWW91ciBNaWNcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuQXVkaW9NdXRlKTtcclxuICAgICAgICAvL2Vsc2UgaWYgKCF0aGlzLnJvb21JbmZvLklzQ29udHJvbEFsbG93ZWQgJiYgKCFtdXRlKSAmJiAoISB0aGlzLmlzVG9nZ2xlTXV0ZU15QXVkaW8pKVxyXG4gICAgICAgIC8vICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJcIiwgXCJIb3N0IFVubXV0ZWQgeW91ciBNaWNcIiwgTm90aWZpY2F0aW9uVHlwZS5BdWRpbyk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm11dGVNeVZpZGVvID0gZnVuY3Rpb24gKG11dGUpIHtcclxuICAgICAgICB0aGlzLmdldExvY2FsVHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHtcclxuICAgICAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobXV0ZSlcclxuICAgICAgICAgICAgICAgICAgICB0cmFjay5tdXRlKCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdHJhY2sudW5tdXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkICYmIG11dGUpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLm15SW5mby5Jc0hvc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNBbGxvd0N0bFZpZGVvID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51aS51cGRhdGVCeVJvbGUodGhpcy5pc0FsbG93Q3RsVmlkZW8pO1xyXG4gICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKFwiXCIsIFwiWW91ciBDYXJtZXJhIGlzIERpc2FibGVkXCIsIE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLlZpZGVvTXV0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCAmJiAoIW11dGUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBbGxvd0N0bE1pYyA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMudWkudXBkYXRlQnlSb2xlKHRoaXMuaXNBbGxvd0N0bE1pYyk7XHJcbiAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJcIiwgXCJZb3VyIENhbWVyYSBpcyBFbmFibGVkXCIsIE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLlZpZGVvKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCAmJiAobXV0ZSkgJiYgKCF0aGlzLmlzVG9nZ2xlTXV0ZU15VmlkZW8pKVxyXG4gICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKFwiXCIsIFwiSG9zdCBkaXNhYmxlZCB5b3VyIENhbWVyYVwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5WaWRlb011dGUpO1xyXG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLnJvb21JbmZvLklzQ29udHJvbEFsbG93ZWQgJiYgKCFtdXRlKSAmJiAoIXRoaXMuaXNUb2dnbGVNdXRlTXlWaWRlbykpXHJcbiAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJcIiwgXCJIb3N0IGVuYWJsZWQgeW91ciBDYW1lcmFcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuVmlkZW8pO1xyXG4gICAgfTtcclxuICAgIC8vbXV0ZSBvdGhlcnNcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5tdXRlVXNlckF1ZGlvID0gZnVuY3Rpb24gKHRhcmdldElkLCBtdXRlKSB7XHJcbiAgICAgICAgdGhpcy5pc1RvZ2dsZU11dGVNeUF1ZGlvID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRhcmdldElkID09PSB0aGlzLm15SW5mby5KaXRzaV9JZCkge1xyXG4gICAgICAgICAgICB0aGlzLm11dGVNeUF1ZGlvKG11dGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5NVVRFX0FVRElPLCB0YXJnZXRJZCwgeyBtdXRlOiBtdXRlIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5tdXRlVXNlclZpZGVvID0gZnVuY3Rpb24gKHRhcmdldElkLCBtdXRlKSB7XHJcbiAgICAgICAgdGhpcy5pc1RvZ2dsZU11dGVNeVZpZGVvID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRhcmdldElkID09PSB0aGlzLm15SW5mby5KaXRzaV9JZClcclxuICAgICAgICAgICAgdGhpcy5tdXRlTXlWaWRlbyhtdXRlKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5NVVRFX1ZJREVPLCB0YXJnZXRJZCwgeyBtdXRlOiBtdXRlIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkFsbG93TWljID0gZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgdmFyIHNlbmRlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgaWYgKHRoaXMubXlJbmZvLklzSG9zdClcclxuICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcIlwiLCBcIllvdXIgcmVxdWVzdCBpcyBkZW5pZWQgYnkgXCIgKyBzZW5kZXJOYW1lLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5BdWRpb011dGUpO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbk11dGVkQXVkaW8gPSBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICB0aGlzLmlzVG9nZ2xlTXV0ZU15QXVkaW8gPSBmYWxzZTtcclxuICAgICAgICB2YXIgdGFyZ2V0SWQgPSBwYXJhbS52YWx1ZTtcclxuICAgICAgICB2YXIgc2VuZGVySWQgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlcklkO1xyXG4gICAgICAgIHZhciBzZW5kZXJOYW1lID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lO1xyXG4gICAgICAgIHZhciBtdXRlID0gcGFyYW0uYXR0cmlidXRlcy5tdXRlID09PSBcInRydWVcIjtcclxuICAgICAgICBpZiAodGFyZ2V0SWQgPT0gdGhpcy5teUluZm8uSml0c2lfSWQpIHtcclxuICAgICAgICAgICAgaWYgKHNlbmRlcklkICE9PSB0YXJnZXRJZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG11dGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuYXNrRGlhbG9nKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUmVxdWVzdGVkIHRvIG11dGUgeW91ciBtaWNyb3Bob25lXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb3RpZmljYXRpb25UeXBlLkF1ZGlvTXV0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubXV0ZU15QXVkaW8uYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7Ki9cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGVNeUF1ZGlvKG11dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvb21JbmZvLklzQ29udHJvbEFsbG93ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5hc2tEaWFsb2coc2VuZGVyTmFtZSwgXCJSZXF1ZXN0ZWQgdG8gdW5tdXRlIHlvdXIgbWljcm9waG9uZVwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5BdWRpbywgdGhpcy5tdXRlTXlBdWRpby5iaW5kKHRoaXMpLCB0aGlzLmRlbmllZHVubXV0ZU15QXVkaW8uYmluZCh0aGlzKSwgbXV0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGVNeUF1ZGlvKG11dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXV0ZU15QXVkaW8obXV0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uTXV0ZWRWaWRlbyA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIHRoaXMuaXNUb2dnbGVNdXRlTXlWaWRlbyA9IGZhbHNlO1xyXG4gICAgICAgIHZhciB0YXJnZXRJZCA9IHBhcmFtLnZhbHVlO1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQ7XHJcbiAgICAgICAgdmFyIHNlbmRlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgdmFyIG11dGUgPSBwYXJhbS5hdHRyaWJ1dGVzLm11dGUgPT09IFwidHJ1ZVwiO1xyXG4gICAgICAgIGlmICh0YXJnZXRJZCA9PSB0aGlzLm15SW5mby5KaXRzaV9JZCkge1xyXG4gICAgICAgICAgICBpZiAoc2VuZGVySWQgIT09IHRhcmdldElkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobXV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuYXNrRGlhbG9nKHNlbmRlck5hbWUsIFwiUmVxdWVzdGVkIHRvIG11dGUgeW91ciBjYW1lcmFcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuVmlkZW9NdXRlLCB0aGlzLm11dGVNeVZpZGVvLmJpbmQodGhpcyksIG51bGwsIG11dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tdXRlTXlWaWRlbyhtdXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucm9vbUluZm8uSXNDb250cm9sQWxsb3dlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmFza0RpYWxvZyhzZW5kZXJOYW1lLCBcIlJlcXVlc3RlZCB0byB1bm11dGUgeW91ciBjYW1lcmFcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuVmlkZW8sIHRoaXMubXV0ZU15VmlkZW8uYmluZCh0aGlzKSwgbnVsbCwgbXV0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGVNeVZpZGVvKG11dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXV0ZU15VmlkZW8obXV0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uTG9jYWxUcmFja011dGVDaGFuZ2VkID0gZnVuY3Rpb24gKHRyYWNrKSB7XHJcbiAgICAgICAgdmFyIGlkID0gdHJhY2suZ2V0UGFydGljaXBhbnRJZCgpO1xyXG4gICAgICAgIC8vaWYgKHRoaXMucm9vbUluZm8uSXNXZWJpbmFyICYmICF0aGlzLm15SW5mby5Jc0hvc3QpIHsgLy9tYXR2ZXlcclxuICAgICAgICBpZiAodGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkICYmICF0aGlzLm15SW5mby5Jc0hvc3QpIHtcclxuICAgICAgICAgICAgdmFyIGlzQWxsTXV0ZWRfMiA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0TG9jYWxUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXQuaXNNdXRlZCgpKVxyXG4gICAgICAgICAgICAgICAgICAgIGlzQWxsTXV0ZWRfMiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGlzQWxsTXV0ZWRfMikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9jYWxWaWRlb1BhbmVsKSB7IC8vcmVtb3RlIGl0XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS52aWRlb1BhbmVsR3JpZC5mcmVlVmlkZW9QYW5lbCh0aGlzLmxvY2FsVmlkZW9QYW5lbC5JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhbFZpZGVvUGFuZWwgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvY2FsVmlkZW9QYW5lbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYWxWaWRlb1BhbmVsID0gdGhpcy51aS52aWRlb1BhbmVsR3JpZC5nZXROZXdWaWRlb1BhbmVsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL2lmICghdGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJhY2suZ2V0VHlwZSgpID09PSBNZWRpYVR5cGVfMS5NZWRpYVR5cGUuVklERU8pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmlkZW9FbGVtID0gdGhpcy5sb2NhbFZpZGVvUGFuZWwudmlkZW9FbGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyYWNrLmF0dGFjaCh2aWRlb0VsZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZGVvRWxlbS5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdWRpb0VsZW0gPSB0aGlzLmxvY2FsVmlkZW9QYW5lbC5hdWRpb0VsZW07XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhY2suYXR0YWNoKGF1ZGlvRWxlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXVkaW9FbGVtLnBsYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBkYXRlVWlPbkxvY2FsVHJhY2tDaGFuZ2UoKTtcclxuICAgICAgICAvL3VwZGF0ZSBsaXN0XHJcbiAgICAgICAgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPKVxyXG4gICAgICAgICAgICB0aGlzLnVpLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQuc2V0TXV0ZUNhbWVyYShpZCwgdHJhY2suaXNNdXRlZCgpKTtcclxuICAgICAgICBlbHNlIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5BVURJTylcclxuICAgICAgICAgICAgdGhpcy51aS5wYXJ0aWNpcGFudHNMaXN0V2lkZ2V0LnNldE11dGVNaWMoaWQsIHRyYWNrLmlzTXV0ZWQoKSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uUmVtb3RlVHJhY2tNdXRlQ2hhbmdlZCA9IGZ1bmN0aW9uICh0cmFjaykge1xyXG4gICAgICAgIHZhciBpZCA9IHRyYWNrLmdldFBhcnRpY2lwYW50SWQoKTtcclxuICAgICAgICB2YXIgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChpZCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy9pZiAodGhpcy5yb29tSW5mby5Jc1dlYmluYXIpIHsgLy9tYXR2ZXlcclxuICAgICAgICBpZiAodGhpcy5yb29tSW5mby5Jc0NvbnRyb2xBbGxvd2VkKSB7XHJcbiAgICAgICAgICAgIHZhciBpc0FsbE11dGVkXzMgPSB0cnVlO1xyXG4gICAgICAgICAgICB1c2VyLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdC5pc011dGVkKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgaXNBbGxNdXRlZF8zID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgdmlkZW9QYW5lbCA9IHVzZXIuZ2V0UHJvcGVydHkoVXNlclByb3BlcnR5XzEuVXNlclByb3BlcnR5LnZpZGVvUGFuZWwpO1xyXG4gICAgICAgICAgICBpZiAoaXNBbGxNdXRlZF8zKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmlkZW9QYW5lbCkgeyAvL3JlbW90ZSBpdFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkudmlkZW9QYW5lbEdyaWQuZnJlZVZpZGVvUGFuZWwodmlkZW9QYW5lbC5JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlci5zZXRQcm9wZXJ0eShVc2VyUHJvcGVydHlfMS5Vc2VyUHJvcGVydHkudmlkZW9QYW5lbCwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXZpZGVvUGFuZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWRlb1BhbmVsID0gdGhpcy51aS52aWRlb1BhbmVsR3JpZC5nZXROZXdWaWRlb1BhbmVsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlci5zZXRQcm9wZXJ0eShVc2VyUHJvcGVydHlfMS5Vc2VyUHJvcGVydHkudmlkZW9QYW5lbCwgdmlkZW9QYW5lbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodHJhY2suZ2V0VHlwZSgpID09PSBNZWRpYVR5cGVfMS5NZWRpYVR5cGUuVklERU8pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmlkZW9FbGVtID0gdmlkZW9QYW5lbC52aWRlb0VsZW07XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhY2suYXR0YWNoKHZpZGVvRWxlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlkZW9FbGVtLnBsYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRyYWNrLmdldFR5cGUoKSA9PT0gTWVkaWFUeXBlXzEuTWVkaWFUeXBlLkFVRElPKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvRWxlbSA9IHZpZGVvUGFuZWwuYXVkaW9FbGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyYWNrLmF0dGFjaChhdWRpb0VsZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGF1ZGlvRWxlbS5wbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy91cGRhdGUgcGFuZWxcclxuICAgICAgICB0aGlzLl91cGRhdGVVc2VyUGFuZWwodXNlcik7XHJcbiAgICAgICAgLy91cGRhdGUgbGlzdFxyXG4gICAgICAgIGlmICh0cmFjay5nZXRUeXBlKCkgPT09IE1lZGlhVHlwZV8xLk1lZGlhVHlwZS5WSURFTylcclxuICAgICAgICAgICAgdGhpcy51aS5wYXJ0aWNpcGFudHNMaXN0V2lkZ2V0LnNldE11dGVDYW1lcmEoaWQsIHRyYWNrLmlzTXV0ZWQoKSk7XHJcbiAgICAgICAgZWxzZSBpZiAodHJhY2suZ2V0VHlwZSgpID09PSBNZWRpYVR5cGVfMS5NZWRpYVR5cGUuQVVESU8pXHJcbiAgICAgICAgICAgIHRoaXMudWkucGFydGljaXBhbnRzTGlzdFdpZGdldC5zZXRNdXRlTWljKGlkLCB0cmFjay5pc011dGVkKCkpO1xyXG4gICAgfTtcclxuICAgIC8vYWxsb3cgb2YgY2FtZXJhLCBtaWMgXHJcbiAgICAvKnB1YmxpYyBhbGxvd0NhbWVyYShqaXRzaUlkOiBzdHJpbmcsIGFsbG93OiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm15SW5mby5Jc0hvc3QpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5zZW5kSml0c2lCcm9hZGNhc3RDb21tYW5kKEppdHNpQ29tbWFuZC5BTExPV19DQU1FUkEsIGppdHNpSWQsIHsgYWxsb3c6IGFsbG93IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhbGxvd01pYyhqaXRzaUlkOiBzdHJpbmcsIGFsbG93OiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm15SW5mby5Jc0hvc3QpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdGhpcy5zZW5kSml0c2lCcm9hZGNhc3RDb21tYW5kKEppdHNpQ29tbWFuZC5BTExPV19NSUMsIGppdHNpSWQsIHsgYWxsb3c6IGFsbG93IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25BbGxvd0NhbWVyYUNvbW1hbmQocGFyYW06IEppdHNpQ29tbWFuZFBhcmFtKSB7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0SWQgPSBwYXJhbS52YWx1ZTtcclxuICAgICAgICBjb25zdCBhbGxvdyA9IHBhcmFtLmF0dHJpYnV0ZXMuYWxsb3cgPT09IFwidHJ1ZVwiO1xyXG5cclxuICAgICAgICB0aGlzLnVpLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQuc2V0TXV0ZUNhbWVyYSh0YXJnZXRJZCwgYWxsb3cpO1xyXG5cclxuICAgICAgICBpZiAodGFyZ2V0SWQgPT09IHRoaXMuaml0c2lSb29tLm15VXNlcklkKCkpIHtcclxuICAgICAgICAgICAgaWYgKHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQgIT09IHRhcmdldElkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWxsb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIllvdXIgY2FtZXJhIHdhcyBhbGxvd2VkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblR5cGUuVmlkZW9cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIllvdXIgY2FtZXJhIHdhcyBibG9ja2VkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblR5cGUuVmlkZW9NdXRlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5vbkFsbG93Q2FtZXJhKGFsbG93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbkFsbG93Q2FtZXJhKGFsbG93OiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5teUluZm8ubWVkaWFQb2xpY3kudXNlQ2FtZXJhID0gYWxsb3c7XHJcbiAgICAgICAgaWYgKGFsbG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVmlkZW9UcmFjayh0aGlzLmFjdGl2ZUNhbWVyYUlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKHRyYWNrczogSml0c2lUcmFja1tdKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkxvY2FsVHJhY2tBZGRlZCh0cmFja3MpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL3JlbW92ZSB0cmFja1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhbFZpZGVvVHJhY2sgPSB0aGlzLmdldExvY2FsVHJhY2tCeVR5cGUoTWVkaWFUeXBlLlZJREVPKTtcclxuICAgICAgICAgICAgaWYgKGxvY2FsVmlkZW9UcmFjaykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMb2NhbFRyYWNrKGxvY2FsVmlkZW9UcmFjaykudGhlbigoXzogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxWaWRlb1RyYWNrLmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVVpT25Mb2NhbFRyYWNrQ2hhbmdlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9uQWxsb3dNaWNDb21tYW5kKHBhcmFtOiBKaXRzaUNvbW1hbmRQYXJhbSkge1xyXG4gICAgICAgIGNvbnN0IHRhcmdldElkID0gcGFyYW0udmFsdWU7XHJcbiAgICAgICAgY29uc3QgYWxsb3cgPSBwYXJhbS5hdHRyaWJ1dGVzLmFsbG93ID09PSBcInRydWVcIjtcclxuXHJcbiAgICAgICAgdGhpcy51aS5wYXJ0aWNpcGFudHNMaXN0V2lkZ2V0LnNldE11dGVNaWModGFyZ2V0SWQsIGFsbG93KTtcclxuXHJcbiAgICAgICAgaWYgKHRhcmdldElkID09PSB0aGlzLmppdHNpUm9vbS5teVVzZXJJZCgpKSB7XHJcbiAgICAgICAgICAgIGlmIChwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlcklkICE9PSB0YXJnZXRJZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFsbG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJZb3VyIG1pY3JvcGhvbmUgd2FzIGFsbG93ZWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgTm90aWZpY2F0aW9uVHlwZS5BdWRpb1xyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiWW91ciBtaWNyb3Bob25lIHdhcyBibG9ja2VkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvblR5cGUuQXVkaW9NdXRlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5vbkFsbG93TWljKGFsbG93KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbkFsbG93TWljKGFsbG93OiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5teUluZm8ubWVkaWFQb2xpY3kudXNlTWljID0gYWxsb3c7XHJcblxyXG4gICAgICAgIGlmIChhbGxvdykge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUF1ZGlvVHJhY2sodGhpcy5hY3RpdmVNaWNJZClcclxuICAgICAgICAgICAgICAgIC50aGVuKCh0cmFja3M6IEppdHNpVHJhY2tbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25Mb2NhbFRyYWNrQWRkZWQodHJhY2tzKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy9yZW1vdmUgdHJhY2tcclxuICAgICAgICAgICAgY29uc3QgbG9jYWxBdWRpb1RyYWNrID0gdGhpcy5nZXRMb2NhbFRyYWNrQnlUeXBlKE1lZGlhVHlwZS5BVURJTyk7XHJcbiAgICAgICAgICAgIGlmIChsb2NhbEF1ZGlvVHJhY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTG9jYWxUcmFjayhsb2NhbEF1ZGlvVHJhY2spLnRoZW4oKF86IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsQXVkaW9UcmFjay5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVVaU9uTG9jYWxUcmFja0NoYW5nZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9Ki9cclxuICAgIC8vc2NyZWVuc2hhcmVcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS50b2dnbGVTY3JlZW5TaGFyZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zY3JlZW5TaGFyaW5nKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy50dXJuT25DYW1lcmEoKV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDExXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5teUluZm8uSXNIb3N0KSByZXR1cm4gWzMgLypicmVhayovLCA2XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoIXRoaXMucm9vbUluZm8uSXNNdWx0aXBsZVNoYXJpbmdBbGxvd2VkICYmIHRoaXMuaXNNdWx0aXBsZVNoYXJpbmcpKSByZXR1cm4gWzMgLypicmVhayovLCAzXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcIlwiLCB0aGlzLnNoYXJpbmdVc2VyTmFtZSArIFwiIGlzIEFscmVhZHkgU2hhcmluZyBTY3JlZW5cIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuU2NyZWVuc2hhcmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy50dXJuT25TY3JlZW5TaGFyZSgpXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTogcmV0dXJuIFszIC8qYnJlYWsqLywgMTFdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvb21JbmZvLklzTXVsdGlwbGVTaGFyaW5nQWxsb3dlZCkgcmV0dXJuIFszIC8qYnJlYWsqLywgMTBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucm9vbUluZm8uSXNTY3JlZW5TaGFyZVJlcXVpcmVkKSByZXR1cm4gWzMgLypicmVhayovLCA3XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hc2sgcGVybWlzc2lvbiB0byBob3N0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5BU0tfU0NSRUVOU0hBUkUsIHRoaXMubXlJbmZvLkppdHNpX0lkLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcIldhaXQgYSBzZWNvbmRcIiwgXCJTZW50IHlvdXIgc2NyZWVuIHNoYXJpbmcgcmVxdWVzdFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5TY3JlZW5zaGFyaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgOV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OiByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnR1cm5PblNjcmVlblNoYXJlKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgODpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OiByZXR1cm4gWzMgLypicmVhayovLCAxMV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNNdWx0aXBsZVNoYXJpbmcpIC8vdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcIlwiLCB0aGlzLnNoYXJpbmdVc2VyTmFtZSArIFwiIGlzIEFscmVhZHkgU2hhcmluZyBTY3JlZW5cIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuU2NyZWVuc2hhcmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2F3YWl0IHRoaXMudHVybk9uU2NyZWVuU2hhcmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5BU0tfU0NSRUVOU0hBUkUsIHRoaXMubXlJbmZvLkppdHNpX0lkLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJXYWl0IGEgc2Vjb25kXCIsIFwiU2VudCB5b3VyIHNjcmVlbiBzaGFyaW5nIHJlcXVlc3RcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuU2NyZWVuc2hhcmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAxMTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDExOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIuc2V0U2NyZWVuU2hhcmUodGhpcy5zY3JlZW5TaGFyaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25Bc2tNdWx0aVNoYXJlID0gZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgaWYgKHBhcmFtLmF0dHJpYnV0ZXMuc2hhcmluZyA9PSBcInRydWVcIikgeyAvL3RydWU6IHR1cm4gb24gc2hhcmluZ1xyXG4gICAgICAgICAgICB0aGlzLmlzTXVsdGlwbGVTaGFyaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5zaGFyaW5nVXNlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBhcmFtLmF0dHJpYnV0ZXMuc2hhcmluZyA9PSBcImZhbHNlXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5pc011bHRpcGxlU2hhcmluZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25Bc2tTY3JlZW5TaGFyZSA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIGlmICghdGhpcy5teUluZm8uSXNIb3N0KVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdmFyIHNlbmRlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgdmFyIHNlbmRlcklkID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJJZDtcclxuICAgICAgICB0aGlzLnVpLmFza0RpYWxvZyhzZW5kZXJOYW1lLCBcIlJlcXVlc3RlZCBzY3JlZW4gc2hhcmluZ1wiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5TY3JlZW5zaGFyaW5nLCB0aGlzLmFsbG93U2NyZWVuc2hhcmUuYmluZCh0aGlzKSwgdGhpcy5kZW55U2NyZWVuc2hhcmUuYmluZCh0aGlzKSwgc2VuZGVySWQpO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5hbGxvd1NjcmVlbnNoYXJlID0gZnVuY3Rpb24gKGppdHNpSWQpIHtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaVByaXZhdGVDb21tYW5kKGppdHNpSWQsIGppdHNpXzEuSml0c2lQcml2YXRlQ29tbWFuZC5BTExPV19TQ1JFRU5TSEFSRSwgeyBhbGxvdzogdHJ1ZSB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuZGVueVNjcmVlbnNoYXJlID0gZnVuY3Rpb24gKGppdHNpSWQpIHtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaVByaXZhdGVDb21tYW5kKGppdHNpSWQsIGppdHNpXzEuSml0c2lQcml2YXRlQ29tbWFuZC5BTExPV19TQ1JFRU5TSEFSRSwgeyBhbGxvdzogZmFsc2UgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uQWxsb3dTY3JlZW5zaGFyZSA9IGZ1bmN0aW9uIChzZW5kZXJJZCwgYWxsb3cpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyLCB1c2VyTmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChzZW5kZXJJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdXNlcikgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lID0gdXNlci5nZXREaXNwbGF5TmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFsbG93KSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb24odXNlck5hbWUsIFwiQWNjZXB0ZWQgeW91ciBSZXF1ZXN0XCIsIE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLlNjcmVlbnNoYXJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnR1cm5PblNjcmVlblNoYXJlKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIuc2V0U2NyZWVuU2hhcmUodGhpcy5zY3JlZW5TaGFyaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKHVzZXJOYW1lLCBcIkRlbmllZCB5b3VyIFJlcXVlc3RcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuU2NyZWVuc2hhcmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLy90dXJuIG9uIHNjcmVlbiBzaGFyZVxyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnR1cm5PblNjcmVlblNoYXJlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5KaXRzaU1lZXRKUy5jcmVhdGVMb2NhbFRyYWNrcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VzOiBbJ2Rlc2t0b3AnXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjcmVlblRyYWNrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJhY2tzLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIFNjcmVlbiBTZWxlY3RlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuVHJhY2sgPSB0cmFja3NbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkxvY2FsVHJhY2tBZGRlZChbc2NyZWVuVHJhY2tdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5UcmFjay5hZGRFdmVudExpc3RlbmVyKHRoaXMuSml0c2lNZWV0SlMuZXZlbnRzLnRyYWNrLkxPQ0FMX1RSQUNLX1NUT1BQRUQsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuTG9nKCdzY3JlZW4gLSBzdG9wcGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvZ2dsZVNjcmVlblNoYXJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbmRKaXRzaUJyb2FkY2FzdENvbW1hbmQoaml0c2lfMS5KaXRzaUNvbW1hbmQuQVNLX01VTFRJU0hBUkUsIF90aGlzLm15SW5mby5KaXRzaV9JZCwgeyBzaGFyaW5nOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmVlblNoYXJpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yb29tSW5mby5Jc011bHRpcGxlU2hhcmluZ0FsbG93ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5BU0tfTVVMVElTSEFSRSwgdGhpcy5teUluZm8uSml0c2lfSWQsIHsgc2hhcmluZzogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zY3JlZW5TaGFyaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUudHVybk9uQ2FtZXJhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5KaXRzaU1lZXRKUy5jcmVhdGVMb2NhbFRyYWNrcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VzOiBbTWVkaWFUeXBlXzEuTWVkaWFUeXBlLlZJREVPXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYWNrcykgeyByZXR1cm4gX19hd2FpdGVyKF90aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhbWVyYVRyYWNrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFja3MubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmFUcmFjayA9IHRyYWNrc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTG9jYWxUcmFja0FkZGVkKFtjYW1lcmFUcmFja10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyZWVuU2hhcmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNjcmVlblNoYXJpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qY2hhdCovXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuc2VuZENoYXRNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHRoaXMuaml0c2lSb29tLnNlbmRUZXh0TWVzc2FnZShtc2cpO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5zZW5kUHJpdmF0ZUNoYXRNZXNzYWdlID0gZnVuY3Rpb24gKHRhcmdldElkLCBtc2cpIHtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaVByaXZhdGVDb21tYW5kKHRhcmdldElkLCBqaXRzaV8xLkppdHNpUHJpdmF0ZUNvbW1hbmQuUFJJVkFURV9DQUhULCBtc2cpO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vblJlY2VpdmVDaGF0TWVzc2FnZSA9IGZ1bmN0aW9uIChpZCwgbXNnLCB0aW1lc3RhbXApIHtcclxuICAgICAgICBpZiAodGhpcy5teUluZm8uSml0c2lfSWQgPT09IGlkKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdmFyIHVzZXIgPSB0aGlzLmppdHNpUm9vbS5nZXRQYXJ0aWNpcGFudEJ5SWQoaWQpO1xyXG4gICAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMudWkuY2hhdHRpbmdXaWRnZXQucmVjZWl2ZU1lc3NhZ2UoaWQsIHVzZXIuZ2V0RGlzcGxheU5hbWUoKSwgbXNnKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uUmVjZWl2ZVByaXZhdGVDaGF0TWVzc2FnZSA9IGZ1bmN0aW9uIChzZW5kZXJJZCwgbXNnKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubXlJbmZvLkppdHNpX0lkID09PSBzZW5kZXJJZClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHZhciB1c2VyID0gdGhpcy5qaXRzaVJvb20uZ2V0UGFydGljaXBhbnRCeUlkKHNlbmRlcklkKTtcclxuICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICB0aGlzLnVpLmNoYXR0aW5nV2lkZ2V0LnJlY2VpdmVNZXNzYWdlKHNlbmRlcklkLCB1c2VyLmdldERpc3BsYXlOYW1lKCksIG1zZywgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkFsbG93Q29udHJvbCA9IGZ1bmN0aW9uIChzZW5kZXJJZCwgYWxsb3cpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyLCB1c2VyTmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChzZW5kZXJJZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lID0gdXNlci5nZXREaXNwbGF5TmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbGxvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyh1c2VyTmFtZSwgXCJSZWNvcmRpbmcgd2FzIGRlbmllZFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5BdWRpb011dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLypmaWxlIHNoYXJpbmcqL1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnNlbmRGaWxlTWV0YSA9IGZ1bmN0aW9uIChtZXRhKSB7XHJcbiAgICAgICAgdGhpcy5zZW5kSml0c2lCcm9hZGNhc3RDb21tYW5kKGppdHNpXzEuSml0c2lDb21tYW5kLkZJTEVfTUVUQSwgbWV0YS5zZXNzaW9uSWQsIHsgbWV0YTogSlNPTi5zdHJpbmdpZnkobWV0YSkgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnNlbmRGaWxlRGF0YSA9IGZ1bmN0aW9uIChzZXNzaW9uSWQsIGRhdGEpIHtcclxuICAgICAgICB2YXIgYmluYXJ5ID0gJyc7XHJcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7XHJcbiAgICAgICAgdmFyIGxlbiA9IGJ5dGVzLmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBlbmMgPSB3aW5kb3cuYnRvYShiaW5hcnkpO1xyXG4gICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5GSUxFX1NMSUNFLCBzZXNzaW9uSWQsIHsgZGF0YTogZW5jIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkZpbGVNZXRhID0gZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgdmFyIHNlc3Npb25JZCA9IHBhcmFtLnZhbHVlO1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQ7XHJcbiAgICAgICAgdmFyIHNlbmRlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgdmFyIG1ldGEgPSBKU09OLnBhcnNlKHBhcmFtLmF0dHJpYnV0ZXMubWV0YSk7XHJcbiAgICAgICAgaWYgKHNlbmRlcklkID09PSB0aGlzLm15SW5mby5KaXRzaV9JZClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMudWkuY2hhdHRpbmdXaWRnZXQub25GaWxlTWV0YShzZXNzaW9uSWQsIG1ldGEsIHNlbmRlcklkLCBzZW5kZXJOYW1lKTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25GaWxlRGF0YSA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIHZhciBzZXNzaW9uSWQgPSBwYXJhbS52YWx1ZTtcclxuICAgICAgICB2YXIgZW5jID0gcGFyYW0uYXR0cmlidXRlcy5kYXRhO1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQ7XHJcbiAgICAgICAgdmFyIHNlbmRlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgaWYgKHNlbmRlcklkID09PSB0aGlzLm15SW5mby5KaXRzaV9JZClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHZhciBiaW5hcnkgPSB3aW5kb3cuYXRvYihlbmMpO1xyXG4gICAgICAgIHZhciBhcnJheSA9IG5ldyBVaW50OEFycmF5KGJpbmFyeS5sZW5ndGgpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJ5Lmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIGFycmF5W2ldID0gYmluYXJ5LmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudWkuY2hhdHRpbmdXaWRnZXQub25GaWxlRGF0YShzZXNzaW9uSWQsIGFycmF5LmJ1ZmZlcik7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnRvZ2dsZVJlY29yZGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZWNvcmRpbmcpIHJldHVybiBbMyAvKmJyZWFrKi8sIDJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnN0b3BSZWNvcmRpbmcoKV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkudG9vbGJhci5zZXRSZWNvcmRpbmcodGhpcy5yZWNvcmRpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA3XTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5teUluZm8uSXNIb3N0KSByZXR1cm4gWzMgLypicmVhayovLCA0XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdGFydFJlY29yZGluZygpXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50b29sYmFyLnNldFJlY29yZGluZyh0aGlzLnJlY29yZGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDddO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvb21JbmZvLklzUmVjb3JkaW5nUmVxdWlyZWQpIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FzayBwZXJtaXNzaW9uIHRvIGhvc3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kSml0c2lCcm9hZGNhc3RDb21tYW5kKGppdHNpXzEuSml0c2lDb21tYW5kLkFTS19SRUNPUkRJTkcsIHRoaXMubXlJbmZvLkppdHNpX0lkLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyhcIldhaXQgYSBzZWNvbmRcIiwgXCJTZW50IHlvdXIgcmVjb3JkaW5nIHJlcXVlc3RcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuUmVjb3JkaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgN107XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OiByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnN0YXJ0UmVjb3JkaW5nKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRvb2xiYXIuc2V0UmVjb3JkaW5nKHRoaXMucmVjb3JkaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA3O1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNzogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25Bc2tSZWNvcmRpbmcgPSBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICBpZiAoIXRoaXMubXlJbmZvLklzSG9zdClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHZhciBzZW5kZXJOYW1lID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lO1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQ7XHJcbiAgICAgICAgdGhpcy51aS5hc2tEaWFsb2coc2VuZGVyTmFtZSwgXCJSZXF1ZXN0ZWQgYSByZWNvcmRpbmdcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuUmVjb3JkaW5nLCB0aGlzLmFsbG93UmVjb3JkaW5nLmJpbmQodGhpcyksIHRoaXMuZGVueVJlY29yZGluZy5iaW5kKHRoaXMpLCBzZW5kZXJJZCk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmFsbG93UmVjb3JkaW5nID0gZnVuY3Rpb24gKGppdHNpSWQpIHtcclxuICAgICAgICB0aGlzLnNlbmRKaXRzaVByaXZhdGVDb21tYW5kKGppdHNpSWQsIGppdHNpXzEuSml0c2lQcml2YXRlQ29tbWFuZC5BTExPV19SRUNPUkRJTkcsIHsgYWxsb3c6IHRydWUgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLmRlbnlSZWNvcmRpbmcgPSBmdW5jdGlvbiAoaml0c2lJZCkge1xyXG4gICAgICAgIHRoaXMuc2VuZEppdHNpUHJpdmF0ZUNvbW1hbmQoaml0c2lJZCwgaml0c2lfMS5KaXRzaVByaXZhdGVDb21tYW5kLkFMTE9XX1JFQ09SRElORywgeyBhbGxvdzogZmFsc2UgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uQWxsb3dSZWNvcmRpbmcgPSBmdW5jdGlvbiAoc2VuZGVySWQsIGFsbG93KSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdXNlciwgdXNlck5hbWU7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIgPSB0aGlzLmppdHNpUm9vbS5nZXRQYXJ0aWNpcGFudEJ5SWQoc2VuZGVySWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXIpIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZSA9IHVzZXIuZ2V0RGlzcGxheU5hbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhbGxvdykgcmV0dXJuIFszIC8qYnJlYWsqLywgMl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uKHVzZXJOYW1lLCBcIlJlY29yZGluZyB3YXMgYWNjZXB0ZWRcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuUmVjb3JkaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdGFydFJlY29yZGluZygpXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50b29sYmFyLnNldFJlY29yZGluZyh0aGlzLnJlY29yZGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5ub3RpZmljYXRpb25fd2FybmluZyh1c2VyTmFtZSwgXCJSZWNvcmRpbmcgd2FzIGRlbmllZFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5SZWNvcmRpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5zdGFydFJlY29yZGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBndW1TdHJlYW0sIGdkbVN0cmVhbSwgZV8xLCBlXzI7XHJcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGd1bVN0cmVhbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdkbVN0cmVhbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMSwgNCwgLCA5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsgdmlkZW86IGZhbHNlLCBhdWRpbzogdHJ1ZSB9KV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBndW1TdHJlYW0gPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlbzogeyBkaXNwbGF5U3VyZmFjZTogXCJicm93c2VyXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpbzogeyBjaGFubmVsQ291bnQ6IDIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdkbVN0cmVhbSA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2RtU3RyZWFtLmFkZEV2ZW50TGlzdGVuZXIoJ2luYWN0aXZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucmVjb3JkaW5nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnRvZ2dsZVJlY29yZGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgOV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlXzEgPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VlbXMgdG8gaGFzIG5vIGF1ZGlvIGRldmljZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFs1LCA3LCAsIDhdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3VtU3RyZWFtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXREaXNwbGF5TWVkaWEoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7IGRpc3BsYXlTdXJmYWNlOiBcImJyb3dzZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvOiB7IGNoYW5uZWxDb3VudDogMiB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZG1TdHJlYW0gPSBfYS5zZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdkbVN0cmVhbS5hZGRFdmVudExpc3RlbmVyKCdpbmFjdGl2ZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnJlY29yZGluZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGVSZWNvcmRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDhdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZV8yID0gX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiY2FwdHVyZSBmb3IgcmVjb3JkaW5nIGZhaWx1cmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDg6IHJldHVybiBbMyAvKmJyZWFrKi8sIDldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgOTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWNvcmRlclN0cmVhbSA9IGd1bVN0cmVhbSA/IHRoaXMubWl4ZXIoZ3VtU3RyZWFtLCBnZG1TdHJlYW0pIDogZ2RtU3RyZWFtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcih0aGlzLnJlY29yZGVyU3RyZWFtLCB7IG1pbWVUeXBlOiAndmlkZW8vd2VibScgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5vbmRhdGFhdmFpbGFibGUgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuZGF0YSAmJiBlLmRhdGEuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZWNvcmRpbmdEYXRhLnB1c2goZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzLnJlY29yZGluZyAmJiAhX3RoaXMuZG93bmxvYWRSZWNvcmRGaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRvd25sb2FkUmVjb3JkaW5nRmlsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLm9uc3RvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJlY29yZGVyU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7IHJldHVybiB0cmFjay5zdG9wKCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3VtU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7IHJldHVybiB0cmFjay5zdG9wKCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2RtU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7IHJldHVybiB0cmFjay5zdG9wKCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29yZGVyU3RyZWFtLmFkZEV2ZW50TGlzdGVuZXIoJ2luYWN0aXZlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0NhcHR1cmUgc3RyZWFtIGluYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdG9wUmVjb3JkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29yZGluZ0RhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXJ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb3JkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb3dubG9hZFJlY29yZEZpbGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuc3RvcFJlY29yZGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZWNvcmRpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMubWVkaWFSZWNvcmRlci5zdG9wKCldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvd25sb2FkUmVjb3JkaW5nRmlsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29yZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5kb3dubG9hZFJlY29yZGluZ0ZpbGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZG93bmxvYWRSZWNvcmRGaWxlIHx8IHRoaXMucmVjb3JkaW5nRGF0YS5sZW5ndGggPD0gMClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IodGhpcy5yZWNvcmRpbmdEYXRhLCB7IHR5cGU6ICd2aWRlby93ZWJtJyB9KTtcclxuICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgYS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIGEuaHJlZiA9IHVybDtcclxuICAgICAgICBhLmRvd25sb2FkID0gdGhpcy5nZXRSZWNvcmRpbmdGaWxlbmFtZSgpICsgXCIud2VibVwiO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XHJcbiAgICAgICAgYS5jbGljaygpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpO1xyXG4gICAgICAgICAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgICAgIH0sIDUwMDApO1xyXG4gICAgICAgIHRoaXMuZG93bmxvYWRSZWNvcmRGaWxlID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuZ2V0UmVjb3JkaW5nRmlsZW5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdmFyIHRpbWVzdGFtcCA9IG5vdy50b0lTT1N0cmluZygpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJvb21JbmZvLmNvbmZlcmVuY2VOYW1lICsgXCJfcmVjb3JkaW5nX1wiICsgdGltZXN0YW1wO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5taXhlciA9IGZ1bmN0aW9uIChzdHJlYW0xLCBzdHJlYW0yKSB7XHJcbiAgICAgICAgdmFyIGN0eCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcclxuICAgICAgICB2YXIgZGVzdCA9IGN0eC5jcmVhdGVNZWRpYVN0cmVhbURlc3RpbmF0aW9uKCk7XHJcbiAgICAgICAgaWYgKHN0cmVhbTEuZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICBjdHguY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtMSkuY29ubmVjdChkZXN0KTtcclxuICAgICAgICBpZiAoc3RyZWFtMi5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIGN0eC5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZShzdHJlYW0yKS5jb25uZWN0KGRlc3QpO1xyXG4gICAgICAgIHZhciB0cmFja3MgPSBkZXN0LnN0cmVhbS5nZXRUcmFja3MoKTtcclxuICAgICAgICB0cmFja3MgPSB0cmFja3MuY29uY2F0KHN0cmVhbTEuZ2V0VmlkZW9UcmFja3MoKSkuY29uY2F0KHN0cmVhbTIuZ2V0VmlkZW9UcmFja3MoKSk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNZWRpYVN0cmVhbSh0cmFja3MpO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS50b2dnbGVNdXRlQWxsVmlkZW8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubXlJbmZvLklzSG9zdClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRKaXRzaUJyb2FkY2FzdENvbW1hbmQoaml0c2lfMS5KaXRzaUNvbW1hbmQuTVVURV9BbGxfVklERU8sIHRoaXMubXlJbmZvLkppdHNpX0lkLCB7IG11dGU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKFwiV2FpdCBhIHNlY29uZFwiLCBcIlNlbnQgeW91ciBhbGwgdmlkZW8gZGlzYWJsZSByZXF1ZXN0XCIsIE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLlZpZGVvTXV0ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbk11dGVBbGxWaWRlbyA9IGZ1bmN0aW9uIChwYXJhbSkge1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLnZhbHVlO1xyXG4gICAgICAgIHZhciBzZW5kZXJOYW1lID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lO1xyXG4gICAgICAgIHZhciBtdXRlID0gcGFyYW0uYXR0cmlidXRlcy5tdXRlID09PSBcInRydWVcIjtcclxuICAgICAgICBpZiAoc2VuZGVySWQgIT09IHRoaXMubXlJbmZvLkppdHNpX0lkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudWkuYXNrRGlhbG9nKHNlbmRlck5hbWUsIFwiUmVxdWVzdGVkIHRvIG11dGUgeW91ciBjYW1lcmFcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuVmlkZW9NdXRlLCB0aGlzLm11dGVNeVZpZGVvLmJpbmQodGhpcyksIG51bGwsIG11dGUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUudG9nZ2xlTXV0ZUFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5teUluZm8uSXNIb3N0KVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VuZEppdHNpQnJvYWRjYXN0Q29tbWFuZChqaXRzaV8xLkppdHNpQ29tbWFuZC5NVVRFX0FsbF9BVURJTywgdGhpcy5teUluZm8uSml0c2lfSWQsIHsgbXV0ZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJXYWl0IGEgc2Vjb25kXCIsIFwiU2VudCB5b3VyIG11dGUgYWxsIHJlcXVlc3RcIiwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuQXVkaW9NdXRlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLm9uTXV0ZUFsbEF1ZGlvID0gZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgdmFyIHNlbmRlcklkID0gcGFyYW0udmFsdWU7XHJcbiAgICAgICAgdmFyIHNlbmRlck5hbWUgPSBwYXJhbS5hdHRyaWJ1dGVzLnNlbmRlck5hbWU7XHJcbiAgICAgICAgdmFyIG11dGUgPSBwYXJhbS5hdHRyaWJ1dGVzLm11dGU7XHJcbiAgICAgICAgaWYgKHNlbmRlcklkICE9PSB0aGlzLm15SW5mby5KaXRzaV9JZCkge1xyXG4gICAgICAgICAgICB0aGlzLnVpLmFza0RpYWxvZyhzZW5kZXJOYW1lLCBcIlJlcXVlc3RlZCB0byBtdXRlIHlvdXIgbWljcm9waG9uZVwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5BdWRpb011dGUsIHRoaXMubXV0ZU15QXVkaW8uYmluZCh0aGlzKSwgbnVsbCwgbXV0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vIGhhbmRyYWlzZVxyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnRvZ2dsZUhhbmRSYWlzZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5teUluZm8uSXNIb3N0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9hc2sgaGFuZHJhaXNlIHRvIGhvc3RcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRKaXRzaUJyb2FkY2FzdENvbW1hbmQoaml0c2lfMS5KaXRzaUNvbW1hbmQuQVNLX0hBTkRSQUlTRSwgdGhpcy5teUluZm8uSml0c2lfSWQsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkubm90aWZpY2F0aW9uX3dhcm5pbmcoXCJXYWl0IGEgc2Vjb25kXCIsIFwiU2VudCB5b3VyIGhhbmQtcmFpc2UgcmVxdWVzdFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5IYW5kUmFpc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25Bc2tIYW5kUmFpc2UgPSBmdW5jdGlvbiAocGFyYW0pIHtcclxuICAgICAgICBpZiAoIXRoaXMubXlJbmZvLklzSG9zdClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHZhciBzZW5kZXJOYW1lID0gcGFyYW0uYXR0cmlidXRlcy5zZW5kZXJOYW1lO1xyXG4gICAgICAgIHZhciBzZW5kZXJJZCA9IHBhcmFtLmF0dHJpYnV0ZXMuc2VuZGVySWQ7XHJcbiAgICAgICAgdGhpcy51aS5hc2tEaWFsb2coc2VuZGVyTmFtZSwgXCJSZXF1ZXN0ZWQgSGFuZC1SYWlzZVwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5IYW5kUmFpc2UsIHRoaXMuYWxsb3dIYW5kUmFpc2UuYmluZCh0aGlzKSwgdGhpcy5kZW55SGFuZFJhaXNlLmJpbmQodGhpcyksIHNlbmRlcklkKTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuYWxsb3dIYW5kUmFpc2UgPSBmdW5jdGlvbiAoaml0c2lJZCkge1xyXG4gICAgICAgIHRoaXMuc2VuZEppdHNpUHJpdmF0ZUNvbW1hbmQoaml0c2lJZCwgaml0c2lfMS5KaXRzaVByaXZhdGVDb21tYW5kLkFMTE9XX0hBTkRSQUlTRSwgeyBhbGxvdzogdHJ1ZSB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuZGVueUhhbmRSYWlzZSA9IGZ1bmN0aW9uIChqaXRzaUlkKSB7XHJcbiAgICAgICAgdGhpcy5zZW5kSml0c2lQcml2YXRlQ29tbWFuZChqaXRzaUlkLCBqaXRzaV8xLkppdHNpUHJpdmF0ZUNvbW1hbmQuQUxMT1dfSEFORFJBSVNFLCB7IGFsbG93OiBmYWxzZSB9KTtcclxuICAgIH07XHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUub25BbGxvd0hhbmRSYWlzZSA9IGZ1bmN0aW9uIChzZW5kZXJJZCwgYWxsb3cpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyLCB1c2VyTmFtZTtcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgdXNlciA9IHRoaXMuaml0c2lSb29tLmdldFBhcnRpY2lwYW50QnlJZChzZW5kZXJJZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lID0gdXNlci5nZXREaXNwbGF5TmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbGxvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbih1c2VyTmFtZSwgXCJIYW5kLXJhaXNlIHdhcyBhY2NlcHRlZFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5IYW5kUmFpc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGVNeVZpZGVvKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tdXRlTXlBdWRpbyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLm5vdGlmaWNhdGlvbl93YXJuaW5nKHVzZXJOYW1lLCBcIkhhbmQtcmFpc2Ugd2FzIGRlbmllZFwiLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5IYW5kUmFpc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQml6R2F6ZU1lZXRpbmcucHJvdG90eXBlLnRvZ2dsZUNvcHlKb2luaW5nSW5mbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgVGVtcFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgVGVtcFRleHQudmFsdWUgPSBcImh0dHBzOi8vXCIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIFwiL2xvYmJ5L1wiICsgdGhpcy5yb29tSW5mby5JZDsgLy8gZW50ZXIgeW91ciBtZWV0aW5nIHVybCBoZXJlXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChUZW1wVGV4dCk7XHJcbiAgICAgICAgVGVtcFRleHQuc2VsZWN0KCk7XHJcbiAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoXCJjb3B5XCIpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoVGVtcFRleHQpO1xyXG4gICAgfTtcclxuICAgIC8vaGlnaGxpZ2h0IHNwZWFrZXJcclxuICAgIEJpekdhemVNZWV0aW5nLnByb3RvdHlwZS5vbkRvbWluYW50U3BlYWtlckNoYW5nZWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICBpZiAoaWQgPT09IHRoaXMubXlJbmZvLkppdHNpX0lkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudWkudmlkZW9QYW5lbEdyaWQuaGlnaHRsaWdodFBhbmVsKHRoaXMubG9jYWxWaWRlb1BhbmVsLklkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyID0gdGhpcy5qaXRzaVJvb20uZ2V0UGFydGljaXBhbnRCeUlkKGlkKTtcclxuICAgICAgICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgIHZhciB2aWRlb1BhbmVsID0gdXNlci5nZXRQcm9wZXJ0eShVc2VyUHJvcGVydHlfMS5Vc2VyUHJvcGVydHkudmlkZW9QYW5lbCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmlkZW9QYW5lbClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnZpZGVvUGFuZWxHcmlkLmhpZ2h0bGlnaHRQYW5lbCh2aWRlb1BhbmVsLklkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKiAgICAgICAgICAgICAgTG9nXHJcbiAgICAgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgICovXHJcbiAgICBCaXpHYXplTWVldGluZy5wcm90b3R5cGUuTG9nID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcclxuICAgICAgICBpZiAodGhpcy51aSAhPSBudWxsKVxyXG4gICAgICAgICAgICB0aGlzLnVpLkxvZyhtZXNzYWdlKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQml6R2F6ZU1lZXRpbmc7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQml6R2F6ZU1lZXRpbmcgPSBCaXpHYXplTWVldGluZztcclxudmFyIG1lZXRpbmcgPSBuZXcgQml6R2F6ZU1lZXRpbmcoKTtcclxubWVldGluZy5zdGFydCgpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZWV0aW5nLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi9mYWtlXzg0Y2I1NWNhLmpzXCIsXCIvXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5GaWxlUmVjZWl2ZXIgPSBleHBvcnRzLkZpbGVSZWNlaXZlclByb3BzID0gdm9pZCAwO1xyXG52YXIgc25pcHBldF8xID0gcmVxdWlyZShcIi4uL3V0aWwvc25pcHBldFwiKTtcclxudmFyIEZpbGVSZWNlaXZlclByb3BzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRmlsZVJlY2VpdmVyUHJvcHMoKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gRmlsZVJlY2VpdmVyUHJvcHM7XHJcbn0oKSk7XHJcbmV4cG9ydHMuRmlsZVJlY2VpdmVyUHJvcHMgPSBGaWxlUmVjZWl2ZXJQcm9wcztcclxudmFyIEZpbGVSZWNlaXZlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEZpbGVSZWNlaXZlcihwcm9wcykge1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZUJ1ZmZlciA9IFtdO1xyXG4gICAgICAgIHRoaXMuc2l6ZSA9IDA7XHJcbiAgICAgICAgdGhpcy5wcm9wcyA9IHByb3BzO1xyXG4gICAgfVxyXG4gICAgRmlsZVJlY2VpdmVyLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZWNlaXZpbmdJZCA9IFwicmVjZWl2aW5nLVwiICsgdGhpcy5wcm9wcy5tZXRhLnNlc3Npb25JZDtcclxuICAgICAgICB2YXIgaHRtbCA9IFwiXFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiZmlsZS1wcm9ncmVzc1xcXCIgaWQ9XFxcIlwiICsgcmVjZWl2aW5nSWQgKyBcIlxcXCI+XFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImZpbGVpbmZvXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPVxcXCJkb3dubG9hZFxcXCIgaHJlZj1cXFwiI1xcXCI+XCIgKyB0aGlzLnByb3BzLm1ldGEubmFtZSArIFwiKFwiICsgc25pcHBldF8xLmdldENhcGFjaXR5TGFiZWwodGhpcy5wcm9wcy5tZXRhLnNpemUpICsgXCIpPC9hPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicHJvZ3Jlc3NcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicHJvZ3Jlc3MtYmFyXFxcIiByb2xlPVxcXCJwcm9ncmVzc2JhclxcXCIgYXJpYS12YWx1ZW5vdz1cXFwiMFxcXCIgYXJpYS12YWx1ZW1pbj1cXFwiMFxcXCIgYXJpYS12YWx1ZW1heD1cXFwiMTAwXFxcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgPC9kaXY+XCI7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5hZGRDaGF0SXRlbSh0aGlzLnByb3BzLnNlbmRlcklkLCB0aGlzLnByb3BzLnNlbmRlck5hbWUsIGh0bWwsIGZhbHNlKTtcclxuICAgICAgICB0aGlzLnJlY2VpdmluZ0VsZW1lbnQgPSAkKFwiI1wiICsgcmVjZWl2aW5nSWQpO1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3NFbGVtZW50ID0gdGhpcy5yZWNlaXZpbmdFbGVtZW50LmZpbmQoXCIucHJvZ3Jlc3MtYmFyXCIpO1xyXG4gICAgICAgIHRoaXMuZG93bmxvYWRFbGVtZW50ID0gdGhpcy5yZWNlaXZpbmdFbGVtZW50LmZpbmQoXCIuZG93bmxvYWRcIik7XHJcbiAgICAgICAgdGhpcy5yZWNlaXZpbmdFbGVtZW50LmNsb3Nlc3QoXCIudXNlcm1lc3NhZ2VcIikuY3NzKFwid2hpdGUtc3BhY2VcIiwgXCJub3dyYXBcIik7XHJcbiAgICB9O1xyXG4gICAgRmlsZVJlY2VpdmVyLnByb3RvdHlwZS5yZWFkRmlsZURhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgIHRoaXMucmVjZWl2ZUJ1ZmZlci5wdXNoKGRhdGEpO1xyXG4gICAgICAgIHRoaXMuc2l6ZSArPSBkYXRhLmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgdmFyIHBlcmNlbnQgPSBNYXRoLmZsb29yKHRoaXMuc2l6ZSAvIHRoaXMucHJvcHMubWV0YS5zaXplICogMTAwKTtcclxuICAgICAgICB0aGlzLnByb2dyZXNzRWxlbWVudC5hdHRyKFwiYXJpYS12YWx1ZW5vd1wiLCBwZXJjZW50KTtcclxuICAgICAgICB0aGlzLnByb2dyZXNzRWxlbWVudC5jc3MoXCJ3aWR0aFwiLCBwZXJjZW50ICsgXCIlXCIpO1xyXG4gICAgICAgIGlmICh0aGlzLnNpemUgPj0gdGhpcy5wcm9wcy5tZXRhLnNpemUpIHtcclxuICAgICAgICAgICAgdmFyIHJlY2VpdmVkID0gbmV3IEJsb2IodGhpcy5yZWNlaXZlQnVmZmVyKTtcclxuICAgICAgICAgICAgdGhpcy5kb3dubG9hZEVsZW1lbnQuYXR0cignaHJlZicsIFVSTC5jcmVhdGVPYmplY3RVUkwocmVjZWl2ZWQpKTtcclxuICAgICAgICAgICAgdGhpcy5kb3dubG9hZEVsZW1lbnQuYXR0cignZG93bmxvYWQnLCB0aGlzLnByb3BzLm1ldGEubmFtZSk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25GaW5pc2hlZCh0aGlzLnByb3BzLm1ldGEuc2Vzc2lvbklkLCB0aGlzLnByb3BzLm1ldGEubmFtZSwgXCJSZWNlaXZlIGZpbmlzaGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gRmlsZVJlY2VpdmVyO1xyXG59KCkpO1xyXG5leHBvcnRzLkZpbGVSZWNlaXZlciA9IEZpbGVSZWNlaXZlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RmlsZVJlY2VpdmVyLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi9maWxlXFxcXEZpbGVSZWNlaXZlci5qc1wiLFwiL2ZpbGVcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5GaWxlU2VuZGVyID0gZXhwb3J0cy5GaWxlU2VuZGVyUHJvcHMgPSB2b2lkIDA7XHJcbnZhciBzbmlwcGV0XzEgPSByZXF1aXJlKFwiLi4vdXRpbC9zbmlwcGV0XCIpO1xyXG52YXIgVGltZVV0aWxfMSA9IHJlcXVpcmUoXCIuLi91dGlsL1RpbWVVdGlsXCIpO1xyXG52YXIgRmlsZVNlbmRlclByb3BzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRmlsZVNlbmRlclByb3BzKCkge1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEZpbGVTZW5kZXJQcm9wcztcclxufSgpKTtcclxuZXhwb3J0cy5GaWxlU2VuZGVyUHJvcHMgPSBGaWxlU2VuZGVyUHJvcHM7XHJcbnZhciBGaWxlU2VuZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRmlsZVNlbmRlcihwcm9wcykge1xyXG4gICAgICAgIHRoaXMuc2VuZEJ1ZiA9IFtdO1xyXG4gICAgICAgIHRoaXMucHJvcHMgPSBwcm9wcztcclxuICAgIH1cclxuICAgIEZpbGVTZW5kZXIucHJvdG90eXBlLnNlbmRGaWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGZpbGUsIHNlbmRpbmdJZCwgaHRtbCwgJHByb2dyZXNzRWxlbSwgY2h1bmtTaXplLCBmaWxlUmVhZGVyLCBvZmZzZXQsIHJlYWRTbGljZTtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvcHMuZmlsZUVsZW1lbnQuZmlsZXMubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3RoaXMucHJvcHMub25FcnJvcihcIk5vIGZpbGVcIiwgXCJQbGVhc2Ugc2VsZWN0IGEgZmlsZSB0byBzaGFyZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmaWxlID0gdGhpcy5wcm9wcy5maWxlRWxlbWVudC5maWxlc1swXTtcclxuICAgICAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMub25FcnJvcihmaWxlLm5hbWUsIFwiWW91IGNob29zZWQgZW1wdHkgZmlsZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGUgPSBmaWxlO1xyXG4gICAgICAgICAgICAgICAgc2VuZGluZ0lkID0gXCJzZW5kaW5nLVwiICsgdGhpcy5wcm9wcy5zZXNzaW9uSWQ7XHJcbiAgICAgICAgICAgICAgICBodG1sID0gXCJcXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJmaWxlLXByb2dyZXNzXFxcIiBpZD1cXFwiXCIgKyBzZW5kaW5nSWQgKyBcIlxcXCI+XFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImZpbGVpbmZvXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIFwiICsgZmlsZS5uYW1lICsgXCIoXCIgKyBzbmlwcGV0XzEuZ2V0Q2FwYWNpdHlMYWJlbChmaWxlLnNpemUpICsgXCIpXFxuICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwcm9ncmVzc1xcXCI+XFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJwcm9ncmVzcy1iYXJcXFwiIHJvbGU9XFxcInByb2dyZXNzYmFyXFxcIiBhcmlhLXZhbHVlbm93PVxcXCIwXFxcIiBhcmlhLXZhbHVlbWluPVxcXCIwXFxcIiBhcmlhLXZhbHVlbWF4PVxcXCIxMDBcXFwiPjwvZGl2PlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cIjtcclxuICAgICAgICAgICAgICAgICQodGhpcy5wcm9wcy5maWxlU2VuZGluZ1BhbmVsKS5hcHBlbmQoaHRtbCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRpbmdFbGVtZW50ID0gJChcIiNcIiArIHNlbmRpbmdJZCk7XHJcbiAgICAgICAgICAgICAgICAkcHJvZ3Jlc3NFbGVtID0gdGhpcy5zZW5kaW5nRWxlbWVudC5maW5kKFwiLnByb2dyZXNzLWJhclwiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuc2VuZEZpbGVNZXRhKHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHRoaXMucHJvcHMuc2Vzc2lvbklkXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGNodW5rU2l6ZSA9IDE2Mzg0O1xyXG4gICAgICAgICAgICAgICAgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSAwO1xyXG4gICAgICAgICAgICAgICAgZmlsZVJlYWRlci5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnJlbW92ZVNlbGYoKTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkVycm9yKGZpbGUubmFtZSwgXCJFcnJvciBoYXBwZW5lZCB3aGlsZSByZWFkaW5nIFwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZmlsZVJlYWRlci5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnJlbW92ZVNlbGYoKTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5vbkVycm9yKGZpbGUubmFtZSwgXCJSZWFkaW5nIHdhcyBhYm9ydGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZWFkU2xpY2UgPSBmdW5jdGlvbiAobykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzbGljZSA9IGZpbGUuc2xpY2Uob2Zmc2V0LCBvICsgY2h1bmtTaXplKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHNsaWNlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBmaWxlUmVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLnNlbmRGaWxlRGF0YShfdGhpcy5wcm9wcy5zZXNzaW9uSWQsIGJsb2IpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSBibG9iLmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgLy91cGRhdGUgcHJvZ3Jlc3NcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudCA9IE1hdGguZmxvb3IoKG9mZnNldCAqIDEwMCkgLyBmaWxlLnNpemUpO1xyXG4gICAgICAgICAgICAgICAgICAgICRwcm9ncmVzc0VsZW0uYXR0cihcImFyaWEtdmFsdWVub3dcIiwgcGVyY2VudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHByb2dyZXNzRWxlbS5jc3MoXCJ3aWR0aFwiLCBwZXJjZW50ICsgXCIlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPCBmaWxlLnNpemUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZFNsaWNlKG9mZnNldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVhZFNsaWNlKG9mZnNldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZW1vdmVTZWxmKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcy5wcm9wcy5vbkZpbmlzaGVkKGZpbGUubmFtZSwgYFNlbmRpbmcgZmluaXNoZWRgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBUaW1lVXRpbF8xLmdldEN1clRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJpbmFyeSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnl0ZXMgPSBuZXcgVWludDhBcnJheShibG9iKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlbiA9IGJ5dGVzLmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmFyeSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VuZGVyID0gbmV3IEJsb2IoQXJyYXkuZnJvbShiaW5hcnkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWxfMSA9IFwiXFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjaGF0LW1lc3NhZ2UtZ3JvdXAgbG9jYWxcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImNoYXRtZXNzYWdlLXdyYXBwZXJcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjaGF0bWVzc2FnZVxcXCIgPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmVwbHl3cmFwcGVyXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJtZXNzYWdlY29udGVudFxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImZpbGVpbmZvXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWYgPSBcXFwiXCIgKyBVUkwuY3JlYXRlT2JqZWN0VVJMKHNlbmRlcikgKyBcIlxcXCIgZG93bmxvYWQgPSBcXFwiXCIgKyBfdGhpcy5maWxlLm5hbWUgKyBcIlxcXCIgPiBcIiArIF90aGlzLmZpbGUubmFtZSArIFwiIChcIiArIHNuaXBwZXRfMS5nZXRDYXBhY2l0eUxhYmVsKF90aGlzLmZpbGUuc2l6ZSkgKyBcIikgPC9hPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXYgPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwidGltZXN0YW1wXFxcIiA+XCIgKyB0aW1lICsgXCI8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICBcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNjaGF0Y29udmVyc2F0aW9uXCIpLmFwcGVuZChodG1sXzEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVhZFNsaWNlKDApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBGaWxlU2VuZGVyLnByb3RvdHlwZS5yZW1vdmVTZWxmID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuc2VuZGluZ0VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZpbGVTZW5kZXI7XHJcbn0oKSk7XHJcbmV4cG9ydHMuRmlsZVNlbmRlciA9IEZpbGVTZW5kZXI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUZpbGVTZW5kZXIuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2ZpbGVcXFxcRmlsZVNlbmRlci5qc1wiLFwiL2ZpbGVcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkppdHNpQ29tbWFuZFBhcmFtID0gdm9pZCAwO1xyXG52YXIgSml0c2lDb21tYW5kUGFyYW0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBKaXRzaUNvbW1hbmRQYXJhbSgpIHtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gSml0c2lDb21tYW5kUGFyYW07XHJcbn0oKSk7XHJcbmV4cG9ydHMuSml0c2lDb21tYW5kUGFyYW0gPSBKaXRzaUNvbW1hbmRQYXJhbTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Sml0c2lDb21tYW5kUGFyYW0uanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2ppdHNpXFxcXEppdHNpQ29tbWFuZFBhcmFtLmpzXCIsXCIvaml0c2lcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkppdHNpUHJpdmF0ZUNvbW1hbmRRdWV1ZSA9IGV4cG9ydHMuSml0c2lDb21tYW5kUXVldWUgPSB2b2lkIDA7XHJcbnZhciBKaXRzaUNvbW1hbmRDYWxsYmFjayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEppdHNpQ29tbWFuZENhbGxiYWNrKCkge1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEppdHNpQ29tbWFuZENhbGxiYWNrO1xyXG59KCkpO1xyXG52YXIgSml0c2lDb21tYW5kUXVldWUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBKaXRzaUNvbW1hbmRRdWV1ZSgpIHtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrcyA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuICAgIEppdHNpQ29tbWFuZFF1ZXVlLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrcy5jbGVhcigpO1xyXG4gICAgfTtcclxuICAgIEppdHNpQ29tbWFuZFF1ZXVlLnByb3RvdHlwZS5xdWV1ZUNvbW1hbmQgPSBmdW5jdGlvbiAoaml0c2lJZCwgY29tbWFuZCwgcGFyYW0sIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNhbGxiYWNrcy5oYXMoaml0c2lJZCkpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFja3Muc2V0KGppdHNpSWQsIFtdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNiID0gbmV3IEppdHNpQ29tbWFuZENhbGxiYWNrKCk7XHJcbiAgICAgICAgY2IuY29tbWFuZCA9IGNvbW1hbmQ7XHJcbiAgICAgICAgY2IucGFyYW0gPSBwYXJhbTtcclxuICAgICAgICBjYi5jYWxsYmFjayA9IGNhbGxiYWNrO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLmdldChqaXRzaUlkKS5wdXNoKGNiKTtcclxuICAgIH07XHJcbiAgICBKaXRzaUNvbW1hbmRRdWV1ZS5wcm90b3R5cGUuZXhlY3V0ZVF1ZXVlZENvbW1hbmRzID0gZnVuY3Rpb24gKGppdHNpSWQpIHtcclxuICAgICAgICBpZiAoIXRoaXMuY2FsbGJhY2tzLmhhcyhqaXRzaUlkKSlcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIHZhciBjYnMgPSB0aGlzLmNhbGxiYWNrcy5nZXQoaml0c2lJZCk7XHJcbiAgICAgICAgY2JzLmZvckVhY2goZnVuY3Rpb24gKGNiLCBpbmRleCkge1xyXG4gICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgY2IuY2FsbGJhY2soY2IucGFyYW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLmRlbGV0ZShqaXRzaUlkKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSml0c2lDb21tYW5kUXVldWU7XHJcbn0oKSk7XHJcbmV4cG9ydHMuSml0c2lDb21tYW5kUXVldWUgPSBKaXRzaUNvbW1hbmRRdWV1ZTtcclxudmFyIEppdHNpUHJpdmF0ZUNvbW1hbmRDYWxsYmFjayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEppdHNpUHJpdmF0ZUNvbW1hbmRDYWxsYmFjaygpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBKaXRzaVByaXZhdGVDb21tYW5kQ2FsbGJhY2s7XHJcbn0oKSk7XHJcbnZhciBKaXRzaVByaXZhdGVDb21tYW5kUXVldWUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBKaXRzaVByaXZhdGVDb21tYW5kUXVldWUoKSB7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFja3MgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcbiAgICBKaXRzaVByaXZhdGVDb21tYW5kUXVldWUucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLmNsZWFyKCk7XHJcbiAgICB9O1xyXG4gICAgSml0c2lQcml2YXRlQ29tbWFuZFF1ZXVlLnByb3RvdHlwZS5xdWV1ZUNvbW1hbmQgPSBmdW5jdGlvbiAoaml0c2lJZCwgY29tbWFuZCwgbWVzc2FnZSwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIXRoaXMuY2FsbGJhY2tzLmhhcyhqaXRzaUlkKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5zZXQoaml0c2lJZCwgW10pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2IgPSBuZXcgSml0c2lQcml2YXRlQ29tbWFuZENhbGxiYWNrKCk7XHJcbiAgICAgICAgY2IuY29tbWFuZCA9IGNvbW1hbmQ7XHJcbiAgICAgICAgY2IubWVzc2FnZSA9IG1lc3NhZ2U7XHJcbiAgICAgICAgY2IuY2FsbGJhY2sgPSBjYWxsYmFjaztcclxuICAgICAgICB0aGlzLmNhbGxiYWNrcy5nZXQoaml0c2lJZCkucHVzaChjYik7XHJcbiAgICB9O1xyXG4gICAgSml0c2lQcml2YXRlQ29tbWFuZFF1ZXVlLnByb3RvdHlwZS5leGVjdXRlUXVldWVkQ29tbWFuZHMgPSBmdW5jdGlvbiAoaml0c2lJZCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jYWxsYmFja3MuaGFzKGppdHNpSWQpKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdmFyIGNicyA9IHRoaXMuY2FsbGJhY2tzLmdldChqaXRzaUlkKTtcclxuICAgICAgICBjYnMuZm9yRWFjaChmdW5jdGlvbiAoY2IsIGluZGV4KSB7XHJcbiAgICAgICAgICAgIGNiLmNhbGxiYWNrKGppdHNpSWQsIGNiLmNvbW1hbmQsIGNiLm1lc3NhZ2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLmRlbGV0ZShqaXRzaUlkKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSml0c2lQcml2YXRlQ29tbWFuZFF1ZXVlO1xyXG59KCkpO1xyXG5leHBvcnRzLkppdHNpUHJpdmF0ZUNvbW1hbmRRdWV1ZSA9IEppdHNpUHJpdmF0ZUNvbW1hbmRRdWV1ZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Sml0c2lDb21tYW5kUXVldWUuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL2ppdHNpXFxcXEppdHNpQ29tbWFuZFF1ZXVlLmpzXCIsXCIvaml0c2lcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICBcclxuICAgICAgICAgIG5QYW5lbENvdW50ID0gNFxyXG5cclxuLS0tLS0tLS0tLXBhbmVsQ29udGFpbmVyLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAtLS1wYW5lbC0tLSAgICAgICAtLS1wYW5lbC0tLVxyXG4gICAgfCAgICAxICAgICB8ICAgICAgfCAgICAyICAgIHxcclxuICAgIHxfX19fX19fX19ffCAgICAgIHxfX19fX19fX198XHJcblxyXG4gICAgLS0tcGFuZWwtLS0gICAgICAgLS0tcGFuZWwtLS1cclxuICAgIHwgICAgMyAgICAgfCAgICAgIHwgICAgNCAgICB8XHJcbiAgICB8X19fX19fX19fX3wgICAgICB8X19fX19fX19ffFxyXG5cclxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICAgQnV0dG9ucyAtICBhdWRpby92aWRlb011dGUsIHNjcmVlblNoYXJlLCBSZWNvcmQsIENoYXRcclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5NZWV0aW5nVUkgPSB2b2lkIDA7XHJcbnZhciBTZXR0aW5nRGlhbG9nXzEgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL1NldHRpbmdEaWFsb2dcIik7XHJcbnZhciBDaGF0dGluZ1BhbmVsXzEgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL0NoYXR0aW5nUGFuZWxcIik7XHJcbnZhciBQYXJ0aWNpcGFudExpc3RQYW5lbF8xID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9QYXJ0aWNpcGFudExpc3RQYW5lbFwiKTtcclxudmFyIE5vdGlmaWNhdGlvblR5cGVfMSA9IHJlcXVpcmUoXCIuL2VudW0vTm90aWZpY2F0aW9uVHlwZVwiKTtcclxudmFyIEFza0RpYWxvZ18xID0gcmVxdWlyZShcIi4vY29tcG9uZW50cy9Bc2tEaWFsb2dcIik7XHJcbnZhciBUb29sQmFyXzEgPSByZXF1aXJlKFwiLi9jb21wb25lbnRzL1Rvb2xCYXJcIik7XHJcbnZhciBNZWV0aW5nRGVzY3JpcHRpb25XaWRnZXRfMSA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0XCIpO1xyXG52YXIgVmlkZW9QYW5lbEdyaWRfMSA9IHJlcXVpcmUoXCIuL2NvbXBvbmVudHMvVmlkZW9QYW5lbEdyaWRcIik7XHJcbnZhciBQYW5lbFZpZGVvU3RhdGU7XHJcbihmdW5jdGlvbiAoUGFuZWxWaWRlb1N0YXRlKSB7XHJcbiAgICBQYW5lbFZpZGVvU3RhdGVbXCJOb0NhbWVyYVwiXSA9IFwibm8tY2FtZXJhXCI7XHJcbiAgICBQYW5lbFZpZGVvU3RhdGVbXCJTY3JlZW5TaGFyZVwiXSA9IFwic2NyZWVuXCI7XHJcbiAgICBQYW5lbFZpZGVvU3RhdGVbXCJDYW1lcmFcIl0gPSBcImNhbWVyYVwiO1xyXG4gICAgUGFuZWxWaWRlb1N0YXRlW1wiVmlkZW9TdHJlYW1pbmdcIl0gPSBcInN0cmVhbVwiO1xyXG59KShQYW5lbFZpZGVvU3RhdGUgfHwgKFBhbmVsVmlkZW9TdGF0ZSA9IHt9KSk7XHJcbnZhciBNZWV0aW5nVUkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBNZWV0aW5nVUkobWVldGluZykge1xyXG4gICAgICAgIHRoaXMubWVldGluZyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge1xyXG4gICAgICAgICAgICBoaWRlVG9vbGJhck9uTW91c2VPdXQ6IGZhbHNlLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5tZWV0aW5nID0gbWVldGluZztcclxuICAgICAgICAvL3Rvb2xiYXJcclxuICAgICAgICB2YXIgdFByb3BzID0gbmV3IFRvb2xCYXJfMS5Ub29sQmFyUHJvcHMoKTtcclxuICAgICAgICB0UHJvcHMudG9nZ2xlVGlsZVZpZXcgPSB0aGlzLnJlZHJhd0dyaWQuYmluZCh0aGlzKTtcclxuICAgICAgICB0UHJvcHMudG9nZ2xlVmlkZW9NdXRlID0gdGhpcy5tZWV0aW5nLk9uVG9nZ2xlTXV0ZU15VmlkZW8uYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHRQcm9wcy50b2dnbGVBdWRpb011dGUgPSB0aGlzLm1lZXRpbmcuT25Ub2dnbGVNdXRlTXlBdWRpby5iaW5kKHRoaXMubWVldGluZyk7XHJcbiAgICAgICAgdFByb3BzLm9wZW5DaGF0dGluZyA9IHRoaXMub3BlbkNoYXR0aW5nLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdFByb3BzLnRvZ2dsZVNjcmVlblNoYXJlID0gdGhpcy5tZWV0aW5nLnRvZ2dsZVNjcmVlblNoYXJlLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB0UHJvcHMudG9nZ2xlUmVjb3JkaW5nID0gdGhpcy5tZWV0aW5nLnRvZ2dsZVJlY29yZGluZy5iaW5kKHRoaXMubWVldGluZyk7XHJcbiAgICAgICAgdFByb3BzLnRvZ2dsZUhhbmRSYWlzZSA9IHRoaXMubWVldGluZy50b2dnbGVIYW5kUmFpc2UuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHRQcm9wcy50b2dnbGVNdXRlQWxsID0gdGhpcy5tZWV0aW5nLnRvZ2dsZU11dGVBbGwuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHRQcm9wcy50b2dnbGVNdXRlQWxsVmlkZW8gPSB0aGlzLm1lZXRpbmcudG9nZ2xlTXV0ZUFsbFZpZGVvLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB0UHJvcHMub3BlblNldHRpbmcgPSB0aGlzLnNob3dTZXR0aW5nRGlhbG9nLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdFByb3BzLmxlYXZlTWVldGluZyA9IHRoaXMubWVldGluZy5zdG9wLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB0aGlzLnRvb2xiYXIgPSBuZXcgVG9vbEJhcl8xLlRvb2xCYXIodFByb3BzKTtcclxuICAgICAgICAvL2NoYXR0aW5nXHJcbiAgICAgICAgdGhpcy5jaGF0dGluZ1dpZGdldCA9IG5ldyBDaGF0dGluZ1BhbmVsXzEuQ2hhdHRpbmdXaWRnZXQoKTtcclxuICAgICAgICB2YXIgcHJvcHMgPSBuZXcgQ2hhdHRpbmdQYW5lbF8xLkNoYXR0aW5nUGFuZWxQcm9wcygpO1xyXG4gICAgICAgIHByb3BzLm9wZW5DYWxsYmFjayA9IHRoaXMucmVkcmF3R3JpZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHByb3BzLnNlbmRDaGF0ID0gdGhpcy5tZWV0aW5nLnNlbmRDaGF0TWVzc2FnZS5iaW5kKHRoaXMubWVldGluZyk7XHJcbiAgICAgICAgcHJvcHMuc2VuZFByaXZhdGVDaGF0ID0gdGhpcy5tZWV0aW5nLnNlbmRQcml2YXRlQ2hhdE1lc3NhZ2UuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHByb3BzLnNlbmRGaWxlTWV0YSA9IHRoaXMubWVldGluZy5zZW5kRmlsZU1ldGEuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHByb3BzLnNlbmRGaWxlRGF0YSA9IHRoaXMubWVldGluZy5zZW5kRmlsZURhdGEuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHByb3BzLm9uRmlsZVNlbmRFcnJyb3IgPSB0aGlzLm9uRmlsZVNlbmRFcnJvci5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHByb3BzLm9uRmlsZVNlbmRGaW5pc2hlZCA9IHRoaXMub25GaWxlU2VuZEZpbmlzaGVkLmJpbmQodGhpcyk7XHJcbiAgICAgICAgcHJvcHMub25GaWxlUmVjZWl2ZUVycm9yID0gdGhpcy5vbkZpbGVSZWNlaXZlRXJyb3IuYmluZCh0aGlzKTtcclxuICAgICAgICBwcm9wcy5vbkZpbGVSZWNlaXZlRmluaXNoZWQgPSB0aGlzLm9uRmlsZVJlY2VpdmVGaW5pc2hlZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHByb3BzLnNob3dVbnJlYWRCYWRnZSA9IHRoaXMudG9vbGJhci5zaG93VW5yZWFkQmFkZ2UuYmluZCh0aGlzLnRvb2xiYXIpO1xyXG4gICAgICAgIHByb3BzLnNldFVucmVhZENvdW50ID0gdGhpcy50b29sYmFyLnNldFVucmVhZENvdW50LmJpbmQodGhpcy50b29sYmFyKTtcclxuICAgICAgICB0aGlzLmNoYXR0aW5nV2lkZ2V0LmluaXQocHJvcHMpO1xyXG4gICAgICAgIC8vbGlzdFxyXG4gICAgICAgIHRoaXMucGFydGljaXBhbnRzTGlzdFdpZGdldCA9IG5ldyBQYXJ0aWNpcGFudExpc3RQYW5lbF8xLlBhcnRpY2lwYW50TGlzdFdpZGdldCgpO1xyXG4gICAgICAgIHZhciBsUHJvcHMgPSBuZXcgUGFydGljaXBhbnRMaXN0UGFuZWxfMS5QYXJ0aWNpcGFudExpc3RQYW5lbFByb3BzKCk7XHJcbiAgICAgICAgbFByb3BzLm9uTXV0ZUNhbWVyYSA9IHRoaXMubWVldGluZy5tdXRlVXNlclZpZGVvLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICBsUHJvcHMub25NdXRlTWljID0gdGhpcy5tZWV0aW5nLm11dGVVc2VyQXVkaW8uYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIGxQcm9wcy50b2dnbGVDb3B5Sm9pbmluZ0luZm8gPSB0aGlzLm1lZXRpbmcudG9nZ2xlQ29weUpvaW5pbmdJbmZvLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQuaW5pdChsUHJvcHMpO1xyXG4gICAgICAgIC8vbWVldGluZyBkZXNjcmlwdGlvblxyXG4gICAgICAgIHRoaXMubWVldGluZ0Rlc2NXaWRnZXQgPSBuZXcgTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0XzEuTWVldGluZ0Rlc2NyaXB0aW9uV2lkZ2V0KCk7XHJcbiAgICAgICAgLy92aWRlbyBncmlkXHJcbiAgICAgICAgdmFyIHZQcm9wcyA9IG5ldyBWaWRlb1BhbmVsR3JpZF8xLlZpZGVvUGFuZWxHcmlkUHJvcHMoKTtcclxuICAgICAgICB2UHJvcHMuZ3JhbnRNb2RlcmF0b3JSb2xlID0gdGhpcy5tZWV0aW5nLmdyYW50TW9kZXJhdG9yUm9sZS5iaW5kKHRoaXMubWVldGluZyk7XHJcbiAgICAgICAgdlByb3BzLmtpY2tQYXJ0aWNpcGFudE91dCA9IHRoaXMubWVldGluZy5raWNrUGFydGljaXBhbnRPdXQuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHZQcm9wcy5zZW5kUmVtb3RlQ29udHJvbFJlcGx5ID0gdGhpcy5tZWV0aW5nLnNlbmRSZW1vdGVDb250cm9sUmVwbHkuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHZQcm9wcy5tdXRlTXlBdWRpbyA9IHRoaXMubWVldGluZy5tdXRlTXlBdWRpby5iaW5kKHRoaXMubWVldGluZyk7XHJcbiAgICAgICAgdlByb3BzLm11dGVNeVZpZGVvID0gdGhpcy5tZWV0aW5nLm11dGVNeVZpZGVvLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB2UHJvcHMubXV0ZVVzZXJBdWRpbyA9IHRoaXMubWVldGluZy5tdXRlVXNlckF1ZGlvLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB2UHJvcHMubXV0ZVVzZXJWaWRlbyA9IHRoaXMubWVldGluZy5tdXRlVXNlclZpZGVvLmJpbmQodGhpcy5tZWV0aW5nKTtcclxuICAgICAgICB2UHJvcHMub3BlblByaXZhdGVDaGF0ID0gdGhpcy5jaGF0dGluZ1dpZGdldC5vcGVuUHJpdmF0ZUNoYXQuYmluZCh0aGlzLmNoYXR0aW5nV2lkZ2V0KTtcclxuICAgICAgICB0aGlzLnZpZGVvUGFuZWxHcmlkID0gbmV3IFZpZGVvUGFuZWxHcmlkXzEuVmlkZW9QYW5lbEdyaWQodlByb3BzKTtcclxuICAgICAgICB0aGlzLmF0dGFjaEhhbmRsZXJzKCk7XHJcbiAgICB9XHJcbiAgICBNZWV0aW5nVUkucHJvdG90eXBlLmF0dGFjaEhhbmRsZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL2hvdmVyIGVmZmVjdFxyXG4gICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5oaWRlVG9vbGJhck9uTW91c2VPdXQpIHtcclxuICAgICAgICAgICAgICAgICQoXCIjY29udGVudFwiKS5ob3ZlcihmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnRvb2xiYXIuZmFkZUluKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubWVldGluZ0Rlc2NXaWRnZXQuZmFkZUluKCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoXykge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnRvb2xiYXIuZmFkZU91dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm1lZXRpbmdEZXNjV2lkZ2V0LmZhZGVPdXQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3VubG9hZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMubWVldGluZy5mb3JjZVN0b3AoKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBNZWV0aW5nVUkucHJvdG90eXBlLnVwZGF0ZUJ5Um9sZSA9IGZ1bmN0aW9uIChpc0hvc3QpIHtcclxuICAgICAgICB2YXIgaXNXZWJpbmFyID0gdGhpcy5tZWV0aW5nLnJvb21JbmZvLklzV2ViaW5hcjtcclxuICAgICAgICAvKmlmIChpc1dlYmluYXIgJiYgIWlzSG9zdClcclxuICAgICAgICAgICAgdGhpcy5zaG93UGFydGljaXBhbnRMaXN0QnV0dG9uKGZhbHNlKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1BhcnRpY2lwYW50TGlzdEJ1dHRvbih0cnVlKTsqL1xyXG4gICAgICAgIC8vdGhpcy5wYXJ0aWNpcGFudHNMaXN0V2lkZ2V0LnVwZGF0ZUJ5Um9sZShpc0hvc3QgJiYgdGhpcy5tZWV0aW5nLnJvb21JbmZvLklzQ29udHJvbEFsbG93ZWQpOyAvL2NvbW1lbnRlZCBieSBtYXR2ZXlcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQudXBkYXRlQnlSb2xlKGlzSG9zdCk7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS51cGRhdGVKb2luaW5nSW5mbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQudXBkYXRlSm9pbmluZ0luZm8oXCJodHRwczovL1wiICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyBcIi9sb2JieS9cIiArIHRoaXMubWVldGluZy5yb29tSW5mby5JZCk7XHJcbiAgICB9O1xyXG4gICAgLy9jaGF0dHRpbmdcclxuICAgIE1lZXRpbmdVSS5wcm90b3R5cGUub3BlbkNoYXR0aW5nID0gZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICBpZiAodGhpcy5jaGF0dGluZ1dpZGdldClcclxuICAgICAgICAgICAgdGhpcy5jaGF0dGluZ1dpZGdldC5vcGVuKG8pO1xyXG4gICAgfTtcclxuICAgIE1lZXRpbmdVSS5wcm90b3R5cGUucmVkcmF3R3JpZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy52aWRlb1BhbmVsR3JpZClcclxuICAgICAgICAgICAgdGhpcy52aWRlb1BhbmVsR3JpZC5yZWRyYXdHcmlkKCk7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS5zaG93U2V0dGluZ0RpYWxvZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc2V0dGluZ0RpYWxvZyA9IG5ldyBTZXR0aW5nRGlhbG9nXzEuU2V0dGluZ0RpYWxvZygpO1xyXG4gICAgICAgIHZhciBwcm9wcyA9IG5ldyBTZXR0aW5nRGlhbG9nXzEuU2V0dGluZ0RpYWxvZ1Byb3BzKCk7XHJcbiAgICAgICAgcHJvcHMuY3VyRGV2aWNlcyA9IHRoaXMubWVldGluZy5nZXRBY3RpdmVEZXZpY2VzKCk7XHJcbiAgICAgICAgcHJvcHMub25EZXZpY2VDaGFuZ2UgPSB0aGlzLm1lZXRpbmcub25EZXZpY2VDaGFuZ2UuYmluZCh0aGlzLm1lZXRpbmcpO1xyXG4gICAgICAgIHNldHRpbmdEaWFsb2cuaW5pdChwcm9wcyk7XHJcbiAgICAgICAgc2V0dGluZ0RpYWxvZy5zaG93KCk7XHJcbiAgICB9O1xyXG4gICAgLy9hZGQsIHJlbW92ZSBwYXJ0aWNpcGFudCB0byBhbmQgZnJvbSBsaXN0XHJcbiAgICBNZWV0aW5nVUkucHJvdG90eXBlLmFkZFBhcnRpY2lwYW50ID0gZnVuY3Rpb24gKGppdHNpSWQsIG5hbWUsIG1lLCBpc01pY0Rpc2FibGUsIGlzVmlkZW9EaXNhYmxlLCBtdXRlQ2FtZXJhLCBtdXRlTWljKSB7XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNpcGFudHNMaXN0V2lkZ2V0LmFkZFBhcnRpY2lwYW50KGppdHNpSWQsIG5hbWUsIG1lLCBpc01pY0Rpc2FibGUsIGlzVmlkZW9EaXNhYmxlLCBtdXRlQ2FtZXJhLCBtdXRlTWljKTtcclxuICAgIH07XHJcbiAgICBNZWV0aW5nVUkucHJvdG90eXBlLnJlbW92ZVBhcnRpY2lwYW50ID0gZnVuY3Rpb24gKGppdHNpSWQpIHtcclxuICAgICAgICB0aGlzLnBhcnRpY2lwYW50c0xpc3RXaWRnZXQucmVtb3ZlUGFydGljaXBhbnQoaml0c2lJZCk7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS5zaG93UGFydGljaXBhbnRMaXN0QnV0dG9uID0gZnVuY3Rpb24gKHNob3cpIHtcclxuICAgICAgICAkKFwiI29wZW4tcGFydGljaXBhbnRzLXRvZ2dsZVwiKS5jc3MoXCJ2aXNpYmlsaXR5XCIsIHNob3cgPyBcInZpc2libGVcIiA6IFwiaGlkZGVuXCIpO1xyXG4gICAgfTtcclxuICAgIC8vZmlsZSBzZW5kXHJcbiAgICBNZWV0aW5nVUkucHJvdG90eXBlLm9uRmlsZVNlbmRFcnJvciA9IGZ1bmN0aW9uIChmaWxlbmFtZSwgbWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uX3dhcm5pbmcoZmlsZW5hbWUsIG1lc3NhZ2UsIE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLkZpbGVUcmFuc2Zlcik7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS5vbkZpbGVTZW5kRmluaXNoZWQgPSBmdW5jdGlvbiAoZmlsZW5hbWUsIG1lc3NhZ2UpIHtcclxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbihmaWxlbmFtZSwgbWVzc2FnZSwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuRmlsZVRyYW5zZmVyKTtcclxuICAgIH07XHJcbiAgICAvL2ZpbGUgcmVjZWl2ZVxyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS5vbkZpbGVSZWNlaXZlRXJyb3IgPSBmdW5jdGlvbiAoZmlsZW5hbWUsIG1lc3NhZ2UpIHtcclxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbl93YXJuaW5nKGZpbGVuYW1lLCBtZXNzYWdlLCBOb3RpZmljYXRpb25UeXBlXzEuTm90aWZpY2F0aW9uVHlwZS5GaWxlUmVjZWl2ZSk7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS5vbkZpbGVSZWNlaXZlRmluaXNoZWQgPSBmdW5jdGlvbiAoZmlsZW5hbWUsIG1lc3NhZ2UpIHtcclxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbihmaWxlbmFtZSwgbWVzc2FnZSwgTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuRmlsZVJlY2VpdmUpO1xyXG4gICAgfTtcclxuICAgIE1lZXRpbmdVSS5wcm90b3R5cGUuTG9nID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgICAgaWYgKCQoXCIjbG9nUGFuZWxcIikubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgdmFyIGxvZ1BhbmVsID0gXCI8ZGl2IGlkPVxcXCJsb2dQYW5lbFxcXCIgc3R5bGU9XFxcInBvc2l0aW9uOiBmaXhlZDt3aWR0aDogMzAwcHg7aGVpZ2h0OiAxMDBweDtiYWNrZ3JvdW5kOiBibGFjazt0b3A6MHB4O2xlZnQ6IDBweDtcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDEwMDAwMDtib3JkZXItcmlnaHQ6IDFweCBkYXNoZWQgcmViZWNjYXB1cnBsZTtib3JkZXItYm90dG9tOiAxcHggZGFzaGVkIHJlYmVjY2FwdXJwbGU7b3ZlcmZsb3cteTphdXRvO1xcXCI+PC9kaXY+XCI7XHJcbiAgICAgICAgICAgICQoXCJib2R5XCIpLmFwcGVuZChsb2dQYW5lbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjb2xvcnMgPSBbJ2JsYW5jaGVkYWxtb25kJywgJ2hvdHBpbmsnLCAnY2hhcnRyZXVzZScsICdjb3JhbCcsICdnb2xkJywgJ2dyZWVueWVsbG93JywgJ3Zpb2xldCcsICd3aGVhdCddO1xyXG4gICAgICAgIHZhciBjb2xvciA9IGNvbG9yc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICUgY29sb3JzLmxlbmd0aF07XHJcbiAgICAgICAgdmFyIG1lc3NhZ2VJdG0gPSBcIjxkaXYgc3R5bGU9XFxcImNvbG9yOlwiICsgY29sb3IgKyBcIjtcXFwiPjxzcGFuPlwiICsgbWVzc2FnZSArIFwiPC9zcGFuPjwvZGl2PlwiO1xyXG4gICAgICAgICQoXCIjbG9nUGFuZWxcIikuYXBwZW5kKG1lc3NhZ2VJdG0pO1xyXG4gICAgICAgICQoJyNsb2dQYW5lbCcpLnNjcm9sbCgpO1xyXG4gICAgICAgICQoXCIjbG9nUGFuZWxcIikuYW5pbWF0ZSh7XHJcbiAgICAgICAgICAgIHNjcm9sbFRvcDogMjAwMDBcclxuICAgICAgICB9LCAyMDApO1xyXG4gICAgfTtcclxuICAgIE1lZXRpbmdVSS5wcm90b3R5cGUuYXNrRGlhbG9nID0gZnVuY3Rpb24gKHRpdGxlLCBtZXNzYWdlLCBpY29uLCBhbGxvd0NhbGxiYWNrLCBkZW55Q2FsbGJhY2ssIHBhcmFtKSB7XHJcbiAgICAgICAgdmFyIHByb3BzID0gbmV3IEFza0RpYWxvZ18xLkFza0RpYWxvZ1Byb3BzKCk7XHJcbiAgICAgICAgcHJvcHMudGl0bGUgPSB0aXRsZTtcclxuICAgICAgICBwcm9wcy5tZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgICBwcm9wcy5pY29uID0gaWNvbjtcclxuICAgICAgICBwcm9wcy5pc1dhcm5pbmcgPSB0cnVlO1xyXG4gICAgICAgIHByb3BzLmFsbG93Q2FsbGJhY2sgPSBhbGxvd0NhbGxiYWNrO1xyXG4gICAgICAgIHByb3BzLmRlbnlDYWxsYmFjayA9IGRlbnlDYWxsYmFjaztcclxuICAgICAgICBwcm9wcy5wYXJhbSA9IHBhcmFtO1xyXG4gICAgICAgIHZhciBkbGcgPSBuZXcgQXNrRGlhbG9nXzEuQXNrRGlhbG9nKHByb3BzKTtcclxuICAgICAgICBkbGcuc2hvdygpO1xyXG4gICAgfTtcclxuICAgIE1lZXRpbmdVSS5wcm90b3R5cGUubm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKHRpdGxlLCBtZXNzYWdlLCBpY29uKSB7XHJcbiAgICAgICAgaWYgKCFpY29uKVxyXG4gICAgICAgICAgICBpY29uID0gTm90aWZpY2F0aW9uVHlwZV8xLk5vdGlmaWNhdGlvblR5cGUuSW5mbztcclxuICAgICAgICAkLnRvYXN0KHtcclxuICAgICAgICAgICAgaGVhZGluZzogdGl0bGUsXHJcbiAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJ3NsaWRlJyxcclxuICAgICAgICAgICAgaGlkZUFmdGVyOiA3MDAwLFxyXG4gICAgICAgICAgICBiZ0NvbG9yOiBcIiMxNjQxNTdcIixcclxuICAgICAgICAgICAgaWNvbjogaWNvbixcclxuICAgICAgICAgICAgc3RhY2s6IDUsXHJcbiAgICAgICAgICAgIGxvYWRlcjogZmFsc2UsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgTWVldGluZ1VJLnByb3RvdHlwZS5ub3RpZmljYXRpb25fd2FybmluZyA9IGZ1bmN0aW9uICh0aXRsZSwgbWVzc2FnZSwgaWNvbikge1xyXG4gICAgICAgIGlmICghaWNvbilcclxuICAgICAgICAgICAgaWNvbiA9IE5vdGlmaWNhdGlvblR5cGVfMS5Ob3RpZmljYXRpb25UeXBlLldhcm5pbmc7XHJcbiAgICAgICAgJC50b2FzdCh7XHJcbiAgICAgICAgICAgIGhlYWRpbmc6IHRpdGxlLFxyXG4gICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxyXG4gICAgICAgICAgICBzaG93SGlkZVRyYW5zaXRpb246ICdzbGlkZScsXHJcbiAgICAgICAgICAgIGhpZGVBZnRlcjogNzAwMCxcclxuICAgICAgICAgICAgYmdDb2xvcjogXCIjODAwMDAwXCIsXHJcbiAgICAgICAgICAgIGljb246IGljb24sXHJcbiAgICAgICAgICAgIHN0YWNrOiA1LFxyXG4gICAgICAgICAgICBsb2FkZXI6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE1lZXRpbmdVSTtcclxufSgpKTtcclxuZXhwb3J0cy5NZWV0aW5nVUkgPSBNZWV0aW5nVUk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1lZXRpbmdfdWkuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL21lZXRpbmdfdWkuanNcIixcIi9cIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkFjdGl2ZURldmljZXMgPSB2b2lkIDA7XHJcbnZhciBBY3RpdmVEZXZpY2VzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQWN0aXZlRGV2aWNlcygpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBBY3RpdmVEZXZpY2VzO1xyXG59KCkpO1xyXG5leHBvcnRzLkFjdGl2ZURldmljZXMgPSBBY3RpdmVEZXZpY2VzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BY3RpdmVEZXZpY2VzLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi9tb2RlbFxcXFxBY3RpdmVEZXZpY2VzLmpzXCIsXCIvbW9kZWxcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkJHTWVldGluZ0luZm8gPSBleHBvcnRzLkJHTWVldGluZyA9IGV4cG9ydHMuQkdNZWV0aW5nUGFydGljaXBhbnQgPSB2b2lkIDA7XHJcbi8qXHJcbmNhbGxiYWNrVXJsOiBcImh0dHA6Ly9cIlxyXG5jb25mZXJlbmNlSWQ6IDEyMzRcclxuY29uZmVyZW5jZU5hbWU6IFwiQnVpbGRpbmcgQSBCaXRjb2luIENyeXB0byBhcHBsaWNhdGlvbiBcIlxyXG5pc0NvbnRyb2xBbGxvd2VkOiB0cnVlIHwgZmFsc2UgICAgICAgICAgICAgIC8vIEhvc3QgY2FuIGNvbnRyb2wgQXVkaW8gYW5kIFZpZGVvIG9mIFBhcnRpY2lwYW50c1xyXG5pc1JlY29yZGluZ1JlcXVpcmVkOiB0cnVlIHwgZmFsc2UgICAgICAgICAgIC8vIEFwcHJvdmFsIHJlcXVpcmVkIGZvciByZWNvcmRpbmcgdGhlIG1lZXRpbmdcclxuaXNNdWx0aXBsZVNoYXJpbmdBbGxvd2VkOiB0cnVlIHwgZmFsc2UgICAgICAvLyBBbGxvdyBtdWx0aXBsZSBwYXJ0aWNpcGFudHMgdG8gc2NyZWVuIHNoYXJlXHJcbmlzU2NyZWVuU2hhcmVSZXF1aXJlZDogdHJ1ZSB8IGZhbHNlICAgICAgICAgLy8gQXBwcm92YWwgcmVxdWlyZWQgdG8gcHJlc2VudC9zaGFyZSB0aGUgc2NyZWVuXHJcbmlzT3BlbmVkOiB0cnVlIHwgZmFsc2UgICAgICAgICAgICAgICAgICAgICAgLy8gQWxsb3cgZXh0ZXJuYWwgdXNlcnMgdG8gam9pbiBtZWV0aW5nIHVzaW5nIGxpbmtcclxuY2hhbm5lbFR5cGUgOiA6IFwiQm90aCB8ICBBdWRpb09ubHkgfCBWaWRlb09ubHlcIlxyXG5kZXNjcmlwdGlvbjogXCJjIyBhcHBsaWNhdGlvbiB0aGF0IHdvcmtzIG9uIGRvdG5ldCBmcmFtZXdvcmssIGFuZCBib3VuY3kgY2FzdGxlIGNyeXB0byBsaWJyYXJpZXNcIlxyXG5kdXJhdGlvbjogXCIyMDIxLTA1LTE4VDA5OjE5OjU3LjY1NFpcIlxyXG5lbmREYXRlVGltZTogXCIyMDIxLTA1LTE4VDA5OjE5OjU3LjY1NFpcIlxyXG5wYXJ0aWNpcGFudHM6ICgyKSBbe+KApn0sIHvigKZ9XVxyXG5yZWZHdWlkOiBcIjMwMjUxMDAzXCJcclxuc3RhcnREYXRlVGltZTogXCIyMDIxLTA1LTE4VDA5OjE5OjU3LjY1NFpcIlxyXG4qL1xyXG4vL3NyYy9EYk1vZGVscy9QYXJ0aWNpcGFudHMuY3NcclxudmFyIEJHTWVldGluZ1BhcnRpY2lwYW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQkdNZWV0aW5nUGFydGljaXBhbnQoKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQkdNZWV0aW5nUGFydGljaXBhbnQ7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQkdNZWV0aW5nUGFydGljaXBhbnQgPSBCR01lZXRpbmdQYXJ0aWNpcGFudDtcclxuLy9zcmMvRGJNb2RlbHMvTWVldGluZy5jc1xyXG4vL2NvbWVzIGZyb20gYXBpXHJcbnZhciBCR01lZXRpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCR01lZXRpbmcoKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQkdNZWV0aW5nO1xyXG59KCkpO1xyXG5leHBvcnRzLkJHTWVldGluZyA9IEJHTWVldGluZztcclxuLy9zcmMvTW9kZWwvTGl2ZU1lZXRpbmcuY3MvTWVldGluZ0luZm9cclxuLy9jb21lcyBmcm9tIEJHTWVldGluZyBTaWduYWxSIFNlcnZlclxyXG52YXIgQkdNZWV0aW5nSW5mbyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJHTWVldGluZ0luZm8oKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQkdNZWV0aW5nSW5mbztcclxufSgpKTtcclxuZXhwb3J0cy5CR01lZXRpbmdJbmZvID0gQkdNZWV0aW5nSW5mbztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QkdNZWV0aW5nLmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi9tb2RlbFxcXFxCR01lZXRpbmcuanNcIixcIi9tb2RlbFwiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuVXNlckluZm8gPSB2b2lkIDA7XHJcbnZhciBVc2VySW5mbyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFVzZXJJbmZvKCkge1xyXG4gICAgICAgIHRoaXMuSWQgPSBcIlwiOyAvL2Nvbm5lY3Rpb25JZFxyXG4gICAgICAgIC8vQkdfSWQ6IHN0cmluZztcclxuICAgICAgICB0aGlzLkppdHNpX0lkID0gXCJcIjtcclxuICAgICAgICB0aGlzLk5hbWUgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuSXNIb3N0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5Jc0Fub255bW91cyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubWVkaWFQb2xpY3kgPSB7IHVzZUNhbWVyYTogZmFsc2UsIHVzZU1pYzogZmFsc2UgfTtcclxuICAgIH1cclxuICAgIHJldHVybiBVc2VySW5mbztcclxufSgpKTtcclxuZXhwb3J0cy5Vc2VySW5mbyA9IFVzZXJJbmZvO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1CR1VzZXIuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL21vZGVsXFxcXEJHVXNlci5qc1wiLFwiL21vZGVsXCIpIiwiKGZ1bmN0aW9uIChwcm9jZXNzLGdsb2JhbCxCdWZmZXIsX19hcmd1bWVudDAsX19hcmd1bWVudDEsX19hcmd1bWVudDIsX19hcmd1bWVudDMsX19maWxlbmFtZSxfX2Rpcm5hbWUpe1xuXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5JbnB1dE1lZGlhUG9saWN5ID0gdm9pZCAwO1xyXG52YXIgSW5wdXRNZWRpYVBvbGljeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIElucHV0TWVkaWFQb2xpY3koKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gSW5wdXRNZWRpYVBvbGljeTtcclxufSgpKTtcclxuZXhwb3J0cy5JbnB1dE1lZGlhUG9saWN5ID0gSW5wdXRNZWRpYVBvbGljeTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SW5wdXREZXZpY2VQb2xpY3kuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL21vZGVsXFxcXElucHV0RGV2aWNlUG9saWN5LmpzXCIsXCIvbW9kZWxcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlVzZXJUb1VzZXJWaWFCRyA9IGV4cG9ydHMuVXNlclRvQkcgPSBleHBvcnRzLkJHdG9Vc2VyID0gdm9pZCAwO1xyXG4vKipcclxuICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICpcclxuICogICAgICAgICAgICAgIHNob3VsZCBtYXRjaCB3aXRoIC9zcmMvU2VydmVyL1Byb3RvY29sL0JHdG9Vc2VyXHJcbiAqXHJcbiAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAqL1xyXG52YXIgQkd0b1VzZXI7XHJcbihmdW5jdGlvbiAoQkd0b1VzZXIpIHtcclxuICAgIEJHdG9Vc2VyW1wiUk9PTV9DUkVBVEVEXCJdID0gXCJjcmVhdGVkXCI7XHJcbiAgICBCR3RvVXNlcltcIlJPT01fSU5GT1wiXSA9IFwicm9vbV9pbmZvXCI7XHJcbiAgICBCR3RvVXNlcltcIlJPT01fSk9JTkVEXCJdID0gXCJqb2luZWRcIjtcclxuICAgIEJHdG9Vc2VyW1wiUk9PTV9VU0VSX0pPSU5FRFwiXSA9IFwidXNlcl9qb2luZWRcIjtcclxuICAgIEJHdG9Vc2VyW1wiUk9PTV9MRUZUXCJdID0gXCJsZWZ0XCI7XHJcbiAgICBCR3RvVXNlcltcIkVSUk9SXCJdID0gXCJlcnJvclwiO1xyXG4gICAgQkd0b1VzZXJbXCJTSUdOQUxJTkdcIl0gPSBcIlNpZ25hbGluZ01lc3NhZ2VcIjtcclxufSkoQkd0b1VzZXIgPSBleHBvcnRzLkJHdG9Vc2VyIHx8IChleHBvcnRzLkJHdG9Vc2VyID0ge30pKTtcclxuO1xyXG4vKipcclxuICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICpcclxuICogICAgICAgICAgICAgIHNob3VsZCBtYXRjaCB3aXRoIC9zcmMvU2VydmVyL1Byb3RvY29sL1VzZXJUb0JHXHJcbiAqXHJcbiAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAqL1xyXG52YXIgVXNlclRvQkc7XHJcbihmdW5jdGlvbiAoVXNlclRvQkcpIHtcclxufSkoVXNlclRvQkcgPSBleHBvcnRzLlVzZXJUb0JHIHx8IChleHBvcnRzLlVzZXJUb0JHID0ge30pKTtcclxudmFyIFVzZXJUb1VzZXJWaWFCRztcclxuKGZ1bmN0aW9uIChVc2VyVG9Vc2VyVmlhQkcpIHtcclxufSkoVXNlclRvVXNlclZpYUJHID0gZXhwb3J0cy5Vc2VyVG9Vc2VyVmlhQkcgfHwgKGV4cG9ydHMuVXNlclRvVXNlclZpYUJHID0ge30pKTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YmcuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL3Byb3RvY29sXFxcXGJnLmpzXCIsXCIvcHJvdG9jb2xcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuLyogU0hPVUxEIG5vdCBleGlzdCBzYW1lIHZhbHVlIGluIHR3byBlbnVtc1xyXG4gKi9cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkppdHNpUHJpdmF0ZUNvbW1hbmQgPSBleHBvcnRzLkppdHNpQ29tbWFuZCA9IHZvaWQgMDtcclxudmFyIEppdHNpQ29tbWFuZDtcclxuKGZ1bmN0aW9uIChKaXRzaUNvbW1hbmQpIHtcclxuICAgIEppdHNpQ29tbWFuZFtcIkdSQU5UX0hPU1RfUk9MRVwiXSA9IFwiZ3JhbnQtaG9zdFwiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiTVVURV9BVURJT1wiXSA9IFwibXV0ZV9hdWRpb1wiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiTVVURV9WSURFT1wiXSA9IFwibXV0ZV92aWRlb1wiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiQUxMT1dfQ0FNRVJBXCJdID0gXCJhbGxvd192aWRlb1wiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiQUxMT1dfTUlDXCJdID0gXCJhbGxvd19hdWRpb1wiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiSU5JVF9NRURJQV9QT0xJQ1lcIl0gPSBcImluaXRfbWVkaWFfcG9saWN5XCI7XHJcbiAgICBKaXRzaUNvbW1hbmRbXCJBU0tfUkVDT1JESU5HXCJdID0gXCJhc2stcmVjb3JkaW5nXCI7XHJcbiAgICBKaXRzaUNvbW1hbmRbXCJBU0tfU0NSRUVOU0hBUkVcIl0gPSBcImFzay1zY3JlZW5zaGFyZVwiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiQVNLX01VTFRJU0hBUkVcIl0gPSBcImFzay1tdWx0aXNoYXJlXCI7XHJcbiAgICBKaXRzaUNvbW1hbmRbXCJBU0tfSEFORFJBSVNFXCJdID0gXCJhc2staGFuZHJhaXNlXCI7XHJcbiAgICBKaXRzaUNvbW1hbmRbXCJGSUxFX01FVEFcIl0gPSBcImZpbGVfbWV0YVwiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiRklMRV9TTElDRVwiXSA9IFwiZmlsZV9zbGljZVwiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiQklaX0lEXCJdID0gXCJiaXpfaWRcIjtcclxuICAgIEppdHNpQ29tbWFuZFtcIktJQ0tfT1VUXCJdID0gXCJraWNrX291dFwiO1xyXG4gICAgSml0c2lDb21tYW5kW1wiTVVURV9BbGxfQVVESU9cIl0gPSBcIm11dGVfYWxsX2F1ZGlvXCI7XHJcbiAgICBKaXRzaUNvbW1hbmRbXCJNVVRFX0FsbF9WSURFT1wiXSA9IFwibXV0ZV9hbGxfdmlkZW9cIjtcclxufSkoSml0c2lDb21tYW5kID0gZXhwb3J0cy5KaXRzaUNvbW1hbmQgfHwgKGV4cG9ydHMuSml0c2lDb21tYW5kID0ge30pKTtcclxuO1xyXG52YXIgSml0c2lQcml2YXRlQ29tbWFuZDtcclxuKGZ1bmN0aW9uIChKaXRzaVByaXZhdGVDb21tYW5kKSB7XHJcbiAgICBKaXRzaVByaXZhdGVDb21tYW5kW1wiTUVESUFfUE9MSUNZXCJdID0gXCJtZWRpYV9wb2xpY3lcIjtcclxuICAgIEppdHNpUHJpdmF0ZUNvbW1hbmRbXCJBTExPV19SRUNPUkRJTkdcIl0gPSBcImFsbG93X3JlY29yZGluZ1wiO1xyXG4gICAgSml0c2lQcml2YXRlQ29tbWFuZFtcIkFMTE9XX1NDUkVFTlNIQVJFXCJdID0gXCJhbGxvd19zY3JlZW5zaGFyZVwiO1xyXG4gICAgSml0c2lQcml2YXRlQ29tbWFuZFtcIkFMTE9XX0hBTkRSQUlTRVwiXSA9IFwiYWxsb3dfaGFuZHJhaXNlXCI7XHJcbiAgICBKaXRzaVByaXZhdGVDb21tYW5kW1wiUFJJVkFURV9DQUhUXCJdID0gXCJwcml2YXRlX2NoYXRcIjtcclxufSkoSml0c2lQcml2YXRlQ29tbWFuZCA9IGV4cG9ydHMuSml0c2lQcml2YXRlQ29tbWFuZCB8fCAoZXhwb3J0cy5KaXRzaVByaXZhdGVDb21tYW5kID0ge30pKTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aml0c2kuanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL3Byb3RvY29sXFxcXGppdHNpLmpzXCIsXCIvcHJvdG9jb2xcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLmdldEN1cnJlbnRUaW1lc3RhbXAgPSBleHBvcnRzLmdldEN1clRpbWUgPSBleHBvcnRzLlRzVG9EYXRlRm9ybWF0ID0gdm9pZCAwO1xyXG5mdW5jdGlvbiBUc1RvRGF0ZUZvcm1hdCh0c0luTWlsbGlzZWNvbmQpIHtcclxuICAgIHZhciBzZWMgPSBNYXRoLmZsb29yKHRzSW5NaWxsaXNlY29uZCAvIDEwMDApO1xyXG4gICAgLy8gSG91cnMgcGFydCBmcm9tIHRoZSB0aW1lc3RhbXBcclxuICAgIHZhciBob3VycyA9IE1hdGguZmxvb3Ioc2VjIC8gMzYwMCk7XHJcbiAgICAvLyBNaW51dGVzIHBhcnQgZnJvbSB0aGUgdGltZXN0YW1wXHJcbiAgICB2YXIgbWludXRlcyA9IFwiMFwiICsgKE1hdGguZmxvb3Ioc2VjIC8gNjApIC0gKGhvdXJzICogNjApKTtcclxuICAgIC8vIFNlY29uZHMgcGFydCBmcm9tIHRoZSB0aW1lc3RhbXBcclxuICAgIHZhciBzZWNvbmRzID0gXCIwXCIgKyAoc2VjICUgNjApO1xyXG4gICAgLy8gV2lsbCBkaXNwbGF5IHRpbWUgaW4gMTA6MzA6MjMgZm9ybWF0XHJcbiAgICB2YXIgZm9ybWF0dGVkVGltZSA9IChcIjBcIiArIGhvdXJzKS5zdWJzdHIoLTIpICsgJzonICsgbWludXRlcy5zdWJzdHIoLTIpICsgJzonICsgc2Vjb25kcy5zdWJzdHIoLTIpO1xyXG4gICAgcmV0dXJuIGZvcm1hdHRlZFRpbWU7XHJcbn1cclxuZXhwb3J0cy5Uc1RvRGF0ZUZvcm1hdCA9IFRzVG9EYXRlRm9ybWF0O1xyXG5mdW5jdGlvbiBnZXRDdXJUaW1lKCkge1xyXG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgdmFyIGggPSBkYXRlLmdldEhvdXJzKCk7XHJcbiAgICB2YXIgbSA9IGRhdGUuZ2V0TWludXRlcygpO1xyXG4gICAgdmFyIG1fMiA9IChcIjBcIiArIG0pLnNsaWNlKC0yKTtcclxuICAgIHZhciBoXzIgPSAoXCIwXCIgKyBoKS5zbGljZSgtMik7XHJcbiAgICB2YXIgdGltZSA9IGhfMiArIFwiOlwiICsgbV8yO1xyXG4gICAgcmV0dXJuIHRpbWU7XHJcbn1cclxuZXhwb3J0cy5nZXRDdXJUaW1lID0gZ2V0Q3VyVGltZTtcclxuZnVuY3Rpb24gZ2V0Q3VycmVudFRpbWVzdGFtcCgpIHtcclxuICAgIHZhciBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICB2YXIgdGltZXN0YW1wID0gY3VycmVudERhdGUuZ2V0VGltZSgpO1xyXG4gICAgcmV0dXJuIHRpbWVzdGFtcDtcclxufVxyXG5leHBvcnRzLmdldEN1cnJlbnRUaW1lc3RhbXAgPSBnZXRDdXJyZW50VGltZXN0YW1wO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1UaW1lVXRpbC5qcy5tYXBcbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiZS9VKzk3XCIpLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSxyZXF1aXJlKFwiYnVmZmVyXCIpLkJ1ZmZlcixhcmd1bWVudHNbM10sYXJndW1lbnRzWzRdLGFyZ3VtZW50c1s1XSxhcmd1bWVudHNbNl0sXCIvdXRpbFxcXFxUaW1lVXRpbC5qc1wiLFwiL3V0aWxcIikiLCIoZnVuY3Rpb24gKHByb2Nlc3MsZ2xvYmFsLEJ1ZmZlcixfX2FyZ3VtZW50MCxfX2FyZ3VtZW50MSxfX2FyZ3VtZW50MixfX2FyZ3VtZW50MyxfX2ZpbGVuYW1lLF9fZGlybmFtZSl7XG5cInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLnJhbmRvbVNlc3NvbklkID0gZXhwb3J0cy5yYW5kb21OdW1iZXIgPSB2b2lkIDA7XHJcbnZhciBUaW1lVXRpbF8xID0gcmVxdWlyZShcIi4vVGltZVV0aWxcIik7XHJcbmZ1bmN0aW9uIHJhbmRvbU51bWJlcigpIHtcclxuICAgIHJldHVybiByYW5kb21Gcm9tSW50ZXJ2YWwoMSwgMTAwMDAwMDAwKTtcclxufVxyXG5leHBvcnRzLnJhbmRvbU51bWJlciA9IHJhbmRvbU51bWJlcjtcclxuZnVuY3Rpb24gcmFuZG9tU2Vzc29uSWQoKSB7XHJcbiAgICByZXR1cm4gVGltZVV0aWxfMS5nZXRDdXJyZW50VGltZXN0YW1wKCkgKyBcIi1cIiArIHJhbmRvbU51bWJlcigpO1xyXG59XHJcbmV4cG9ydHMucmFuZG9tU2Vzc29uSWQgPSByYW5kb21TZXNzb25JZDtcclxuZnVuY3Rpb24gcmFuZG9tRnJvbUludGVydmFsKGZyb20sIHRvKSB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRvIC0gZnJvbSArIDEpICsgZnJvbSk7XHJcbn1cclxuLyppbnRlcmZhY2UgUHJvdmlkZUZlZWRiYWNrRm9ybVByb3BzIHtcclxuICAgIGZlZWRiYWNrTmF0dXJlOiBGb3JtaWtEcm9wZG93blByb3BzXHJcbiAgICB3YXliaWxsTnVtYmVyOiBGb3JtaWtEcm9wZG93blByb3BzXHJcbiAgICBwcm92aWRlRmVlZGJhY2s6IEZvcm1pa0Ryb3Bkb3duUHJvcHNcclxuICAgIGVkaXRvclN0YXRlPzogc3RyaW5nXHJcbiAgICBhdHRhY2htZW50cz86IHN0cmluZ1tdXHJcbn1cclxuXHJcblxyXG5pbnRlcmZhY2UgRm9ybWlrRHJvcGRvd25Qcm9wcyB7XHJcbiAgICBpZDogbnVtYmVyXHJcbiAgICB2YWx1ZTogc3RyaW5nXHJcbn1cclxuXHJcbmNvbnN0IHZhbHVlczogUHJvdmlkZUZlZWRiYWNrRm9ybVByb3BzID0ge307XHJcbmNvbnN0IGN1c3RvbUZpZWxkczogc3RyaW5nW10gPSBbXTtcclxuXHJcbmZvciAoY29uc3QgcHJvcGVydHkgaW4gdmFsdWVzKSB7XHJcbiAgICBjb25zdCBjdXN0b21GaWVsZCA9IHZhbHVlc1twcm9wZXJ0eSBhcyBrZXlvZiBQcm92aWRlRmVlZGJhY2tGb3JtUHJvcHNdXHJcbiAgICBjdXN0b21GaWVsZHMucHVzaChjdXN0b21GaWVsZClcclxufSovIFxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1yYW5kb20uanMubWFwXG59KS5jYWxsKHRoaXMscmVxdWlyZShcImUvVSs5N1wiKSx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30scmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsYXJndW1lbnRzWzNdLGFyZ3VtZW50c1s0XSxhcmd1bWVudHNbNV0sYXJndW1lbnRzWzZdLFwiL3V0aWxcXFxccmFuZG9tLmpzXCIsXCIvdXRpbFwiKSIsIihmdW5jdGlvbiAocHJvY2VzcyxnbG9iYWwsQnVmZmVyLF9fYXJndW1lbnQwLF9fYXJndW1lbnQxLF9fYXJndW1lbnQyLF9fYXJndW1lbnQzLF9fZmlsZW5hbWUsX19kaXJuYW1lKXtcblwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuZ2V0Q2FwYWNpdHlMYWJlbCA9IGV4cG9ydHMucmFuZG9tID0gZXhwb3J0cy5hdmF0YXJOYW1lID0gZXhwb3J0cy5zdHJpcEhUTUxUYWdzID0gdm9pZCAwO1xyXG5mdW5jdGlvbiBzdHJpcEhUTUxUYWdzKHRleHQpIHtcclxuICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoLyg8KFtePl0rKT4pL2dpLCBcIlwiKTtcclxufVxyXG5leHBvcnRzLnN0cmlwSFRNTFRhZ3MgPSBzdHJpcEhUTUxUYWdzO1xyXG4vKlxyXG4gYWpheCBleGFtcGxlXHJcbiAkLmFqYXgoe1xyXG4gICAgICAgIHVybDogXCJodHRwOi8vbG9jYWxob3N0L215cHJvamVjdC9hamF4X3VybFwiLFxyXG4gICAgICAgIHR5cGU6IFwiUE9TVFwiLFxyXG4gICAgICAgIGRhdGE6ICQoXCIjbXktZm9ybVwiKS5zZXJpYWxpemUoKSxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLCAvLyBsb3dlcmNhc2UgaXMgYWx3YXlzIHByZWZlcmVyZWQgdGhvdWdoIGpRdWVyeSBkb2VzIGl0LCB0b28uXHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKXt9XHJcbn0pO1xyXG4gXHJcbiBcclxuICovXHJcbmZ1bmN0aW9uIGF2YXRhck5hbWUobmFtZSkge1xyXG4gICAgdmFyIHVua25vd24gPSBcIj9cIjtcclxuICAgIGlmICghbmFtZSB8fCBuYW1lLmxlbmd0aCA8PSAwKVxyXG4gICAgICAgIHJldHVybiB1bmtub3duO1xyXG4gICAgdmFyIG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoXCIgXCIpO1xyXG4gICAgdmFyIHJlcyA9IFwiXCI7XHJcbiAgICBuYW1lUGFydHMuZm9yRWFjaChmdW5jdGlvbiAocCkge1xyXG4gICAgICAgIGlmIChwLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHJlcyArPSBwWzBdO1xyXG4gICAgfSk7XHJcbiAgICBpZiAocmVzLmxlbmd0aCA8PSAwKVxyXG4gICAgICAgIHVua25vd247XHJcbiAgICByZXR1cm4gcmVzLnRvVXBwZXJDYXNlKCkuc3Vic3RyKDAsIDIpO1xyXG59XHJcbmV4cG9ydHMuYXZhdGFyTmFtZSA9IGF2YXRhck5hbWU7XHJcbnZhciByYW5kb20gPSBmdW5jdGlvbiAobWluLCBtYXgpIHsgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pKSArIG1pbjsgfTtcclxuZXhwb3J0cy5yYW5kb20gPSByYW5kb207XHJcbmZ1bmN0aW9uIGdldENhcGFjaXR5TGFiZWwoYnl0ZXMpIHtcclxuICAgIGlmIChieXRlcyA8IDEwMjQpXHJcbiAgICAgICAgcmV0dXJuIGJ5dGVzICsgXCIgYnl0ZXNcIjtcclxuICAgIGVsc2UgaWYgKGJ5dGVzIDwgMTAyNCAqIDEwMjQpIHtcclxuICAgICAgICB2YXIga2IgPSBieXRlcyAvIDEwMjQ7XHJcbiAgICAgICAgcmV0dXJuIGtiLnRvRml4ZWQoMikgKyBcIiBLQlwiO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIG1iID0gYnl0ZXMgLyAoMTAyNCAqIDEwMjQpO1xyXG4gICAgICAgIHJldHVybiBtYi50b0ZpeGVkKDIpICsgXCIgTUJcIjtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLmdldENhcGFjaXR5TGFiZWwgPSBnZXRDYXBhY2l0eUxhYmVsO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zbmlwcGV0LmpzLm1hcFxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCJlL1UrOTdcIiksdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiA/IHdpbmRvdyA6IHt9LHJlcXVpcmUoXCJidWZmZXJcIikuQnVmZmVyLGFyZ3VtZW50c1szXSxhcmd1bWVudHNbNF0sYXJndW1lbnRzWzVdLGFyZ3VtZW50c1s2XSxcIi91dGlsXFxcXHNuaXBwZXQuanNcIixcIi91dGlsXCIpIl19
